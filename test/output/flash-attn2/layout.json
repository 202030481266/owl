{
    "pdf_info": [
        {
            "preproc_blocks": [
                {
                    "type": "title",
                    "bbox": [
                        79,
                        109,
                        533,
                        150
                    ],
                    "lines": [
                        {
                            "bbox": [
                                227,
                                111,
                                387,
                                126
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        227,
                                        111,
                                        387,
                                        126
                                    ],
                                    "score": 1.0,
                                    "content": "FlashAttention-2:",
                                    "type": "text"
                                }
                            ],
                            "index": 0
                        },
                        {
                            "bbox": [
                                78,
                                129,
                                534,
                                151
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        78,
                                        129,
                                        534,
                                        151
                                    ],
                                    "score": 1.0,
                                    "content": "Faster Attention with Better Parallelism and Work Partitioning",
                                    "type": "text"
                                }
                            ],
                            "index": 1
                        }
                    ],
                    "index": 0.5
                },
                {
                    "type": "text",
                    "bbox": [
                        280,
                        162,
                        332,
                        177
                    ],
                    "lines": [
                        {
                            "bbox": [
                                278,
                                163,
                                333,
                                177
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        278,
                                        163,
                                        333,
                                        177
                                    ],
                                    "score": 1.0,
                                    "content": "Tri Dao1,2",
                                    "type": "text"
                                }
                            ],
                            "index": 2
                        }
                    ],
                    "index": 2
                },
                {
                    "type": "text",
                    "bbox": [
                        162,
                        188,
                        451,
                        229
                    ],
                    "lines": [
                        {
                            "bbox": [
                                160,
                                187,
                                452,
                                204
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        160,
                                        189,
                                        166,
                                        200
                                    ],
                                    "score": 0.46,
                                    "content": "^{1}",
                                    "type": "inline_equation",
                                    "height": 11,
                                    "width": 6
                                },
                                {
                                    "bbox": [
                                        167,
                                        187,
                                        452,
                                        204
                                    ],
                                    "score": 1.0,
                                    "content": "Department of Computer Science, Princeton University",
                                    "type": "text"
                                }
                            ],
                            "index": 3
                        },
                        {
                            "bbox": [
                                164,
                                201,
                                449,
                                218
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        164,
                                        203,
                                        169,
                                        214
                                    ],
                                    "score": 0.44,
                                    "content": "^2",
                                    "type": "inline_equation",
                                    "height": 11,
                                    "width": 5
                                },
                                {
                                    "bbox": [
                                        169,
                                        201,
                                        449,
                                        218
                                    ],
                                    "score": 1.0,
                                    "content": "Department of Computer Science, Stanford University",
                                    "type": "text"
                                }
                            ],
                            "index": 4
                        },
                        {
                            "bbox": [
                                245,
                                218,
                                370,
                                228
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        245,
                                        218,
                                        370,
                                        228
                                    ],
                                    "score": 1.0,
                                    "content": "trid@cs.stanford.edu",
                                    "type": "text"
                                }
                            ],
                            "index": 5
                        }
                    ],
                    "index": 4
                },
                {
                    "type": "text",
                    "bbox": [
                        271,
                        248,
                        340,
                        262
                    ],
                    "lines": [
                        {
                            "bbox": [
                                271,
                                249,
                                340,
                                261
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        271,
                                        249,
                                        340,
                                        261
                                    ],
                                    "score": 1.0,
                                    "content": "July 18, 2023",
                                    "type": "text"
                                }
                            ],
                            "index": 6
                        }
                    ],
                    "index": 6
                },
                {
                    "type": "title",
                    "bbox": [
                        285,
                        286,
                        326,
                        297
                    ],
                    "lines": [
                        {
                            "bbox": [
                                285,
                                287,
                                327,
                                296
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        285,
                                        287,
                                        327,
                                        296
                                    ],
                                    "score": 1.0,
                                    "content": "Abstract",
                                    "type": "text"
                                }
                            ],
                            "index": 7
                        }
                    ],
                    "index": 7
                },
                {
                    "type": "text",
                    "bbox": [
                        95,
                        302,
                        517,
                        498
                    ],
                    "lines": [
                        {
                            "bbox": [
                                109,
                                302,
                                516,
                                313
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        109,
                                        302,
                                        516,
                                        313
                                    ],
                                    "score": 1.0,
                                    "content": "Scaling Transformers to longer sequence lengths has been a major problem in the last several years,",
                                    "type": "text"
                                }
                            ],
                            "index": 8
                        },
                        {
                            "bbox": [
                                95,
                                313,
                                517,
                                325
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        95,
                                        313,
                                        517,
                                        325
                                    ],
                                    "score": 1.0,
                                    "content": "promising to improve performance in language modeling and high-resolution image understanding, as",
                                    "type": "text"
                                }
                            ],
                            "index": 9
                        },
                        {
                            "bbox": [
                                95,
                                324,
                                516,
                                336
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        95,
                                        324,
                                        516,
                                        336
                                    ],
                                    "score": 1.0,
                                    "content": "well as to unlock new applications in code, audio, and video generation. The attention layer is the",
                                    "type": "text"
                                }
                            ],
                            "index": 10
                        },
                        {
                            "bbox": [
                                95,
                                335,
                                516,
                                346
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        95,
                                        335,
                                        516,
                                        346
                                    ],
                                    "score": 1.0,
                                    "content": "main bottleneck in scaling to longer sequences, as its runtime and memory increase quadratically in",
                                    "type": "text"
                                }
                            ],
                            "index": 11
                        },
                        {
                            "bbox": [
                                95,
                                347,
                                516,
                                357
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        95,
                                        347,
                                        516,
                                        357
                                    ],
                                    "score": 1.0,
                                    "content": "the sequence length. FlashAttention [5] exploits the asymmetric GPU memory hierarchy to bring",
                                    "type": "text"
                                }
                            ],
                            "index": 12
                        },
                        {
                            "bbox": [
                                95,
                                357,
                                516,
                                368
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        95,
                                        357,
                                        403,
                                        368
                                    ],
                                    "score": 1.0,
                                    "content": "significant memory saving (linear instead of quadratic) and runtime speedup (",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        403,
                                        358,
                                        422,
                                        366
                                    ],
                                    "score": 0.34,
                                    "content": "2\\mathrm{-}4\\times",
                                    "type": "inline_equation",
                                    "height": 8,
                                    "width": 19
                                },
                                {
                                    "bbox": [
                                        422,
                                        357,
                                        516,
                                        368
                                    ],
                                    "score": 1.0,
                                    "content": " compared to optimized",
                                    "type": "text"
                                }
                            ],
                            "index": 13
                        },
                        {
                            "bbox": [
                                95,
                                369,
                                516,
                                379
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        95,
                                        369,
                                        516,
                                        379
                                    ],
                                    "score": 1.0,
                                    "content": "baselines), with no approximation. However, FlashAttention is still not nearly as fast as optimized",
                                    "type": "text"
                                }
                            ],
                            "index": 14
                        },
                        {
                            "bbox": [
                                95,
                                379,
                                516,
                                390
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        95,
                                        379,
                                        308,
                                        390
                                    ],
                                    "score": 1.0,
                                    "content": "matrix-multiply (GEMM) operations, reaching only",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        309,
                                        379,
                                        339,
                                        388
                                    ],
                                    "score": 0.51,
                                    "content": "25–40\\%",
                                    "type": "inline_equation",
                                    "height": 9,
                                    "width": 30
                                },
                                {
                                    "bbox": [
                                        340,
                                        379,
                                        516,
                                        390
                                    ],
                                    "score": 1.0,
                                    "content": " of the theoretical maximum FLOPs/s. We",
                                    "type": "text"
                                }
                            ],
                            "index": 15
                        },
                        {
                            "bbox": [
                                95,
                                390,
                                516,
                                400
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        95,
                                        390,
                                        516,
                                        400
                                    ],
                                    "score": 1.0,
                                    "content": "observe that the inefficiency is due to suboptimal work partitioning between different thread blocks and",
                                    "type": "text"
                                }
                            ],
                            "index": 16
                        },
                        {
                            "bbox": [
                                95,
                                401,
                                515,
                                412
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        95,
                                        401,
                                        515,
                                        412
                                    ],
                                    "score": 1.0,
                                    "content": "warps on the GPU, causing either low-occupancy or unnecessary shared memory reads/writes. We propose",
                                    "type": "text"
                                }
                            ],
                            "index": 17
                        },
                        {
                            "bbox": [
                                95,
                                411,
                                517,
                                423
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        95,
                                        411,
                                        517,
                                        423
                                    ],
                                    "score": 1.0,
                                    "content": "FlashAttention-2, with better work partitioning to address these issues. In particular, we (1) tweak",
                                    "type": "text"
                                }
                            ],
                            "index": 18
                        },
                        {
                            "bbox": [
                                95,
                                423,
                                516,
                                434
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        95,
                                        423,
                                        516,
                                        434
                                    ],
                                    "score": 1.0,
                                    "content": "the algorithm to reduce the number of non-matmul FLOPs (2) parallelize the attention computation, even",
                                    "type": "text"
                                }
                            ],
                            "index": 19
                        },
                        {
                            "bbox": [
                                95,
                                433,
                                517,
                                445
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        95,
                                        433,
                                        517,
                                        445
                                    ],
                                    "score": 1.0,
                                    "content": "for a single head, across different thread blocks to increase occupancy, and (3) within each thread block,",
                                    "type": "text"
                                }
                            ],
                            "index": 20
                        },
                        {
                            "bbox": [
                                96,
                                445,
                                516,
                                456
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        96,
                                        445,
                                        516,
                                        456
                                    ],
                                    "score": 1.0,
                                    "content": "distribute the work between warps to reduce communication through shared memory. These yield around",
                                    "type": "text"
                                }
                            ],
                            "index": 21
                        },
                        {
                            "bbox": [
                                96,
                                456,
                                516,
                                466
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        96,
                                        458,
                                        107,
                                        465
                                    ],
                                    "score": 0.56,
                                    "content": "2\\times",
                                    "type": "inline_equation",
                                    "height": 7,
                                    "width": 11
                                },
                                {
                                    "bbox": [
                                        107,
                                        456,
                                        516,
                                        466
                                    ],
                                    "score": 1.0,
                                    "content": " speedup compared to FlashAttention, reaching 50-73% of the theoretical maximum FLOPs/s on",
                                    "type": "text"
                                }
                            ],
                            "index": 22
                        },
                        {
                            "bbox": [
                                95,
                                467,
                                516,
                                477
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        95,
                                        467,
                                        516,
                                        477
                                    ],
                                    "score": 1.0,
                                    "content": "A100 and getting close to the efficiency of GEMM operations. We empirically validate that when used",
                                    "type": "text"
                                }
                            ],
                            "index": 23
                        },
                        {
                            "bbox": [
                                95,
                                477,
                                517,
                                489
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        95,
                                        477,
                                        517,
                                        489
                                    ],
                                    "score": 1.0,
                                    "content": "end-to-end to train GPT-style models, FlashAttention-2 reaches training speed of up to 225 TFLOPs/s",
                                    "type": "text"
                                }
                            ],
                            "index": 24
                        },
                        {
                            "bbox": [
                                95,
                                488,
                                295,
                                500
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        95,
                                        488,
                                        163,
                                        500
                                    ],
                                    "score": 1.0,
                                    "content": "per A100 GPU (",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        163,
                                        490,
                                        180,
                                        498
                                    ],
                                    "score": 0.45,
                                    "content": "72\\%",
                                    "type": "inline_equation",
                                    "height": 8,
                                    "width": 17
                                },
                                {
                                    "bbox": [
                                        181,
                                        488,
                                        295,
                                        500
                                    ],
                                    "score": 1.0,
                                    "content": " model FLOPs utilization).1",
                                    "type": "text"
                                }
                            ],
                            "index": 25
                        }
                    ],
                    "index": 16.5
                },
                {
                    "type": "title",
                    "bbox": [
                        72,
                        516,
                        182,
                        533
                    ],
                    "lines": [
                        {
                            "bbox": [
                                70,
                                518,
                                182,
                                532
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        519,
                                        80,
                                        530
                                    ],
                                    "score": 1.0,
                                    "content": "1",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        92,
                                        518,
                                        182,
                                        532
                                    ],
                                    "score": 1.0,
                                    "content": "Introduction",
                                    "type": "text"
                                }
                            ],
                            "index": 26
                        }
                    ],
                    "index": 26
                },
                {
                    "type": "text",
                    "bbox": [
                        70,
                        541,
                        541,
                        626
                    ],
                    "lines": [
                        {
                            "bbox": [
                                71,
                                543,
                                541,
                                554
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        71,
                                        543,
                                        541,
                                        554
                                    ],
                                    "score": 1.0,
                                    "content": "Scaling up the context length of Transformers [18] is a challenge, since the attention layer at their heart",
                                    "type": "text"
                                }
                            ],
                            "index": 27
                        },
                        {
                            "bbox": [
                                69,
                                553,
                                541,
                                568
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        69,
                                        553,
                                        541,
                                        568
                                    ],
                                    "score": 1.0,
                                    "content": "has runtime and memory requirements quadratic in the input sequence length. Ideally, we would like to go",
                                    "type": "text"
                                }
                            ],
                            "index": 28
                        },
                        {
                            "bbox": [
                                69,
                                565,
                                542,
                                580
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        69,
                                        565,
                                        542,
                                        580
                                    ],
                                    "score": 1.0,
                                    "content": "beyond the standard 2k sequence length limit to train models to understand books, high resolution images,",
                                    "type": "text"
                                }
                            ],
                            "index": 29
                        },
                        {
                            "bbox": [
                                70,
                                579,
                                541,
                                590
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        579,
                                        541,
                                        590
                                    ],
                                    "score": 1.0,
                                    "content": "and long-form videos. Just within the last year, there have been several language models with much longer",
                                    "type": "text"
                                }
                            ],
                            "index": 30
                        },
                        {
                            "bbox": [
                                70,
                                590,
                                541,
                                602
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        590,
                                        501,
                                        602
                                    ],
                                    "score": 1.0,
                                    "content": "context than before: GPT-4 [12] with context length 32k, MosaicML’s MPT with context length ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        501,
                                        592,
                                        517,
                                        600
                                    ],
                                    "score": 0.42,
                                    "content": "65\\mathrm{k}",
                                    "type": "inline_equation",
                                    "height": 8,
                                    "width": 16
                                },
                                {
                                    "bbox": [
                                        518,
                                        590,
                                        541,
                                        602
                                    ],
                                    "score": 1.0,
                                    "content": ", and",
                                    "type": "text"
                                }
                            ],
                            "index": 31
                        },
                        {
                            "bbox": [
                                70,
                                602,
                                540,
                                615
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        602,
                                        540,
                                        615
                                    ],
                                    "score": 1.0,
                                    "content": "Anthropic’s Claude with context length 100k. Emerging use cases such as long document querying and story",
                                    "type": "text"
                                }
                            ],
                            "index": 32
                        },
                        {
                            "bbox": [
                                70,
                                614,
                                374,
                                626
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        614,
                                        374,
                                        626
                                    ],
                                    "score": 1.0,
                                    "content": "writing have demonstrated a need for models with such long context.",
                                    "type": "text"
                                }
                            ],
                            "index": 33
                        }
                    ],
                    "index": 30
                },
                {
                    "type": "text",
                    "bbox": [
                        71,
                        626,
                        541,
                        698
                    ],
                    "lines": [
                        {
                            "bbox": [
                                86,
                                626,
                                541,
                                639
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        86,
                                        626,
                                        541,
                                        639
                                    ],
                                    "score": 1.0,
                                    "content": "To reduce the computational requirement of attention on such long context, there have been numerous",
                                    "type": "text"
                                }
                            ],
                            "index": 34
                        },
                        {
                            "bbox": [
                                70,
                                637,
                                541,
                                651
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        637,
                                        541,
                                        651
                                    ],
                                    "score": 1.0,
                                    "content": "methods proposed to approximate attention [2, 3, 4, 8, 9, 14, 19, 20]. Though these methods have seen",
                                    "type": "text"
                                }
                            ],
                            "index": 35
                        },
                        {
                            "bbox": [
                                70,
                                650,
                                541,
                                663
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        650,
                                        541,
                                        663
                                    ],
                                    "score": 1.0,
                                    "content": "some use cases, as far as we know, most large-scale training runs still use standard attention. Motivated by",
                                    "type": "text"
                                }
                            ],
                            "index": 36
                        },
                        {
                            "bbox": [
                                69,
                                661,
                                541,
                                676
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        69,
                                        661,
                                        541,
                                        676
                                    ],
                                    "score": 1.0,
                                    "content": "this, Dao et al. [5] proposed to reorder the attention computation and leverages classical techniques (tiling,",
                                    "type": "text"
                                }
                            ],
                            "index": 37
                        },
                        {
                            "bbox": [
                                70,
                                674,
                                541,
                                686
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        674,
                                        541,
                                        686
                                    ],
                                    "score": 1.0,
                                    "content": "recomputation) to significantly speed it up and reduce memory usage from quadratic to linear in sequence",
                                    "type": "text"
                                }
                            ],
                            "index": 38
                        },
                        {
                            "bbox": [
                                70,
                                685,
                                541,
                                699
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        685,
                                        159,
                                        699
                                    ],
                                    "score": 1.0,
                                    "content": "length. This yields ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        159,
                                        686,
                                        181,
                                        696
                                    ],
                                    "score": 0.59,
                                    "content": "2{\\cdot}4\\times",
                                    "type": "inline_equation",
                                    "height": 10,
                                    "width": 22
                                },
                                {
                                    "bbox": [
                                        181,
                                        685,
                                        436,
                                        699
                                    ],
                                    "score": 1.0,
                                    "content": " wall-clock time speedup over optimized baselines, up to ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        436,
                                        688,
                                        468,
                                        696
                                    ],
                                    "score": 0.34,
                                    "content": "10\\mathrm{-}20\\times",
                                    "type": "inline_equation",
                                    "height": 8,
                                    "width": 32
                                },
                                {
                                    "bbox": [
                                        468,
                                        685,
                                        541,
                                        699
                                    ],
                                    "score": 1.0,
                                    "content": " memory saving,",
                                    "type": "text"
                                }
                            ],
                            "index": 39
                        }
                    ],
                    "index": 36.5
                }
            ],
            "layout_bboxes": [],
            "page_idx": 0,
            "page_size": [
                612.0,
                792.0
            ],
            "_layout_tree": [],
            "images": [],
            "tables": [],
            "interline_equations": [],
            "discarded_blocks": [
                {
                    "type": "discarded",
                    "bbox": [
                        82,
                        705,
                        406,
                        715
                    ],
                    "lines": [
                        {
                            "bbox": [
                                82,
                                704,
                                407,
                                715
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        82,
                                        704,
                                        407,
                                        715
                                    ],
                                    "score": 1.0,
                                    "content": "1FlashAttention-2 is available at https://github.com/Dao-AILab/flash-attention",
                                    "type": "text"
                                }
                            ]
                        }
                    ]
                },
                {
                    "type": "discarded",
                    "bbox": [
                        14,
                        216,
                        38,
                        562
                    ],
                    "lines": [
                        {
                            "bbox": [
                                15,
                                216,
                                37,
                                564
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        15,
                                        216,
                                        37,
                                        564
                                    ],
                                    "score": 1.0,
                                    "content": "arXiv:2307.08691v1  [cs.LG]  17 Jul 2023",
                                    "type": "text",
                                    "height": 348,
                                    "width": 22
                                }
                            ]
                        }
                    ]
                },
                {
                    "type": "discarded",
                    "bbox": [
                        302,
                        743,
                        308,
                        751
                    ],
                    "lines": [
                        {
                            "bbox": [
                                301,
                                741,
                                310,
                                754
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        301,
                                        741,
                                        310,
                                        754
                                    ],
                                    "score": 1.0,
                                    "content": "",
                                    "type": "text",
                                    "height": 13,
                                    "width": 9
                                }
                            ]
                        }
                    ]
                }
            ],
            "need_drop": false,
            "drop_reason": [],
            "para_blocks": [
                {
                    "type": "title",
                    "bbox": [
                        79,
                        109,
                        533,
                        150
                    ],
                    "lines": [
                        {
                            "bbox": [
                                227,
                                111,
                                387,
                                126
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        227,
                                        111,
                                        387,
                                        126
                                    ],
                                    "score": 1.0,
                                    "content": "FlashAttention-2:",
                                    "type": "text"
                                }
                            ],
                            "index": 0
                        },
                        {
                            "bbox": [
                                78,
                                129,
                                534,
                                151
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        78,
                                        129,
                                        534,
                                        151
                                    ],
                                    "score": 1.0,
                                    "content": "Faster Attention with Better Parallelism and Work Partitioning",
                                    "type": "text"
                                }
                            ],
                            "index": 1
                        }
                    ],
                    "index": 0.5,
                    "page_num": "page_0",
                    "page_size": [
                        612.0,
                        792.0
                    ]
                },
                {
                    "type": "text",
                    "bbox": [
                        280,
                        162,
                        332,
                        177
                    ],
                    "lines": [
                        {
                            "bbox": [
                                278,
                                163,
                                333,
                                177
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        278,
                                        163,
                                        333,
                                        177
                                    ],
                                    "score": 1.0,
                                    "content": "Tri Dao1,2",
                                    "type": "text"
                                }
                            ],
                            "index": 2
                        }
                    ],
                    "index": 2,
                    "page_num": "page_0",
                    "page_size": [
                        612.0,
                        792.0
                    ],
                    "bbox_fs": [
                        278,
                        163,
                        333,
                        177
                    ]
                },
                {
                    "type": "text",
                    "bbox": [
                        162,
                        188,
                        451,
                        229
                    ],
                    "lines": [
                        {
                            "bbox": [
                                160,
                                187,
                                452,
                                204
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        160,
                                        189,
                                        166,
                                        200
                                    ],
                                    "score": 0.46,
                                    "content": "^{1}",
                                    "type": "inline_equation",
                                    "height": 11,
                                    "width": 6
                                },
                                {
                                    "bbox": [
                                        167,
                                        187,
                                        452,
                                        204
                                    ],
                                    "score": 1.0,
                                    "content": "Department of Computer Science, Princeton University",
                                    "type": "text"
                                }
                            ],
                            "index": 3
                        },
                        {
                            "bbox": [
                                164,
                                201,
                                449,
                                218
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        164,
                                        203,
                                        169,
                                        214
                                    ],
                                    "score": 0.44,
                                    "content": "^2",
                                    "type": "inline_equation",
                                    "height": 11,
                                    "width": 5
                                },
                                {
                                    "bbox": [
                                        169,
                                        201,
                                        449,
                                        218
                                    ],
                                    "score": 1.0,
                                    "content": "Department of Computer Science, Stanford University",
                                    "type": "text"
                                }
                            ],
                            "index": 4
                        },
                        {
                            "bbox": [
                                245,
                                218,
                                370,
                                228
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        245,
                                        218,
                                        370,
                                        228
                                    ],
                                    "score": 1.0,
                                    "content": "trid@cs.stanford.edu",
                                    "type": "text"
                                }
                            ],
                            "index": 5
                        }
                    ],
                    "index": 4,
                    "page_num": "page_0",
                    "page_size": [
                        612.0,
                        792.0
                    ],
                    "bbox_fs": [
                        160,
                        187,
                        452,
                        228
                    ]
                },
                {
                    "type": "text",
                    "bbox": [
                        271,
                        248,
                        340,
                        262
                    ],
                    "lines": [
                        {
                            "bbox": [
                                271,
                                249,
                                340,
                                261
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        271,
                                        249,
                                        340,
                                        261
                                    ],
                                    "score": 1.0,
                                    "content": "July 18, 2023",
                                    "type": "text"
                                }
                            ],
                            "index": 6
                        }
                    ],
                    "index": 6,
                    "page_num": "page_0",
                    "page_size": [
                        612.0,
                        792.0
                    ],
                    "bbox_fs": [
                        271,
                        249,
                        340,
                        261
                    ]
                },
                {
                    "type": "title",
                    "bbox": [
                        285,
                        286,
                        326,
                        297
                    ],
                    "lines": [
                        {
                            "bbox": [
                                285,
                                287,
                                327,
                                296
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        285,
                                        287,
                                        327,
                                        296
                                    ],
                                    "score": 1.0,
                                    "content": "Abstract",
                                    "type": "text"
                                }
                            ],
                            "index": 7
                        }
                    ],
                    "index": 7,
                    "page_num": "page_0",
                    "page_size": [
                        612.0,
                        792.0
                    ]
                },
                {
                    "type": "text",
                    "bbox": [
                        95,
                        302,
                        517,
                        498
                    ],
                    "lines": [
                        {
                            "bbox": [
                                109,
                                302,
                                516,
                                313
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        109,
                                        302,
                                        516,
                                        313
                                    ],
                                    "score": 1.0,
                                    "content": "Scaling Transformers to longer sequence lengths has been a major problem in the last several years,",
                                    "type": "text"
                                }
                            ],
                            "index": 8
                        },
                        {
                            "bbox": [
                                95,
                                313,
                                517,
                                325
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        95,
                                        313,
                                        517,
                                        325
                                    ],
                                    "score": 1.0,
                                    "content": "promising to improve performance in language modeling and high-resolution image understanding, as",
                                    "type": "text"
                                }
                            ],
                            "index": 9
                        },
                        {
                            "bbox": [
                                95,
                                324,
                                516,
                                336
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        95,
                                        324,
                                        516,
                                        336
                                    ],
                                    "score": 1.0,
                                    "content": "well as to unlock new applications in code, audio, and video generation. The attention layer is the",
                                    "type": "text"
                                }
                            ],
                            "index": 10
                        },
                        {
                            "bbox": [
                                95,
                                335,
                                516,
                                346
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        95,
                                        335,
                                        516,
                                        346
                                    ],
                                    "score": 1.0,
                                    "content": "main bottleneck in scaling to longer sequences, as its runtime and memory increase quadratically in",
                                    "type": "text"
                                }
                            ],
                            "index": 11
                        },
                        {
                            "bbox": [
                                95,
                                347,
                                516,
                                357
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        95,
                                        347,
                                        516,
                                        357
                                    ],
                                    "score": 1.0,
                                    "content": "the sequence length. FlashAttention [5] exploits the asymmetric GPU memory hierarchy to bring",
                                    "type": "text"
                                }
                            ],
                            "index": 12
                        },
                        {
                            "bbox": [
                                95,
                                357,
                                516,
                                368
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        95,
                                        357,
                                        403,
                                        368
                                    ],
                                    "score": 1.0,
                                    "content": "significant memory saving (linear instead of quadratic) and runtime speedup (",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        403,
                                        358,
                                        422,
                                        366
                                    ],
                                    "score": 0.34,
                                    "content": "2\\mathrm{-}4\\times",
                                    "type": "inline_equation",
                                    "height": 8,
                                    "width": 19
                                },
                                {
                                    "bbox": [
                                        422,
                                        357,
                                        516,
                                        368
                                    ],
                                    "score": 1.0,
                                    "content": " compared to optimized",
                                    "type": "text"
                                }
                            ],
                            "index": 13
                        },
                        {
                            "bbox": [
                                95,
                                369,
                                516,
                                379
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        95,
                                        369,
                                        516,
                                        379
                                    ],
                                    "score": 1.0,
                                    "content": "baselines), with no approximation. However, FlashAttention is still not nearly as fast as optimized",
                                    "type": "text"
                                }
                            ],
                            "index": 14
                        },
                        {
                            "bbox": [
                                95,
                                379,
                                516,
                                390
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        95,
                                        379,
                                        308,
                                        390
                                    ],
                                    "score": 1.0,
                                    "content": "matrix-multiply (GEMM) operations, reaching only",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        309,
                                        379,
                                        339,
                                        388
                                    ],
                                    "score": 0.51,
                                    "content": "25–40\\%",
                                    "type": "inline_equation",
                                    "height": 9,
                                    "width": 30
                                },
                                {
                                    "bbox": [
                                        340,
                                        379,
                                        516,
                                        390
                                    ],
                                    "score": 1.0,
                                    "content": " of the theoretical maximum FLOPs/s. We",
                                    "type": "text"
                                }
                            ],
                            "index": 15
                        },
                        {
                            "bbox": [
                                95,
                                390,
                                516,
                                400
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        95,
                                        390,
                                        516,
                                        400
                                    ],
                                    "score": 1.0,
                                    "content": "observe that the inefficiency is due to suboptimal work partitioning between different thread blocks and",
                                    "type": "text"
                                }
                            ],
                            "index": 16
                        },
                        {
                            "bbox": [
                                95,
                                401,
                                515,
                                412
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        95,
                                        401,
                                        515,
                                        412
                                    ],
                                    "score": 1.0,
                                    "content": "warps on the GPU, causing either low-occupancy or unnecessary shared memory reads/writes. We propose",
                                    "type": "text"
                                }
                            ],
                            "index": 17
                        },
                        {
                            "bbox": [
                                95,
                                411,
                                517,
                                423
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        95,
                                        411,
                                        517,
                                        423
                                    ],
                                    "score": 1.0,
                                    "content": "FlashAttention-2, with better work partitioning to address these issues. In particular, we (1) tweak",
                                    "type": "text"
                                }
                            ],
                            "index": 18
                        },
                        {
                            "bbox": [
                                95,
                                423,
                                516,
                                434
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        95,
                                        423,
                                        516,
                                        434
                                    ],
                                    "score": 1.0,
                                    "content": "the algorithm to reduce the number of non-matmul FLOPs (2) parallelize the attention computation, even",
                                    "type": "text"
                                }
                            ],
                            "index": 19
                        },
                        {
                            "bbox": [
                                95,
                                433,
                                517,
                                445
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        95,
                                        433,
                                        517,
                                        445
                                    ],
                                    "score": 1.0,
                                    "content": "for a single head, across different thread blocks to increase occupancy, and (3) within each thread block,",
                                    "type": "text"
                                }
                            ],
                            "index": 20
                        },
                        {
                            "bbox": [
                                96,
                                445,
                                516,
                                456
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        96,
                                        445,
                                        516,
                                        456
                                    ],
                                    "score": 1.0,
                                    "content": "distribute the work between warps to reduce communication through shared memory. These yield around",
                                    "type": "text"
                                }
                            ],
                            "index": 21
                        },
                        {
                            "bbox": [
                                96,
                                456,
                                516,
                                466
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        96,
                                        458,
                                        107,
                                        465
                                    ],
                                    "score": 0.56,
                                    "content": "2\\times",
                                    "type": "inline_equation",
                                    "height": 7,
                                    "width": 11
                                },
                                {
                                    "bbox": [
                                        107,
                                        456,
                                        516,
                                        466
                                    ],
                                    "score": 1.0,
                                    "content": " speedup compared to FlashAttention, reaching 50-73% of the theoretical maximum FLOPs/s on",
                                    "type": "text"
                                }
                            ],
                            "index": 22
                        },
                        {
                            "bbox": [
                                95,
                                467,
                                516,
                                477
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        95,
                                        467,
                                        516,
                                        477
                                    ],
                                    "score": 1.0,
                                    "content": "A100 and getting close to the efficiency of GEMM operations. We empirically validate that when used",
                                    "type": "text"
                                }
                            ],
                            "index": 23
                        },
                        {
                            "bbox": [
                                95,
                                477,
                                517,
                                489
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        95,
                                        477,
                                        517,
                                        489
                                    ],
                                    "score": 1.0,
                                    "content": "end-to-end to train GPT-style models, FlashAttention-2 reaches training speed of up to 225 TFLOPs/s",
                                    "type": "text"
                                }
                            ],
                            "index": 24
                        },
                        {
                            "bbox": [
                                95,
                                488,
                                295,
                                500
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        95,
                                        488,
                                        163,
                                        500
                                    ],
                                    "score": 1.0,
                                    "content": "per A100 GPU (",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        163,
                                        490,
                                        180,
                                        498
                                    ],
                                    "score": 0.45,
                                    "content": "72\\%",
                                    "type": "inline_equation",
                                    "height": 8,
                                    "width": 17
                                },
                                {
                                    "bbox": [
                                        181,
                                        488,
                                        295,
                                        500
                                    ],
                                    "score": 1.0,
                                    "content": " model FLOPs utilization).1",
                                    "type": "text"
                                }
                            ],
                            "index": 25
                        }
                    ],
                    "index": 16.5,
                    "page_num": "page_0",
                    "page_size": [
                        612.0,
                        792.0
                    ],
                    "bbox_fs": [
                        95,
                        302,
                        517,
                        500
                    ]
                },
                {
                    "type": "title",
                    "bbox": [
                        72,
                        516,
                        182,
                        533
                    ],
                    "lines": [
                        {
                            "bbox": [
                                70,
                                518,
                                182,
                                532
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        519,
                                        80,
                                        530
                                    ],
                                    "score": 1.0,
                                    "content": "1",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        92,
                                        518,
                                        182,
                                        532
                                    ],
                                    "score": 1.0,
                                    "content": "Introduction",
                                    "type": "text"
                                }
                            ],
                            "index": 26
                        }
                    ],
                    "index": 26,
                    "page_num": "page_0",
                    "page_size": [
                        612.0,
                        792.0
                    ]
                },
                {
                    "type": "text",
                    "bbox": [
                        70,
                        541,
                        541,
                        626
                    ],
                    "lines": [
                        {
                            "bbox": [
                                71,
                                543,
                                541,
                                554
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        71,
                                        543,
                                        541,
                                        554
                                    ],
                                    "score": 1.0,
                                    "content": "Scaling up the context length of Transformers [18] is a challenge, since the attention layer at their heart",
                                    "type": "text"
                                }
                            ],
                            "index": 27
                        },
                        {
                            "bbox": [
                                69,
                                553,
                                541,
                                568
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        69,
                                        553,
                                        541,
                                        568
                                    ],
                                    "score": 1.0,
                                    "content": "has runtime and memory requirements quadratic in the input sequence length. Ideally, we would like to go",
                                    "type": "text"
                                }
                            ],
                            "index": 28
                        },
                        {
                            "bbox": [
                                69,
                                565,
                                542,
                                580
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        69,
                                        565,
                                        542,
                                        580
                                    ],
                                    "score": 1.0,
                                    "content": "beyond the standard 2k sequence length limit to train models to understand books, high resolution images,",
                                    "type": "text"
                                }
                            ],
                            "index": 29
                        },
                        {
                            "bbox": [
                                70,
                                579,
                                541,
                                590
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        579,
                                        541,
                                        590
                                    ],
                                    "score": 1.0,
                                    "content": "and long-form videos. Just within the last year, there have been several language models with much longer",
                                    "type": "text"
                                }
                            ],
                            "index": 30
                        },
                        {
                            "bbox": [
                                70,
                                590,
                                541,
                                602
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        590,
                                        501,
                                        602
                                    ],
                                    "score": 1.0,
                                    "content": "context than before: GPT-4 [12] with context length 32k, MosaicML’s MPT with context length ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        501,
                                        592,
                                        517,
                                        600
                                    ],
                                    "score": 0.42,
                                    "content": "65\\mathrm{k}",
                                    "type": "inline_equation",
                                    "height": 8,
                                    "width": 16
                                },
                                {
                                    "bbox": [
                                        518,
                                        590,
                                        541,
                                        602
                                    ],
                                    "score": 1.0,
                                    "content": ", and",
                                    "type": "text"
                                }
                            ],
                            "index": 31
                        },
                        {
                            "bbox": [
                                70,
                                602,
                                540,
                                615
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        602,
                                        540,
                                        615
                                    ],
                                    "score": 1.0,
                                    "content": "Anthropic’s Claude with context length 100k. Emerging use cases such as long document querying and story",
                                    "type": "text"
                                }
                            ],
                            "index": 32
                        },
                        {
                            "bbox": [
                                70,
                                614,
                                374,
                                626
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        614,
                                        374,
                                        626
                                    ],
                                    "score": 1.0,
                                    "content": "writing have demonstrated a need for models with such long context.",
                                    "type": "text"
                                }
                            ],
                            "index": 33
                        }
                    ],
                    "index": 30,
                    "page_num": "page_0",
                    "page_size": [
                        612.0,
                        792.0
                    ],
                    "bbox_fs": [
                        69,
                        543,
                        542,
                        626
                    ]
                },
                {
                    "type": "text",
                    "bbox": [
                        71,
                        626,
                        541,
                        698
                    ],
                    "lines": [
                        {
                            "bbox": [
                                86,
                                626,
                                541,
                                639
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        86,
                                        626,
                                        541,
                                        639
                                    ],
                                    "score": 1.0,
                                    "content": "To reduce the computational requirement of attention on such long context, there have been numerous",
                                    "type": "text"
                                }
                            ],
                            "index": 34
                        },
                        {
                            "bbox": [
                                70,
                                637,
                                541,
                                651
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        637,
                                        541,
                                        651
                                    ],
                                    "score": 1.0,
                                    "content": "methods proposed to approximate attention [2, 3, 4, 8, 9, 14, 19, 20]. Though these methods have seen",
                                    "type": "text"
                                }
                            ],
                            "index": 35
                        },
                        {
                            "bbox": [
                                70,
                                650,
                                541,
                                663
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        650,
                                        541,
                                        663
                                    ],
                                    "score": 1.0,
                                    "content": "some use cases, as far as we know, most large-scale training runs still use standard attention. Motivated by",
                                    "type": "text"
                                }
                            ],
                            "index": 36
                        },
                        {
                            "bbox": [
                                69,
                                661,
                                541,
                                676
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        69,
                                        661,
                                        541,
                                        676
                                    ],
                                    "score": 1.0,
                                    "content": "this, Dao et al. [5] proposed to reorder the attention computation and leverages classical techniques (tiling,",
                                    "type": "text"
                                }
                            ],
                            "index": 37
                        },
                        {
                            "bbox": [
                                70,
                                674,
                                541,
                                686
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        674,
                                        541,
                                        686
                                    ],
                                    "score": 1.0,
                                    "content": "recomputation) to significantly speed it up and reduce memory usage from quadratic to linear in sequence",
                                    "type": "text"
                                }
                            ],
                            "index": 38
                        },
                        {
                            "bbox": [
                                70,
                                685,
                                541,
                                699
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        685,
                                        159,
                                        699
                                    ],
                                    "score": 1.0,
                                    "content": "length. This yields ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        159,
                                        686,
                                        181,
                                        696
                                    ],
                                    "score": 0.59,
                                    "content": "2{\\cdot}4\\times",
                                    "type": "inline_equation",
                                    "height": 10,
                                    "width": 22
                                },
                                {
                                    "bbox": [
                                        181,
                                        685,
                                        436,
                                        699
                                    ],
                                    "score": 1.0,
                                    "content": " wall-clock time speedup over optimized baselines, up to ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        436,
                                        688,
                                        468,
                                        696
                                    ],
                                    "score": 0.34,
                                    "content": "10\\mathrm{-}20\\times",
                                    "type": "inline_equation",
                                    "height": 8,
                                    "width": 32
                                },
                                {
                                    "bbox": [
                                        468,
                                        685,
                                        541,
                                        699
                                    ],
                                    "score": 1.0,
                                    "content": " memory saving,",
                                    "type": "text"
                                }
                            ],
                            "index": 39
                        },
                        {
                            "bbox": [
                                72,
                                74,
                                541,
                                86
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        72,
                                        74,
                                        541,
                                        86
                                    ],
                                    "score": 1.0,
                                    "content": "with no approximation, and as a result FlashAttention has seen wide adoption in large-scale training and",
                                    "type": "text",
                                    "cross_page": true
                                }
                            ],
                            "index": 0
                        },
                        {
                            "bbox": [
                                71,
                                86,
                                185,
                                96
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        71,
                                        86,
                                        185,
                                        96
                                    ],
                                    "score": 1.0,
                                    "content": "inference of Transformers.",
                                    "type": "text",
                                    "cross_page": true
                                }
                            ],
                            "index": 1
                        }
                    ],
                    "index": 36.5,
                    "page_num": "page_0",
                    "page_size": [
                        612.0,
                        792.0
                    ],
                    "bbox_fs": [
                        69,
                        626,
                        541,
                        699
                    ]
                }
            ]
        },
        {
            "preproc_blocks": [
                {
                    "type": "text",
                    "bbox": [
                        73,
                        73,
                        542,
                        96
                    ],
                    "lines": [
                        {
                            "bbox": [
                                72,
                                74,
                                541,
                                86
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        72,
                                        74,
                                        541,
                                        86
                                    ],
                                    "score": 1.0,
                                    "content": "with no approximation, and as a result FlashAttention has seen wide adoption in large-scale training and",
                                    "type": "text"
                                }
                            ],
                            "index": 0
                        },
                        {
                            "bbox": [
                                71,
                                86,
                                185,
                                96
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        71,
                                        86,
                                        185,
                                        96
                                    ],
                                    "score": 1.0,
                                    "content": "inference of Transformers.",
                                    "type": "text"
                                }
                            ],
                            "index": 1
                        }
                    ],
                    "index": 0.5
                },
                {
                    "type": "text",
                    "bbox": [
                        70,
                        97,
                        541,
                        192
                    ],
                    "lines": [
                        {
                            "bbox": [
                                85,
                                97,
                                541,
                                109
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        85,
                                        97,
                                        541,
                                        109
                                    ],
                                    "score": 1.0,
                                    "content": "However, context length increases even more, FlashAttention is still not nearly as efficient as other",
                                    "type": "text"
                                }
                            ],
                            "index": 2
                        },
                        {
                            "bbox": [
                                69,
                                109,
                                542,
                                122
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        69,
                                        109,
                                        505,
                                        122
                                    ],
                                    "score": 1.0,
                                    "content": "primitives such as matrix-multiply (GEMM). In particular, while FlashAttention is already 2-4",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        505,
                                        113,
                                        512,
                                        119
                                    ],
                                    "score": 0.25,
                                    "content": "\\times",
                                    "type": "inline_equation",
                                    "height": 6,
                                    "width": 7
                                },
                                {
                                    "bbox": [
                                        513,
                                        109,
                                        542,
                                        122
                                    ],
                                    "score": 1.0,
                                    "content": " faster",
                                    "type": "text"
                                }
                            ],
                            "index": 3
                        },
                        {
                            "bbox": [
                                71,
                                122,
                                541,
                                133
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        71,
                                        122,
                                        386,
                                        133
                                    ],
                                    "score": 1.0,
                                    "content": "than a standard attention implementation, the forward pass only reaches ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        387,
                                        123,
                                        418,
                                        132
                                    ],
                                    "score": 0.33,
                                    "content": "30\\mathrm{-}50\\%",
                                    "type": "inline_equation",
                                    "height": 9,
                                    "width": 31
                                },
                                {
                                    "bbox": [
                                        418,
                                        122,
                                        541,
                                        133
                                    ],
                                    "score": 1.0,
                                    "content": " of the theoretical maximum",
                                    "type": "text"
                                }
                            ],
                            "index": 4
                        },
                        {
                            "bbox": [
                                70,
                                132,
                                540,
                                146
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        132,
                                        507,
                                        146
                                    ],
                                    "score": 1.0,
                                    "content": "FLOPs/s of the device (Fig. 5), while the backward pass is even more challenging, reaching only ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        507,
                                        135,
                                        540,
                                        144
                                    ],
                                    "score": 0.61,
                                    "content": "25\\substack{-35\\%}",
                                    "type": "inline_equation",
                                    "height": 9,
                                    "width": 33
                                }
                            ],
                            "index": 5
                        },
                        {
                            "bbox": [
                                71,
                                146,
                                542,
                                157
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        71,
                                        146,
                                        542,
                                        157
                                    ],
                                    "score": 1.0,
                                    "content": "of maximum throughput on A100 GPU (Fig. 6). In contrast, optimized GEMM can reach up to 80-90% of",
                                    "type": "text"
                                }
                            ],
                            "index": 6
                        },
                        {
                            "bbox": [
                                70,
                                158,
                                541,
                                169
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        158,
                                        541,
                                        169
                                    ],
                                    "score": 1.0,
                                    "content": "the theoretical maximum device throughput. Through careful profiling, we observe that FlashAttention",
                                    "type": "text"
                                }
                            ],
                            "index": 7
                        },
                        {
                            "bbox": [
                                70,
                                170,
                                541,
                                181
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        170,
                                        541,
                                        181
                                    ],
                                    "score": 1.0,
                                    "content": "still has suboptimal work partitioning between different thread blocks and warps on the GPU, causing either",
                                    "type": "text"
                                }
                            ],
                            "index": 8
                        },
                        {
                            "bbox": [
                                69,
                                181,
                                334,
                                194
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        69,
                                        181,
                                        334,
                                        194
                                    ],
                                    "score": 1.0,
                                    "content": "low-occupancy or unnecessary shared memory reads/writes.",
                                    "type": "text"
                                }
                            ],
                            "index": 9
                        }
                    ],
                    "index": 5.5
                },
                {
                    "type": "text",
                    "bbox": [
                        72,
                        193,
                        539,
                        217
                    ],
                    "lines": [
                        {
                            "bbox": [
                                86,
                                193,
                                541,
                                205
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        86,
                                        193,
                                        541,
                                        205
                                    ],
                                    "score": 1.0,
                                    "content": "Building on FlashAttention, we propose FlashAttention-2 with better parallelism and work",
                                    "type": "text"
                                }
                            ],
                            "index": 10
                        },
                        {
                            "bbox": [
                                71,
                                206,
                                246,
                                217
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        71,
                                        206,
                                        246,
                                        217
                                    ],
                                    "score": 1.0,
                                    "content": "partitioning to address these challenges.",
                                    "type": "text"
                                }
                            ],
                            "index": 11
                        }
                    ],
                    "index": 10.5
                },
                {
                    "type": "text",
                    "bbox": [
                        82,
                        224,
                        542,
                        360
                    ],
                    "lines": [
                        {
                            "bbox": [
                                82,
                                223,
                                542,
                                238
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        82,
                                        223,
                                        542,
                                        238
                                    ],
                                    "score": 1.0,
                                    "content": "1. In Section 3.1, we tweak the algorithms to reduce the number of non-matmul FLOPs while not changing",
                                    "type": "text"
                                }
                            ],
                            "index": 12
                        },
                        {
                            "bbox": [
                                95,
                                236,
                                541,
                                249
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        95,
                                        236,
                                        541,
                                        249
                                    ],
                                    "score": 1.0,
                                    "content": "the output. While the non-matmul FLOPs only account for a small fraction of the total FLOPs, they",
                                    "type": "text"
                                }
                            ],
                            "index": 13
                        },
                        {
                            "bbox": [
                                95,
                                249,
                                541,
                                261
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        95,
                                        249,
                                        541,
                                        261
                                    ],
                                    "score": 1.0,
                                    "content": "take longer to perform as GPUs have specialized units for matrix multiply, and as a result the matmul",
                                    "type": "text"
                                }
                            ],
                            "index": 14
                        },
                        {
                            "bbox": [
                                95,
                                261,
                                542,
                                273
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        95,
                                        261,
                                        211,
                                        273
                                    ],
                                    "score": 1.0,
                                    "content": "throughput can be up to ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        212,
                                        263,
                                        228,
                                        271
                                    ],
                                    "score": 0.31,
                                    "content": "16\\times",
                                    "type": "inline_equation",
                                    "height": 8,
                                    "width": 16
                                },
                                {
                                    "bbox": [
                                        229,
                                        261,
                                        542,
                                        273
                                    ],
                                    "score": 1.0,
                                    "content": " higher than non-matmul throughput. It is thus important to reduce",
                                    "type": "text"
                                }
                            ],
                            "index": 15
                        },
                        {
                            "bbox": [
                                94,
                                272,
                                446,
                                286
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        94,
                                        272,
                                        446,
                                        286
                                    ],
                                    "score": 1.0,
                                    "content": "non-matmul FLOPs and spend as much time as possible doing matmul FLOPs.",
                                    "type": "text"
                                }
                            ],
                            "index": 16
                        },
                        {
                            "bbox": [
                                83,
                                293,
                                541,
                                305
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        83,
                                        293,
                                        541,
                                        305
                                    ],
                                    "score": 1.0,
                                    "content": "2. We propose to parallelize both the forward pass and backward pass along the sequence length dimension,",
                                    "type": "text"
                                }
                            ],
                            "index": 17
                        },
                        {
                            "bbox": [
                                95,
                                305,
                                540,
                                317
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        95,
                                        305,
                                        540,
                                        317
                                    ],
                                    "score": 1.0,
                                    "content": "in addition to the batch and number of heads dimension. This increases occupancy (utilization of GPU",
                                    "type": "text"
                                }
                            ],
                            "index": 18
                        },
                        {
                            "bbox": [
                                95,
                                317,
                                483,
                                329
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        95,
                                        317,
                                        483,
                                        329
                                    ],
                                    "score": 1.0,
                                    "content": "resources) in the case where the sequences are long (and hence batch size is often small).",
                                    "type": "text"
                                }
                            ],
                            "index": 19
                        },
                        {
                            "bbox": [
                                83,
                                337,
                                541,
                                349
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        83,
                                        337,
                                        541,
                                        349
                                    ],
                                    "score": 1.0,
                                    "content": "3. Even within one block of attention computation, we partition the work between different warps of a",
                                    "type": "text"
                                }
                            ],
                            "index": 20
                        },
                        {
                            "bbox": [
                                95,
                                348,
                                414,
                                360
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        95,
                                        348,
                                        414,
                                        360
                                    ],
                                    "score": 1.0,
                                    "content": "thread block to reduce communication and shared memory reads/writes.",
                                    "type": "text"
                                }
                            ],
                            "index": 21
                        }
                    ],
                    "index": 16.5
                },
                {
                    "type": "text",
                    "bbox": [
                        71,
                        368,
                        540,
                        439
                    ],
                    "lines": [
                        {
                            "bbox": [
                                85,
                                368,
                                541,
                                381
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        85,
                                        368,
                                        541,
                                        381
                                    ],
                                    "score": 1.0,
                                    "content": "In Section 4, we empirically validate that FlashAttention-2 yields significant speedup compared to",
                                    "type": "text"
                                }
                            ],
                            "index": 22
                        },
                        {
                            "bbox": [
                                70,
                                381,
                                541,
                                392
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        381,
                                        541,
                                        392
                                    ],
                                    "score": 1.0,
                                    "content": "even FlashAttention. Benchmarks on different settings (with or without causal mask, different head",
                                    "type": "text"
                                }
                            ],
                            "index": 23
                        },
                        {
                            "bbox": [
                                70,
                                392,
                                541,
                                405
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        392,
                                        340,
                                        405
                                    ],
                                    "score": 1.0,
                                    "content": "dimensions) show that FlashAttention-2 achieves around ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        340,
                                        395,
                                        352,
                                        402
                                    ],
                                    "score": 0.26,
                                    "content": "2\\times",
                                    "type": "inline_equation",
                                    "height": 7,
                                    "width": 12
                                },
                                {
                                    "bbox": [
                                        352,
                                        392,
                                        541,
                                        405
                                    ],
                                    "score": 1.0,
                                    "content": " speedup over FlashAttention, reaching",
                                    "type": "text"
                                }
                            ],
                            "index": 24
                        },
                        {
                            "bbox": [
                                72,
                                405,
                                541,
                                416
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        72,
                                        405,
                                        418,
                                        416
                                    ],
                                    "score": 1.0,
                                    "content": "up to 73% of the theoretical max throughput in the forward pass, and up to ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        418,
                                        406,
                                        437,
                                        415
                                    ],
                                    "score": 0.25,
                                    "content": "63\\%",
                                    "type": "inline_equation",
                                    "height": 9,
                                    "width": 19
                                },
                                {
                                    "bbox": [
                                        438,
                                        405,
                                        541,
                                        416
                                    ],
                                    "score": 1.0,
                                    "content": " of the theoretical max",
                                    "type": "text"
                                }
                            ],
                            "index": 25
                        },
                        {
                            "bbox": [
                                70,
                                416,
                                541,
                                429
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        416,
                                        541,
                                        429
                                    ],
                                    "score": 1.0,
                                    "content": "throughput in the backward pass. When used end-to-end to train GPT-style models, we reach training speed",
                                    "type": "text"
                                }
                            ],
                            "index": 26
                        },
                        {
                            "bbox": [
                                70,
                                428,
                                247,
                                441
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        428,
                                        247,
                                        441
                                    ],
                                    "score": 1.0,
                                    "content": "of up to 225 TFLOPs/s per A100 GPU.",
                                    "type": "text"
                                }
                            ],
                            "index": 27
                        }
                    ],
                    "index": 24.5
                },
                {
                    "type": "title",
                    "bbox": [
                        72,
                        457,
                        178,
                        474
                    ],
                    "lines": [
                        {
                            "bbox": [
                                70,
                                459,
                                178,
                                473
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        460,
                                        82,
                                        472
                                    ],
                                    "score": 1.0,
                                    "content": "2",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        91,
                                        459,
                                        178,
                                        473
                                    ],
                                    "score": 1.0,
                                    "content": "Background",
                                    "type": "text"
                                }
                            ],
                            "index": 28
                        }
                    ],
                    "index": 28
                },
                {
                    "type": "text",
                    "bbox": [
                        72,
                        482,
                        541,
                        506
                    ],
                    "lines": [
                        {
                            "bbox": [
                                72,
                                484,
                                541,
                                493
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        72,
                                        484,
                                        541,
                                        493
                                    ],
                                    "score": 1.0,
                                    "content": "We provide some background on the performance characteristics and execution model of GPUs. We also",
                                    "type": "text"
                                }
                            ],
                            "index": 29
                        },
                        {
                            "bbox": [
                                72,
                                497,
                                426,
                                506
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        72,
                                        497,
                                        426,
                                        506
                                    ],
                                    "score": 1.0,
                                    "content": "describe the standard implementation of attention, as well as FlashAttention.",
                                    "type": "text"
                                }
                            ],
                            "index": 30
                        }
                    ],
                    "index": 29.5
                },
                {
                    "type": "title",
                    "bbox": [
                        72,
                        520,
                        249,
                        534
                    ],
                    "lines": [
                        {
                            "bbox": [
                                70,
                                522,
                                248,
                                534
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        522,
                                        90,
                                        534
                                    ],
                                    "score": 1.0,
                                    "content": "2.1",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        101,
                                        522,
                                        248,
                                        533
                                    ],
                                    "score": 1.0,
                                    "content": "Hardware characteristics",
                                    "type": "text"
                                }
                            ],
                            "index": 31
                        }
                    ],
                    "index": 31
                },
                {
                    "type": "text",
                    "bbox": [
                        70,
                        540,
                        541,
                        636
                    ],
                    "lines": [
                        {
                            "bbox": [
                                70,
                                540,
                                541,
                                554
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        540,
                                        541,
                                        554
                                    ],
                                    "score": 1.0,
                                    "content": "GPU performance characteristics. The GPU consists of compute elements (e.g., floating point arithmetic",
                                    "type": "text"
                                }
                            ],
                            "index": 32
                        },
                        {
                            "bbox": [
                                71,
                                554,
                                541,
                                564
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        71,
                                        554,
                                        541,
                                        564
                                    ],
                                    "score": 1.0,
                                    "content": "units) and a memory hierarchy. Most modern GPUs contain specialized units to accelerate matrix multiply in",
                                    "type": "text"
                                }
                            ],
                            "index": 33
                        },
                        {
                            "bbox": [
                                70,
                                565,
                                542,
                                578
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        565,
                                        542,
                                        578
                                    ],
                                    "score": 1.0,
                                    "content": "low-precision (e.g., Tensor Cores on Nvidia GPUs for FP16/BF16 matrix multiply). The memory hierarchy",
                                    "type": "text"
                                }
                            ],
                            "index": 34
                        },
                        {
                            "bbox": [
                                70,
                                578,
                                540,
                                589
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        578,
                                        540,
                                        589
                                    ],
                                    "score": 1.0,
                                    "content": "comprise of high bandwidth memory (HBM), and on-chip SRAM (aka shared memory). As an example, the",
                                    "type": "text"
                                }
                            ],
                            "index": 35
                        },
                        {
                            "bbox": [
                                70,
                                588,
                                542,
                                601
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        588,
                                        542,
                                        601
                                    ],
                                    "score": 1.0,
                                    "content": "A100 GPU has 40-80GB of high bandwidth memory (HBM) with bandwidth 1.5-2.0TB/s and 192KB of",
                                    "type": "text"
                                }
                            ],
                            "index": 36
                        },
                        {
                            "bbox": [
                                71,
                                601,
                                542,
                                613
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        71,
                                        601,
                                        542,
                                        613
                                    ],
                                    "score": 1.0,
                                    "content": "on-chip SRAM per each of 108 streaming multiprocessors with bandwidth estimated around 19TB/s [6, 7].",
                                    "type": "text"
                                }
                            ],
                            "index": 37
                        },
                        {
                            "bbox": [
                                71,
                                613,
                                541,
                                625
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        71,
                                        613,
                                        541,
                                        625
                                    ],
                                    "score": 1.0,
                                    "content": "As the L2 cache is not directly controllable by the programmer, we focus on the HBM and SRAM for the",
                                    "type": "text"
                                }
                            ],
                            "index": 38
                        },
                        {
                            "bbox": [
                                70,
                                626,
                                187,
                                637
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        626,
                                        187,
                                        637
                                    ],
                                    "score": 1.0,
                                    "content": "purpose of this discussion.",
                                    "type": "text"
                                }
                            ],
                            "index": 39
                        }
                    ],
                    "index": 35.5
                },
                {
                    "type": "text",
                    "bbox": [
                        71,
                        637,
                        541,
                        708
                    ],
                    "lines": [
                        {
                            "bbox": [
                                86,
                                636,
                                540,
                                649
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        86,
                                        636,
                                        540,
                                        649
                                    ],
                                    "score": 1.0,
                                    "content": "Execution Model. GPUs have a massive number of threads to execute an operation (called a kernel).",
                                    "type": "text"
                                }
                            ],
                            "index": 40
                        },
                        {
                            "bbox": [
                                70,
                                648,
                                541,
                                661
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        648,
                                        541,
                                        661
                                    ],
                                    "score": 1.0,
                                    "content": "Threads are organized into thread blocks, which are scheduled to run on streaming multiprocessors (SMs).",
                                    "type": "text"
                                }
                            ],
                            "index": 41
                        },
                        {
                            "bbox": [
                                70,
                                661,
                                541,
                                673
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        661,
                                        541,
                                        673
                                    ],
                                    "score": 1.0,
                                    "content": "Within each thread blocks, threads are grouped into warps (a group of 32 threads). Threads within a warp",
                                    "type": "text"
                                }
                            ],
                            "index": 42
                        },
                        {
                            "bbox": [
                                71,
                                674,
                                540,
                                684
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        71,
                                        674,
                                        540,
                                        684
                                    ],
                                    "score": 1.0,
                                    "content": "can communicate by fast shuffle instructions or cooperate to perform matrix multiply. Warps within a thread",
                                    "type": "text"
                                }
                            ],
                            "index": 43
                        },
                        {
                            "bbox": [
                                71,
                                685,
                                541,
                                697
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        71,
                                        685,
                                        541,
                                        697
                                    ],
                                    "score": 1.0,
                                    "content": "block can communicate by reading from / writing to shared memory. Each kernel loads inputs from HBM to",
                                    "type": "text"
                                }
                            ],
                            "index": 44
                        },
                        {
                            "bbox": [
                                71,
                                696,
                                342,
                                709
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        71,
                                        696,
                                        342,
                                        709
                                    ],
                                    "score": 1.0,
                                    "content": "registers and SRAM, computes, then writes outputs to HBM.",
                                    "type": "text"
                                }
                            ],
                            "index": 45
                        }
                    ],
                    "index": 42.5
                }
            ],
            "layout_bboxes": [],
            "page_idx": 1,
            "page_size": [
                612.0,
                792.0
            ],
            "_layout_tree": [],
            "images": [],
            "tables": [],
            "interline_equations": [],
            "discarded_blocks": [
                {
                    "type": "discarded",
                    "bbox": [
                        302,
                        742,
                        309,
                        751
                    ],
                    "lines": [
                        {
                            "bbox": [
                                301,
                                741,
                                310,
                                754
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        301,
                                        741,
                                        310,
                                        754
                                    ],
                                    "score": 1.0,
                                    "content": "2",
                                    "type": "text"
                                }
                            ]
                        }
                    ]
                }
            ],
            "need_drop": false,
            "drop_reason": [],
            "para_blocks": [
                {
                    "type": "text",
                    "bbox": [
                        73,
                        73,
                        542,
                        96
                    ],
                    "lines": [],
                    "index": 0.5,
                    "page_num": "page_1",
                    "page_size": [
                        612.0,
                        792.0
                    ],
                    "bbox_fs": [
                        71,
                        74,
                        541,
                        96
                    ],
                    "lines_deleted": true
                },
                {
                    "type": "text",
                    "bbox": [
                        70,
                        97,
                        541,
                        192
                    ],
                    "lines": [
                        {
                            "bbox": [
                                85,
                                97,
                                541,
                                109
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        85,
                                        97,
                                        541,
                                        109
                                    ],
                                    "score": 1.0,
                                    "content": "However, context length increases even more, FlashAttention is still not nearly as efficient as other",
                                    "type": "text"
                                }
                            ],
                            "index": 2
                        },
                        {
                            "bbox": [
                                69,
                                109,
                                542,
                                122
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        69,
                                        109,
                                        505,
                                        122
                                    ],
                                    "score": 1.0,
                                    "content": "primitives such as matrix-multiply (GEMM). In particular, while FlashAttention is already 2-4",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        505,
                                        113,
                                        512,
                                        119
                                    ],
                                    "score": 0.25,
                                    "content": "\\times",
                                    "type": "inline_equation",
                                    "height": 6,
                                    "width": 7
                                },
                                {
                                    "bbox": [
                                        513,
                                        109,
                                        542,
                                        122
                                    ],
                                    "score": 1.0,
                                    "content": " faster",
                                    "type": "text"
                                }
                            ],
                            "index": 3
                        },
                        {
                            "bbox": [
                                71,
                                122,
                                541,
                                133
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        71,
                                        122,
                                        386,
                                        133
                                    ],
                                    "score": 1.0,
                                    "content": "than a standard attention implementation, the forward pass only reaches ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        387,
                                        123,
                                        418,
                                        132
                                    ],
                                    "score": 0.33,
                                    "content": "30\\mathrm{-}50\\%",
                                    "type": "inline_equation",
                                    "height": 9,
                                    "width": 31
                                },
                                {
                                    "bbox": [
                                        418,
                                        122,
                                        541,
                                        133
                                    ],
                                    "score": 1.0,
                                    "content": " of the theoretical maximum",
                                    "type": "text"
                                }
                            ],
                            "index": 4
                        },
                        {
                            "bbox": [
                                70,
                                132,
                                540,
                                146
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        132,
                                        507,
                                        146
                                    ],
                                    "score": 1.0,
                                    "content": "FLOPs/s of the device (Fig. 5), while the backward pass is even more challenging, reaching only ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        507,
                                        135,
                                        540,
                                        144
                                    ],
                                    "score": 0.61,
                                    "content": "25\\substack{-35\\%}",
                                    "type": "inline_equation",
                                    "height": 9,
                                    "width": 33
                                }
                            ],
                            "index": 5
                        },
                        {
                            "bbox": [
                                71,
                                146,
                                542,
                                157
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        71,
                                        146,
                                        542,
                                        157
                                    ],
                                    "score": 1.0,
                                    "content": "of maximum throughput on A100 GPU (Fig. 6). In contrast, optimized GEMM can reach up to 80-90% of",
                                    "type": "text"
                                }
                            ],
                            "index": 6
                        },
                        {
                            "bbox": [
                                70,
                                158,
                                541,
                                169
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        158,
                                        541,
                                        169
                                    ],
                                    "score": 1.0,
                                    "content": "the theoretical maximum device throughput. Through careful profiling, we observe that FlashAttention",
                                    "type": "text"
                                }
                            ],
                            "index": 7
                        },
                        {
                            "bbox": [
                                70,
                                170,
                                541,
                                181
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        170,
                                        541,
                                        181
                                    ],
                                    "score": 1.0,
                                    "content": "still has suboptimal work partitioning between different thread blocks and warps on the GPU, causing either",
                                    "type": "text"
                                }
                            ],
                            "index": 8
                        },
                        {
                            "bbox": [
                                69,
                                181,
                                334,
                                194
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        69,
                                        181,
                                        334,
                                        194
                                    ],
                                    "score": 1.0,
                                    "content": "low-occupancy or unnecessary shared memory reads/writes.",
                                    "type": "text"
                                }
                            ],
                            "index": 9
                        }
                    ],
                    "index": 5.5,
                    "page_num": "page_1",
                    "page_size": [
                        612.0,
                        792.0
                    ],
                    "bbox_fs": [
                        69,
                        97,
                        542,
                        194
                    ]
                },
                {
                    "type": "text",
                    "bbox": [
                        72,
                        193,
                        539,
                        217
                    ],
                    "lines": [
                        {
                            "bbox": [
                                86,
                                193,
                                541,
                                205
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        86,
                                        193,
                                        541,
                                        205
                                    ],
                                    "score": 1.0,
                                    "content": "Building on FlashAttention, we propose FlashAttention-2 with better parallelism and work",
                                    "type": "text"
                                }
                            ],
                            "index": 10
                        },
                        {
                            "bbox": [
                                71,
                                206,
                                246,
                                217
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        71,
                                        206,
                                        246,
                                        217
                                    ],
                                    "score": 1.0,
                                    "content": "partitioning to address these challenges.",
                                    "type": "text"
                                }
                            ],
                            "index": 11
                        }
                    ],
                    "index": 10.5,
                    "page_num": "page_1",
                    "page_size": [
                        612.0,
                        792.0
                    ],
                    "bbox_fs": [
                        71,
                        193,
                        541,
                        217
                    ]
                },
                {
                    "type": "text",
                    "bbox": [
                        82,
                        224,
                        542,
                        360
                    ],
                    "lines": [
                        {
                            "bbox": [
                                82,
                                223,
                                542,
                                238
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        82,
                                        223,
                                        542,
                                        238
                                    ],
                                    "score": 1.0,
                                    "content": "1. In Section 3.1, we tweak the algorithms to reduce the number of non-matmul FLOPs while not changing",
                                    "type": "text"
                                }
                            ],
                            "index": 12
                        },
                        {
                            "bbox": [
                                95,
                                236,
                                541,
                                249
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        95,
                                        236,
                                        541,
                                        249
                                    ],
                                    "score": 1.0,
                                    "content": "the output. While the non-matmul FLOPs only account for a small fraction of the total FLOPs, they",
                                    "type": "text"
                                }
                            ],
                            "index": 13
                        },
                        {
                            "bbox": [
                                95,
                                249,
                                541,
                                261
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        95,
                                        249,
                                        541,
                                        261
                                    ],
                                    "score": 1.0,
                                    "content": "take longer to perform as GPUs have specialized units for matrix multiply, and as a result the matmul",
                                    "type": "text"
                                }
                            ],
                            "index": 14
                        },
                        {
                            "bbox": [
                                95,
                                261,
                                542,
                                273
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        95,
                                        261,
                                        211,
                                        273
                                    ],
                                    "score": 1.0,
                                    "content": "throughput can be up to ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        212,
                                        263,
                                        228,
                                        271
                                    ],
                                    "score": 0.31,
                                    "content": "16\\times",
                                    "type": "inline_equation",
                                    "height": 8,
                                    "width": 16
                                },
                                {
                                    "bbox": [
                                        229,
                                        261,
                                        542,
                                        273
                                    ],
                                    "score": 1.0,
                                    "content": " higher than non-matmul throughput. It is thus important to reduce",
                                    "type": "text"
                                }
                            ],
                            "index": 15
                        },
                        {
                            "bbox": [
                                94,
                                272,
                                446,
                                286
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        94,
                                        272,
                                        446,
                                        286
                                    ],
                                    "score": 1.0,
                                    "content": "non-matmul FLOPs and spend as much time as possible doing matmul FLOPs.",
                                    "type": "text"
                                }
                            ],
                            "index": 16
                        },
                        {
                            "bbox": [
                                83,
                                293,
                                541,
                                305
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        83,
                                        293,
                                        541,
                                        305
                                    ],
                                    "score": 1.0,
                                    "content": "2. We propose to parallelize both the forward pass and backward pass along the sequence length dimension,",
                                    "type": "text"
                                }
                            ],
                            "index": 17
                        },
                        {
                            "bbox": [
                                95,
                                305,
                                540,
                                317
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        95,
                                        305,
                                        540,
                                        317
                                    ],
                                    "score": 1.0,
                                    "content": "in addition to the batch and number of heads dimension. This increases occupancy (utilization of GPU",
                                    "type": "text"
                                }
                            ],
                            "index": 18
                        },
                        {
                            "bbox": [
                                95,
                                317,
                                483,
                                329
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        95,
                                        317,
                                        483,
                                        329
                                    ],
                                    "score": 1.0,
                                    "content": "resources) in the case where the sequences are long (and hence batch size is often small).",
                                    "type": "text"
                                }
                            ],
                            "index": 19
                        },
                        {
                            "bbox": [
                                83,
                                337,
                                541,
                                349
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        83,
                                        337,
                                        541,
                                        349
                                    ],
                                    "score": 1.0,
                                    "content": "3. Even within one block of attention computation, we partition the work between different warps of a",
                                    "type": "text"
                                }
                            ],
                            "index": 20
                        },
                        {
                            "bbox": [
                                95,
                                348,
                                414,
                                360
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        95,
                                        348,
                                        414,
                                        360
                                    ],
                                    "score": 1.0,
                                    "content": "thread block to reduce communication and shared memory reads/writes.",
                                    "type": "text"
                                }
                            ],
                            "index": 21
                        }
                    ],
                    "index": 16.5,
                    "page_num": "page_1",
                    "page_size": [
                        612.0,
                        792.0
                    ],
                    "bbox_fs": [
                        82,
                        223,
                        542,
                        360
                    ]
                },
                {
                    "type": "text",
                    "bbox": [
                        71,
                        368,
                        540,
                        439
                    ],
                    "lines": [
                        {
                            "bbox": [
                                85,
                                368,
                                541,
                                381
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        85,
                                        368,
                                        541,
                                        381
                                    ],
                                    "score": 1.0,
                                    "content": "In Section 4, we empirically validate that FlashAttention-2 yields significant speedup compared to",
                                    "type": "text"
                                }
                            ],
                            "index": 22
                        },
                        {
                            "bbox": [
                                70,
                                381,
                                541,
                                392
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        381,
                                        541,
                                        392
                                    ],
                                    "score": 1.0,
                                    "content": "even FlashAttention. Benchmarks on different settings (with or without causal mask, different head",
                                    "type": "text"
                                }
                            ],
                            "index": 23
                        },
                        {
                            "bbox": [
                                70,
                                392,
                                541,
                                405
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        392,
                                        340,
                                        405
                                    ],
                                    "score": 1.0,
                                    "content": "dimensions) show that FlashAttention-2 achieves around ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        340,
                                        395,
                                        352,
                                        402
                                    ],
                                    "score": 0.26,
                                    "content": "2\\times",
                                    "type": "inline_equation",
                                    "height": 7,
                                    "width": 12
                                },
                                {
                                    "bbox": [
                                        352,
                                        392,
                                        541,
                                        405
                                    ],
                                    "score": 1.0,
                                    "content": " speedup over FlashAttention, reaching",
                                    "type": "text"
                                }
                            ],
                            "index": 24
                        },
                        {
                            "bbox": [
                                72,
                                405,
                                541,
                                416
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        72,
                                        405,
                                        418,
                                        416
                                    ],
                                    "score": 1.0,
                                    "content": "up to 73% of the theoretical max throughput in the forward pass, and up to ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        418,
                                        406,
                                        437,
                                        415
                                    ],
                                    "score": 0.25,
                                    "content": "63\\%",
                                    "type": "inline_equation",
                                    "height": 9,
                                    "width": 19
                                },
                                {
                                    "bbox": [
                                        438,
                                        405,
                                        541,
                                        416
                                    ],
                                    "score": 1.0,
                                    "content": " of the theoretical max",
                                    "type": "text"
                                }
                            ],
                            "index": 25
                        },
                        {
                            "bbox": [
                                70,
                                416,
                                541,
                                429
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        416,
                                        541,
                                        429
                                    ],
                                    "score": 1.0,
                                    "content": "throughput in the backward pass. When used end-to-end to train GPT-style models, we reach training speed",
                                    "type": "text"
                                }
                            ],
                            "index": 26
                        },
                        {
                            "bbox": [
                                70,
                                428,
                                247,
                                441
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        428,
                                        247,
                                        441
                                    ],
                                    "score": 1.0,
                                    "content": "of up to 225 TFLOPs/s per A100 GPU.",
                                    "type": "text"
                                }
                            ],
                            "index": 27
                        }
                    ],
                    "index": 24.5,
                    "page_num": "page_1",
                    "page_size": [
                        612.0,
                        792.0
                    ],
                    "bbox_fs": [
                        70,
                        368,
                        541,
                        441
                    ]
                },
                {
                    "type": "title",
                    "bbox": [
                        72,
                        457,
                        178,
                        474
                    ],
                    "lines": [
                        {
                            "bbox": [
                                70,
                                459,
                                178,
                                473
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        460,
                                        82,
                                        472
                                    ],
                                    "score": 1.0,
                                    "content": "2",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        91,
                                        459,
                                        178,
                                        473
                                    ],
                                    "score": 1.0,
                                    "content": "Background",
                                    "type": "text"
                                }
                            ],
                            "index": 28
                        }
                    ],
                    "index": 28,
                    "page_num": "page_1",
                    "page_size": [
                        612.0,
                        792.0
                    ]
                },
                {
                    "type": "text",
                    "bbox": [
                        72,
                        482,
                        541,
                        506
                    ],
                    "lines": [
                        {
                            "bbox": [
                                72,
                                484,
                                541,
                                493
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        72,
                                        484,
                                        541,
                                        493
                                    ],
                                    "score": 1.0,
                                    "content": "We provide some background on the performance characteristics and execution model of GPUs. We also",
                                    "type": "text"
                                }
                            ],
                            "index": 29
                        },
                        {
                            "bbox": [
                                72,
                                497,
                                426,
                                506
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        72,
                                        497,
                                        426,
                                        506
                                    ],
                                    "score": 1.0,
                                    "content": "describe the standard implementation of attention, as well as FlashAttention.",
                                    "type": "text"
                                }
                            ],
                            "index": 30
                        }
                    ],
                    "index": 29.5,
                    "page_num": "page_1",
                    "page_size": [
                        612.0,
                        792.0
                    ],
                    "bbox_fs": [
                        72,
                        484,
                        541,
                        506
                    ]
                },
                {
                    "type": "title",
                    "bbox": [
                        72,
                        520,
                        249,
                        534
                    ],
                    "lines": [
                        {
                            "bbox": [
                                70,
                                522,
                                248,
                                534
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        522,
                                        90,
                                        534
                                    ],
                                    "score": 1.0,
                                    "content": "2.1",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        101,
                                        522,
                                        248,
                                        533
                                    ],
                                    "score": 1.0,
                                    "content": "Hardware characteristics",
                                    "type": "text"
                                }
                            ],
                            "index": 31
                        }
                    ],
                    "index": 31,
                    "page_num": "page_1",
                    "page_size": [
                        612.0,
                        792.0
                    ]
                },
                {
                    "type": "text",
                    "bbox": [
                        70,
                        540,
                        541,
                        636
                    ],
                    "lines": [
                        {
                            "bbox": [
                                70,
                                540,
                                541,
                                554
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        540,
                                        541,
                                        554
                                    ],
                                    "score": 1.0,
                                    "content": "GPU performance characteristics. The GPU consists of compute elements (e.g., floating point arithmetic",
                                    "type": "text"
                                }
                            ],
                            "index": 32
                        },
                        {
                            "bbox": [
                                71,
                                554,
                                541,
                                564
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        71,
                                        554,
                                        541,
                                        564
                                    ],
                                    "score": 1.0,
                                    "content": "units) and a memory hierarchy. Most modern GPUs contain specialized units to accelerate matrix multiply in",
                                    "type": "text"
                                }
                            ],
                            "index": 33
                        },
                        {
                            "bbox": [
                                70,
                                565,
                                542,
                                578
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        565,
                                        542,
                                        578
                                    ],
                                    "score": 1.0,
                                    "content": "low-precision (e.g., Tensor Cores on Nvidia GPUs for FP16/BF16 matrix multiply). The memory hierarchy",
                                    "type": "text"
                                }
                            ],
                            "index": 34
                        },
                        {
                            "bbox": [
                                70,
                                578,
                                540,
                                589
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        578,
                                        540,
                                        589
                                    ],
                                    "score": 1.0,
                                    "content": "comprise of high bandwidth memory (HBM), and on-chip SRAM (aka shared memory). As an example, the",
                                    "type": "text"
                                }
                            ],
                            "index": 35
                        },
                        {
                            "bbox": [
                                70,
                                588,
                                542,
                                601
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        588,
                                        542,
                                        601
                                    ],
                                    "score": 1.0,
                                    "content": "A100 GPU has 40-80GB of high bandwidth memory (HBM) with bandwidth 1.5-2.0TB/s and 192KB of",
                                    "type": "text"
                                }
                            ],
                            "index": 36
                        },
                        {
                            "bbox": [
                                71,
                                601,
                                542,
                                613
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        71,
                                        601,
                                        542,
                                        613
                                    ],
                                    "score": 1.0,
                                    "content": "on-chip SRAM per each of 108 streaming multiprocessors with bandwidth estimated around 19TB/s [6, 7].",
                                    "type": "text"
                                }
                            ],
                            "index": 37
                        },
                        {
                            "bbox": [
                                71,
                                613,
                                541,
                                625
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        71,
                                        613,
                                        541,
                                        625
                                    ],
                                    "score": 1.0,
                                    "content": "As the L2 cache is not directly controllable by the programmer, we focus on the HBM and SRAM for the",
                                    "type": "text"
                                }
                            ],
                            "index": 38
                        },
                        {
                            "bbox": [
                                70,
                                626,
                                187,
                                637
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        626,
                                        187,
                                        637
                                    ],
                                    "score": 1.0,
                                    "content": "purpose of this discussion.",
                                    "type": "text"
                                }
                            ],
                            "index": 39
                        }
                    ],
                    "index": 35.5,
                    "page_num": "page_1",
                    "page_size": [
                        612.0,
                        792.0
                    ],
                    "bbox_fs": [
                        70,
                        540,
                        542,
                        637
                    ]
                },
                {
                    "type": "text",
                    "bbox": [
                        71,
                        637,
                        541,
                        708
                    ],
                    "lines": [
                        {
                            "bbox": [
                                86,
                                636,
                                540,
                                649
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        86,
                                        636,
                                        540,
                                        649
                                    ],
                                    "score": 1.0,
                                    "content": "Execution Model. GPUs have a massive number of threads to execute an operation (called a kernel).",
                                    "type": "text"
                                }
                            ],
                            "index": 40
                        },
                        {
                            "bbox": [
                                70,
                                648,
                                541,
                                661
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        648,
                                        541,
                                        661
                                    ],
                                    "score": 1.0,
                                    "content": "Threads are organized into thread blocks, which are scheduled to run on streaming multiprocessors (SMs).",
                                    "type": "text"
                                }
                            ],
                            "index": 41
                        },
                        {
                            "bbox": [
                                70,
                                661,
                                541,
                                673
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        661,
                                        541,
                                        673
                                    ],
                                    "score": 1.0,
                                    "content": "Within each thread blocks, threads are grouped into warps (a group of 32 threads). Threads within a warp",
                                    "type": "text"
                                }
                            ],
                            "index": 42
                        },
                        {
                            "bbox": [
                                71,
                                674,
                                540,
                                684
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        71,
                                        674,
                                        540,
                                        684
                                    ],
                                    "score": 1.0,
                                    "content": "can communicate by fast shuffle instructions or cooperate to perform matrix multiply. Warps within a thread",
                                    "type": "text"
                                }
                            ],
                            "index": 43
                        },
                        {
                            "bbox": [
                                71,
                                685,
                                541,
                                697
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        71,
                                        685,
                                        541,
                                        697
                                    ],
                                    "score": 1.0,
                                    "content": "block can communicate by reading from / writing to shared memory. Each kernel loads inputs from HBM to",
                                    "type": "text"
                                }
                            ],
                            "index": 44
                        },
                        {
                            "bbox": [
                                71,
                                696,
                                342,
                                709
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        71,
                                        696,
                                        342,
                                        709
                                    ],
                                    "score": 1.0,
                                    "content": "registers and SRAM, computes, then writes outputs to HBM.",
                                    "type": "text"
                                }
                            ],
                            "index": 45
                        }
                    ],
                    "index": 42.5,
                    "page_num": "page_1",
                    "page_size": [
                        612.0,
                        792.0
                    ],
                    "bbox_fs": [
                        70,
                        636,
                        541,
                        709
                    ]
                }
            ]
        },
        {
            "preproc_blocks": [
                {
                    "type": "title",
                    "bbox": [
                        70,
                        71,
                        316,
                        86
                    ],
                    "lines": [
                        {
                            "bbox": [
                                70,
                                73,
                                315,
                                85
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        73,
                                        91,
                                        85
                                    ],
                                    "score": 1.0,
                                    "content": "2.2",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        101,
                                        73,
                                        315,
                                        84
                                    ],
                                    "score": 1.0,
                                    "content": "Standard Attention Implementation",
                                    "type": "text"
                                }
                            ],
                            "index": 0
                        }
                    ],
                    "index": 0
                },
                {
                    "type": "text",
                    "bbox": [
                        68,
                        91,
                        541,
                        115
                    ],
                    "lines": [
                        {
                            "bbox": [
                                69,
                                89,
                                543,
                                105
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        69,
                                        89,
                                        170,
                                        105
                                    ],
                                    "score": 1.0,
                                    "content": "Given input sequences ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        170,
                                        92,
                                        237,
                                        103
                                    ],
                                    "score": 0.91,
                                    "content": "{\\bf Q},{\\bf K},{\\bf V}\\in\\mathbb{R}^{N\\times d}",
                                    "type": "inline_equation",
                                    "height": 11,
                                    "width": 67
                                },
                                {
                                    "bbox": [
                                        237,
                                        89,
                                        268,
                                        105
                                    ],
                                    "score": 1.0,
                                    "content": "where ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        268,
                                        95,
                                        276,
                                        101
                                    ],
                                    "score": 0.9,
                                    "content": "N",
                                    "type": "inline_equation",
                                    "height": 6,
                                    "width": 8
                                },
                                {
                                    "bbox": [
                                        277,
                                        89,
                                        396,
                                        105
                                    ],
                                    "score": 1.0,
                                    "content": "is the sequence length and ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        396,
                                        94,
                                        402,
                                        101
                                    ],
                                    "score": 0.89,
                                    "content": "d",
                                    "type": "inline_equation",
                                    "height": 7,
                                    "width": 6
                                },
                                {
                                    "bbox": [
                                        402,
                                        89,
                                        543,
                                        105
                                    ],
                                    "score": 1.0,
                                    "content": "is the head dimension, we want",
                                    "type": "text"
                                }
                            ],
                            "index": 1
                        },
                        {
                            "bbox": [
                                69,
                                102,
                                266,
                                117
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        69,
                                        102,
                                        266,
                                        117
                                    ],
                                    "score": 1.0,
                                    "content": "to compute the attention output O ∈ R𝑁 ×𝑑:",
                                    "type": "text"
                                }
                            ],
                            "index": 2
                        }
                    ],
                    "index": 1.5
                },
                {
                    "type": "interline_equation",
                    "bbox": [
                        165,
                        125,
                        444,
                        137
                    ],
                    "lines": [
                        {
                            "bbox": [
                                165,
                                125,
                                444,
                                137
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        165,
                                        125,
                                        444,
                                        137
                                    ],
                                    "score": 0.85,
                                    "content": "\\begin{array}{r}{\\mathbf{S}=\\mathbf{Q}\\mathbf{K}^{\\top}\\in\\mathbb{R}^{N\\times N},\\quad\\mathbf{P}=\\operatorname{softmax}(\\mathbf{S})\\in\\mathbb{R}^{N\\times N},\\quad\\mathbf{0}=\\mathbf{P}\\mathbf{V}\\in\\mathbb{R}^{N\\times d},}\\end{array}",
                                    "type": "interline_equation"
                                }
                            ]
                        }
                    ],
                    "index": 3,
                    "virtual_lines": [
                        {
                            "bbox": [
                                165,
                                125,
                                444,
                                137
                            ],
                            "spans": [],
                            "index": 3
                        }
                    ]
                },
                {
                    "type": "text",
                    "bbox": [
                        71,
                        146,
                        541,
                        171
                    ],
                    "lines": [
                        {
                            "bbox": [
                                71,
                                147,
                                541,
                                160
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        71,
                                        147,
                                        541,
                                        160
                                    ],
                                    "score": 1.0,
                                    "content": "where softmax is applied row-wise.2 For multi-head attention (MHA), this same computation is performed in",
                                    "type": "text"
                                }
                            ],
                            "index": 4
                        },
                        {
                            "bbox": [
                                71,
                                161,
                                536,
                                171
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        71,
                                        161,
                                        536,
                                        171
                                    ],
                                    "score": 1.0,
                                    "content": "parallel across many heads, and parallel over the batch dimension (number of input sequences in a batch).",
                                    "type": "text"
                                }
                            ],
                            "index": 5
                        }
                    ],
                    "index": 4.5
                },
                {
                    "type": "text",
                    "bbox": [
                        71,
                        172,
                        542,
                        196
                    ],
                    "lines": [
                        {
                            "bbox": [
                                84,
                                169,
                                542,
                                185
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        84,
                                        169,
                                        331,
                                        185
                                    ],
                                    "score": 1.0,
                                    "content": "The backward pass of attention proceeds as follows. Let ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        332,
                                        172,
                                        380,
                                        181
                                    ],
                                    "score": 0.92,
                                    "content": "\\mathbf{d}\\mathbf{0}\\in\\mathbb{R}^{N\\times d}",
                                    "type": "inline_equation",
                                    "height": 9,
                                    "width": 48
                                },
                                {
                                    "bbox": [
                                        380,
                                        169,
                                        464,
                                        185
                                    ],
                                    "score": 1.0,
                                    "content": "be the gradient of ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        464,
                                        174,
                                        471,
                                        181
                                    ],
                                    "score": 0.53,
                                    "content": "\\mathbf{0}",
                                    "type": "inline_equation",
                                    "height": 7,
                                    "width": 7
                                },
                                {
                                    "bbox": [
                                        471,
                                        169,
                                        542,
                                        185
                                    ],
                                    "score": 1.0,
                                    "content": " with respect to",
                                    "type": "text"
                                }
                            ],
                            "index": 6
                        },
                        {
                            "bbox": [
                                70,
                                184,
                                363,
                                195
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        184,
                                        363,
                                        195
                                    ],
                                    "score": 1.0,
                                    "content": "some loss function. Then by the chain rule (aka backpropagation):",
                                    "type": "text"
                                }
                            ],
                            "index": 7
                        }
                    ],
                    "index": 6.5
                },
                {
                    "type": "interline_equation",
                    "bbox": [
                        244,
                        202,
                        366,
                        285
                    ],
                    "lines": [
                        {
                            "bbox": [
                                244,
                                202,
                                366,
                                285
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        244,
                                        202,
                                        366,
                                        285
                                    ],
                                    "score": 0.93,
                                    "content": "\\begin{array}{r l}&{\\mathbf{d}{\\mathbf{V}}={\\mathbf{P}}^{\\top}\\mathbf{d}{\\mathbf{0}}\\in\\mathbb{R}^{N\\times d}}\\\\ &{{\\mathbf{d}}{\\mathbf{P}}={\\mathbf{d}}{\\mathbf{0}}{{\\mathbf{V}}}^{\\top}\\in\\mathbb{R}^{N\\times N}}\\\\ &{{\\mathbf{d}}{\\mathbf{S}}={\\mathrm{d}}{\\mathrm{softmax}}(\\mathbf{d}{\\mathbf{P}})\\in\\mathbb{R}^{N\\times N}}\\\\ &{{\\mathbf{d}}{\\mathbf{Q}}={\\mathbf{d}}{\\mathbf{S}}{{\\mathbf{K}}}\\in\\mathbb{R}^{N\\times d}}\\\\ &{{\\mathbf{d}}{\\mathbf{K}}={\\mathbf{Q}}{\\mathbf{d}}{\\mathbf{S}}^{\\top}\\in\\mathbb{R}^{N\\times d},}\\end{array}",
                                    "type": "interline_equation"
                                }
                            ]
                        }
                    ],
                    "index": 8.5,
                    "virtual_lines": [
                        {
                            "bbox": [
                                244,
                                202,
                                366,
                                243.5
                            ],
                            "spans": [],
                            "index": 8
                        },
                        {
                            "bbox": [
                                244,
                                243.5,
                                366,
                                285.0
                            ],
                            "spans": [],
                            "index": 9
                        }
                    ]
                },
                {
                    "type": "text",
                    "bbox": [
                        70,
                        293,
                        543,
                        317
                    ],
                    "lines": [
                        {
                            "bbox": [
                                72,
                                294,
                                541,
                                305
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        72,
                                        294,
                                        524,
                                        305
                                    ],
                                    "score": 1.0,
                                    "content": "where dsoftmax is the gradient (backward pass) of softmax applied row-wise. One can work out that if ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        524,
                                        296,
                                        541,
                                        305
                                    ],
                                    "score": 0.83,
                                    "content": "p=",
                                    "type": "inline_equation",
                                    "height": 9,
                                    "width": 17
                                }
                            ],
                            "index": 10
                        },
                        {
                            "bbox": [
                                70,
                                306,
                                541,
                                318
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        306,
                                        106,
                                        318
                                    ],
                                    "score": 1.0,
                                    "content": "softmax",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        106,
                                        307,
                                        118,
                                        317
                                    ],
                                    "score": 0.42,
                                    "content": "(s)",
                                    "type": "inline_equation",
                                    "height": 10,
                                    "width": 12
                                },
                                {
                                    "bbox": [
                                        118,
                                        306,
                                        189,
                                        318
                                    ],
                                    "score": 1.0,
                                    "content": " for some vector ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        189,
                                        310,
                                        194,
                                        315
                                    ],
                                    "score": 0.85,
                                    "content": "s",
                                    "type": "inline_equation",
                                    "height": 5,
                                    "width": 5
                                },
                                {
                                    "bbox": [
                                        194,
                                        306,
                                        215,
                                        318
                                    ],
                                    "score": 1.0,
                                    "content": "and ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        215,
                                        310,
                                        221,
                                        317
                                    ],
                                    "score": 0.88,
                                    "content": "p",
                                    "type": "inline_equation",
                                    "height": 7,
                                    "width": 6
                                },
                                {
                                    "bbox": [
                                        221,
                                        306,
                                        340,
                                        318
                                    ],
                                    "score": 1.0,
                                    "content": ", then with output gradient",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        341,
                                        308,
                                        352,
                                        317
                                    ],
                                    "score": 0.9,
                                    "content": "d p",
                                    "type": "inline_equation",
                                    "height": 9,
                                    "width": 11
                                },
                                {
                                    "bbox": [
                                        352,
                                        306,
                                        438,
                                        318
                                    ],
                                    "score": 1.0,
                                    "content": ", the input gradient ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        438,
                                        307,
                                        539,
                                        317
                                    ],
                                    "score": 0.91,
                                    "content": "d s=(\\mathrm{diag}(p)-p p^{\\top})d p",
                                    "type": "inline_equation",
                                    "height": 10,
                                    "width": 101
                                },
                                {
                                    "bbox": [
                                        539,
                                        306,
                                        541,
                                        318
                                    ],
                                    "score": 1.0,
                                    "content": ".",
                                    "type": "text"
                                }
                            ],
                            "index": 11
                        }
                    ],
                    "index": 10.5
                },
                {
                    "type": "text",
                    "bbox": [
                        70,
                        317,
                        541,
                        401
                    ],
                    "lines": [
                        {
                            "bbox": [
                                85,
                                317,
                                539,
                                329
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        85,
                                        317,
                                        397,
                                        329
                                    ],
                                    "score": 1.0,
                                    "content": "Standard attention implementations materialize the matrices S and ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        398,
                                        320,
                                        405,
                                        327
                                    ],
                                    "score": 0.88,
                                    "content": "\\mathbf{P}",
                                    "type": "inline_equation",
                                    "height": 7,
                                    "width": 7
                                },
                                {
                                    "bbox": [
                                        406,
                                        317,
                                        511,
                                        329
                                    ],
                                    "score": 1.0,
                                    "content": " to HBM, which takes ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        511,
                                        318,
                                        539,
                                        329
                                    ],
                                    "score": 0.92,
                                    "content": "O(N^{2})",
                                    "type": "inline_equation",
                                    "height": 11,
                                    "width": 28
                                }
                            ],
                            "index": 12
                        },
                        {
                            "bbox": [
                                70,
                                330,
                                541,
                                341
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        330,
                                        138,
                                        341
                                    ],
                                    "score": 1.0,
                                    "content": "memory. Often",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        139,
                                        332,
                                        168,
                                        339
                                    ],
                                    "score": 0.9,
                                    "content": "N\\gg d",
                                    "type": "inline_equation",
                                    "height": 7,
                                    "width": 29
                                },
                                {
                                    "bbox": [
                                        168,
                                        330,
                                        214,
                                        341
                                    ],
                                    "score": 1.0,
                                    "content": "(typically ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        214,
                                        332,
                                        222,
                                        339
                                    ],
                                    "score": 0.9,
                                    "content": "N",
                                    "type": "inline_equation",
                                    "height": 7,
                                    "width": 8
                                },
                                {
                                    "bbox": [
                                        223,
                                        330,
                                        348,
                                        341
                                    ],
                                    "score": 1.0,
                                    "content": "is on the order of 1k–8k and ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        348,
                                        332,
                                        354,
                                        339
                                    ],
                                    "score": 0.9,
                                    "content": "d",
                                    "type": "inline_equation",
                                    "height": 7,
                                    "width": 6
                                },
                                {
                                    "bbox": [
                                        354,
                                        330,
                                        541,
                                        341
                                    ],
                                    "score": 1.0,
                                    "content": "is around 64–128). The standard attention",
                                    "type": "text"
                                }
                            ],
                            "index": 13
                        },
                        {
                            "bbox": [
                                70,
                                342,
                                541,
                                353
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        342,
                                        412,
                                        353
                                    ],
                                    "score": 1.0,
                                    "content": "implementation (1) calls the matrix multiply (GEMM) subroutine to multiply ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        413,
                                        343,
                                        451,
                                        353
                                    ],
                                    "score": 0.92,
                                    "content": "\\mathbf{S}=\\mathbf{Q}\\mathbf{K}^{\\mathrm{~l~}}",
                                    "type": "inline_equation",
                                    "height": 10,
                                    "width": 38
                                },
                                {
                                    "bbox": [
                                        451,
                                        342,
                                        541,
                                        353
                                    ],
                                    "score": 1.0,
                                    "content": ", writes the result to",
                                    "type": "text"
                                }
                            ],
                            "index": 14
                        },
                        {
                            "bbox": [
                                70,
                                353,
                                541,
                                366
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        353,
                                        165,
                                        366
                                    ],
                                    "score": 1.0,
                                    "content": "HBM, then (2) loads ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        165,
                                        356,
                                        170,
                                        364
                                    ],
                                    "score": 0.83,
                                    "content": "\\S",
                                    "type": "inline_equation",
                                    "height": 8,
                                    "width": 5
                                },
                                {
                                    "bbox": [
                                        171,
                                        353,
                                        403,
                                        366
                                    ],
                                    "score": 1.0,
                                    "content": " from HBM to compute softmax and write the result ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        403,
                                        356,
                                        410,
                                        363
                                    ],
                                    "score": 0.89,
                                    "content": "\\mathbf{P}",
                                    "type": "inline_equation",
                                    "height": 7,
                                    "width": 7
                                },
                                {
                                    "bbox": [
                                        411,
                                        353,
                                        541,
                                        366
                                    ],
                                    "score": 1.0,
                                    "content": " to HBM, and finally (3) calls",
                                    "type": "text"
                                }
                            ],
                            "index": 15
                        },
                        {
                            "bbox": [
                                70,
                                366,
                                541,
                                377
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        366,
                                        136,
                                        377
                                    ],
                                    "score": 1.0,
                                    "content": "GEMM to get ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        136,
                                        367,
                                        169,
                                        375
                                    ],
                                    "score": 0.86,
                                    "content": "\\mathbf{0}=\\mathbf{PV}",
                                    "type": "inline_equation",
                                    "height": 8,
                                    "width": 33
                                },
                                {
                                    "bbox": [
                                        170,
                                        366,
                                        541,
                                        377
                                    ],
                                    "score": 1.0,
                                    "content": ". As most of the operations are bounded by memory bandwidth, the large number of",
                                    "type": "text"
                                }
                            ],
                            "index": 16
                        },
                        {
                            "bbox": [
                                69,
                                376,
                                541,
                                390
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        69,
                                        376,
                                        448,
                                        390
                                    ],
                                    "score": 1.0,
                                    "content": "memory accesses translates to slow wall-clock time. Moreover, the required memory is ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        449,
                                        378,
                                        477,
                                        389
                                    ],
                                    "score": 0.94,
                                    "content": "O(N^{2})",
                                    "type": "inline_equation",
                                    "height": 11,
                                    "width": 28
                                },
                                {
                                    "bbox": [
                                        477,
                                        376,
                                        541,
                                        390
                                    ],
                                    "score": 1.0,
                                    "content": " due to having",
                                    "type": "text"
                                }
                            ],
                            "index": 17
                        },
                        {
                            "bbox": [
                                69,
                                388,
                                543,
                                402
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        69,
                                        388,
                                        160,
                                        402
                                    ],
                                    "score": 1.0,
                                    "content": "to materialize S and ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        160,
                                        392,
                                        167,
                                        399
                                    ],
                                    "score": 0.88,
                                    "content": "\\mathbf{P}",
                                    "type": "inline_equation",
                                    "height": 7,
                                    "width": 7
                                },
                                {
                                    "bbox": [
                                        168,
                                        388,
                                        287,
                                        402
                                    ],
                                    "score": 1.0,
                                    "content": ". Moreover, one has to save ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        288,
                                        390,
                                        332,
                                        399
                                    ],
                                    "score": 0.93,
                                    "content": "\\mathbf{P}\\in\\mathbb{R}^{N\\times N}",
                                    "type": "inline_equation",
                                    "height": 9,
                                    "width": 44
                                },
                                {
                                    "bbox": [
                                        332,
                                        388,
                                        543,
                                        402
                                    ],
                                    "score": 1.0,
                                    "content": "for the backward pass to compute the gradients.",
                                    "type": "text"
                                }
                            ],
                            "index": 18
                        }
                    ],
                    "index": 15
                },
                {
                    "type": "title",
                    "bbox": [
                        71,
                        415,
                        208,
                        429
                    ],
                    "lines": [
                        {
                            "bbox": [
                                70,
                                415,
                                209,
                                429
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        415,
                                        91,
                                        429
                                    ],
                                    "score": 1.0,
                                    "content": "2.3",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        101,
                                        416,
                                        209,
                                        428
                                    ],
                                    "score": 1.0,
                                    "content": "FlashAttention",
                                    "type": "text"
                                }
                            ],
                            "index": 19
                        }
                    ],
                    "index": 19
                },
                {
                    "type": "text",
                    "bbox": [
                        70,
                        434,
                        541,
                        459
                    ],
                    "lines": [
                        {
                            "bbox": [
                                71,
                                436,
                                541,
                                448
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        71,
                                        436,
                                        541,
                                        448
                                    ],
                                    "score": 1.0,
                                    "content": "To speed up attention on hardware accelerators such as GPU, [5] proposes an algorithm to reduce the memory",
                                    "type": "text"
                                }
                            ],
                            "index": 20
                        },
                        {
                            "bbox": [
                                70,
                                448,
                                395,
                                459
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        448,
                                        395,
                                        459
                                    ],
                                    "score": 1.0,
                                    "content": "reads/writes while maintaining the same output (without approximation).",
                                    "type": "text"
                                }
                            ],
                            "index": 21
                        }
                    ],
                    "index": 20.5
                },
                {
                    "type": "title",
                    "bbox": [
                        71,
                        473,
                        173,
                        485
                    ],
                    "lines": [
                        {
                            "bbox": [
                                71,
                                474,
                                173,
                                485
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        71,
                                        474,
                                        97,
                                        484
                                    ],
                                    "score": 1.0,
                                    "content": "2.3.1",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        104,
                                        474,
                                        173,
                                        485
                                    ],
                                    "score": 1.0,
                                    "content": "Forward pass",
                                    "type": "text"
                                }
                            ],
                            "index": 22
                        }
                    ],
                    "index": 22
                },
                {
                    "type": "text",
                    "bbox": [
                        70,
                        491,
                        541,
                        574
                    ],
                    "lines": [
                        {
                            "bbox": [
                                70,
                                492,
                                542,
                                504
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        492,
                                        542,
                                        504
                                    ],
                                    "score": 1.0,
                                    "content": "FlashAttention applies the classical technique of tiling to reduce memory IOs, by (1) loading blocks of",
                                    "type": "text"
                                }
                            ],
                            "index": 23
                        },
                        {
                            "bbox": [
                                70,
                                504,
                                541,
                                516
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        504,
                                        541,
                                        516
                                    ],
                                    "score": 1.0,
                                    "content": "inputs from HBM to SRAM, (2) computing attention with respect to that block, and then (3) updating the",
                                    "type": "text"
                                }
                            ],
                            "index": 24
                        },
                        {
                            "bbox": [
                                70,
                                515,
                                541,
                                527
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        515,
                                        310,
                                        527
                                    ],
                                    "score": 1.0,
                                    "content": "output without writing the large intermediate matrices ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        310,
                                        518,
                                        316,
                                        525
                                    ],
                                    "score": 0.27,
                                    "content": "\\mathbf{S}",
                                    "type": "inline_equation",
                                    "height": 7,
                                    "width": 6
                                },
                                {
                                    "bbox": [
                                        317,
                                        515,
                                        338,
                                        527
                                    ],
                                    "score": 1.0,
                                    "content": " and ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        338,
                                        518,
                                        345,
                                        525
                                    ],
                                    "score": 0.89,
                                    "content": "\\mathbf{P}",
                                    "type": "inline_equation",
                                    "height": 7,
                                    "width": 7
                                },
                                {
                                    "bbox": [
                                        345,
                                        515,
                                        541,
                                        527
                                    ],
                                    "score": 1.0,
                                    "content": " to HBM. As the softmax couples entire rows",
                                    "type": "text"
                                }
                            ],
                            "index": 25
                        },
                        {
                            "bbox": [
                                70,
                                529,
                                541,
                                539
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        529,
                                        541,
                                        539
                                    ],
                                    "score": 1.0,
                                    "content": "or blocks of row, online softmax [11, 13] can split the attention computation into blocks, and rescale the",
                                    "type": "text"
                                }
                            ],
                            "index": 26
                        },
                        {
                            "bbox": [
                                70,
                                540,
                                541,
                                552
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        540,
                                        541,
                                        552
                                    ],
                                    "score": 1.0,
                                    "content": "output of each block to finally get the right result (with no approximation). By significantly reducing the",
                                    "type": "text"
                                }
                            ],
                            "index": 27
                        },
                        {
                            "bbox": [
                                70,
                                552,
                                541,
                                564
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        552,
                                        541,
                                        564
                                    ],
                                    "score": 1.0,
                                    "content": "amount of memory reads/writes, FlashAttention yields 2-4× wall-clock speedup over optimized baseline",
                                    "type": "text"
                                }
                            ],
                            "index": 28
                        },
                        {
                            "bbox": [
                                70,
                                564,
                                190,
                                576
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        564,
                                        190,
                                        576
                                    ],
                                    "score": 1.0,
                                    "content": "attention implementations.",
                                    "type": "text"
                                }
                            ],
                            "index": 29
                        }
                    ],
                    "index": 26
                },
                {
                    "type": "text",
                    "bbox": [
                        70,
                        575,
                        541,
                        637
                    ],
                    "lines": [
                        {
                            "bbox": [
                                86,
                                575,
                                541,
                                587
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        86,
                                        575,
                                        541,
                                        587
                                    ],
                                    "score": 1.0,
                                    "content": "We describe the online softmax technique [11] and how it is used in attention [13]. For simplicity, consider",
                                    "type": "text"
                                }
                            ],
                            "index": 30
                        },
                        {
                            "bbox": [
                                69,
                                586,
                                540,
                                600
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        69,
                                        586,
                                        322,
                                        599
                                    ],
                                    "score": 1.0,
                                    "content": "just one row block of the attention matrix S, of the form",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        323,
                                        587,
                                        374,
                                        600
                                    ],
                                    "score": 0.92,
                                    "content": "\\left[\\mathbf{S}^{(1)}\\quad\\mathbf{S}^{(2)}\\right]",
                                    "type": "inline_equation",
                                    "height": 13,
                                    "width": 51
                                },
                                {
                                    "bbox": [
                                        375,
                                        586,
                                        457,
                                        599
                                    ],
                                    "score": 1.0,
                                    "content": "for some matrices",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        457,
                                        587,
                                        538,
                                        599
                                    ],
                                    "score": 0.79,
                                    "content": "\\mathbf{S}^{(1)},\\mathbf{S}^{(2)}\\in\\mathbb{R}^{B_{r}\\times B_{c}}",
                                    "type": "inline_equation",
                                    "height": 12,
                                    "width": 81
                                },
                                {
                                    "bbox": [
                                        538,
                                        586,
                                        540,
                                        599
                                    ],
                                    "score": 1.0,
                                    "content": ",",
                                    "type": "text"
                                }
                            ],
                            "index": 31
                        },
                        {
                            "bbox": [
                                70,
                                599,
                                541,
                                612
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        599,
                                        100,
                                        612
                                    ],
                                    "score": 1.0,
                                    "content": "where ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        100,
                                        602,
                                        111,
                                        610
                                    ],
                                    "score": 0.91,
                                    "content": "B_{r}",
                                    "type": "inline_equation",
                                    "height": 8,
                                    "width": 11
                                },
                                {
                                    "bbox": [
                                        111,
                                        599,
                                        134,
                                        612
                                    ],
                                    "score": 1.0,
                                    "content": "and ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        134,
                                        602,
                                        145,
                                        610
                                    ],
                                    "score": 0.92,
                                    "content": "B_{c}",
                                    "type": "inline_equation",
                                    "height": 8,
                                    "width": 11
                                },
                                {
                                    "bbox": [
                                        145,
                                        599,
                                        541,
                                        612
                                    ],
                                    "score": 1.0,
                                    "content": "are the row and column block sizes. We want to compute softmax of this row block and",
                                    "type": "text"
                                }
                            ],
                            "index": 32
                        },
                        {
                            "bbox": [
                                69,
                                611,
                                542,
                                636
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        69,
                                        616,
                                        232,
                                        630
                                    ],
                                    "score": 1.0,
                                    "content": "multiply with the value, of the form",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        232,
                                        611,
                                        261,
                                        636
                                    ],
                                    "score": 0.92,
                                    "content": "\\left[\\mathbf{V}^{(1)}\\right]",
                                    "type": "inline_equation",
                                    "height": 25,
                                    "width": 29
                                },
                                {
                                    "bbox": [
                                        262,
                                        614,
                                        344,
                                        630
                                    ],
                                    "score": 1.0,
                                    "content": "for some matrices ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        345,
                                        617,
                                        363,
                                        627
                                    ],
                                    "score": 0.66,
                                    "content": "\\mathbf{V}^{(1)}",
                                    "type": "inline_equation",
                                    "height": 10,
                                    "width": 18
                                },
                                {
                                    "bbox": [
                                        364,
                                        614,
                                        368,
                                        630
                                    ],
                                    "score": 1.0,
                                    "content": ", ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        368,
                                        617,
                                        425,
                                        627
                                    ],
                                    "score": 0.62,
                                    "content": "{\\bf V}^{(2)}\\in\\mathbb{R}^{B_{c}\\times d}",
                                    "type": "inline_equation",
                                    "height": 10,
                                    "width": 57
                                },
                                {
                                    "bbox": [
                                        425,
                                        614,
                                        542,
                                        630
                                    ],
                                    "score": 1.0,
                                    "content": ". Standard softmax would",
                                    "type": "text"
                                }
                            ],
                            "index": 33
                        }
                    ],
                    "index": 31.5
                }
            ],
            "layout_bboxes": [],
            "page_idx": 2,
            "page_size": [
                612.0,
                792.0
            ],
            "_layout_tree": [],
            "images": [],
            "tables": [],
            "interline_equations": [
                {
                    "type": "interline_equation",
                    "bbox": [
                        165,
                        125,
                        444,
                        137
                    ],
                    "lines": [
                        {
                            "bbox": [
                                165,
                                125,
                                444,
                                137
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        165,
                                        125,
                                        444,
                                        137
                                    ],
                                    "score": 0.85,
                                    "content": "\\begin{array}{r}{\\mathbf{S}=\\mathbf{Q}\\mathbf{K}^{\\top}\\in\\mathbb{R}^{N\\times N},\\quad\\mathbf{P}=\\operatorname{softmax}(\\mathbf{S})\\in\\mathbb{R}^{N\\times N},\\quad\\mathbf{0}=\\mathbf{P}\\mathbf{V}\\in\\mathbb{R}^{N\\times d},}\\end{array}",
                                    "type": "interline_equation"
                                }
                            ]
                        }
                    ],
                    "index": 3,
                    "virtual_lines": [
                        {
                            "bbox": [
                                165,
                                125,
                                444,
                                137
                            ],
                            "spans": [],
                            "index": 3
                        }
                    ]
                },
                {
                    "type": "interline_equation",
                    "bbox": [
                        244,
                        202,
                        366,
                        285
                    ],
                    "lines": [
                        {
                            "bbox": [
                                244,
                                202,
                                366,
                                285
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        244,
                                        202,
                                        366,
                                        285
                                    ],
                                    "score": 0.93,
                                    "content": "\\begin{array}{r l}&{\\mathbf{d}{\\mathbf{V}}={\\mathbf{P}}^{\\top}\\mathbf{d}{\\mathbf{0}}\\in\\mathbb{R}^{N\\times d}}\\\\ &{{\\mathbf{d}}{\\mathbf{P}}={\\mathbf{d}}{\\mathbf{0}}{{\\mathbf{V}}}^{\\top}\\in\\mathbb{R}^{N\\times N}}\\\\ &{{\\mathbf{d}}{\\mathbf{S}}={\\mathrm{d}}{\\mathrm{softmax}}(\\mathbf{d}{\\mathbf{P}})\\in\\mathbb{R}^{N\\times N}}\\\\ &{{\\mathbf{d}}{\\mathbf{Q}}={\\mathbf{d}}{\\mathbf{S}}{{\\mathbf{K}}}\\in\\mathbb{R}^{N\\times d}}\\\\ &{{\\mathbf{d}}{\\mathbf{K}}={\\mathbf{Q}}{\\mathbf{d}}{\\mathbf{S}}^{\\top}\\in\\mathbb{R}^{N\\times d},}\\end{array}",
                                    "type": "interline_equation"
                                }
                            ]
                        }
                    ],
                    "index": 8.5,
                    "virtual_lines": [
                        {
                            "bbox": [
                                244,
                                202,
                                366,
                                243.5
                            ],
                            "spans": [],
                            "index": 8
                        },
                        {
                            "bbox": [
                                244,
                                243.5,
                                366,
                                285.0
                            ],
                            "spans": [],
                            "index": 9
                        }
                    ]
                }
            ],
            "discarded_blocks": [
                {
                    "type": "discarded",
                    "bbox": [
                        69,
                        643,
                        539,
                        664
                    ],
                    "lines": [
                        {
                            "bbox": [
                                81,
                                642,
                                541,
                                655
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        81,
                                        642,
                                        266,
                                        655
                                    ],
                                    "score": 1.0,
                                    "content": "2For clarity of exposition, we omit the scaling of ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        266,
                                        646,
                                        284,
                                        654
                                    ],
                                    "score": 0.65,
                                    "content": "\\mathbf{Q}\\mathbf{K}^{\\mathrm{~I~}}",
                                    "type": "inline_equation",
                                    "height": 8,
                                    "width": 18
                                },
                                {
                                    "bbox": [
                                        284,
                                        642,
                                        336,
                                        655
                                    ],
                                    "score": 1.0,
                                    "content": "(typically by ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        336,
                                        646,
                                        349,
                                        654
                                    ],
                                    "score": 0.7,
                                    "content": "1/\\mathrm{d}",
                                    "type": "inline_equation",
                                    "height": 8,
                                    "width": 13
                                },
                                {
                                    "bbox": [
                                        349,
                                        642,
                                        541,
                                        655
                                    ],
                                    "score": 1.0,
                                    "content": "), and optionally elementwise masking on S and/or",
                                    "type": "text"
                                }
                            ]
                        },
                        {
                            "bbox": [
                                70,
                                653,
                                149,
                                664
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        653,
                                        143,
                                        664
                                    ],
                                    "score": 1.0,
                                    "content": "dropout applied to ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        143,
                                        656,
                                        149,
                                        662
                                    ],
                                    "score": 0.57,
                                    "content": "\\mathbf{P}",
                                    "type": "inline_equation",
                                    "height": 6,
                                    "width": 6
                                }
                            ]
                        }
                    ]
                },
                {
                    "type": "discarded",
                    "bbox": [
                        302,
                        742,
                        309,
                        751
                    ],
                    "lines": [
                        {
                            "bbox": [
                                300,
                                741,
                                311,
                                754
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        300,
                                        741,
                                        311,
                                        754
                                    ],
                                    "score": 1.0,
                                    "content": "",
                                    "type": "text",
                                    "height": 13,
                                    "width": 11
                                }
                            ]
                        }
                    ]
                }
            ],
            "need_drop": false,
            "drop_reason": [],
            "para_blocks": [
                {
                    "type": "title",
                    "bbox": [
                        70,
                        71,
                        316,
                        86
                    ],
                    "lines": [
                        {
                            "bbox": [
                                70,
                                73,
                                315,
                                85
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        73,
                                        91,
                                        85
                                    ],
                                    "score": 1.0,
                                    "content": "2.2",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        101,
                                        73,
                                        315,
                                        84
                                    ],
                                    "score": 1.0,
                                    "content": "Standard Attention Implementation",
                                    "type": "text"
                                }
                            ],
                            "index": 0
                        }
                    ],
                    "index": 0,
                    "page_num": "page_2",
                    "page_size": [
                        612.0,
                        792.0
                    ]
                },
                {
                    "type": "text",
                    "bbox": [
                        68,
                        91,
                        541,
                        115
                    ],
                    "lines": [
                        {
                            "bbox": [
                                69,
                                89,
                                543,
                                105
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        69,
                                        89,
                                        170,
                                        105
                                    ],
                                    "score": 1.0,
                                    "content": "Given input sequences ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        170,
                                        92,
                                        237,
                                        103
                                    ],
                                    "score": 0.91,
                                    "content": "{\\bf Q},{\\bf K},{\\bf V}\\in\\mathbb{R}^{N\\times d}",
                                    "type": "inline_equation",
                                    "height": 11,
                                    "width": 67
                                },
                                {
                                    "bbox": [
                                        237,
                                        89,
                                        268,
                                        105
                                    ],
                                    "score": 1.0,
                                    "content": "where ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        268,
                                        95,
                                        276,
                                        101
                                    ],
                                    "score": 0.9,
                                    "content": "N",
                                    "type": "inline_equation",
                                    "height": 6,
                                    "width": 8
                                },
                                {
                                    "bbox": [
                                        277,
                                        89,
                                        396,
                                        105
                                    ],
                                    "score": 1.0,
                                    "content": "is the sequence length and ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        396,
                                        94,
                                        402,
                                        101
                                    ],
                                    "score": 0.89,
                                    "content": "d",
                                    "type": "inline_equation",
                                    "height": 7,
                                    "width": 6
                                },
                                {
                                    "bbox": [
                                        402,
                                        89,
                                        543,
                                        105
                                    ],
                                    "score": 1.0,
                                    "content": "is the head dimension, we want",
                                    "type": "text"
                                }
                            ],
                            "index": 1
                        },
                        {
                            "bbox": [
                                69,
                                102,
                                266,
                                117
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        69,
                                        102,
                                        266,
                                        117
                                    ],
                                    "score": 1.0,
                                    "content": "to compute the attention output O ∈ R𝑁 ×𝑑:",
                                    "type": "text"
                                }
                            ],
                            "index": 2
                        }
                    ],
                    "index": 1.5,
                    "page_num": "page_2",
                    "page_size": [
                        612.0,
                        792.0
                    ],
                    "bbox_fs": [
                        69,
                        89,
                        543,
                        117
                    ]
                },
                {
                    "type": "interline_equation",
                    "bbox": [
                        165,
                        125,
                        444,
                        137
                    ],
                    "lines": [
                        {
                            "bbox": [
                                165,
                                125,
                                444,
                                137
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        165,
                                        125,
                                        444,
                                        137
                                    ],
                                    "score": 0.85,
                                    "content": "\\begin{array}{r}{\\mathbf{S}=\\mathbf{Q}\\mathbf{K}^{\\top}\\in\\mathbb{R}^{N\\times N},\\quad\\mathbf{P}=\\operatorname{softmax}(\\mathbf{S})\\in\\mathbb{R}^{N\\times N},\\quad\\mathbf{0}=\\mathbf{P}\\mathbf{V}\\in\\mathbb{R}^{N\\times d},}\\end{array}",
                                    "type": "interline_equation"
                                }
                            ]
                        }
                    ],
                    "index": 3,
                    "virtual_lines": [
                        {
                            "bbox": [
                                165,
                                125,
                                444,
                                137
                            ],
                            "spans": [],
                            "index": 3
                        }
                    ],
                    "page_num": "page_2",
                    "page_size": [
                        612.0,
                        792.0
                    ]
                },
                {
                    "type": "text",
                    "bbox": [
                        71,
                        146,
                        541,
                        171
                    ],
                    "lines": [
                        {
                            "bbox": [
                                71,
                                147,
                                541,
                                160
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        71,
                                        147,
                                        541,
                                        160
                                    ],
                                    "score": 1.0,
                                    "content": "where softmax is applied row-wise.2 For multi-head attention (MHA), this same computation is performed in",
                                    "type": "text"
                                }
                            ],
                            "index": 4
                        },
                        {
                            "bbox": [
                                71,
                                161,
                                536,
                                171
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        71,
                                        161,
                                        536,
                                        171
                                    ],
                                    "score": 1.0,
                                    "content": "parallel across many heads, and parallel over the batch dimension (number of input sequences in a batch).",
                                    "type": "text"
                                }
                            ],
                            "index": 5
                        }
                    ],
                    "index": 4.5,
                    "page_num": "page_2",
                    "page_size": [
                        612.0,
                        792.0
                    ],
                    "bbox_fs": [
                        71,
                        147,
                        541,
                        171
                    ]
                },
                {
                    "type": "text",
                    "bbox": [
                        71,
                        172,
                        542,
                        196
                    ],
                    "lines": [
                        {
                            "bbox": [
                                84,
                                169,
                                542,
                                185
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        84,
                                        169,
                                        331,
                                        185
                                    ],
                                    "score": 1.0,
                                    "content": "The backward pass of attention proceeds as follows. Let ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        332,
                                        172,
                                        380,
                                        181
                                    ],
                                    "score": 0.92,
                                    "content": "\\mathbf{d}\\mathbf{0}\\in\\mathbb{R}^{N\\times d}",
                                    "type": "inline_equation",
                                    "height": 9,
                                    "width": 48
                                },
                                {
                                    "bbox": [
                                        380,
                                        169,
                                        464,
                                        185
                                    ],
                                    "score": 1.0,
                                    "content": "be the gradient of ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        464,
                                        174,
                                        471,
                                        181
                                    ],
                                    "score": 0.53,
                                    "content": "\\mathbf{0}",
                                    "type": "inline_equation",
                                    "height": 7,
                                    "width": 7
                                },
                                {
                                    "bbox": [
                                        471,
                                        169,
                                        542,
                                        185
                                    ],
                                    "score": 1.0,
                                    "content": " with respect to",
                                    "type": "text"
                                }
                            ],
                            "index": 6
                        },
                        {
                            "bbox": [
                                70,
                                184,
                                363,
                                195
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        184,
                                        363,
                                        195
                                    ],
                                    "score": 1.0,
                                    "content": "some loss function. Then by the chain rule (aka backpropagation):",
                                    "type": "text"
                                }
                            ],
                            "index": 7
                        }
                    ],
                    "index": 6.5,
                    "page_num": "page_2",
                    "page_size": [
                        612.0,
                        792.0
                    ],
                    "bbox_fs": [
                        70,
                        169,
                        542,
                        195
                    ]
                },
                {
                    "type": "interline_equation",
                    "bbox": [
                        244,
                        202,
                        366,
                        285
                    ],
                    "lines": [
                        {
                            "bbox": [
                                244,
                                202,
                                366,
                                285
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        244,
                                        202,
                                        366,
                                        285
                                    ],
                                    "score": 0.93,
                                    "content": "\\begin{array}{r l}&{\\mathbf{d}{\\mathbf{V}}={\\mathbf{P}}^{\\top}\\mathbf{d}{\\mathbf{0}}\\in\\mathbb{R}^{N\\times d}}\\\\ &{{\\mathbf{d}}{\\mathbf{P}}={\\mathbf{d}}{\\mathbf{0}}{{\\mathbf{V}}}^{\\top}\\in\\mathbb{R}^{N\\times N}}\\\\ &{{\\mathbf{d}}{\\mathbf{S}}={\\mathrm{d}}{\\mathrm{softmax}}(\\mathbf{d}{\\mathbf{P}})\\in\\mathbb{R}^{N\\times N}}\\\\ &{{\\mathbf{d}}{\\mathbf{Q}}={\\mathbf{d}}{\\mathbf{S}}{{\\mathbf{K}}}\\in\\mathbb{R}^{N\\times d}}\\\\ &{{\\mathbf{d}}{\\mathbf{K}}={\\mathbf{Q}}{\\mathbf{d}}{\\mathbf{S}}^{\\top}\\in\\mathbb{R}^{N\\times d},}\\end{array}",
                                    "type": "interline_equation"
                                }
                            ]
                        }
                    ],
                    "index": 8.5,
                    "virtual_lines": [
                        {
                            "bbox": [
                                244,
                                202,
                                366,
                                243.5
                            ],
                            "spans": [],
                            "index": 8
                        },
                        {
                            "bbox": [
                                244,
                                243.5,
                                366,
                                285.0
                            ],
                            "spans": [],
                            "index": 9
                        }
                    ],
                    "page_num": "page_2",
                    "page_size": [
                        612.0,
                        792.0
                    ]
                },
                {
                    "type": "text",
                    "bbox": [
                        70,
                        293,
                        543,
                        317
                    ],
                    "lines": [
                        {
                            "bbox": [
                                72,
                                294,
                                541,
                                305
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        72,
                                        294,
                                        524,
                                        305
                                    ],
                                    "score": 1.0,
                                    "content": "where dsoftmax is the gradient (backward pass) of softmax applied row-wise. One can work out that if ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        524,
                                        296,
                                        541,
                                        305
                                    ],
                                    "score": 0.83,
                                    "content": "p=",
                                    "type": "inline_equation",
                                    "height": 9,
                                    "width": 17
                                }
                            ],
                            "index": 10
                        },
                        {
                            "bbox": [
                                70,
                                306,
                                541,
                                318
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        306,
                                        106,
                                        318
                                    ],
                                    "score": 1.0,
                                    "content": "softmax",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        106,
                                        307,
                                        118,
                                        317
                                    ],
                                    "score": 0.42,
                                    "content": "(s)",
                                    "type": "inline_equation",
                                    "height": 10,
                                    "width": 12
                                },
                                {
                                    "bbox": [
                                        118,
                                        306,
                                        189,
                                        318
                                    ],
                                    "score": 1.0,
                                    "content": " for some vector ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        189,
                                        310,
                                        194,
                                        315
                                    ],
                                    "score": 0.85,
                                    "content": "s",
                                    "type": "inline_equation",
                                    "height": 5,
                                    "width": 5
                                },
                                {
                                    "bbox": [
                                        194,
                                        306,
                                        215,
                                        318
                                    ],
                                    "score": 1.0,
                                    "content": "and ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        215,
                                        310,
                                        221,
                                        317
                                    ],
                                    "score": 0.88,
                                    "content": "p",
                                    "type": "inline_equation",
                                    "height": 7,
                                    "width": 6
                                },
                                {
                                    "bbox": [
                                        221,
                                        306,
                                        340,
                                        318
                                    ],
                                    "score": 1.0,
                                    "content": ", then with output gradient",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        341,
                                        308,
                                        352,
                                        317
                                    ],
                                    "score": 0.9,
                                    "content": "d p",
                                    "type": "inline_equation",
                                    "height": 9,
                                    "width": 11
                                },
                                {
                                    "bbox": [
                                        352,
                                        306,
                                        438,
                                        318
                                    ],
                                    "score": 1.0,
                                    "content": ", the input gradient ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        438,
                                        307,
                                        539,
                                        317
                                    ],
                                    "score": 0.91,
                                    "content": "d s=(\\mathrm{diag}(p)-p p^{\\top})d p",
                                    "type": "inline_equation",
                                    "height": 10,
                                    "width": 101
                                },
                                {
                                    "bbox": [
                                        539,
                                        306,
                                        541,
                                        318
                                    ],
                                    "score": 1.0,
                                    "content": ".",
                                    "type": "text"
                                }
                            ],
                            "index": 11
                        }
                    ],
                    "index": 10.5,
                    "page_num": "page_2",
                    "page_size": [
                        612.0,
                        792.0
                    ],
                    "bbox_fs": [
                        70,
                        294,
                        541,
                        318
                    ]
                },
                {
                    "type": "text",
                    "bbox": [
                        70,
                        317,
                        541,
                        401
                    ],
                    "lines": [
                        {
                            "bbox": [
                                85,
                                317,
                                539,
                                329
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        85,
                                        317,
                                        397,
                                        329
                                    ],
                                    "score": 1.0,
                                    "content": "Standard attention implementations materialize the matrices S and ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        398,
                                        320,
                                        405,
                                        327
                                    ],
                                    "score": 0.88,
                                    "content": "\\mathbf{P}",
                                    "type": "inline_equation",
                                    "height": 7,
                                    "width": 7
                                },
                                {
                                    "bbox": [
                                        406,
                                        317,
                                        511,
                                        329
                                    ],
                                    "score": 1.0,
                                    "content": " to HBM, which takes ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        511,
                                        318,
                                        539,
                                        329
                                    ],
                                    "score": 0.92,
                                    "content": "O(N^{2})",
                                    "type": "inline_equation",
                                    "height": 11,
                                    "width": 28
                                }
                            ],
                            "index": 12
                        },
                        {
                            "bbox": [
                                70,
                                330,
                                541,
                                341
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        330,
                                        138,
                                        341
                                    ],
                                    "score": 1.0,
                                    "content": "memory. Often",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        139,
                                        332,
                                        168,
                                        339
                                    ],
                                    "score": 0.9,
                                    "content": "N\\gg d",
                                    "type": "inline_equation",
                                    "height": 7,
                                    "width": 29
                                },
                                {
                                    "bbox": [
                                        168,
                                        330,
                                        214,
                                        341
                                    ],
                                    "score": 1.0,
                                    "content": "(typically ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        214,
                                        332,
                                        222,
                                        339
                                    ],
                                    "score": 0.9,
                                    "content": "N",
                                    "type": "inline_equation",
                                    "height": 7,
                                    "width": 8
                                },
                                {
                                    "bbox": [
                                        223,
                                        330,
                                        348,
                                        341
                                    ],
                                    "score": 1.0,
                                    "content": "is on the order of 1k–8k and ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        348,
                                        332,
                                        354,
                                        339
                                    ],
                                    "score": 0.9,
                                    "content": "d",
                                    "type": "inline_equation",
                                    "height": 7,
                                    "width": 6
                                },
                                {
                                    "bbox": [
                                        354,
                                        330,
                                        541,
                                        341
                                    ],
                                    "score": 1.0,
                                    "content": "is around 64–128). The standard attention",
                                    "type": "text"
                                }
                            ],
                            "index": 13
                        },
                        {
                            "bbox": [
                                70,
                                342,
                                541,
                                353
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        342,
                                        412,
                                        353
                                    ],
                                    "score": 1.0,
                                    "content": "implementation (1) calls the matrix multiply (GEMM) subroutine to multiply ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        413,
                                        343,
                                        451,
                                        353
                                    ],
                                    "score": 0.92,
                                    "content": "\\mathbf{S}=\\mathbf{Q}\\mathbf{K}^{\\mathrm{~l~}}",
                                    "type": "inline_equation",
                                    "height": 10,
                                    "width": 38
                                },
                                {
                                    "bbox": [
                                        451,
                                        342,
                                        541,
                                        353
                                    ],
                                    "score": 1.0,
                                    "content": ", writes the result to",
                                    "type": "text"
                                }
                            ],
                            "index": 14
                        },
                        {
                            "bbox": [
                                70,
                                353,
                                541,
                                366
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        353,
                                        165,
                                        366
                                    ],
                                    "score": 1.0,
                                    "content": "HBM, then (2) loads ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        165,
                                        356,
                                        170,
                                        364
                                    ],
                                    "score": 0.83,
                                    "content": "\\S",
                                    "type": "inline_equation",
                                    "height": 8,
                                    "width": 5
                                },
                                {
                                    "bbox": [
                                        171,
                                        353,
                                        403,
                                        366
                                    ],
                                    "score": 1.0,
                                    "content": " from HBM to compute softmax and write the result ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        403,
                                        356,
                                        410,
                                        363
                                    ],
                                    "score": 0.89,
                                    "content": "\\mathbf{P}",
                                    "type": "inline_equation",
                                    "height": 7,
                                    "width": 7
                                },
                                {
                                    "bbox": [
                                        411,
                                        353,
                                        541,
                                        366
                                    ],
                                    "score": 1.0,
                                    "content": " to HBM, and finally (3) calls",
                                    "type": "text"
                                }
                            ],
                            "index": 15
                        },
                        {
                            "bbox": [
                                70,
                                366,
                                541,
                                377
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        366,
                                        136,
                                        377
                                    ],
                                    "score": 1.0,
                                    "content": "GEMM to get ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        136,
                                        367,
                                        169,
                                        375
                                    ],
                                    "score": 0.86,
                                    "content": "\\mathbf{0}=\\mathbf{PV}",
                                    "type": "inline_equation",
                                    "height": 8,
                                    "width": 33
                                },
                                {
                                    "bbox": [
                                        170,
                                        366,
                                        541,
                                        377
                                    ],
                                    "score": 1.0,
                                    "content": ". As most of the operations are bounded by memory bandwidth, the large number of",
                                    "type": "text"
                                }
                            ],
                            "index": 16
                        },
                        {
                            "bbox": [
                                69,
                                376,
                                541,
                                390
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        69,
                                        376,
                                        448,
                                        390
                                    ],
                                    "score": 1.0,
                                    "content": "memory accesses translates to slow wall-clock time. Moreover, the required memory is ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        449,
                                        378,
                                        477,
                                        389
                                    ],
                                    "score": 0.94,
                                    "content": "O(N^{2})",
                                    "type": "inline_equation",
                                    "height": 11,
                                    "width": 28
                                },
                                {
                                    "bbox": [
                                        477,
                                        376,
                                        541,
                                        390
                                    ],
                                    "score": 1.0,
                                    "content": " due to having",
                                    "type": "text"
                                }
                            ],
                            "index": 17
                        },
                        {
                            "bbox": [
                                69,
                                388,
                                543,
                                402
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        69,
                                        388,
                                        160,
                                        402
                                    ],
                                    "score": 1.0,
                                    "content": "to materialize S and ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        160,
                                        392,
                                        167,
                                        399
                                    ],
                                    "score": 0.88,
                                    "content": "\\mathbf{P}",
                                    "type": "inline_equation",
                                    "height": 7,
                                    "width": 7
                                },
                                {
                                    "bbox": [
                                        168,
                                        388,
                                        287,
                                        402
                                    ],
                                    "score": 1.0,
                                    "content": ". Moreover, one has to save ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        288,
                                        390,
                                        332,
                                        399
                                    ],
                                    "score": 0.93,
                                    "content": "\\mathbf{P}\\in\\mathbb{R}^{N\\times N}",
                                    "type": "inline_equation",
                                    "height": 9,
                                    "width": 44
                                },
                                {
                                    "bbox": [
                                        332,
                                        388,
                                        543,
                                        402
                                    ],
                                    "score": 1.0,
                                    "content": "for the backward pass to compute the gradients.",
                                    "type": "text"
                                }
                            ],
                            "index": 18
                        }
                    ],
                    "index": 15,
                    "page_num": "page_2",
                    "page_size": [
                        612.0,
                        792.0
                    ],
                    "bbox_fs": [
                        69,
                        317,
                        543,
                        402
                    ]
                },
                {
                    "type": "title",
                    "bbox": [
                        71,
                        415,
                        208,
                        429
                    ],
                    "lines": [
                        {
                            "bbox": [
                                70,
                                415,
                                209,
                                429
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        415,
                                        91,
                                        429
                                    ],
                                    "score": 1.0,
                                    "content": "2.3",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        101,
                                        416,
                                        209,
                                        428
                                    ],
                                    "score": 1.0,
                                    "content": "FlashAttention",
                                    "type": "text"
                                }
                            ],
                            "index": 19
                        }
                    ],
                    "index": 19,
                    "page_num": "page_2",
                    "page_size": [
                        612.0,
                        792.0
                    ]
                },
                {
                    "type": "text",
                    "bbox": [
                        70,
                        434,
                        541,
                        459
                    ],
                    "lines": [
                        {
                            "bbox": [
                                71,
                                436,
                                541,
                                448
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        71,
                                        436,
                                        541,
                                        448
                                    ],
                                    "score": 1.0,
                                    "content": "To speed up attention on hardware accelerators such as GPU, [5] proposes an algorithm to reduce the memory",
                                    "type": "text"
                                }
                            ],
                            "index": 20
                        },
                        {
                            "bbox": [
                                70,
                                448,
                                395,
                                459
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        448,
                                        395,
                                        459
                                    ],
                                    "score": 1.0,
                                    "content": "reads/writes while maintaining the same output (without approximation).",
                                    "type": "text"
                                }
                            ],
                            "index": 21
                        }
                    ],
                    "index": 20.5,
                    "page_num": "page_2",
                    "page_size": [
                        612.0,
                        792.0
                    ],
                    "bbox_fs": [
                        70,
                        436,
                        541,
                        459
                    ]
                },
                {
                    "type": "title",
                    "bbox": [
                        71,
                        473,
                        173,
                        485
                    ],
                    "lines": [
                        {
                            "bbox": [
                                71,
                                474,
                                173,
                                485
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        71,
                                        474,
                                        97,
                                        484
                                    ],
                                    "score": 1.0,
                                    "content": "2.3.1",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        104,
                                        474,
                                        173,
                                        485
                                    ],
                                    "score": 1.0,
                                    "content": "Forward pass",
                                    "type": "text"
                                }
                            ],
                            "index": 22
                        }
                    ],
                    "index": 22,
                    "page_num": "page_2",
                    "page_size": [
                        612.0,
                        792.0
                    ]
                },
                {
                    "type": "text",
                    "bbox": [
                        70,
                        491,
                        541,
                        574
                    ],
                    "lines": [
                        {
                            "bbox": [
                                70,
                                492,
                                542,
                                504
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        492,
                                        542,
                                        504
                                    ],
                                    "score": 1.0,
                                    "content": "FlashAttention applies the classical technique of tiling to reduce memory IOs, by (1) loading blocks of",
                                    "type": "text"
                                }
                            ],
                            "index": 23
                        },
                        {
                            "bbox": [
                                70,
                                504,
                                541,
                                516
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        504,
                                        541,
                                        516
                                    ],
                                    "score": 1.0,
                                    "content": "inputs from HBM to SRAM, (2) computing attention with respect to that block, and then (3) updating the",
                                    "type": "text"
                                }
                            ],
                            "index": 24
                        },
                        {
                            "bbox": [
                                70,
                                515,
                                541,
                                527
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        515,
                                        310,
                                        527
                                    ],
                                    "score": 1.0,
                                    "content": "output without writing the large intermediate matrices ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        310,
                                        518,
                                        316,
                                        525
                                    ],
                                    "score": 0.27,
                                    "content": "\\mathbf{S}",
                                    "type": "inline_equation",
                                    "height": 7,
                                    "width": 6
                                },
                                {
                                    "bbox": [
                                        317,
                                        515,
                                        338,
                                        527
                                    ],
                                    "score": 1.0,
                                    "content": " and ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        338,
                                        518,
                                        345,
                                        525
                                    ],
                                    "score": 0.89,
                                    "content": "\\mathbf{P}",
                                    "type": "inline_equation",
                                    "height": 7,
                                    "width": 7
                                },
                                {
                                    "bbox": [
                                        345,
                                        515,
                                        541,
                                        527
                                    ],
                                    "score": 1.0,
                                    "content": " to HBM. As the softmax couples entire rows",
                                    "type": "text"
                                }
                            ],
                            "index": 25
                        },
                        {
                            "bbox": [
                                70,
                                529,
                                541,
                                539
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        529,
                                        541,
                                        539
                                    ],
                                    "score": 1.0,
                                    "content": "or blocks of row, online softmax [11, 13] can split the attention computation into blocks, and rescale the",
                                    "type": "text"
                                }
                            ],
                            "index": 26
                        },
                        {
                            "bbox": [
                                70,
                                540,
                                541,
                                552
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        540,
                                        541,
                                        552
                                    ],
                                    "score": 1.0,
                                    "content": "output of each block to finally get the right result (with no approximation). By significantly reducing the",
                                    "type": "text"
                                }
                            ],
                            "index": 27
                        },
                        {
                            "bbox": [
                                70,
                                552,
                                541,
                                564
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        552,
                                        541,
                                        564
                                    ],
                                    "score": 1.0,
                                    "content": "amount of memory reads/writes, FlashAttention yields 2-4× wall-clock speedup over optimized baseline",
                                    "type": "text"
                                }
                            ],
                            "index": 28
                        },
                        {
                            "bbox": [
                                70,
                                564,
                                190,
                                576
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        564,
                                        190,
                                        576
                                    ],
                                    "score": 1.0,
                                    "content": "attention implementations.",
                                    "type": "text"
                                }
                            ],
                            "index": 29
                        }
                    ],
                    "index": 26,
                    "page_num": "page_2",
                    "page_size": [
                        612.0,
                        792.0
                    ],
                    "bbox_fs": [
                        70,
                        492,
                        542,
                        576
                    ]
                },
                {
                    "type": "text",
                    "bbox": [
                        70,
                        575,
                        541,
                        637
                    ],
                    "lines": [
                        {
                            "bbox": [
                                86,
                                575,
                                541,
                                587
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        86,
                                        575,
                                        541,
                                        587
                                    ],
                                    "score": 1.0,
                                    "content": "We describe the online softmax technique [11] and how it is used in attention [13]. For simplicity, consider",
                                    "type": "text"
                                }
                            ],
                            "index": 30
                        },
                        {
                            "bbox": [
                                69,
                                586,
                                540,
                                600
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        69,
                                        586,
                                        322,
                                        599
                                    ],
                                    "score": 1.0,
                                    "content": "just one row block of the attention matrix S, of the form",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        323,
                                        587,
                                        374,
                                        600
                                    ],
                                    "score": 0.92,
                                    "content": "\\left[\\mathbf{S}^{(1)}\\quad\\mathbf{S}^{(2)}\\right]",
                                    "type": "inline_equation",
                                    "height": 13,
                                    "width": 51
                                },
                                {
                                    "bbox": [
                                        375,
                                        586,
                                        457,
                                        599
                                    ],
                                    "score": 1.0,
                                    "content": "for some matrices",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        457,
                                        587,
                                        538,
                                        599
                                    ],
                                    "score": 0.79,
                                    "content": "\\mathbf{S}^{(1)},\\mathbf{S}^{(2)}\\in\\mathbb{R}^{B_{r}\\times B_{c}}",
                                    "type": "inline_equation",
                                    "height": 12,
                                    "width": 81
                                },
                                {
                                    "bbox": [
                                        538,
                                        586,
                                        540,
                                        599
                                    ],
                                    "score": 1.0,
                                    "content": ",",
                                    "type": "text"
                                }
                            ],
                            "index": 31
                        },
                        {
                            "bbox": [
                                70,
                                599,
                                541,
                                612
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        599,
                                        100,
                                        612
                                    ],
                                    "score": 1.0,
                                    "content": "where ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        100,
                                        602,
                                        111,
                                        610
                                    ],
                                    "score": 0.91,
                                    "content": "B_{r}",
                                    "type": "inline_equation",
                                    "height": 8,
                                    "width": 11
                                },
                                {
                                    "bbox": [
                                        111,
                                        599,
                                        134,
                                        612
                                    ],
                                    "score": 1.0,
                                    "content": "and ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        134,
                                        602,
                                        145,
                                        610
                                    ],
                                    "score": 0.92,
                                    "content": "B_{c}",
                                    "type": "inline_equation",
                                    "height": 8,
                                    "width": 11
                                },
                                {
                                    "bbox": [
                                        145,
                                        599,
                                        541,
                                        612
                                    ],
                                    "score": 1.0,
                                    "content": "are the row and column block sizes. We want to compute softmax of this row block and",
                                    "type": "text"
                                }
                            ],
                            "index": 32
                        },
                        {
                            "bbox": [
                                69,
                                611,
                                542,
                                636
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        69,
                                        616,
                                        232,
                                        630
                                    ],
                                    "score": 1.0,
                                    "content": "multiply with the value, of the form",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        232,
                                        611,
                                        261,
                                        636
                                    ],
                                    "score": 0.92,
                                    "content": "\\left[\\mathbf{V}^{(1)}\\right]",
                                    "type": "inline_equation",
                                    "height": 25,
                                    "width": 29
                                },
                                {
                                    "bbox": [
                                        262,
                                        614,
                                        344,
                                        630
                                    ],
                                    "score": 1.0,
                                    "content": "for some matrices ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        345,
                                        617,
                                        363,
                                        627
                                    ],
                                    "score": 0.66,
                                    "content": "\\mathbf{V}^{(1)}",
                                    "type": "inline_equation",
                                    "height": 10,
                                    "width": 18
                                },
                                {
                                    "bbox": [
                                        364,
                                        614,
                                        368,
                                        630
                                    ],
                                    "score": 1.0,
                                    "content": ", ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        368,
                                        617,
                                        425,
                                        627
                                    ],
                                    "score": 0.62,
                                    "content": "{\\bf V}^{(2)}\\in\\mathbb{R}^{B_{c}\\times d}",
                                    "type": "inline_equation",
                                    "height": 10,
                                    "width": 57
                                },
                                {
                                    "bbox": [
                                        425,
                                        614,
                                        542,
                                        630
                                    ],
                                    "score": 1.0,
                                    "content": ". Standard softmax would",
                                    "type": "text"
                                }
                            ],
                            "index": 33
                        }
                    ],
                    "index": 31.5,
                    "page_num": "page_2",
                    "page_size": [
                        612.0,
                        792.0
                    ],
                    "bbox_fs": [
                        69,
                        575,
                        542,
                        636
                    ]
                }
            ]
        },
        {
            "preproc_blocks": [
                {
                    "type": "text",
                    "bbox": [
                        70,
                        74,
                        112,
                        85
                    ],
                    "lines": [
                        {
                            "bbox": [
                                71,
                                75,
                                112,
                                85
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        71,
                                        75,
                                        112,
                                        85
                                    ],
                                    "score": 1.0,
                                    "content": "compute:",
                                    "type": "text"
                                }
                            ],
                            "index": 0
                        }
                    ],
                    "index": 0
                },
                {
                    "type": "interline_equation",
                    "bbox": [
                        153,
                        92,
                        459,
                        180
                    ],
                    "lines": [
                        {
                            "bbox": [
                                153,
                                92,
                                459,
                                180
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        153,
                                        92,
                                        459,
                                        180
                                    ],
                                    "score": 0.94,
                                    "content": "\\begin{array}{r l}&{m=\\operatorname*{max}(\\operatorname{rowmax}(\\mathbf{S}^{(1)}),\\operatorname{rowmax}(\\mathbf{S}^{(2)}))\\in\\mathbb{R}^{B_{r}}}\\\\ &{\\ell=\\operatorname{rowsum}(e^{\\mathbf{S}^{(1)}-m})+\\operatorname{rowsum}(e^{\\mathbf{S}^{(2)}-m})\\in\\mathbb{R}^{B_{r}}}\\\\ &{\\mathbf{P}=\\left[\\mathbf{P}^{(1)}\\quad\\mathbf{P}^{(2)}\\right]=\\operatorname{diag}(\\ell)^{-1}\\left[e^{\\mathbf{S}^{(1)}-m}\\quad e^{\\mathbf{S}^{(2)}-m}\\right]\\in\\mathbb{R}^{B_{r}\\times2B_{c}}}\\\\ &{\\mathbf{0}=\\left[\\mathbf{P}^{(1)}\\quad\\mathbf{P}^{(2)}\\right]\\left[\\mathbf{V}^{(1)}\\right]=\\operatorname{diag}(\\ell)^{-1}e^{\\mathbf{S}^{(1)}-m}\\mathbf{V}^{(1)}+e^{\\mathbf{S}^{(2)}-m}\\mathbf{V}^{(2)}\\in\\mathbb{R}^{B_{r}\\times d}.}\\end{array}",
                                    "type": "interline_equation"
                                }
                            ]
                        }
                    ],
                    "index": 2,
                    "virtual_lines": [
                        {
                            "bbox": [
                                153,
                                92,
                                459,
                                121.33333333333333
                            ],
                            "spans": [],
                            "index": 1
                        },
                        {
                            "bbox": [
                                153,
                                121.33333333333333,
                                459,
                                150.66666666666666
                            ],
                            "spans": [],
                            "index": 2
                        },
                        {
                            "bbox": [
                                153,
                                150.66666666666666,
                                459,
                                180.0
                            ],
                            "spans": [],
                            "index": 3
                        }
                    ]
                },
                {
                    "type": "text",
                    "bbox": [
                        70,
                        185,
                        540,
                        209
                    ],
                    "lines": [
                        {
                            "bbox": [
                                71,
                                186,
                                540,
                                197
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        71,
                                        186,
                                        540,
                                        197
                                    ],
                                    "score": 1.0,
                                    "content": "Online softmax instead computes “local” softmax with respect to each block and rescale to get the right",
                                    "type": "text"
                                }
                            ],
                            "index": 4
                        },
                        {
                            "bbox": [
                                70,
                                198,
                                153,
                                209
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        198,
                                        153,
                                        209
                                    ],
                                    "score": 1.0,
                                    "content": "output at the end:",
                                    "type": "text"
                                }
                            ],
                            "index": 5
                        }
                    ],
                    "index": 4.5
                },
                {
                    "type": "interline_equation",
                    "bbox": [
                        98,
                        217,
                        500,
                        359
                    ],
                    "lines": [
                        {
                            "bbox": [
                                98,
                                217,
                                500,
                                359
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        98,
                                        217,
                                        500,
                                        359
                                    ],
                                    "score": 0.95,
                                    "content": "\\begin{array}{r l}&{m^{(1)}=\\mathrm{rovmax}(\\mathbf{S}^{(1)})\\in\\mathbb{R}^{R_{r}}}\\\\ &{\\ell^{(1)}=\\mathrm{rovsum}(e^{(s^{(1)}-m^{(1)})})\\in\\mathbb{R}^{B_{r}}}\\\\ &{\\tilde{\\mathbf{P}}^{(1)}=\\mathrm{diag}(\\ell^{(1)})^{-1}e^{\\mathbf{S}^{(1)}-m^{(1)}}\\in\\mathbb{R}^{B_{r}\\times B_{\\ell}}}\\\\ &{\\mathbf{O}^{(1)}=\\tilde{\\mathbf{P}}^{(1)}\\mathbf{V}^{(1)}=\\mathrm{diag}(\\ell^{(1)})^{-1}e^{\\mathbf{S}^{(1)}-m^{(1)}}\\mathbf{V}^{(1)}\\in\\mathbb{R}^{B_{r}\\times A_{\\ell}}}\\\\ &{m^{(2)}=\\operatorname*{max}(m^{(1)},\\mathrm{rowmax}(\\mathbf{S}^{(2)}))=m}\\\\ &{\\ell^{(2)}=e^{m^{(1)}-m^{(2)}}\\ell^{(1)}+\\mathrm{rowsum}(e^{\\mathbf{S}^{(2)}-m^{(2)}})=\\mathrm{rowsum}(e^{\\mathbf{S}^{(1)}-m})+\\mathrm{rowsum}(e^{\\mathbf{S}^{(2)}-m})=\\ell}\\\\ &{\\tilde{\\mathbf{P}}^{(2)}=\\mathrm{diag}(\\ell^{(2)})^{-1}e^{\\mathbf{S}^{(2)}-m^{(2)}}}\\\\ &{\\mathbf{O}^{(2)}=\\mathrm{diag}(\\ell^{(1)}/\\ell^{(2)})^{-1}\\mathbf{O}^{(1)}+\\tilde{\\mathbf{P}}^{(2)}\\mathbf{V}^{(2)}=\\mathrm{diag}(\\ell^{(2)})^{-1}e^{\\mathbf{S}^{(1)}-m}\\mathbf{V}^{(1)}+\\mathrm{diag}(\\ell^{(2)})^{-1}e^{\\mathbf{S}^{(2)}-m}\\mathbf{V}^{(2)}=}\\end{array}",
                                    "type": "interline_equation"
                                }
                            ]
                        }
                    ],
                    "index": 7,
                    "virtual_lines": [
                        {
                            "bbox": [
                                98,
                                217,
                                500,
                                264.3333333333333
                            ],
                            "spans": [],
                            "index": 6
                        },
                        {
                            "bbox": [
                                98,
                                264.3333333333333,
                                500,
                                311.66666666666663
                            ],
                            "spans": [],
                            "index": 7
                        },
                        {
                            "bbox": [
                                98,
                                311.66666666666663,
                                500,
                                358.99999999999994
                            ],
                            "spans": [],
                            "index": 8
                        }
                    ]
                },
                {
                    "type": "text",
                    "bbox": [
                        84,
                        367,
                        539,
                        380
                    ],
                    "lines": [
                        {
                            "bbox": [
                                87,
                                368,
                                539,
                                380
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        87,
                                        368,
                                        539,
                                        380
                                    ],
                                    "score": 1.0,
                                    "content": "We show how FlashAttention uses online softmax to enable tiling (Fig. 1) to reduce memory reads/writes",
                                    "type": "text"
                                }
                            ],
                            "index": 9
                        }
                    ],
                    "index": 9
                },
                {
                    "type": "image",
                    "bbox": [
                        95,
                        404,
                        518,
                        615
                    ],
                    "blocks": [
                        {
                            "type": "image_body",
                            "bbox": [
                                95,
                                404,
                                518,
                                615
                            ],
                            "group_id": 0,
                            "lines": [
                                {
                                    "bbox": [
                                        95,
                                        404,
                                        518,
                                        615
                                    ],
                                    "spans": [
                                        {
                                            "bbox": [
                                                95,
                                                404,
                                                518,
                                                615
                                            ],
                                            "score": 0.963,
                                            "type": "image",
                                            "image_path": "0f7173de1eb9d7b896f412c7b0f85605c2f147d7de98ef50f34e7b664c93c1fe.jpg"
                                        }
                                    ]
                                }
                            ],
                            "index": 11,
                            "virtual_lines": [
                                {
                                    "bbox": [
                                        95,
                                        404,
                                        518,
                                        474.3333333333333
                                    ],
                                    "spans": [],
                                    "index": 10
                                },
                                {
                                    "bbox": [
                                        95,
                                        474.3333333333333,
                                        518,
                                        544.6666666666666
                                    ],
                                    "spans": [],
                                    "index": 11
                                },
                                {
                                    "bbox": [
                                        95,
                                        544.6666666666666,
                                        518,
                                        615.0
                                    ],
                                    "spans": [],
                                    "index": 12
                                }
                            ]
                        },
                        {
                            "type": "image_caption",
                            "bbox": [
                                69,
                                626,
                                542,
                                687
                            ],
                            "group_id": 0,
                            "lines": [
                                {
                                    "bbox": [
                                        71,
                                        628,
                                        541,
                                        639
                                    ],
                                    "spans": [
                                        {
                                            "bbox": [
                                                71,
                                                628,
                                                450,
                                                639
                                            ],
                                            "score": 1.0,
                                            "content": "Figure 1: Diagram of how FlashAttention forward pass is performed, when the key ",
                                            "type": "text"
                                        },
                                        {
                                            "bbox": [
                                                450,
                                                629,
                                                458,
                                                637
                                            ],
                                            "score": 0.5,
                                            "content": "\\mathbf{K}",
                                            "type": "inline_equation",
                                            "height": 8,
                                            "width": 8
                                        },
                                        {
                                            "bbox": [
                                                459,
                                                628,
                                                541,
                                                639
                                            ],
                                            "score": 1.0,
                                            "content": " is partitioned into",
                                            "type": "text"
                                        }
                                    ],
                                    "index": 13
                                },
                                {
                                    "bbox": [
                                        70,
                                        640,
                                        541,
                                        651
                                    ],
                                    "spans": [
                                        {
                                            "bbox": [
                                                70,
                                                640,
                                                186,
                                                651
                                            ],
                                            "score": 1.0,
                                            "content": "two blocks and the value ",
                                            "type": "text"
                                        },
                                        {
                                            "bbox": [
                                                187,
                                                640,
                                                195,
                                                649
                                            ],
                                            "score": 0.47,
                                            "content": "\\mathbf{V}",
                                            "type": "inline_equation",
                                            "height": 9,
                                            "width": 8
                                        },
                                        {
                                            "bbox": [
                                                196,
                                                640,
                                                541,
                                                651
                                            ],
                                            "score": 1.0,
                                            "content": " is also partitioned into two blocks. By computing attention with respect to",
                                            "type": "text"
                                        }
                                    ],
                                    "index": 14
                                },
                                {
                                    "bbox": [
                                        69,
                                        651,
                                        541,
                                        664
                                    ],
                                    "spans": [
                                        {
                                            "bbox": [
                                                69,
                                                651,
                                                541,
                                                664
                                            ],
                                            "score": 1.0,
                                            "content": "each block and rescaling the output, we get the right answer at the end, while avoiding expensive memory",
                                            "type": "text"
                                        }
                                    ],
                                    "index": 15
                                },
                                {
                                    "bbox": [
                                        69,
                                        662,
                                        542,
                                        676
                                    ],
                                    "spans": [
                                        {
                                            "bbox": [
                                                69,
                                                662,
                                                256,
                                                676
                                            ],
                                            "score": 1.0,
                                            "content": "reads/writes of the intermediate matrices ",
                                            "type": "text"
                                        },
                                        {
                                            "bbox": [
                                                257,
                                                666,
                                                262,
                                                673
                                            ],
                                            "score": 0.27,
                                            "content": "\\mathbf{s}",
                                            "type": "inline_equation",
                                            "height": 7,
                                            "width": 5
                                        },
                                        {
                                            "bbox": [
                                                263,
                                                662,
                                                284,
                                                676
                                            ],
                                            "score": 1.0,
                                            "content": " and",
                                            "type": "text"
                                        },
                                        {
                                            "bbox": [
                                                285,
                                                666,
                                                292,
                                                673
                                            ],
                                            "score": 0.8,
                                            "content": "\\mathbf{P}",
                                            "type": "inline_equation",
                                            "height": 7,
                                            "width": 7
                                        },
                                        {
                                            "bbox": [
                                                292,
                                                662,
                                                542,
                                                676
                                            ],
                                            "score": 1.0,
                                            "content": ". We simplify the diagram, omitting the step in softmax",
                                            "type": "text"
                                        }
                                    ],
                                    "index": 16
                                },
                                {
                                    "bbox": [
                                        70,
                                        676,
                                        291,
                                        687
                                    ],
                                    "spans": [
                                        {
                                            "bbox": [
                                                70,
                                                676,
                                                291,
                                                687
                                            ],
                                            "score": 1.0,
                                            "content": "that subtracts each element by the row-wise max.",
                                            "type": "text"
                                        }
                                    ],
                                    "index": 17
                                }
                            ],
                            "index": 15
                        }
                    ],
                    "index": 13.0
                }
            ],
            "layout_bboxes": [],
            "page_idx": 3,
            "page_size": [
                612.0,
                792.0
            ],
            "_layout_tree": [],
            "images": [
                {
                    "type": "image",
                    "bbox": [
                        95,
                        404,
                        518,
                        615
                    ],
                    "blocks": [
                        {
                            "type": "image_body",
                            "bbox": [
                                95,
                                404,
                                518,
                                615
                            ],
                            "group_id": 0,
                            "lines": [
                                {
                                    "bbox": [
                                        95,
                                        404,
                                        518,
                                        615
                                    ],
                                    "spans": [
                                        {
                                            "bbox": [
                                                95,
                                                404,
                                                518,
                                                615
                                            ],
                                            "score": 0.963,
                                            "type": "image",
                                            "image_path": "0f7173de1eb9d7b896f412c7b0f85605c2f147d7de98ef50f34e7b664c93c1fe.jpg"
                                        }
                                    ]
                                }
                            ],
                            "index": 11,
                            "virtual_lines": [
                                {
                                    "bbox": [
                                        95,
                                        404,
                                        518,
                                        474.3333333333333
                                    ],
                                    "spans": [],
                                    "index": 10
                                },
                                {
                                    "bbox": [
                                        95,
                                        474.3333333333333,
                                        518,
                                        544.6666666666666
                                    ],
                                    "spans": [],
                                    "index": 11
                                },
                                {
                                    "bbox": [
                                        95,
                                        544.6666666666666,
                                        518,
                                        615.0
                                    ],
                                    "spans": [],
                                    "index": 12
                                }
                            ]
                        },
                        {
                            "type": "image_caption",
                            "bbox": [
                                69,
                                626,
                                542,
                                687
                            ],
                            "group_id": 0,
                            "lines": [
                                {
                                    "bbox": [
                                        71,
                                        628,
                                        541,
                                        639
                                    ],
                                    "spans": [
                                        {
                                            "bbox": [
                                                71,
                                                628,
                                                450,
                                                639
                                            ],
                                            "score": 1.0,
                                            "content": "Figure 1: Diagram of how FlashAttention forward pass is performed, when the key ",
                                            "type": "text"
                                        },
                                        {
                                            "bbox": [
                                                450,
                                                629,
                                                458,
                                                637
                                            ],
                                            "score": 0.5,
                                            "content": "\\mathbf{K}",
                                            "type": "inline_equation",
                                            "height": 8,
                                            "width": 8
                                        },
                                        {
                                            "bbox": [
                                                459,
                                                628,
                                                541,
                                                639
                                            ],
                                            "score": 1.0,
                                            "content": " is partitioned into",
                                            "type": "text"
                                        }
                                    ],
                                    "index": 13
                                },
                                {
                                    "bbox": [
                                        70,
                                        640,
                                        541,
                                        651
                                    ],
                                    "spans": [
                                        {
                                            "bbox": [
                                                70,
                                                640,
                                                186,
                                                651
                                            ],
                                            "score": 1.0,
                                            "content": "two blocks and the value ",
                                            "type": "text"
                                        },
                                        {
                                            "bbox": [
                                                187,
                                                640,
                                                195,
                                                649
                                            ],
                                            "score": 0.47,
                                            "content": "\\mathbf{V}",
                                            "type": "inline_equation",
                                            "height": 9,
                                            "width": 8
                                        },
                                        {
                                            "bbox": [
                                                196,
                                                640,
                                                541,
                                                651
                                            ],
                                            "score": 1.0,
                                            "content": " is also partitioned into two blocks. By computing attention with respect to",
                                            "type": "text"
                                        }
                                    ],
                                    "index": 14
                                },
                                {
                                    "bbox": [
                                        69,
                                        651,
                                        541,
                                        664
                                    ],
                                    "spans": [
                                        {
                                            "bbox": [
                                                69,
                                                651,
                                                541,
                                                664
                                            ],
                                            "score": 1.0,
                                            "content": "each block and rescaling the output, we get the right answer at the end, while avoiding expensive memory",
                                            "type": "text"
                                        }
                                    ],
                                    "index": 15
                                },
                                {
                                    "bbox": [
                                        69,
                                        662,
                                        542,
                                        676
                                    ],
                                    "spans": [
                                        {
                                            "bbox": [
                                                69,
                                                662,
                                                256,
                                                676
                                            ],
                                            "score": 1.0,
                                            "content": "reads/writes of the intermediate matrices ",
                                            "type": "text"
                                        },
                                        {
                                            "bbox": [
                                                257,
                                                666,
                                                262,
                                                673
                                            ],
                                            "score": 0.27,
                                            "content": "\\mathbf{s}",
                                            "type": "inline_equation",
                                            "height": 7,
                                            "width": 5
                                        },
                                        {
                                            "bbox": [
                                                263,
                                                662,
                                                284,
                                                676
                                            ],
                                            "score": 1.0,
                                            "content": " and",
                                            "type": "text"
                                        },
                                        {
                                            "bbox": [
                                                285,
                                                666,
                                                292,
                                                673
                                            ],
                                            "score": 0.8,
                                            "content": "\\mathbf{P}",
                                            "type": "inline_equation",
                                            "height": 7,
                                            "width": 7
                                        },
                                        {
                                            "bbox": [
                                                292,
                                                662,
                                                542,
                                                676
                                            ],
                                            "score": 1.0,
                                            "content": ". We simplify the diagram, omitting the step in softmax",
                                            "type": "text"
                                        }
                                    ],
                                    "index": 16
                                },
                                {
                                    "bbox": [
                                        70,
                                        676,
                                        291,
                                        687
                                    ],
                                    "spans": [
                                        {
                                            "bbox": [
                                                70,
                                                676,
                                                291,
                                                687
                                            ],
                                            "score": 1.0,
                                            "content": "that subtracts each element by the row-wise max.",
                                            "type": "text"
                                        }
                                    ],
                                    "index": 17
                                }
                            ],
                            "index": 15
                        }
                    ],
                    "index": 13.0
                }
            ],
            "tables": [],
            "interline_equations": [
                {
                    "type": "interline_equation",
                    "bbox": [
                        153,
                        92,
                        459,
                        180
                    ],
                    "lines": [
                        {
                            "bbox": [
                                153,
                                92,
                                459,
                                180
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        153,
                                        92,
                                        459,
                                        180
                                    ],
                                    "score": 0.94,
                                    "content": "\\begin{array}{r l}&{m=\\operatorname*{max}(\\operatorname{rowmax}(\\mathbf{S}^{(1)}),\\operatorname{rowmax}(\\mathbf{S}^{(2)}))\\in\\mathbb{R}^{B_{r}}}\\\\ &{\\ell=\\operatorname{rowsum}(e^{\\mathbf{S}^{(1)}-m})+\\operatorname{rowsum}(e^{\\mathbf{S}^{(2)}-m})\\in\\mathbb{R}^{B_{r}}}\\\\ &{\\mathbf{P}=\\left[\\mathbf{P}^{(1)}\\quad\\mathbf{P}^{(2)}\\right]=\\operatorname{diag}(\\ell)^{-1}\\left[e^{\\mathbf{S}^{(1)}-m}\\quad e^{\\mathbf{S}^{(2)}-m}\\right]\\in\\mathbb{R}^{B_{r}\\times2B_{c}}}\\\\ &{\\mathbf{0}=\\left[\\mathbf{P}^{(1)}\\quad\\mathbf{P}^{(2)}\\right]\\left[\\mathbf{V}^{(1)}\\right]=\\operatorname{diag}(\\ell)^{-1}e^{\\mathbf{S}^{(1)}-m}\\mathbf{V}^{(1)}+e^{\\mathbf{S}^{(2)}-m}\\mathbf{V}^{(2)}\\in\\mathbb{R}^{B_{r}\\times d}.}\\end{array}",
                                    "type": "interline_equation"
                                }
                            ]
                        }
                    ],
                    "index": 2,
                    "virtual_lines": [
                        {
                            "bbox": [
                                153,
                                92,
                                459,
                                121.33333333333333
                            ],
                            "spans": [],
                            "index": 1
                        },
                        {
                            "bbox": [
                                153,
                                121.33333333333333,
                                459,
                                150.66666666666666
                            ],
                            "spans": [],
                            "index": 2
                        },
                        {
                            "bbox": [
                                153,
                                150.66666666666666,
                                459,
                                180.0
                            ],
                            "spans": [],
                            "index": 3
                        }
                    ]
                },
                {
                    "type": "interline_equation",
                    "bbox": [
                        98,
                        217,
                        500,
                        359
                    ],
                    "lines": [
                        {
                            "bbox": [
                                98,
                                217,
                                500,
                                359
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        98,
                                        217,
                                        500,
                                        359
                                    ],
                                    "score": 0.95,
                                    "content": "\\begin{array}{r l}&{m^{(1)}=\\mathrm{rovmax}(\\mathbf{S}^{(1)})\\in\\mathbb{R}^{R_{r}}}\\\\ &{\\ell^{(1)}=\\mathrm{rovsum}(e^{(s^{(1)}-m^{(1)})})\\in\\mathbb{R}^{B_{r}}}\\\\ &{\\tilde{\\mathbf{P}}^{(1)}=\\mathrm{diag}(\\ell^{(1)})^{-1}e^{\\mathbf{S}^{(1)}-m^{(1)}}\\in\\mathbb{R}^{B_{r}\\times B_{\\ell}}}\\\\ &{\\mathbf{O}^{(1)}=\\tilde{\\mathbf{P}}^{(1)}\\mathbf{V}^{(1)}=\\mathrm{diag}(\\ell^{(1)})^{-1}e^{\\mathbf{S}^{(1)}-m^{(1)}}\\mathbf{V}^{(1)}\\in\\mathbb{R}^{B_{r}\\times A_{\\ell}}}\\\\ &{m^{(2)}=\\operatorname*{max}(m^{(1)},\\mathrm{rowmax}(\\mathbf{S}^{(2)}))=m}\\\\ &{\\ell^{(2)}=e^{m^{(1)}-m^{(2)}}\\ell^{(1)}+\\mathrm{rowsum}(e^{\\mathbf{S}^{(2)}-m^{(2)}})=\\mathrm{rowsum}(e^{\\mathbf{S}^{(1)}-m})+\\mathrm{rowsum}(e^{\\mathbf{S}^{(2)}-m})=\\ell}\\\\ &{\\tilde{\\mathbf{P}}^{(2)}=\\mathrm{diag}(\\ell^{(2)})^{-1}e^{\\mathbf{S}^{(2)}-m^{(2)}}}\\\\ &{\\mathbf{O}^{(2)}=\\mathrm{diag}(\\ell^{(1)}/\\ell^{(2)})^{-1}\\mathbf{O}^{(1)}+\\tilde{\\mathbf{P}}^{(2)}\\mathbf{V}^{(2)}=\\mathrm{diag}(\\ell^{(2)})^{-1}e^{\\mathbf{S}^{(1)}-m}\\mathbf{V}^{(1)}+\\mathrm{diag}(\\ell^{(2)})^{-1}e^{\\mathbf{S}^{(2)}-m}\\mathbf{V}^{(2)}=}\\end{array}",
                                    "type": "interline_equation"
                                }
                            ]
                        }
                    ],
                    "index": 7,
                    "virtual_lines": [
                        {
                            "bbox": [
                                98,
                                217,
                                500,
                                264.3333333333333
                            ],
                            "spans": [],
                            "index": 6
                        },
                        {
                            "bbox": [
                                98,
                                264.3333333333333,
                                500,
                                311.66666666666663
                            ],
                            "spans": [],
                            "index": 7
                        },
                        {
                            "bbox": [
                                98,
                                311.66666666666663,
                                500,
                                358.99999999999994
                            ],
                            "spans": [],
                            "index": 8
                        }
                    ]
                }
            ],
            "discarded_blocks": [
                {
                    "type": "discarded",
                    "bbox": [
                        302,
                        742,
                        309,
                        751
                    ],
                    "lines": [
                        {
                            "bbox": [
                                301,
                                742,
                                311,
                                753
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        301,
                                        742,
                                        311,
                                        753
                                    ],
                                    "score": 1.0,
                                    "content": "4",
                                    "type": "text"
                                }
                            ]
                        }
                    ]
                }
            ],
            "need_drop": false,
            "drop_reason": [],
            "para_blocks": [
                {
                    "type": "text",
                    "bbox": [
                        70,
                        74,
                        112,
                        85
                    ],
                    "lines": [
                        {
                            "bbox": [
                                71,
                                75,
                                112,
                                85
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        71,
                                        75,
                                        112,
                                        85
                                    ],
                                    "score": 1.0,
                                    "content": "compute:",
                                    "type": "text"
                                }
                            ],
                            "index": 0
                        }
                    ],
                    "index": 0,
                    "page_num": "page_3",
                    "page_size": [
                        612.0,
                        792.0
                    ],
                    "bbox_fs": [
                        71,
                        75,
                        112,
                        85
                    ]
                },
                {
                    "type": "interline_equation",
                    "bbox": [
                        153,
                        92,
                        459,
                        180
                    ],
                    "lines": [
                        {
                            "bbox": [
                                153,
                                92,
                                459,
                                180
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        153,
                                        92,
                                        459,
                                        180
                                    ],
                                    "score": 0.94,
                                    "content": "\\begin{array}{r l}&{m=\\operatorname*{max}(\\operatorname{rowmax}(\\mathbf{S}^{(1)}),\\operatorname{rowmax}(\\mathbf{S}^{(2)}))\\in\\mathbb{R}^{B_{r}}}\\\\ &{\\ell=\\operatorname{rowsum}(e^{\\mathbf{S}^{(1)}-m})+\\operatorname{rowsum}(e^{\\mathbf{S}^{(2)}-m})\\in\\mathbb{R}^{B_{r}}}\\\\ &{\\mathbf{P}=\\left[\\mathbf{P}^{(1)}\\quad\\mathbf{P}^{(2)}\\right]=\\operatorname{diag}(\\ell)^{-1}\\left[e^{\\mathbf{S}^{(1)}-m}\\quad e^{\\mathbf{S}^{(2)}-m}\\right]\\in\\mathbb{R}^{B_{r}\\times2B_{c}}}\\\\ &{\\mathbf{0}=\\left[\\mathbf{P}^{(1)}\\quad\\mathbf{P}^{(2)}\\right]\\left[\\mathbf{V}^{(1)}\\right]=\\operatorname{diag}(\\ell)^{-1}e^{\\mathbf{S}^{(1)}-m}\\mathbf{V}^{(1)}+e^{\\mathbf{S}^{(2)}-m}\\mathbf{V}^{(2)}\\in\\mathbb{R}^{B_{r}\\times d}.}\\end{array}",
                                    "type": "interline_equation"
                                }
                            ]
                        }
                    ],
                    "index": 2,
                    "virtual_lines": [
                        {
                            "bbox": [
                                153,
                                92,
                                459,
                                121.33333333333333
                            ],
                            "spans": [],
                            "index": 1
                        },
                        {
                            "bbox": [
                                153,
                                121.33333333333333,
                                459,
                                150.66666666666666
                            ],
                            "spans": [],
                            "index": 2
                        },
                        {
                            "bbox": [
                                153,
                                150.66666666666666,
                                459,
                                180.0
                            ],
                            "spans": [],
                            "index": 3
                        }
                    ],
                    "page_num": "page_3",
                    "page_size": [
                        612.0,
                        792.0
                    ]
                },
                {
                    "type": "text",
                    "bbox": [
                        70,
                        185,
                        540,
                        209
                    ],
                    "lines": [
                        {
                            "bbox": [
                                71,
                                186,
                                540,
                                197
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        71,
                                        186,
                                        540,
                                        197
                                    ],
                                    "score": 1.0,
                                    "content": "Online softmax instead computes “local” softmax with respect to each block and rescale to get the right",
                                    "type": "text"
                                }
                            ],
                            "index": 4
                        },
                        {
                            "bbox": [
                                70,
                                198,
                                153,
                                209
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        198,
                                        153,
                                        209
                                    ],
                                    "score": 1.0,
                                    "content": "output at the end:",
                                    "type": "text"
                                }
                            ],
                            "index": 5
                        }
                    ],
                    "index": 4.5,
                    "page_num": "page_3",
                    "page_size": [
                        612.0,
                        792.0
                    ],
                    "bbox_fs": [
                        70,
                        186,
                        540,
                        209
                    ]
                },
                {
                    "type": "interline_equation",
                    "bbox": [
                        98,
                        217,
                        500,
                        359
                    ],
                    "lines": [
                        {
                            "bbox": [
                                98,
                                217,
                                500,
                                359
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        98,
                                        217,
                                        500,
                                        359
                                    ],
                                    "score": 0.95,
                                    "content": "\\begin{array}{r l}&{m^{(1)}=\\mathrm{rovmax}(\\mathbf{S}^{(1)})\\in\\mathbb{R}^{R_{r}}}\\\\ &{\\ell^{(1)}=\\mathrm{rovsum}(e^{(s^{(1)}-m^{(1)})})\\in\\mathbb{R}^{B_{r}}}\\\\ &{\\tilde{\\mathbf{P}}^{(1)}=\\mathrm{diag}(\\ell^{(1)})^{-1}e^{\\mathbf{S}^{(1)}-m^{(1)}}\\in\\mathbb{R}^{B_{r}\\times B_{\\ell}}}\\\\ &{\\mathbf{O}^{(1)}=\\tilde{\\mathbf{P}}^{(1)}\\mathbf{V}^{(1)}=\\mathrm{diag}(\\ell^{(1)})^{-1}e^{\\mathbf{S}^{(1)}-m^{(1)}}\\mathbf{V}^{(1)}\\in\\mathbb{R}^{B_{r}\\times A_{\\ell}}}\\\\ &{m^{(2)}=\\operatorname*{max}(m^{(1)},\\mathrm{rowmax}(\\mathbf{S}^{(2)}))=m}\\\\ &{\\ell^{(2)}=e^{m^{(1)}-m^{(2)}}\\ell^{(1)}+\\mathrm{rowsum}(e^{\\mathbf{S}^{(2)}-m^{(2)}})=\\mathrm{rowsum}(e^{\\mathbf{S}^{(1)}-m})+\\mathrm{rowsum}(e^{\\mathbf{S}^{(2)}-m})=\\ell}\\\\ &{\\tilde{\\mathbf{P}}^{(2)}=\\mathrm{diag}(\\ell^{(2)})^{-1}e^{\\mathbf{S}^{(2)}-m^{(2)}}}\\\\ &{\\mathbf{O}^{(2)}=\\mathrm{diag}(\\ell^{(1)}/\\ell^{(2)})^{-1}\\mathbf{O}^{(1)}+\\tilde{\\mathbf{P}}^{(2)}\\mathbf{V}^{(2)}=\\mathrm{diag}(\\ell^{(2)})^{-1}e^{\\mathbf{S}^{(1)}-m}\\mathbf{V}^{(1)}+\\mathrm{diag}(\\ell^{(2)})^{-1}e^{\\mathbf{S}^{(2)}-m}\\mathbf{V}^{(2)}=}\\end{array}",
                                    "type": "interline_equation"
                                }
                            ]
                        }
                    ],
                    "index": 7,
                    "virtual_lines": [
                        {
                            "bbox": [
                                98,
                                217,
                                500,
                                264.3333333333333
                            ],
                            "spans": [],
                            "index": 6
                        },
                        {
                            "bbox": [
                                98,
                                264.3333333333333,
                                500,
                                311.66666666666663
                            ],
                            "spans": [],
                            "index": 7
                        },
                        {
                            "bbox": [
                                98,
                                311.66666666666663,
                                500,
                                358.99999999999994
                            ],
                            "spans": [],
                            "index": 8
                        }
                    ],
                    "page_num": "page_3",
                    "page_size": [
                        612.0,
                        792.0
                    ]
                },
                {
                    "type": "text",
                    "bbox": [
                        84,
                        367,
                        539,
                        380
                    ],
                    "lines": [
                        {
                            "bbox": [
                                87,
                                368,
                                539,
                                380
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        87,
                                        368,
                                        539,
                                        380
                                    ],
                                    "score": 1.0,
                                    "content": "We show how FlashAttention uses online softmax to enable tiling (Fig. 1) to reduce memory reads/writes",
                                    "type": "text"
                                }
                            ],
                            "index": 9
                        }
                    ],
                    "index": 9,
                    "page_num": "page_3",
                    "page_size": [
                        612.0,
                        792.0
                    ],
                    "bbox_fs": [
                        87,
                        368,
                        539,
                        380
                    ]
                },
                {
                    "type": "image",
                    "bbox": [
                        95,
                        404,
                        518,
                        615
                    ],
                    "blocks": [
                        {
                            "type": "image_body",
                            "bbox": [
                                95,
                                404,
                                518,
                                615
                            ],
                            "group_id": 0,
                            "lines": [
                                {
                                    "bbox": [
                                        95,
                                        404,
                                        518,
                                        615
                                    ],
                                    "spans": [
                                        {
                                            "bbox": [
                                                95,
                                                404,
                                                518,
                                                615
                                            ],
                                            "score": 0.963,
                                            "type": "image",
                                            "image_path": "0f7173de1eb9d7b896f412c7b0f85605c2f147d7de98ef50f34e7b664c93c1fe.jpg"
                                        }
                                    ]
                                }
                            ],
                            "index": 11,
                            "virtual_lines": [
                                {
                                    "bbox": [
                                        95,
                                        404,
                                        518,
                                        474.3333333333333
                                    ],
                                    "spans": [],
                                    "index": 10
                                },
                                {
                                    "bbox": [
                                        95,
                                        474.3333333333333,
                                        518,
                                        544.6666666666666
                                    ],
                                    "spans": [],
                                    "index": 11
                                },
                                {
                                    "bbox": [
                                        95,
                                        544.6666666666666,
                                        518,
                                        615.0
                                    ],
                                    "spans": [],
                                    "index": 12
                                }
                            ]
                        },
                        {
                            "type": "image_caption",
                            "bbox": [
                                69,
                                626,
                                542,
                                687
                            ],
                            "group_id": 0,
                            "lines": [
                                {
                                    "bbox": [
                                        71,
                                        628,
                                        541,
                                        639
                                    ],
                                    "spans": [
                                        {
                                            "bbox": [
                                                71,
                                                628,
                                                450,
                                                639
                                            ],
                                            "score": 1.0,
                                            "content": "Figure 1: Diagram of how FlashAttention forward pass is performed, when the key ",
                                            "type": "text"
                                        },
                                        {
                                            "bbox": [
                                                450,
                                                629,
                                                458,
                                                637
                                            ],
                                            "score": 0.5,
                                            "content": "\\mathbf{K}",
                                            "type": "inline_equation",
                                            "height": 8,
                                            "width": 8
                                        },
                                        {
                                            "bbox": [
                                                459,
                                                628,
                                                541,
                                                639
                                            ],
                                            "score": 1.0,
                                            "content": " is partitioned into",
                                            "type": "text"
                                        }
                                    ],
                                    "index": 13
                                },
                                {
                                    "bbox": [
                                        70,
                                        640,
                                        541,
                                        651
                                    ],
                                    "spans": [
                                        {
                                            "bbox": [
                                                70,
                                                640,
                                                186,
                                                651
                                            ],
                                            "score": 1.0,
                                            "content": "two blocks and the value ",
                                            "type": "text"
                                        },
                                        {
                                            "bbox": [
                                                187,
                                                640,
                                                195,
                                                649
                                            ],
                                            "score": 0.47,
                                            "content": "\\mathbf{V}",
                                            "type": "inline_equation",
                                            "height": 9,
                                            "width": 8
                                        },
                                        {
                                            "bbox": [
                                                196,
                                                640,
                                                541,
                                                651
                                            ],
                                            "score": 1.0,
                                            "content": " is also partitioned into two blocks. By computing attention with respect to",
                                            "type": "text"
                                        }
                                    ],
                                    "index": 14
                                },
                                {
                                    "bbox": [
                                        69,
                                        651,
                                        541,
                                        664
                                    ],
                                    "spans": [
                                        {
                                            "bbox": [
                                                69,
                                                651,
                                                541,
                                                664
                                            ],
                                            "score": 1.0,
                                            "content": "each block and rescaling the output, we get the right answer at the end, while avoiding expensive memory",
                                            "type": "text"
                                        }
                                    ],
                                    "index": 15
                                },
                                {
                                    "bbox": [
                                        69,
                                        662,
                                        542,
                                        676
                                    ],
                                    "spans": [
                                        {
                                            "bbox": [
                                                69,
                                                662,
                                                256,
                                                676
                                            ],
                                            "score": 1.0,
                                            "content": "reads/writes of the intermediate matrices ",
                                            "type": "text"
                                        },
                                        {
                                            "bbox": [
                                                257,
                                                666,
                                                262,
                                                673
                                            ],
                                            "score": 0.27,
                                            "content": "\\mathbf{s}",
                                            "type": "inline_equation",
                                            "height": 7,
                                            "width": 5
                                        },
                                        {
                                            "bbox": [
                                                263,
                                                662,
                                                284,
                                                676
                                            ],
                                            "score": 1.0,
                                            "content": " and",
                                            "type": "text"
                                        },
                                        {
                                            "bbox": [
                                                285,
                                                666,
                                                292,
                                                673
                                            ],
                                            "score": 0.8,
                                            "content": "\\mathbf{P}",
                                            "type": "inline_equation",
                                            "height": 7,
                                            "width": 7
                                        },
                                        {
                                            "bbox": [
                                                292,
                                                662,
                                                542,
                                                676
                                            ],
                                            "score": 1.0,
                                            "content": ". We simplify the diagram, omitting the step in softmax",
                                            "type": "text"
                                        }
                                    ],
                                    "index": 16
                                },
                                {
                                    "bbox": [
                                        70,
                                        676,
                                        291,
                                        687
                                    ],
                                    "spans": [
                                        {
                                            "bbox": [
                                                70,
                                                676,
                                                291,
                                                687
                                            ],
                                            "score": 1.0,
                                            "content": "that subtracts each element by the row-wise max.",
                                            "type": "text"
                                        }
                                    ],
                                    "index": 17
                                }
                            ],
                            "index": 15
                        }
                    ],
                    "index": 13.0,
                    "page_num": "page_3",
                    "page_size": [
                        612.0,
                        792.0
                    ]
                }
            ]
        },
        {
            "preproc_blocks": [
                {
                    "type": "title",
                    "bbox": [
                        71,
                        73,
                        181,
                        85
                    ],
                    "lines": [
                        {
                            "bbox": [
                                71,
                                74,
                                181,
                                85
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        71,
                                        74,
                                        97,
                                        84
                                    ],
                                    "score": 1.0,
                                    "content": "2.3.2",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        105,
                                        74,
                                        181,
                                        85
                                    ],
                                    "score": 1.0,
                                    "content": "Backward pass",
                                    "type": "text"
                                }
                            ],
                            "index": 0
                        }
                    ],
                    "index": 0
                },
                {
                    "type": "text",
                    "bbox": [
                        70,
                        91,
                        541,
                        151
                    ],
                    "lines": [
                        {
                            "bbox": [
                                69,
                                91,
                                541,
                                104
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        69,
                                        91,
                                        436,
                                        104
                                    ],
                                    "score": 1.0,
                                    "content": "In the backward pass, by re-computing the values of the attention matrices S and ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        436,
                                        94,
                                        443,
                                        101
                                    ],
                                    "score": 0.89,
                                    "content": "\\mathbf{P}",
                                    "type": "inline_equation",
                                    "height": 7,
                                    "width": 7
                                },
                                {
                                    "bbox": [
                                        444,
                                        91,
                                        541,
                                        104
                                    ],
                                    "score": 1.0,
                                    "content": " once blocks of inputs",
                                    "type": "text"
                                }
                            ],
                            "index": 1
                        },
                        {
                            "bbox": [
                                71,
                                104,
                                541,
                                116
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        71,
                                        106,
                                        102,
                                        115
                                    ],
                                    "score": 0.92,
                                    "content": "\\mathbf{Q},\\mathbf{K},\\mathbf{V}",
                                    "type": "inline_equation",
                                    "height": 9,
                                    "width": 31
                                },
                                {
                                    "bbox": [
                                        103,
                                        104,
                                        541,
                                        116
                                    ],
                                    "score": 1.0,
                                    "content": " are already loaded to SRAM, FlashAttention avoids having to store large intermediate values. By",
                                    "type": "text"
                                }
                            ],
                            "index": 2
                        },
                        {
                            "bbox": [
                                70,
                                115,
                                541,
                                129
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        115,
                                        260,
                                        129
                                    ],
                                    "score": 1.0,
                                    "content": "not having to save the large matrices S and ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        261,
                                        118,
                                        268,
                                        126
                                    ],
                                    "score": 0.88,
                                    "content": "\\mathbf{P}",
                                    "type": "inline_equation",
                                    "height": 8,
                                    "width": 7
                                },
                                {
                                    "bbox": [
                                        268,
                                        115,
                                        299,
                                        129
                                    ],
                                    "score": 1.0,
                                    "content": " of size",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        300,
                                        119,
                                        327,
                                        126
                                    ],
                                    "score": 0.92,
                                    "content": "N\\times N",
                                    "type": "inline_equation",
                                    "height": 7,
                                    "width": 27
                                },
                                {
                                    "bbox": [
                                        327,
                                        115,
                                        465,
                                        129
                                    ],
                                    "score": 1.0,
                                    "content": ", FlashAttention yields 10-20",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        465,
                                        119,
                                        472,
                                        126
                                    ],
                                    "score": 0.54,
                                    "content": "\\times",
                                    "type": "inline_equation",
                                    "height": 7,
                                    "width": 7
                                },
                                {
                                    "bbox": [
                                        473,
                                        115,
                                        541,
                                        129
                                    ],
                                    "score": 1.0,
                                    "content": " memory saving",
                                    "type": "text"
                                }
                            ],
                            "index": 3
                        },
                        {
                            "bbox": [
                                72,
                                129,
                                541,
                                140
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        72,
                                        129,
                                        411,
                                        140
                                    ],
                                    "score": 1.0,
                                    "content": "depending on sequence length (memory required in linear in sequence length",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        411,
                                        131,
                                        420,
                                        137
                                    ],
                                    "score": 0.9,
                                    "content": "N",
                                    "type": "inline_equation",
                                    "height": 6,
                                    "width": 9
                                },
                                {
                                    "bbox": [
                                        420,
                                        129,
                                        541,
                                        140
                                    ],
                                    "score": 1.0,
                                    "content": "instead of quadratic). The",
                                    "type": "text"
                                }
                            ],
                            "index": 4
                        },
                        {
                            "bbox": [
                                70,
                                140,
                                462,
                                152
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        140,
                                        462,
                                        152
                                    ],
                                    "score": 1.0,
                                    "content": "backward pass also achieves 2-4× wall-clock speedup due to reduce memory reads/writes.",
                                    "type": "text"
                                }
                            ],
                            "index": 5
                        }
                    ],
                    "index": 3
                },
                {
                    "type": "text",
                    "bbox": [
                        71,
                        152,
                        540,
                        199
                    ],
                    "lines": [
                        {
                            "bbox": [
                                86,
                                152,
                                540,
                                164
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        86,
                                        152,
                                        540,
                                        164
                                    ],
                                    "score": 1.0,
                                    "content": "The backward pass applies tiling to the equations in Section 2.2. Though the backward pass is simpler",
                                    "type": "text"
                                }
                            ],
                            "index": 6
                        },
                        {
                            "bbox": [
                                71,
                                164,
                                541,
                                176
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        71,
                                        164,
                                        541,
                                        176
                                    ],
                                    "score": 1.0,
                                    "content": "than the forward pass conceptually (there is no softmax rescaling), the implementation is significantly more",
                                    "type": "text"
                                }
                            ],
                            "index": 7
                        },
                        {
                            "bbox": [
                                71,
                                176,
                                541,
                                187
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        71,
                                        176,
                                        541,
                                        187
                                    ],
                                    "score": 1.0,
                                    "content": "involved. This is because there are more values to be kept in SRAM to perform 5 matrix multiples in the",
                                    "type": "text"
                                }
                            ],
                            "index": 8
                        },
                        {
                            "bbox": [
                                70,
                                187,
                                389,
                                201
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        187,
                                        389,
                                        201
                                    ],
                                    "score": 1.0,
                                    "content": "backward pass, compared to just 2 matrix multiples in the forward pass.",
                                    "type": "text"
                                }
                            ],
                            "index": 9
                        }
                    ],
                    "index": 7.5
                },
                {
                    "type": "title",
                    "bbox": [
                        71,
                        216,
                        541,
                        251
                    ],
                    "lines": [
                        {
                            "bbox": [
                                71,
                                217,
                                542,
                                233
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        71,
                                        218,
                                        81,
                                        231
                                    ],
                                    "score": 1.0,
                                    "content": "3",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        91,
                                        217,
                                        542,
                                        233
                                    ],
                                    "score": 1.0,
                                    "content": "FlashAttention-2: Algorithm, Parallelism, and Work Partition-",
                                    "type": "text"
                                }
                            ],
                            "index": 10
                        },
                        {
                            "bbox": [
                                93,
                                233,
                                120,
                                254
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        93,
                                        233,
                                        120,
                                        254
                                    ],
                                    "score": 1.0,
                                    "content": "ing",
                                    "type": "text"
                                }
                            ],
                            "index": 11
                        }
                    ],
                    "index": 10.5
                },
                {
                    "type": "text",
                    "bbox": [
                        71,
                        259,
                        541,
                        320
                    ],
                    "lines": [
                        {
                            "bbox": [
                                70,
                                260,
                                541,
                                272
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        260,
                                        541,
                                        272
                                    ],
                                    "score": 1.0,
                                    "content": "We describe the FlashAttention-2 algorithm, which includes several tweaks to FlashAttention to reduce",
                                    "type": "text"
                                }
                            ],
                            "index": 12
                        },
                        {
                            "bbox": [
                                70,
                                272,
                                541,
                                284
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        272,
                                        541,
                                        284
                                    ],
                                    "score": 1.0,
                                    "content": "the number of non-matmul FLOPs. We then describe how to parallelize the computation on different thread",
                                    "type": "text"
                                }
                            ],
                            "index": 13
                        },
                        {
                            "bbox": [
                                70,
                                284,
                                541,
                                297
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        284,
                                        541,
                                        297
                                    ],
                                    "score": 1.0,
                                    "content": "blocks to make full use the GPU resources. Finally we describe we partition the work between different warps",
                                    "type": "text"
                                }
                            ],
                            "index": 14
                        },
                        {
                            "bbox": [
                                71,
                                297,
                                541,
                                308
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        71,
                                        297,
                                        541,
                                        308
                                    ],
                                    "score": 1.0,
                                    "content": "within one thread block to reduce the amount of shared memory access. These improvements lead to 2-3×",
                                    "type": "text"
                                }
                            ],
                            "index": 15
                        },
                        {
                            "bbox": [
                                71,
                                309,
                                220,
                                320
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        71,
                                        309,
                                        220,
                                        320
                                    ],
                                    "score": 1.0,
                                    "content": "speedup as validated in Section 4.",
                                    "type": "text"
                                }
                            ],
                            "index": 16
                        }
                    ],
                    "index": 14
                },
                {
                    "type": "title",
                    "bbox": [
                        71,
                        334,
                        164,
                        348
                    ],
                    "lines": [
                        {
                            "bbox": [
                                70,
                                334,
                                164,
                                348
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        334,
                                        91,
                                        348
                                    ],
                                    "score": 1.0,
                                    "content": "3.1",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        101,
                                        334,
                                        164,
                                        348
                                    ],
                                    "score": 1.0,
                                    "content": "Algorithm",
                                    "type": "text"
                                }
                            ],
                            "index": 17
                        }
                    ],
                    "index": 17
                },
                {
                    "type": "text",
                    "bbox": [
                        70,
                        353,
                        541,
                        438
                    ],
                    "lines": [
                        {
                            "bbox": [
                                70,
                                354,
                                541,
                                366
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        354,
                                        541,
                                        366
                                    ],
                                    "score": 1.0,
                                    "content": "We tweak the algorithm from FlashAttention to reduce the number of non-matmul FLOPs. This is",
                                    "type": "text"
                                }
                            ],
                            "index": 18
                        },
                        {
                            "bbox": [
                                70,
                                366,
                                541,
                                378
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        366,
                                        541,
                                        378
                                    ],
                                    "score": 1.0,
                                    "content": "because modern GPUs have specialized compute units (e.g., Tensor Cores on Nvidia GPUs) that makes",
                                    "type": "text"
                                }
                            ],
                            "index": 19
                        },
                        {
                            "bbox": [
                                70,
                                379,
                                542,
                                391
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        379,
                                        542,
                                        391
                                    ],
                                    "score": 1.0,
                                    "content": "matmul much faster. As an example, the A100 GPU has a max theoretical throughput of 312 TFLOPs/s of",
                                    "type": "text"
                                }
                            ],
                            "index": 20
                        },
                        {
                            "bbox": [
                                70,
                                390,
                                542,
                                402
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        390,
                                        542,
                                        402
                                    ],
                                    "score": 1.0,
                                    "content": "FP16/BF16 matmul, but only 19.5 TFLOPs/s of non-matmul FP32. Another way to think about this is that",
                                    "type": "text"
                                }
                            ],
                            "index": 21
                        },
                        {
                            "bbox": [
                                69,
                                400,
                                542,
                                416
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        69,
                                        400,
                                        192,
                                        416
                                    ],
                                    "score": 1.0,
                                    "content": "each non-matmul FLOP is ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        192,
                                        405,
                                        209,
                                        412
                                    ],
                                    "score": 0.4,
                                    "content": "16\\times",
                                    "type": "inline_equation",
                                    "height": 7,
                                    "width": 17
                                },
                                {
                                    "bbox": [
                                        210,
                                        400,
                                        542,
                                        416
                                    ],
                                    "score": 1.0,
                                    "content": " more expensive than a matmul FLOP. To maintain high throughput (e.g.,",
                                    "type": "text"
                                }
                            ],
                            "index": 22
                        },
                        {
                            "bbox": [
                                70,
                                414,
                                542,
                                426
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        414,
                                        118,
                                        426
                                    ],
                                    "score": 1.0,
                                    "content": "more than ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        119,
                                        415,
                                        137,
                                        424
                                    ],
                                    "score": 0.33,
                                    "content": "50\\%",
                                    "type": "inline_equation",
                                    "height": 9,
                                    "width": 18
                                },
                                {
                                    "bbox": [
                                        137,
                                        414,
                                        542,
                                        426
                                    ],
                                    "score": 1.0,
                                    "content": " of the maximum theoretical TFLOPs/s), we want to spend as much time on matmul FLOPs",
                                    "type": "text"
                                }
                            ],
                            "index": 23
                        },
                        {
                            "bbox": [
                                69,
                                425,
                                122,
                                437
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        69,
                                        425,
                                        122,
                                        437
                                    ],
                                    "score": 1.0,
                                    "content": "as possible.",
                                    "type": "text"
                                }
                            ],
                            "index": 24
                        }
                    ],
                    "index": 21
                },
                {
                    "type": "title",
                    "bbox": [
                        71,
                        451,
                        174,
                        463
                    ],
                    "lines": [
                        {
                            "bbox": [
                                70,
                                452,
                                173,
                                464
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        452,
                                        98,
                                        462
                                    ],
                                    "score": 1.0,
                                    "content": "3.1.1",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        104,
                                        452,
                                        173,
                                        464
                                    ],
                                    "score": 1.0,
                                    "content": "Forward pass",
                                    "type": "text"
                                }
                            ],
                            "index": 25
                        }
                    ],
                    "index": 25
                },
                {
                    "type": "text",
                    "bbox": [
                        74,
                        470,
                        542,
                        494
                    ],
                    "lines": [
                        {
                            "bbox": [
                                73,
                                471,
                                541,
                                481
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        73,
                                        471,
                                        541,
                                        481
                                    ],
                                    "score": 1.0,
                                    "content": "We revisit the online softmax trick as shown in Section 2.3 and make two minor tweaks to reduce non-matmul",
                                    "type": "text"
                                }
                            ],
                            "index": 26
                        },
                        {
                            "bbox": [
                                71,
                                482,
                                108,
                                494
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        71,
                                        482,
                                        108,
                                        494
                                    ],
                                    "score": 1.0,
                                    "content": "FLOPs:",
                                    "type": "text"
                                }
                            ],
                            "index": 27
                        }
                    ],
                    "index": 26.5
                },
                {
                    "type": "text",
                    "bbox": [
                        82,
                        501,
                        428,
                        514
                    ],
                    "lines": [
                        {
                            "bbox": [
                                82,
                                501,
                                426,
                                514
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        82,
                                        501,
                                        371,
                                        514
                                    ],
                                    "score": 1.0,
                                    "content": "1. We do not have to rescale both terms of the output update by ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        371,
                                        503,
                                        423,
                                        514
                                    ],
                                    "score": 0.83,
                                    "content": "\\mathrm{diag}(\\ell^{(2)})^{-1}",
                                    "type": "inline_equation",
                                    "height": 11,
                                    "width": 52
                                },
                                {
                                    "bbox": [
                                        424,
                                        501,
                                        426,
                                        514
                                    ],
                                    "score": 1.0,
                                    "content": ":",
                                    "type": "text"
                                }
                            ],
                            "index": 28
                        }
                    ],
                    "index": 28
                },
                {
                    "type": "interline_equation",
                    "bbox": [
                        196,
                        524,
                        439,
                        537
                    ],
                    "lines": [
                        {
                            "bbox": [
                                196,
                                524,
                                439,
                                537
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        196,
                                        524,
                                        439,
                                        537
                                    ],
                                    "score": 0.87,
                                    "content": "\\mathbf{O}^{(2)}=\\mathrm{diag}(\\ell^{(1)}/\\ell^{(2)})^{-1}\\mathbf{O}^{(1)}+\\mathrm{diag}(\\ell^{(2)})^{-1}e^{\\mathbf{S}^{(2)}-m^{(2)}}\\mathbf{V}^{(2)}.",
                                    "type": "interline_equation"
                                }
                            ]
                        }
                    ],
                    "index": 29,
                    "virtual_lines": [
                        {
                            "bbox": [
                                196,
                                524,
                                439,
                                537
                            ],
                            "spans": [],
                            "index": 29
                        }
                    ]
                },
                {
                    "type": "text",
                    "bbox": [
                        93,
                        546,
                        496,
                        559
                    ],
                    "lines": [
                        {
                            "bbox": [
                                95,
                                546,
                                495,
                                560
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        95,
                                        546,
                                        317,
                                        560
                                    ],
                                    "score": 1.0,
                                    "content": "We can instead maintain an “un-scaled” version of ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        318,
                                        548,
                                        336,
                                        557
                                    ],
                                    "score": 0.92,
                                    "content": "\\mathbf{O}^{(2)}",
                                    "type": "inline_equation",
                                    "height": 9,
                                    "width": 18
                                },
                                {
                                    "bbox": [
                                        336,
                                        546,
                                        474,
                                        560
                                    ],
                                    "score": 1.0,
                                    "content": " and keep around the statistics ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        474,
                                        548,
                                        490,
                                        557
                                    ],
                                    "score": 0.92,
                                    "content": "\\ell^{(2)}",
                                    "type": "inline_equation",
                                    "height": 9,
                                    "width": 16
                                },
                                {
                                    "bbox": [
                                        490,
                                        546,
                                        495,
                                        560
                                    ],
                                    "score": 1.0,
                                    "content": ":",
                                    "type": "text"
                                }
                            ],
                            "index": 30
                        }
                    ],
                    "index": 30
                },
                {
                    "type": "interline_equation",
                    "bbox": [
                        232,
                        569,
                        403,
                        583
                    ],
                    "lines": [
                        {
                            "bbox": [
                                232,
                                569,
                                403,
                                583
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        232,
                                        569,
                                        403,
                                        583
                                    ],
                                    "score": 0.89,
                                    "content": "\\tilde{\\bf0}^{(2)}=\\mathrm{diag}(\\ell^{(1)})^{-1}{\\bf0}^{(1)}+e^{{\\bf S}^{(2)}-m^{(2)}}{\\bf V}^{(2)}.",
                                    "type": "interline_equation"
                                }
                            ]
                        }
                    ],
                    "index": 31,
                    "virtual_lines": [
                        {
                            "bbox": [
                                232,
                                569,
                                403,
                                583
                            ],
                            "spans": [],
                            "index": 31
                        }
                    ]
                },
                {
                    "type": "text",
                    "bbox": [
                        91,
                        591,
                        542,
                        605
                    ],
                    "lines": [
                        {
                            "bbox": [
                                94,
                                589,
                                543,
                                608
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        94,
                                        589,
                                        333,
                                        608
                                    ],
                                    "score": 1.0,
                                    "content": "Only at the every end of the loop do we scale the final ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        333,
                                        593,
                                        360,
                                        603
                                    ],
                                    "score": 0.89,
                                    "content": "\\bar{\\bf O}^{(\\mathrm{last})}",
                                    "type": "inline_equation",
                                    "height": 10,
                                    "width": 27
                                },
                                {
                                    "bbox": [
                                        361,
                                        589,
                                        377,
                                        608
                                    ],
                                    "score": 1.0,
                                    "content": " by ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        377,
                                        594,
                                        437,
                                        605
                                    ],
                                    "score": 0.95,
                                    "content": "\\mathrm{diag}(\\ell^{(\\mathrm{last})})^{-1}",
                                    "type": "inline_equation",
                                    "height": 11,
                                    "width": 60
                                },
                                {
                                    "bbox": [
                                        438,
                                        589,
                                        543,
                                        608
                                    ],
                                    "score": 1.0,
                                    "content": " to get the right output.",
                                    "type": "text"
                                }
                            ],
                            "index": 32
                        }
                    ],
                    "index": 32
                },
                {
                    "type": "text",
                    "bbox": [
                        82,
                        612,
                        542,
                        637
                    ],
                    "lines": [
                        {
                            "bbox": [
                                83,
                                612,
                                541,
                                626
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        83,
                                        612,
                                        260,
                                        626
                                    ],
                                    "score": 1.0,
                                    "content": "2. We do not have to save both the max ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        260,
                                        613,
                                        279,
                                        623
                                    ],
                                    "score": 0.91,
                                    "content": "\\mathbf{\\Omega}_{m}(j)",
                                    "type": "inline_equation",
                                    "height": 10,
                                    "width": 19
                                },
                                {
                                    "bbox": [
                                        279,
                                        612,
                                        406,
                                        626
                                    ],
                                    "score": 1.0,
                                    "content": " and the sum of exponentials ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        406,
                                        613,
                                        422,
                                        623
                                    ],
                                    "score": 0.92,
                                    "content": "\\ell^{(j)}",
                                    "type": "inline_equation",
                                    "height": 10,
                                    "width": 16
                                },
                                {
                                    "bbox": [
                                        422,
                                        612,
                                        541,
                                        626
                                    ],
                                    "score": 1.0,
                                    "content": " for the backward pass. We",
                                    "type": "text"
                                }
                            ],
                            "index": 33
                        },
                        {
                            "bbox": [
                                95,
                                624,
                                342,
                                637
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        95,
                                        624,
                                        244,
                                        637
                                    ],
                                    "score": 1.0,
                                    "content": "only need to store the logsumexp ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        244,
                                        625,
                                        338,
                                        637
                                    ],
                                    "score": 0.91,
                                    "content": "L^{(j)}=m^{(j)}+\\log(\\ell^{(j)})",
                                    "type": "inline_equation",
                                    "height": 12,
                                    "width": 94
                                },
                                {
                                    "bbox": [
                                        339,
                                        624,
                                        342,
                                        637
                                    ],
                                    "score": 1.0,
                                    "content": ".",
                                    "type": "text"
                                }
                            ],
                            "index": 34
                        }
                    ],
                    "index": 33.5
                }
            ],
            "layout_bboxes": [],
            "page_idx": 4,
            "page_size": [
                612.0,
                792.0
            ],
            "_layout_tree": [],
            "images": [],
            "tables": [],
            "interline_equations": [
                {
                    "type": "interline_equation",
                    "bbox": [
                        196,
                        524,
                        439,
                        537
                    ],
                    "lines": [
                        {
                            "bbox": [
                                196,
                                524,
                                439,
                                537
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        196,
                                        524,
                                        439,
                                        537
                                    ],
                                    "score": 0.87,
                                    "content": "\\mathbf{O}^{(2)}=\\mathrm{diag}(\\ell^{(1)}/\\ell^{(2)})^{-1}\\mathbf{O}^{(1)}+\\mathrm{diag}(\\ell^{(2)})^{-1}e^{\\mathbf{S}^{(2)}-m^{(2)}}\\mathbf{V}^{(2)}.",
                                    "type": "interline_equation"
                                }
                            ]
                        }
                    ],
                    "index": 29,
                    "virtual_lines": [
                        {
                            "bbox": [
                                196,
                                524,
                                439,
                                537
                            ],
                            "spans": [],
                            "index": 29
                        }
                    ]
                },
                {
                    "type": "interline_equation",
                    "bbox": [
                        232,
                        569,
                        403,
                        583
                    ],
                    "lines": [
                        {
                            "bbox": [
                                232,
                                569,
                                403,
                                583
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        232,
                                        569,
                                        403,
                                        583
                                    ],
                                    "score": 0.89,
                                    "content": "\\tilde{\\bf0}^{(2)}=\\mathrm{diag}(\\ell^{(1)})^{-1}{\\bf0}^{(1)}+e^{{\\bf S}^{(2)}-m^{(2)}}{\\bf V}^{(2)}.",
                                    "type": "interline_equation"
                                }
                            ]
                        }
                    ],
                    "index": 31,
                    "virtual_lines": [
                        {
                            "bbox": [
                                232,
                                569,
                                403,
                                583
                            ],
                            "spans": [],
                            "index": 31
                        }
                    ]
                }
            ],
            "discarded_blocks": [
                {
                    "type": "discarded",
                    "bbox": [
                        302,
                        742,
                        309,
                        751
                    ],
                    "lines": [
                        {
                            "bbox": [
                                301,
                                741,
                                310,
                                753
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        301,
                                        741,
                                        310,
                                        753
                                    ],
                                    "score": 1.0,
                                    "content": "5",
                                    "type": "text"
                                }
                            ]
                        }
                    ]
                }
            ],
            "need_drop": false,
            "drop_reason": [],
            "para_blocks": [
                {
                    "type": "title",
                    "bbox": [
                        71,
                        73,
                        181,
                        85
                    ],
                    "lines": [
                        {
                            "bbox": [
                                71,
                                74,
                                181,
                                85
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        71,
                                        74,
                                        97,
                                        84
                                    ],
                                    "score": 1.0,
                                    "content": "2.3.2",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        105,
                                        74,
                                        181,
                                        85
                                    ],
                                    "score": 1.0,
                                    "content": "Backward pass",
                                    "type": "text"
                                }
                            ],
                            "index": 0
                        }
                    ],
                    "index": 0,
                    "page_num": "page_4",
                    "page_size": [
                        612.0,
                        792.0
                    ]
                },
                {
                    "type": "text",
                    "bbox": [
                        70,
                        91,
                        541,
                        151
                    ],
                    "lines": [
                        {
                            "bbox": [
                                69,
                                91,
                                541,
                                104
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        69,
                                        91,
                                        436,
                                        104
                                    ],
                                    "score": 1.0,
                                    "content": "In the backward pass, by re-computing the values of the attention matrices S and ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        436,
                                        94,
                                        443,
                                        101
                                    ],
                                    "score": 0.89,
                                    "content": "\\mathbf{P}",
                                    "type": "inline_equation",
                                    "height": 7,
                                    "width": 7
                                },
                                {
                                    "bbox": [
                                        444,
                                        91,
                                        541,
                                        104
                                    ],
                                    "score": 1.0,
                                    "content": " once blocks of inputs",
                                    "type": "text"
                                }
                            ],
                            "index": 1
                        },
                        {
                            "bbox": [
                                71,
                                104,
                                541,
                                116
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        71,
                                        106,
                                        102,
                                        115
                                    ],
                                    "score": 0.92,
                                    "content": "\\mathbf{Q},\\mathbf{K},\\mathbf{V}",
                                    "type": "inline_equation",
                                    "height": 9,
                                    "width": 31
                                },
                                {
                                    "bbox": [
                                        103,
                                        104,
                                        541,
                                        116
                                    ],
                                    "score": 1.0,
                                    "content": " are already loaded to SRAM, FlashAttention avoids having to store large intermediate values. By",
                                    "type": "text"
                                }
                            ],
                            "index": 2
                        },
                        {
                            "bbox": [
                                70,
                                115,
                                541,
                                129
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        115,
                                        260,
                                        129
                                    ],
                                    "score": 1.0,
                                    "content": "not having to save the large matrices S and ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        261,
                                        118,
                                        268,
                                        126
                                    ],
                                    "score": 0.88,
                                    "content": "\\mathbf{P}",
                                    "type": "inline_equation",
                                    "height": 8,
                                    "width": 7
                                },
                                {
                                    "bbox": [
                                        268,
                                        115,
                                        299,
                                        129
                                    ],
                                    "score": 1.0,
                                    "content": " of size",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        300,
                                        119,
                                        327,
                                        126
                                    ],
                                    "score": 0.92,
                                    "content": "N\\times N",
                                    "type": "inline_equation",
                                    "height": 7,
                                    "width": 27
                                },
                                {
                                    "bbox": [
                                        327,
                                        115,
                                        465,
                                        129
                                    ],
                                    "score": 1.0,
                                    "content": ", FlashAttention yields 10-20",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        465,
                                        119,
                                        472,
                                        126
                                    ],
                                    "score": 0.54,
                                    "content": "\\times",
                                    "type": "inline_equation",
                                    "height": 7,
                                    "width": 7
                                },
                                {
                                    "bbox": [
                                        473,
                                        115,
                                        541,
                                        129
                                    ],
                                    "score": 1.0,
                                    "content": " memory saving",
                                    "type": "text"
                                }
                            ],
                            "index": 3
                        },
                        {
                            "bbox": [
                                72,
                                129,
                                541,
                                140
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        72,
                                        129,
                                        411,
                                        140
                                    ],
                                    "score": 1.0,
                                    "content": "depending on sequence length (memory required in linear in sequence length",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        411,
                                        131,
                                        420,
                                        137
                                    ],
                                    "score": 0.9,
                                    "content": "N",
                                    "type": "inline_equation",
                                    "height": 6,
                                    "width": 9
                                },
                                {
                                    "bbox": [
                                        420,
                                        129,
                                        541,
                                        140
                                    ],
                                    "score": 1.0,
                                    "content": "instead of quadratic). The",
                                    "type": "text"
                                }
                            ],
                            "index": 4
                        },
                        {
                            "bbox": [
                                70,
                                140,
                                462,
                                152
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        140,
                                        462,
                                        152
                                    ],
                                    "score": 1.0,
                                    "content": "backward pass also achieves 2-4× wall-clock speedup due to reduce memory reads/writes.",
                                    "type": "text"
                                }
                            ],
                            "index": 5
                        }
                    ],
                    "index": 3,
                    "page_num": "page_4",
                    "page_size": [
                        612.0,
                        792.0
                    ],
                    "bbox_fs": [
                        69,
                        91,
                        541,
                        152
                    ]
                },
                {
                    "type": "text",
                    "bbox": [
                        71,
                        152,
                        540,
                        199
                    ],
                    "lines": [
                        {
                            "bbox": [
                                86,
                                152,
                                540,
                                164
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        86,
                                        152,
                                        540,
                                        164
                                    ],
                                    "score": 1.0,
                                    "content": "The backward pass applies tiling to the equations in Section 2.2. Though the backward pass is simpler",
                                    "type": "text"
                                }
                            ],
                            "index": 6
                        },
                        {
                            "bbox": [
                                71,
                                164,
                                541,
                                176
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        71,
                                        164,
                                        541,
                                        176
                                    ],
                                    "score": 1.0,
                                    "content": "than the forward pass conceptually (there is no softmax rescaling), the implementation is significantly more",
                                    "type": "text"
                                }
                            ],
                            "index": 7
                        },
                        {
                            "bbox": [
                                71,
                                176,
                                541,
                                187
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        71,
                                        176,
                                        541,
                                        187
                                    ],
                                    "score": 1.0,
                                    "content": "involved. This is because there are more values to be kept in SRAM to perform 5 matrix multiples in the",
                                    "type": "text"
                                }
                            ],
                            "index": 8
                        },
                        {
                            "bbox": [
                                70,
                                187,
                                389,
                                201
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        187,
                                        389,
                                        201
                                    ],
                                    "score": 1.0,
                                    "content": "backward pass, compared to just 2 matrix multiples in the forward pass.",
                                    "type": "text"
                                }
                            ],
                            "index": 9
                        }
                    ],
                    "index": 7.5,
                    "page_num": "page_4",
                    "page_size": [
                        612.0,
                        792.0
                    ],
                    "bbox_fs": [
                        70,
                        152,
                        541,
                        201
                    ]
                },
                {
                    "type": "title",
                    "bbox": [
                        71,
                        216,
                        541,
                        251
                    ],
                    "lines": [
                        {
                            "bbox": [
                                71,
                                217,
                                542,
                                233
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        71,
                                        218,
                                        81,
                                        231
                                    ],
                                    "score": 1.0,
                                    "content": "3",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        91,
                                        217,
                                        542,
                                        233
                                    ],
                                    "score": 1.0,
                                    "content": "FlashAttention-2: Algorithm, Parallelism, and Work Partition-",
                                    "type": "text"
                                }
                            ],
                            "index": 10
                        },
                        {
                            "bbox": [
                                93,
                                233,
                                120,
                                254
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        93,
                                        233,
                                        120,
                                        254
                                    ],
                                    "score": 1.0,
                                    "content": "ing",
                                    "type": "text"
                                }
                            ],
                            "index": 11
                        }
                    ],
                    "index": 10.5,
                    "page_num": "page_4",
                    "page_size": [
                        612.0,
                        792.0
                    ]
                },
                {
                    "type": "text",
                    "bbox": [
                        71,
                        259,
                        541,
                        320
                    ],
                    "lines": [
                        {
                            "bbox": [
                                70,
                                260,
                                541,
                                272
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        260,
                                        541,
                                        272
                                    ],
                                    "score": 1.0,
                                    "content": "We describe the FlashAttention-2 algorithm, which includes several tweaks to FlashAttention to reduce",
                                    "type": "text"
                                }
                            ],
                            "index": 12
                        },
                        {
                            "bbox": [
                                70,
                                272,
                                541,
                                284
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        272,
                                        541,
                                        284
                                    ],
                                    "score": 1.0,
                                    "content": "the number of non-matmul FLOPs. We then describe how to parallelize the computation on different thread",
                                    "type": "text"
                                }
                            ],
                            "index": 13
                        },
                        {
                            "bbox": [
                                70,
                                284,
                                541,
                                297
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        284,
                                        541,
                                        297
                                    ],
                                    "score": 1.0,
                                    "content": "blocks to make full use the GPU resources. Finally we describe we partition the work between different warps",
                                    "type": "text"
                                }
                            ],
                            "index": 14
                        },
                        {
                            "bbox": [
                                71,
                                297,
                                541,
                                308
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        71,
                                        297,
                                        541,
                                        308
                                    ],
                                    "score": 1.0,
                                    "content": "within one thread block to reduce the amount of shared memory access. These improvements lead to 2-3×",
                                    "type": "text"
                                }
                            ],
                            "index": 15
                        },
                        {
                            "bbox": [
                                71,
                                309,
                                220,
                                320
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        71,
                                        309,
                                        220,
                                        320
                                    ],
                                    "score": 1.0,
                                    "content": "speedup as validated in Section 4.",
                                    "type": "text"
                                }
                            ],
                            "index": 16
                        }
                    ],
                    "index": 14,
                    "page_num": "page_4",
                    "page_size": [
                        612.0,
                        792.0
                    ],
                    "bbox_fs": [
                        70,
                        260,
                        541,
                        320
                    ]
                },
                {
                    "type": "title",
                    "bbox": [
                        71,
                        334,
                        164,
                        348
                    ],
                    "lines": [
                        {
                            "bbox": [
                                70,
                                334,
                                164,
                                348
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        334,
                                        91,
                                        348
                                    ],
                                    "score": 1.0,
                                    "content": "3.1",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        101,
                                        334,
                                        164,
                                        348
                                    ],
                                    "score": 1.0,
                                    "content": "Algorithm",
                                    "type": "text"
                                }
                            ],
                            "index": 17
                        }
                    ],
                    "index": 17,
                    "page_num": "page_4",
                    "page_size": [
                        612.0,
                        792.0
                    ]
                },
                {
                    "type": "text",
                    "bbox": [
                        70,
                        353,
                        541,
                        438
                    ],
                    "lines": [
                        {
                            "bbox": [
                                70,
                                354,
                                541,
                                366
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        354,
                                        541,
                                        366
                                    ],
                                    "score": 1.0,
                                    "content": "We tweak the algorithm from FlashAttention to reduce the number of non-matmul FLOPs. This is",
                                    "type": "text"
                                }
                            ],
                            "index": 18
                        },
                        {
                            "bbox": [
                                70,
                                366,
                                541,
                                378
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        366,
                                        541,
                                        378
                                    ],
                                    "score": 1.0,
                                    "content": "because modern GPUs have specialized compute units (e.g., Tensor Cores on Nvidia GPUs) that makes",
                                    "type": "text"
                                }
                            ],
                            "index": 19
                        },
                        {
                            "bbox": [
                                70,
                                379,
                                542,
                                391
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        379,
                                        542,
                                        391
                                    ],
                                    "score": 1.0,
                                    "content": "matmul much faster. As an example, the A100 GPU has a max theoretical throughput of 312 TFLOPs/s of",
                                    "type": "text"
                                }
                            ],
                            "index": 20
                        },
                        {
                            "bbox": [
                                70,
                                390,
                                542,
                                402
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        390,
                                        542,
                                        402
                                    ],
                                    "score": 1.0,
                                    "content": "FP16/BF16 matmul, but only 19.5 TFLOPs/s of non-matmul FP32. Another way to think about this is that",
                                    "type": "text"
                                }
                            ],
                            "index": 21
                        },
                        {
                            "bbox": [
                                69,
                                400,
                                542,
                                416
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        69,
                                        400,
                                        192,
                                        416
                                    ],
                                    "score": 1.0,
                                    "content": "each non-matmul FLOP is ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        192,
                                        405,
                                        209,
                                        412
                                    ],
                                    "score": 0.4,
                                    "content": "16\\times",
                                    "type": "inline_equation",
                                    "height": 7,
                                    "width": 17
                                },
                                {
                                    "bbox": [
                                        210,
                                        400,
                                        542,
                                        416
                                    ],
                                    "score": 1.0,
                                    "content": " more expensive than a matmul FLOP. To maintain high throughput (e.g.,",
                                    "type": "text"
                                }
                            ],
                            "index": 22
                        },
                        {
                            "bbox": [
                                70,
                                414,
                                542,
                                426
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        414,
                                        118,
                                        426
                                    ],
                                    "score": 1.0,
                                    "content": "more than ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        119,
                                        415,
                                        137,
                                        424
                                    ],
                                    "score": 0.33,
                                    "content": "50\\%",
                                    "type": "inline_equation",
                                    "height": 9,
                                    "width": 18
                                },
                                {
                                    "bbox": [
                                        137,
                                        414,
                                        542,
                                        426
                                    ],
                                    "score": 1.0,
                                    "content": " of the maximum theoretical TFLOPs/s), we want to spend as much time on matmul FLOPs",
                                    "type": "text"
                                }
                            ],
                            "index": 23
                        },
                        {
                            "bbox": [
                                69,
                                425,
                                122,
                                437
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        69,
                                        425,
                                        122,
                                        437
                                    ],
                                    "score": 1.0,
                                    "content": "as possible.",
                                    "type": "text"
                                }
                            ],
                            "index": 24
                        }
                    ],
                    "index": 21,
                    "page_num": "page_4",
                    "page_size": [
                        612.0,
                        792.0
                    ],
                    "bbox_fs": [
                        69,
                        354,
                        542,
                        437
                    ]
                },
                {
                    "type": "title",
                    "bbox": [
                        71,
                        451,
                        174,
                        463
                    ],
                    "lines": [
                        {
                            "bbox": [
                                70,
                                452,
                                173,
                                464
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        452,
                                        98,
                                        462
                                    ],
                                    "score": 1.0,
                                    "content": "3.1.1",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        104,
                                        452,
                                        173,
                                        464
                                    ],
                                    "score": 1.0,
                                    "content": "Forward pass",
                                    "type": "text"
                                }
                            ],
                            "index": 25
                        }
                    ],
                    "index": 25,
                    "page_num": "page_4",
                    "page_size": [
                        612.0,
                        792.0
                    ]
                },
                {
                    "type": "text",
                    "bbox": [
                        74,
                        470,
                        542,
                        494
                    ],
                    "lines": [
                        {
                            "bbox": [
                                73,
                                471,
                                541,
                                481
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        73,
                                        471,
                                        541,
                                        481
                                    ],
                                    "score": 1.0,
                                    "content": "We revisit the online softmax trick as shown in Section 2.3 and make two minor tweaks to reduce non-matmul",
                                    "type": "text"
                                }
                            ],
                            "index": 26
                        },
                        {
                            "bbox": [
                                71,
                                482,
                                108,
                                494
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        71,
                                        482,
                                        108,
                                        494
                                    ],
                                    "score": 1.0,
                                    "content": "FLOPs:",
                                    "type": "text"
                                }
                            ],
                            "index": 27
                        }
                    ],
                    "index": 26.5,
                    "page_num": "page_4",
                    "page_size": [
                        612.0,
                        792.0
                    ],
                    "bbox_fs": [
                        71,
                        471,
                        541,
                        494
                    ]
                },
                {
                    "type": "text",
                    "bbox": [
                        82,
                        501,
                        428,
                        514
                    ],
                    "lines": [
                        {
                            "bbox": [
                                82,
                                501,
                                426,
                                514
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        82,
                                        501,
                                        371,
                                        514
                                    ],
                                    "score": 1.0,
                                    "content": "1. We do not have to rescale both terms of the output update by ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        371,
                                        503,
                                        423,
                                        514
                                    ],
                                    "score": 0.83,
                                    "content": "\\mathrm{diag}(\\ell^{(2)})^{-1}",
                                    "type": "inline_equation",
                                    "height": 11,
                                    "width": 52
                                },
                                {
                                    "bbox": [
                                        424,
                                        501,
                                        426,
                                        514
                                    ],
                                    "score": 1.0,
                                    "content": ":",
                                    "type": "text"
                                }
                            ],
                            "index": 28
                        }
                    ],
                    "index": 28,
                    "page_num": "page_4",
                    "page_size": [
                        612.0,
                        792.0
                    ],
                    "bbox_fs": [
                        82,
                        501,
                        426,
                        514
                    ]
                },
                {
                    "type": "interline_equation",
                    "bbox": [
                        196,
                        524,
                        439,
                        537
                    ],
                    "lines": [
                        {
                            "bbox": [
                                196,
                                524,
                                439,
                                537
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        196,
                                        524,
                                        439,
                                        537
                                    ],
                                    "score": 0.87,
                                    "content": "\\mathbf{O}^{(2)}=\\mathrm{diag}(\\ell^{(1)}/\\ell^{(2)})^{-1}\\mathbf{O}^{(1)}+\\mathrm{diag}(\\ell^{(2)})^{-1}e^{\\mathbf{S}^{(2)}-m^{(2)}}\\mathbf{V}^{(2)}.",
                                    "type": "interline_equation"
                                }
                            ]
                        }
                    ],
                    "index": 29,
                    "virtual_lines": [
                        {
                            "bbox": [
                                196,
                                524,
                                439,
                                537
                            ],
                            "spans": [],
                            "index": 29
                        }
                    ],
                    "page_num": "page_4",
                    "page_size": [
                        612.0,
                        792.0
                    ]
                },
                {
                    "type": "text",
                    "bbox": [
                        93,
                        546,
                        496,
                        559
                    ],
                    "lines": [
                        {
                            "bbox": [
                                95,
                                546,
                                495,
                                560
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        95,
                                        546,
                                        317,
                                        560
                                    ],
                                    "score": 1.0,
                                    "content": "We can instead maintain an “un-scaled” version of ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        318,
                                        548,
                                        336,
                                        557
                                    ],
                                    "score": 0.92,
                                    "content": "\\mathbf{O}^{(2)}",
                                    "type": "inline_equation",
                                    "height": 9,
                                    "width": 18
                                },
                                {
                                    "bbox": [
                                        336,
                                        546,
                                        474,
                                        560
                                    ],
                                    "score": 1.0,
                                    "content": " and keep around the statistics ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        474,
                                        548,
                                        490,
                                        557
                                    ],
                                    "score": 0.92,
                                    "content": "\\ell^{(2)}",
                                    "type": "inline_equation",
                                    "height": 9,
                                    "width": 16
                                },
                                {
                                    "bbox": [
                                        490,
                                        546,
                                        495,
                                        560
                                    ],
                                    "score": 1.0,
                                    "content": ":",
                                    "type": "text"
                                }
                            ],
                            "index": 30
                        }
                    ],
                    "index": 30,
                    "page_num": "page_4",
                    "page_size": [
                        612.0,
                        792.0
                    ],
                    "bbox_fs": [
                        95,
                        546,
                        495,
                        560
                    ]
                },
                {
                    "type": "interline_equation",
                    "bbox": [
                        232,
                        569,
                        403,
                        583
                    ],
                    "lines": [
                        {
                            "bbox": [
                                232,
                                569,
                                403,
                                583
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        232,
                                        569,
                                        403,
                                        583
                                    ],
                                    "score": 0.89,
                                    "content": "\\tilde{\\bf0}^{(2)}=\\mathrm{diag}(\\ell^{(1)})^{-1}{\\bf0}^{(1)}+e^{{\\bf S}^{(2)}-m^{(2)}}{\\bf V}^{(2)}.",
                                    "type": "interline_equation"
                                }
                            ]
                        }
                    ],
                    "index": 31,
                    "virtual_lines": [
                        {
                            "bbox": [
                                232,
                                569,
                                403,
                                583
                            ],
                            "spans": [],
                            "index": 31
                        }
                    ],
                    "page_num": "page_4",
                    "page_size": [
                        612.0,
                        792.0
                    ]
                },
                {
                    "type": "text",
                    "bbox": [
                        91,
                        591,
                        542,
                        605
                    ],
                    "lines": [
                        {
                            "bbox": [
                                94,
                                589,
                                543,
                                608
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        94,
                                        589,
                                        333,
                                        608
                                    ],
                                    "score": 1.0,
                                    "content": "Only at the every end of the loop do we scale the final ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        333,
                                        593,
                                        360,
                                        603
                                    ],
                                    "score": 0.89,
                                    "content": "\\bar{\\bf O}^{(\\mathrm{last})}",
                                    "type": "inline_equation",
                                    "height": 10,
                                    "width": 27
                                },
                                {
                                    "bbox": [
                                        361,
                                        589,
                                        377,
                                        608
                                    ],
                                    "score": 1.0,
                                    "content": " by ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        377,
                                        594,
                                        437,
                                        605
                                    ],
                                    "score": 0.95,
                                    "content": "\\mathrm{diag}(\\ell^{(\\mathrm{last})})^{-1}",
                                    "type": "inline_equation",
                                    "height": 11,
                                    "width": 60
                                },
                                {
                                    "bbox": [
                                        438,
                                        589,
                                        543,
                                        608
                                    ],
                                    "score": 1.0,
                                    "content": " to get the right output.",
                                    "type": "text"
                                }
                            ],
                            "index": 32
                        }
                    ],
                    "index": 32,
                    "page_num": "page_4",
                    "page_size": [
                        612.0,
                        792.0
                    ],
                    "bbox_fs": [
                        94,
                        589,
                        543,
                        608
                    ]
                },
                {
                    "type": "text",
                    "bbox": [
                        82,
                        612,
                        542,
                        637
                    ],
                    "lines": [
                        {
                            "bbox": [
                                83,
                                612,
                                541,
                                626
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        83,
                                        612,
                                        260,
                                        626
                                    ],
                                    "score": 1.0,
                                    "content": "2. We do not have to save both the max ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        260,
                                        613,
                                        279,
                                        623
                                    ],
                                    "score": 0.91,
                                    "content": "\\mathbf{\\Omega}_{m}(j)",
                                    "type": "inline_equation",
                                    "height": 10,
                                    "width": 19
                                },
                                {
                                    "bbox": [
                                        279,
                                        612,
                                        406,
                                        626
                                    ],
                                    "score": 1.0,
                                    "content": " and the sum of exponentials ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        406,
                                        613,
                                        422,
                                        623
                                    ],
                                    "score": 0.92,
                                    "content": "\\ell^{(j)}",
                                    "type": "inline_equation",
                                    "height": 10,
                                    "width": 16
                                },
                                {
                                    "bbox": [
                                        422,
                                        612,
                                        541,
                                        626
                                    ],
                                    "score": 1.0,
                                    "content": " for the backward pass. We",
                                    "type": "text"
                                }
                            ],
                            "index": 33
                        },
                        {
                            "bbox": [
                                95,
                                624,
                                342,
                                637
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        95,
                                        624,
                                        244,
                                        637
                                    ],
                                    "score": 1.0,
                                    "content": "only need to store the logsumexp ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        244,
                                        625,
                                        338,
                                        637
                                    ],
                                    "score": 0.91,
                                    "content": "L^{(j)}=m^{(j)}+\\log(\\ell^{(j)})",
                                    "type": "inline_equation",
                                    "height": 12,
                                    "width": 94
                                },
                                {
                                    "bbox": [
                                        339,
                                        624,
                                        342,
                                        637
                                    ],
                                    "score": 1.0,
                                    "content": ".",
                                    "type": "text"
                                }
                            ],
                            "index": 34
                        }
                    ],
                    "index": 33.5,
                    "page_num": "page_4",
                    "page_size": [
                        612.0,
                        792.0
                    ],
                    "bbox_fs": [
                        83,
                        612,
                        541,
                        637
                    ]
                }
            ]
        },
        {
            "preproc_blocks": [
                {
                    "type": "text",
                    "bbox": [
                        82,
                        73,
                        451,
                        86
                    ],
                    "lines": [
                        {
                            "bbox": [
                                86,
                                74,
                                451,
                                84
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        86,
                                        74,
                                        451,
                                        84
                                    ],
                                    "score": 1.0,
                                    "content": "In the simple case of 2 blocks in Section 2.3, the online softmax trick now becomes:",
                                    "type": "text"
                                }
                            ],
                            "index": 0
                        }
                    ],
                    "index": 0
                },
                {
                    "type": "interline_equation",
                    "bbox": [
                        124,
                        92,
                        486,
                        234
                    ],
                    "lines": [
                        {
                            "bbox": [
                                124,
                                92,
                                486,
                                234
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        124,
                                        92,
                                        486,
                                        234
                                    ],
                                    "score": 0.93,
                                    "content": "\\begin{array}{r l}&{m^{(1)}=\\mathrm{rowmax}(\\mathbb{S}^{(1)})\\in\\mathbb{R}^{N_{r}}}\\\\ &{\\ell^{(1)}=\\mathrm{rowsum}(e^{\\mathbb{S}^{(1)}-m^{(1)}})\\in\\mathbb{R}^{B},}\\\\ &{\\mathbb{O}^{(1)}=e^{\\mathbb{S}^{(1)}-m^{(1)}\\mathbb{V}^{(1)}}\\nabla^{(1)}\\in\\mathbb{R}^{N_{r}\\times M}}\\\\ &{m^{(2)}=\\operatorname*{max}(m^{(1)},\\mathrm{rownax}(\\mathbb{S}^{(2)}))=m}\\\\ &{\\ell^{(2)}=e^{m^{(1)}-m^{(2)}}\\ell^{(1)}+\\mathrm{rowsum}(e^{\\mathbb{S}^{(2)}-m^{(2)}})=\\mathrm{rowsum}(e^{\\mathbb{S}^{(1)}-m})+\\mathrm{rowsum}(e^{\\mathbb{S}^{(2)}-m})=\\ell}\\\\ &{\\tilde{\\mathbb{P}}^{(2)}=\\mathrm{diag}(\\ell^{(2)})^{-1}e^{\\mathbb{S}^{(2)}-m^{(2)}}}\\\\ &{\\tilde{\\mathbb{O}}^{(2)}=\\mathrm{diag}(e^{m^{(1)}-m^{(2)}})^{-1}\\tilde{\\mathbb{O}}^{(1)}+e^{\\mathbb{S}^{(2)}-m^{(2)}}\\nabla^{(2)}=e^{\\mathbb{S}^{(1)}-m}\\nabla^{(1)}+e^{\\mathbb{S}^{(2)}-m}\\nabla^{(2)}}\\\\ &{\\mathbb{O}^{(2)}=\\mathrm{diag}(\\ell^{(2)})^{-1}\\tilde{\\mathbb{O}}^{(2)}={\\mathbb{O}}.}\\end{array}",
                                    "type": "interline_equation"
                                }
                            ]
                        }
                    ],
                    "index": 2,
                    "virtual_lines": [
                        {
                            "bbox": [
                                124,
                                92,
                                486,
                                139.33333333333334
                            ],
                            "spans": [],
                            "index": 1
                        },
                        {
                            "bbox": [
                                124,
                                139.33333333333334,
                                486,
                                186.66666666666669
                            ],
                            "spans": [],
                            "index": 2
                        },
                        {
                            "bbox": [
                                124,
                                186.66666666666669,
                                486,
                                234.00000000000003
                            ],
                            "spans": [],
                            "index": 3
                        }
                    ]
                },
                {
                    "type": "text",
                    "bbox": [
                        87,
                        241,
                        396,
                        254
                    ],
                    "lines": [
                        {
                            "bbox": [
                                86,
                                242,
                                396,
                                253
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        86,
                                        242,
                                        396,
                                        253
                                    ],
                                    "score": 1.0,
                                    "content": "We describe the full FlashAttention-2 forward pass in Algorithm 1.",
                                    "type": "text"
                                }
                            ],
                            "index": 4
                        }
                    ],
                    "index": 4
                },
                {
                    "type": "title",
                    "bbox": [
                        73,
                        266,
                        272,
                        278
                    ],
                    "lines": [
                        {
                            "bbox": [
                                72,
                                267,
                                273,
                                278
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        72,
                                        267,
                                        273,
                                        278
                                    ],
                                    "score": 1.0,
                                    "content": "Algorithm 1 FlashAttention-2 forward pass",
                                    "type": "text"
                                }
                            ],
                            "index": 5
                        }
                    ],
                    "index": 5
                },
                {
                    "type": "text",
                    "bbox": [
                        72,
                        281,
                        541,
                        560
                    ],
                    "lines": [
                        {
                            "bbox": [
                                72,
                                281,
                                352,
                                296
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        72,
                                        281,
                                        159,
                                        296
                                    ],
                                    "score": 1.0,
                                    "content": "Require: Matrices ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        160,
                                        284,
                                        226,
                                        294
                                    ],
                                    "score": 0.87,
                                    "content": "{\\bf Q},{\\bf K},{\\bf V}\\in\\mathbb{R}^{N\\times d}",
                                    "type": "inline_equation",
                                    "height": 10,
                                    "width": 66
                                },
                                {
                                    "bbox": [
                                        227,
                                        281,
                                        319,
                                        296
                                    ],
                                    "score": 1.0,
                                    "content": "in HBM, block sizes",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        320,
                                        284,
                                        348,
                                        295
                                    ],
                                    "score": 0.28,
                                    "content": "B_{c},B_{r}",
                                    "type": "inline_equation",
                                    "height": 11,
                                    "width": 28
                                },
                                {
                                    "bbox": [
                                        349,
                                        281,
                                        352,
                                        296
                                    ],
                                    "score": 1.0,
                                    "content": ".",
                                    "type": "text"
                                }
                            ],
                            "index": 6
                        },
                        {
                            "bbox": [
                                74,
                                295,
                                540,
                                314
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        74,
                                        295,
                                        120,
                                        312
                                    ],
                                    "score": 1.0,
                                    "content": "1: Divide ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        121,
                                        300,
                                        129,
                                        309
                                    ],
                                    "score": 0.63,
                                    "content": "\\mathbf{Q}",
                                    "type": "inline_equation",
                                    "height": 9,
                                    "width": 8
                                },
                                {
                                    "bbox": [
                                        129,
                                        295,
                                        152,
                                        312
                                    ],
                                    "score": 1.0,
                                    "content": " into ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        152,
                                        295,
                                        194,
                                        314
                                    ],
                                    "score": 0.93,
                                    "content": "\\begin{array}{r}{T_{r}=\\bigg\\lceil\\frac{N}{B_{r}}\\bigg\\rceil}\\end{array}",
                                    "type": "inline_equation",
                                    "height": 19,
                                    "width": 42
                                },
                                {
                                    "bbox": [
                                        194,
                                        295,
                                        227,
                                        312
                                    ],
                                    "score": 1.0,
                                    "content": "blocks ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        227,
                                        299,
                                        277,
                                        310
                                    ],
                                    "score": 0.85,
                                    "content": "\\mathbf{Q}_{1},\\ldots,\\mathbf{Q}_{T_{r}}",
                                    "type": "inline_equation",
                                    "height": 11,
                                    "width": 50
                                },
                                {
                                    "bbox": [
                                        277,
                                        295,
                                        311,
                                        312
                                    ],
                                    "score": 1.0,
                                    "content": "of size ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        311,
                                        299,
                                        340,
                                        309
                                    ],
                                    "score": 0.88,
                                    "content": "B_{r}\\times d",
                                    "type": "inline_equation",
                                    "height": 10,
                                    "width": 29
                                },
                                {
                                    "bbox": [
                                        340,
                                        295,
                                        419,
                                        312
                                    ],
                                    "score": 1.0,
                                    "content": "each, and divide ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        419,
                                        298,
                                        440,
                                        309
                                    ],
                                    "score": 0.81,
                                    "content": "\\mathbf{K},\\mathbf{V}",
                                    "type": "inline_equation",
                                    "height": 11,
                                    "width": 21
                                },
                                {
                                    "bbox": [
                                        440,
                                        295,
                                        466,
                                        312
                                    ],
                                    "score": 1.0,
                                    "content": " in to",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        467,
                                        295,
                                        509,
                                        314
                                    ],
                                    "score": 0.93,
                                    "content": "\\begin{array}{r}{T_{c}=\\left\\lceil\\frac{N}{B_{c}}\\right\\rceil}\\end{array}",
                                    "type": "inline_equation",
                                    "height": 19,
                                    "width": 42
                                },
                                {
                                    "bbox": [
                                        511,
                                        297,
                                        540,
                                        309
                                    ],
                                    "score": 1.0,
                                    "content": "blocks",
                                    "type": "text"
                                }
                            ],
                            "index": 7
                        },
                        {
                            "bbox": [
                                88,
                                312,
                                302,
                                325
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        88,
                                        314,
                                        138,
                                        324
                                    ],
                                    "score": 0.91,
                                    "content": "\\mathbf{K}_{1},\\ldots,\\mathbf{K}_{T_{c}}",
                                    "type": "inline_equation",
                                    "height": 10,
                                    "width": 50
                                },
                                {
                                    "bbox": [
                                        138,
                                        312,
                                        161,
                                        325
                                    ],
                                    "score": 1.0,
                                    "content": "and ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        161,
                                        314,
                                        211,
                                        324
                                    ],
                                    "score": 0.83,
                                    "content": "\\mathbf{V}_{1},\\ldots,\\mathbf{V}_{T_{c}}",
                                    "type": "inline_equation",
                                    "height": 10,
                                    "width": 50
                                },
                                {
                                    "bbox": [
                                        212,
                                        312,
                                        247,
                                        325
                                    ],
                                    "score": 1.0,
                                    "content": ", of size ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        247,
                                        315,
                                        275,
                                        323
                                    ],
                                    "score": 0.9,
                                    "content": "B_{c}\\times d",
                                    "type": "inline_equation",
                                    "height": 8,
                                    "width": 28
                                },
                                {
                                    "bbox": [
                                        276,
                                        312,
                                        302,
                                        325
                                    ],
                                    "score": 1.0,
                                    "content": "each.",
                                    "type": "text"
                                }
                            ],
                            "index": 8
                        },
                        {
                            "bbox": [
                                74,
                                321,
                                540,
                                339
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        74,
                                        321,
                                        170,
                                        339
                                    ],
                                    "score": 1.0,
                                    "content": "2: Divide the output ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        170,
                                        325,
                                        213,
                                        334
                                    ],
                                    "score": 0.89,
                                    "content": "\\mathbf{O}\\in\\mathbb{R}^{N\\times d}",
                                    "type": "inline_equation",
                                    "height": 9,
                                    "width": 43
                                },
                                {
                                    "bbox": [
                                        213,
                                        321,
                                        236,
                                        339
                                    ],
                                    "score": 1.0,
                                    "content": "into ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        236,
                                        327,
                                        245,
                                        335
                                    ],
                                    "score": 0.9,
                                    "content": "T_{r}",
                                    "type": "inline_equation",
                                    "height": 8,
                                    "width": 9
                                },
                                {
                                    "bbox": [
                                        246,
                                        321,
                                        279,
                                        339
                                    ],
                                    "score": 1.0,
                                    "content": "blocks ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        279,
                                        325,
                                        327,
                                        336
                                    ],
                                    "score": 0.89,
                                    "content": "\\mathbf{0}_{i},\\ldots,\\mathbf{0}_{T_{r}}",
                                    "type": "inline_equation",
                                    "height": 11,
                                    "width": 48
                                },
                                {
                                    "bbox": [
                                        327,
                                        321,
                                        360,
                                        339
                                    ],
                                    "score": 1.0,
                                    "content": "of size",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        361,
                                        325,
                                        389,
                                        335
                                    ],
                                    "score": 0.9,
                                    "content": "B_{r}\\times d",
                                    "type": "inline_equation",
                                    "height": 10,
                                    "width": 28
                                },
                                {
                                    "bbox": [
                                        389,
                                        321,
                                        532,
                                        339
                                    ],
                                    "score": 1.0,
                                    "content": "each, and divide the logsumexp",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        532,
                                        327,
                                        540,
                                        334
                                    ],
                                    "score": 0.84,
                                    "content": "L",
                                    "type": "inline_equation",
                                    "height": 7,
                                    "width": 8
                                }
                            ],
                            "index": 9
                        },
                        {
                            "bbox": [
                                87,
                                336,
                                268,
                                349
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        87,
                                        336,
                                        108,
                                        349
                                    ],
                                    "score": 1.0,
                                    "content": "into ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        108,
                                        339,
                                        117,
                                        347
                                    ],
                                    "score": 0.9,
                                    "content": "T_{r}",
                                    "type": "inline_equation",
                                    "height": 8,
                                    "width": 9
                                },
                                {
                                    "bbox": [
                                        118,
                                        336,
                                        151,
                                        349
                                    ],
                                    "score": 1.0,
                                    "content": "blocks ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        151,
                                        339,
                                        197,
                                        348
                                    ],
                                    "score": 0.92,
                                    "content": "L_{i},\\ldots,L_{T_{r}}",
                                    "type": "inline_equation",
                                    "height": 9,
                                    "width": 46
                                },
                                {
                                    "bbox": [
                                        197,
                                        336,
                                        230,
                                        349
                                    ],
                                    "score": 1.0,
                                    "content": "of size ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        231,
                                        339,
                                        241,
                                        347
                                    ],
                                    "score": 0.89,
                                    "content": "B_{r}",
                                    "type": "inline_equation",
                                    "height": 8,
                                    "width": 10
                                },
                                {
                                    "bbox": [
                                        242,
                                        336,
                                        268,
                                        349
                                    ],
                                    "score": 1.0,
                                    "content": "each.",
                                    "type": "text"
                                }
                            ],
                            "index": 10
                        },
                        {
                            "bbox": [
                                75,
                                349,
                                165,
                                359
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        75,
                                        349,
                                        105,
                                        359
                                    ],
                                    "score": 1.0,
                                    "content": "3: for ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        105,
                                        351,
                                        147,
                                        359
                                    ],
                                    "score": 0.91,
                                    "content": "1\\leq i\\leq T_{r}",
                                    "type": "inline_equation",
                                    "height": 8,
                                    "width": 42
                                },
                                {
                                    "bbox": [
                                        147,
                                        349,
                                        165,
                                        359
                                    ],
                                    "score": 1.0,
                                    "content": "do",
                                    "type": "text"
                                }
                            ],
                            "index": 11
                        },
                        {
                            "bbox": [
                                74,
                                360,
                                268,
                                373
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        74,
                                        361,
                                        86,
                                        372
                                    ],
                                    "score": 1.0,
                                    "content": "4:",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        97,
                                        360,
                                        123,
                                        373
                                    ],
                                    "score": 1.0,
                                    "content": "Load ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        123,
                                        362,
                                        134,
                                        371
                                    ],
                                    "score": 0.9,
                                    "content": "\\mathbf{Q}_{i}",
                                    "type": "inline_equation",
                                    "height": 9,
                                    "width": 11
                                },
                                {
                                    "bbox": [
                                        134,
                                        360,
                                        268,
                                        373
                                    ],
                                    "score": 1.0,
                                    "content": "from HBM to on-chip SRAM.",
                                    "type": "text"
                                }
                            ],
                            "index": 12
                        },
                        {
                            "bbox": [
                                74,
                                367,
                                458,
                                389
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        74,
                                        374,
                                        86,
                                        385
                                    ],
                                    "score": 1.0,
                                    "content": "5:",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        95,
                                        367,
                                        178,
                                        389
                                    ],
                                    "score": 1.0,
                                    "content": "On chip, initialize",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        179,
                                        371,
                                        458,
                                        386
                                    ],
                                    "score": 0.83,
                                    "content": "\\mathbf{O}_{i}^{(0)}=(0)_{B_{r}\\times d}\\in\\mathbb{R}^{B_{r}\\times d},\\ell_{i}^{(0)}=(0)_{B_{r}}\\in\\mathbb{R}^{B_{r}},m_{i}^{(0)}=(-\\infty)_{B_{r}}\\in\\mathbb{R}^{B_{r}}.",
                                    "type": "inline_equation",
                                    "height": 15,
                                    "width": 279
                                }
                            ],
                            "index": 13
                        },
                        {
                            "bbox": [
                                74,
                                386,
                                177,
                                397
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        74,
                                        386,
                                        86,
                                        397
                                    ],
                                    "score": 1.0,
                                    "content": "6:",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        97,
                                        386,
                                        115,
                                        397
                                    ],
                                    "score": 1.0,
                                    "content": "for ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        115,
                                        387,
                                        159,
                                        397
                                    ],
                                    "score": 0.9,
                                    "content": "1\\leq j\\leq T_{c}",
                                    "type": "inline_equation",
                                    "height": 10,
                                    "width": 44
                                },
                                {
                                    "bbox": [
                                        160,
                                        386,
                                        177,
                                        397
                                    ],
                                    "score": 1.0,
                                    "content": "do",
                                    "type": "text"
                                }
                            ],
                            "index": 14
                        },
                        {
                            "bbox": [
                                75,
                                396,
                                296,
                                410
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        75,
                                        398,
                                        86,
                                        410
                                    ],
                                    "score": 1.0,
                                    "content": "7:",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        106,
                                        396,
                                        133,
                                        410
                                    ],
                                    "score": 1.0,
                                    "content": "Load ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        133,
                                        399,
                                        162,
                                        410
                                    ],
                                    "score": 0.92,
                                    "content": "\\mathbf{K}_{j},\\mathbf{V}_{j}",
                                    "type": "inline_equation",
                                    "height": 11,
                                    "width": 29
                                },
                                {
                                    "bbox": [
                                        162,
                                        396,
                                        296,
                                        410
                                    ],
                                    "score": 1.0,
                                    "content": "from HBM to on-chip SRAM.",
                                    "type": "text"
                                }
                            ],
                            "index": 15
                        },
                        {
                            "bbox": [
                                74,
                                409,
                                289,
                                425
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        74,
                                        412,
                                        86,
                                        424
                                    ],
                                    "score": 1.0,
                                    "content": "8:",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        105,
                                        409,
                                        189,
                                        425
                                    ],
                                    "score": 1.0,
                                    "content": "On chip, compute ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        189,
                                        410,
                                        284,
                                        425
                                    ],
                                    "score": 0.92,
                                    "content": "\\mathbf{S}_{i}^{(j)}=\\mathbf{Q}_{i}\\mathbf{K}_{j}^{T}\\in\\mathbb{R}^{B_{r}\\times B_{c}}",
                                    "type": "inline_equation",
                                    "height": 15,
                                    "width": 95
                                },
                                {
                                    "bbox": [
                                        284,
                                        409,
                                        289,
                                        425
                                    ],
                                    "score": 1.0,
                                    "content": ".",
                                    "type": "text"
                                }
                            ],
                            "index": 16
                        },
                        {
                            "bbox": [
                                74,
                                420,
                                539,
                                473
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        74,
                                        428,
                                        86,
                                        439
                                    ],
                                    "score": 1.0,
                                    "content": "9:",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        102,
                                        420,
                                        189,
                                        443
                                    ],
                                    "score": 1.0,
                                    "content": "On chip, compute",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        189,
                                        423,
                                        539,
                                        473
                                    ],
                                    "score": 0.44,
                                    "content": "\\begin{array}{r l}&{\\textrm{\\boldmath{m}}_{i}^{(j)}=\\displaystyle\\operatorname*{max}_{m({m}_{i}^{(j-1)},\\mathrm{rowmax}({\\bf S}_{i}^{(j)}))}\\in\\mathbb{R}^{B_{r}},\\tilde{{\\bf P}}_{i}^{(j)}=\\exp({\\bf S}_{i}^{(j)}-m_{i}^{(j)})\\in\\mathbb{R}^{B_{r}\\times B_{c}}}\\\\ &{e^{m_{i}^{j-1}-m_{i}^{(j)}}\\ell_{i}^{(j-1)}+\\mathrm{rowsum}(\\tilde{{\\bf P}}_{i}^{(j)})\\in\\mathbb{R}^{B_{r}}.}\\\\ &{{\\bf O}_{i}^{(j)}=\\mathrm{diag}(e^{m_{i}^{(j-1)}-m_{i}^{(j)}})^{-1}{\\bf O}_{i}^{(j-1)}+\\tilde{{\\bf P}}_{i}^{(j)}{\\bf V}_{j}.}\\end{array}",
                                    "type": "inline_equation"
                                }
                            ],
                            "index": 18
                        },
                        {
                            "bbox": [
                                104,
                                437,
                                161,
                                458
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        104,
                                        437,
                                        161,
                                        458
                                    ],
                                    "score": 1.0,
                                    "content": "(pointwise), ",
                                    "type": "text"
                                }
                            ],
                            "index": 17
                        },
                        {
                            "bbox": [
                                71,
                                454,
                                189,
                                471
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        71,
                                        459,
                                        86,
                                        471
                                    ],
                                    "score": 1.0,
                                    "content": "10:",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        104,
                                        454,
                                        189,
                                        471
                                    ],
                                    "score": 1.0,
                                    "content": "On chip, compute ",
                                    "type": "text"
                                }
                            ],
                            "index": 19
                        },
                        {
                            "bbox": [
                                71,
                                471,
                                136,
                                483
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        71,
                                        471,
                                        86,
                                        483
                                    ],
                                    "score": 1.0,
                                    "content": "11:",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        98,
                                        471,
                                        136,
                                        482
                                    ],
                                    "score": 1.0,
                                    "content": "end for",
                                    "type": "text"
                                }
                            ],
                            "index": 20
                        },
                        {
                            "bbox": [
                                71,
                                481,
                                280,
                                496
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        71,
                                        483,
                                        86,
                                        495
                                    ],
                                    "score": 1.0,
                                    "content": "12:",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        95,
                                        481,
                                        179,
                                        496
                                    ],
                                    "score": 1.0,
                                    "content": "On chip, compute ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        179,
                                        481,
                                        280,
                                        495
                                    ],
                                    "score": 0.92,
                                    "content": "\\mathbf{O}_{i}=\\mathrm{diag}(\\ell_{i}^{(T_{c})})^{-1}\\mathbf{O}_{i}^{(T_{c})}",
                                    "type": "inline_equation",
                                    "height": 14,
                                    "width": 101
                                }
                            ],
                            "index": 21
                        },
                        {
                            "bbox": [
                                71,
                                493,
                                274,
                                512
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        71,
                                        497,
                                        86,
                                        509
                                    ],
                                    "score": 1.0,
                                    "content": "13:",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        95,
                                        493,
                                        178,
                                        512
                                    ],
                                    "score": 1.0,
                                    "content": "On chip, compute",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        179,
                                        496,
                                        274,
                                        510
                                    ],
                                    "score": 0.92,
                                    "content": "L_{i}=m_{i}^{(T_{c})}+\\log(\\ell_{i}^{(T_{c})})",
                                    "type": "inline_equation",
                                    "height": 14,
                                    "width": 95
                                }
                            ],
                            "index": 22
                        },
                        {
                            "bbox": [
                                71,
                                509,
                                275,
                                521
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        71,
                                        509,
                                        86,
                                        521
                                    ],
                                    "score": 1.0,
                                    "content": "14:",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        98,
                                        509,
                                        126,
                                        520
                                    ],
                                    "score": 1.0,
                                    "content": "Write ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        126,
                                        511,
                                        136,
                                        520
                                    ],
                                    "score": 0.88,
                                    "content": "\\mathbf{0}_{i}",
                                    "type": "inline_equation",
                                    "height": 9,
                                    "width": 10
                                },
                                {
                                    "bbox": [
                                        137,
                                        509,
                                        208,
                                        520
                                    ],
                                    "score": 1.0,
                                    "content": "to HBM as the ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        208,
                                        511,
                                        212,
                                        518
                                    ],
                                    "score": 0.77,
                                    "content": "i",
                                    "type": "inline_equation",
                                    "height": 7,
                                    "width": 4
                                },
                                {
                                    "bbox": [
                                        212,
                                        509,
                                        264,
                                        520
                                    ],
                                    "score": 1.0,
                                    "content": "-th block of ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        265,
                                        511,
                                        273,
                                        518
                                    ],
                                    "score": 0.76,
                                    "content": "\\mathbf{0}",
                                    "type": "inline_equation",
                                    "height": 7,
                                    "width": 8
                                },
                                {
                                    "bbox": [
                                        273,
                                        509,
                                        275,
                                        520
                                    ],
                                    "score": 1.0,
                                    "content": ".",
                                    "type": "text"
                                }
                            ],
                            "index": 23
                        },
                        {
                            "bbox": [
                                71,
                                521,
                                274,
                                533
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        71,
                                        522,
                                        86,
                                        533
                                    ],
                                    "score": 1.0,
                                    "content": "15:",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        98,
                                        521,
                                        126,
                                        532
                                    ],
                                    "score": 1.0,
                                    "content": "Write ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        126,
                                        523,
                                        135,
                                        532
                                    ],
                                    "score": 0.9,
                                    "content": "L_{i}",
                                    "type": "inline_equation",
                                    "height": 9,
                                    "width": 9
                                },
                                {
                                    "bbox": [
                                        136,
                                        521,
                                        207,
                                        532
                                    ],
                                    "score": 1.0,
                                    "content": "to HBM as the ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        207,
                                        523,
                                        210,
                                        530
                                    ],
                                    "score": 0.8,
                                    "content": "i",
                                    "type": "inline_equation",
                                    "height": 7,
                                    "width": 3
                                },
                                {
                                    "bbox": [
                                        211,
                                        521,
                                        263,
                                        532
                                    ],
                                    "score": 1.0,
                                    "content": "-th block of",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        264,
                                        523,
                                        271,
                                        530
                                    ],
                                    "score": 0.88,
                                    "content": "L",
                                    "type": "inline_equation",
                                    "height": 7,
                                    "width": 7
                                },
                                {
                                    "bbox": [
                                        271,
                                        521,
                                        274,
                                        532
                                    ],
                                    "score": 1.0,
                                    "content": ".",
                                    "type": "text"
                                }
                            ],
                            "index": 24
                        },
                        {
                            "bbox": [
                                71,
                                533,
                                125,
                                543
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        71,
                                        533,
                                        125,
                                        543
                                    ],
                                    "score": 1.0,
                                    "content": "16: end for",
                                    "type": "text"
                                }
                            ],
                            "index": 25
                        },
                        {
                            "bbox": [
                                72,
                                546,
                                278,
                                557
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        72,
                                        546,
                                        172,
                                        557
                                    ],
                                    "score": 1.0,
                                    "content": "17: Return the output ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        172,
                                        547,
                                        180,
                                        555
                                    ],
                                    "score": 0.32,
                                    "content": "\\mathbf{0}",
                                    "type": "inline_equation",
                                    "height": 8,
                                    "width": 8
                                },
                                {
                                    "bbox": [
                                        180,
                                        546,
                                        268,
                                        557
                                    ],
                                    "score": 1.0,
                                    "content": " and the logsumexp ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        268,
                                        547,
                                        275,
                                        555
                                    ],
                                    "score": 0.84,
                                    "content": "L",
                                    "type": "inline_equation",
                                    "height": 8,
                                    "width": 7
                                },
                                {
                                    "bbox": [
                                        275,
                                        546,
                                        278,
                                        557
                                    ],
                                    "score": 1.0,
                                    "content": ".",
                                    "type": "text"
                                }
                            ],
                            "index": 26
                        }
                    ],
                    "index": 16
                },
                {
                    "type": "text",
                    "bbox": [
                        72,
                        576,
                        541,
                        601
                    ],
                    "lines": [
                        {
                            "bbox": [
                                72,
                                577,
                                541,
                                588
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        72,
                                        577,
                                        541,
                                        588
                                    ],
                                    "score": 1.0,
                                    "content": "Causal masking. One common use case of attention is in auto-regressive language modeling, where we",
                                    "type": "text"
                                }
                            ],
                            "index": 27
                        },
                        {
                            "bbox": [
                                70,
                                589,
                                501,
                                601
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        589,
                                        379,
                                        601
                                    ],
                                    "score": 1.0,
                                    "content": "need to apply a causal mask to the attention matrix S (i.e., any entry ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        379,
                                        591,
                                        392,
                                        601
                                    ],
                                    "score": 0.91,
                                    "content": "\\mathbf{S}_{i j}",
                                    "type": "inline_equation",
                                    "height": 10,
                                    "width": 13
                                },
                                {
                                    "bbox": [
                                        392,
                                        589,
                                        417,
                                        601
                                    ],
                                    "score": 1.0,
                                    "content": "with",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        417,
                                        591,
                                        438,
                                        600
                                    ],
                                    "score": 0.92,
                                    "content": "j>i",
                                    "type": "inline_equation",
                                    "height": 9,
                                    "width": 21
                                },
                                {
                                    "bbox": [
                                        438,
                                        589,
                                        478,
                                        601
                                    ],
                                    "score": 1.0,
                                    "content": "is set to ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        479,
                                        592,
                                        494,
                                        598
                                    ],
                                    "score": 0.85,
                                    "content": "-\\infty",
                                    "type": "inline_equation",
                                    "height": 6,
                                    "width": 15
                                },
                                {
                                    "bbox": [
                                        494,
                                        589,
                                        501,
                                        601
                                    ],
                                    "score": 1.0,
                                    "content": ").",
                                    "type": "text"
                                }
                            ],
                            "index": 28
                        }
                    ],
                    "index": 27.5
                },
                {
                    "type": "text",
                    "bbox": [
                        79,
                        608,
                        543,
                        701
                    ],
                    "lines": [
                        {
                            "bbox": [
                                83,
                                609,
                                540,
                                620
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        83,
                                        609,
                                        540,
                                        620
                                    ],
                                    "score": 1.0,
                                    "content": "1. As FlashAttention and FlashAttention-2 already operate by blocks, for any blocks where all",
                                    "type": "text"
                                }
                            ],
                            "index": 29
                        },
                        {
                            "bbox": [
                                95,
                                621,
                                541,
                                632
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        95,
                                        621,
                                        541,
                                        632
                                    ],
                                    "score": 1.0,
                                    "content": "the column indices are more than the row indices (approximately half of the blocks for large sequence",
                                    "type": "text"
                                }
                            ],
                            "index": 30
                        },
                        {
                            "bbox": [
                                95,
                                632,
                                542,
                                645
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        95,
                                        632,
                                        542,
                                        645
                                    ],
                                    "score": 1.0,
                                    "content": "length), we can skip the computation of that block. This leads to around 1.7-1.8× speedup compared",
                                    "type": "text"
                                }
                            ],
                            "index": 31
                        },
                        {
                            "bbox": [
                                96,
                                646,
                                262,
                                655
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        96,
                                        646,
                                        262,
                                        655
                                    ],
                                    "score": 1.0,
                                    "content": "to attention without the causal mask.",
                                    "type": "text"
                                }
                            ],
                            "index": 32
                        },
                        {
                            "bbox": [
                                83,
                                664,
                                541,
                                677
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        83,
                                        664,
                                        541,
                                        677
                                    ],
                                    "score": 1.0,
                                    "content": "2. We do not need to apply the causal mask for blocks whose row indices are guaranteed to be strictly less",
                                    "type": "text"
                                }
                            ],
                            "index": 33
                        },
                        {
                            "bbox": [
                                96,
                                677,
                                541,
                                688
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        96,
                                        677,
                                        541,
                                        688
                                    ],
                                    "score": 1.0,
                                    "content": "than the column indices. This means that for each row, we only need apply causal mask to 1 block",
                                    "type": "text"
                                }
                            ],
                            "index": 34
                        },
                        {
                            "bbox": [
                                95,
                                689,
                                205,
                                701
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        95,
                                        689,
                                        205,
                                        701
                                    ],
                                    "score": 1.0,
                                    "content": "(assuming square block).",
                                    "type": "text"
                                }
                            ],
                            "index": 35
                        }
                    ],
                    "index": 32
                }
            ],
            "layout_bboxes": [],
            "page_idx": 5,
            "page_size": [
                612.0,
                792.0
            ],
            "_layout_tree": [],
            "images": [],
            "tables": [],
            "interline_equations": [
                {
                    "type": "interline_equation",
                    "bbox": [
                        124,
                        92,
                        486,
                        234
                    ],
                    "lines": [
                        {
                            "bbox": [
                                124,
                                92,
                                486,
                                234
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        124,
                                        92,
                                        486,
                                        234
                                    ],
                                    "score": 0.93,
                                    "content": "\\begin{array}{r l}&{m^{(1)}=\\mathrm{rowmax}(\\mathbb{S}^{(1)})\\in\\mathbb{R}^{N_{r}}}\\\\ &{\\ell^{(1)}=\\mathrm{rowsum}(e^{\\mathbb{S}^{(1)}-m^{(1)}})\\in\\mathbb{R}^{B},}\\\\ &{\\mathbb{O}^{(1)}=e^{\\mathbb{S}^{(1)}-m^{(1)}\\mathbb{V}^{(1)}}\\nabla^{(1)}\\in\\mathbb{R}^{N_{r}\\times M}}\\\\ &{m^{(2)}=\\operatorname*{max}(m^{(1)},\\mathrm{rownax}(\\mathbb{S}^{(2)}))=m}\\\\ &{\\ell^{(2)}=e^{m^{(1)}-m^{(2)}}\\ell^{(1)}+\\mathrm{rowsum}(e^{\\mathbb{S}^{(2)}-m^{(2)}})=\\mathrm{rowsum}(e^{\\mathbb{S}^{(1)}-m})+\\mathrm{rowsum}(e^{\\mathbb{S}^{(2)}-m})=\\ell}\\\\ &{\\tilde{\\mathbb{P}}^{(2)}=\\mathrm{diag}(\\ell^{(2)})^{-1}e^{\\mathbb{S}^{(2)}-m^{(2)}}}\\\\ &{\\tilde{\\mathbb{O}}^{(2)}=\\mathrm{diag}(e^{m^{(1)}-m^{(2)}})^{-1}\\tilde{\\mathbb{O}}^{(1)}+e^{\\mathbb{S}^{(2)}-m^{(2)}}\\nabla^{(2)}=e^{\\mathbb{S}^{(1)}-m}\\nabla^{(1)}+e^{\\mathbb{S}^{(2)}-m}\\nabla^{(2)}}\\\\ &{\\mathbb{O}^{(2)}=\\mathrm{diag}(\\ell^{(2)})^{-1}\\tilde{\\mathbb{O}}^{(2)}={\\mathbb{O}}.}\\end{array}",
                                    "type": "interline_equation"
                                }
                            ]
                        }
                    ],
                    "index": 2,
                    "virtual_lines": [
                        {
                            "bbox": [
                                124,
                                92,
                                486,
                                139.33333333333334
                            ],
                            "spans": [],
                            "index": 1
                        },
                        {
                            "bbox": [
                                124,
                                139.33333333333334,
                                486,
                                186.66666666666669
                            ],
                            "spans": [],
                            "index": 2
                        },
                        {
                            "bbox": [
                                124,
                                186.66666666666669,
                                486,
                                234.00000000000003
                            ],
                            "spans": [],
                            "index": 3
                        }
                    ]
                }
            ],
            "discarded_blocks": [
                {
                    "type": "discarded",
                    "bbox": [
                        302,
                        742,
                        309,
                        751
                    ],
                    "lines": [
                        {
                            "bbox": [
                                301,
                                741,
                                310,
                                754
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        301,
                                        741,
                                        310,
                                        754
                                    ],
                                    "score": 1.0,
                                    "content": "6",
                                    "type": "text"
                                }
                            ]
                        }
                    ]
                }
            ],
            "need_drop": false,
            "drop_reason": [],
            "para_blocks": [
                {
                    "type": "text",
                    "bbox": [
                        82,
                        73,
                        451,
                        86
                    ],
                    "lines": [
                        {
                            "bbox": [
                                86,
                                74,
                                451,
                                84
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        86,
                                        74,
                                        451,
                                        84
                                    ],
                                    "score": 1.0,
                                    "content": "In the simple case of 2 blocks in Section 2.3, the online softmax trick now becomes:",
                                    "type": "text"
                                }
                            ],
                            "index": 0
                        }
                    ],
                    "index": 0,
                    "page_num": "page_5",
                    "page_size": [
                        612.0,
                        792.0
                    ],
                    "bbox_fs": [
                        86,
                        74,
                        451,
                        84
                    ]
                },
                {
                    "type": "interline_equation",
                    "bbox": [
                        124,
                        92,
                        486,
                        234
                    ],
                    "lines": [
                        {
                            "bbox": [
                                124,
                                92,
                                486,
                                234
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        124,
                                        92,
                                        486,
                                        234
                                    ],
                                    "score": 0.93,
                                    "content": "\\begin{array}{r l}&{m^{(1)}=\\mathrm{rowmax}(\\mathbb{S}^{(1)})\\in\\mathbb{R}^{N_{r}}}\\\\ &{\\ell^{(1)}=\\mathrm{rowsum}(e^{\\mathbb{S}^{(1)}-m^{(1)}})\\in\\mathbb{R}^{B},}\\\\ &{\\mathbb{O}^{(1)}=e^{\\mathbb{S}^{(1)}-m^{(1)}\\mathbb{V}^{(1)}}\\nabla^{(1)}\\in\\mathbb{R}^{N_{r}\\times M}}\\\\ &{m^{(2)}=\\operatorname*{max}(m^{(1)},\\mathrm{rownax}(\\mathbb{S}^{(2)}))=m}\\\\ &{\\ell^{(2)}=e^{m^{(1)}-m^{(2)}}\\ell^{(1)}+\\mathrm{rowsum}(e^{\\mathbb{S}^{(2)}-m^{(2)}})=\\mathrm{rowsum}(e^{\\mathbb{S}^{(1)}-m})+\\mathrm{rowsum}(e^{\\mathbb{S}^{(2)}-m})=\\ell}\\\\ &{\\tilde{\\mathbb{P}}^{(2)}=\\mathrm{diag}(\\ell^{(2)})^{-1}e^{\\mathbb{S}^{(2)}-m^{(2)}}}\\\\ &{\\tilde{\\mathbb{O}}^{(2)}=\\mathrm{diag}(e^{m^{(1)}-m^{(2)}})^{-1}\\tilde{\\mathbb{O}}^{(1)}+e^{\\mathbb{S}^{(2)}-m^{(2)}}\\nabla^{(2)}=e^{\\mathbb{S}^{(1)}-m}\\nabla^{(1)}+e^{\\mathbb{S}^{(2)}-m}\\nabla^{(2)}}\\\\ &{\\mathbb{O}^{(2)}=\\mathrm{diag}(\\ell^{(2)})^{-1}\\tilde{\\mathbb{O}}^{(2)}={\\mathbb{O}}.}\\end{array}",
                                    "type": "interline_equation"
                                }
                            ]
                        }
                    ],
                    "index": 2,
                    "virtual_lines": [
                        {
                            "bbox": [
                                124,
                                92,
                                486,
                                139.33333333333334
                            ],
                            "spans": [],
                            "index": 1
                        },
                        {
                            "bbox": [
                                124,
                                139.33333333333334,
                                486,
                                186.66666666666669
                            ],
                            "spans": [],
                            "index": 2
                        },
                        {
                            "bbox": [
                                124,
                                186.66666666666669,
                                486,
                                234.00000000000003
                            ],
                            "spans": [],
                            "index": 3
                        }
                    ],
                    "page_num": "page_5",
                    "page_size": [
                        612.0,
                        792.0
                    ]
                },
                {
                    "type": "text",
                    "bbox": [
                        87,
                        241,
                        396,
                        254
                    ],
                    "lines": [
                        {
                            "bbox": [
                                86,
                                242,
                                396,
                                253
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        86,
                                        242,
                                        396,
                                        253
                                    ],
                                    "score": 1.0,
                                    "content": "We describe the full FlashAttention-2 forward pass in Algorithm 1.",
                                    "type": "text"
                                }
                            ],
                            "index": 4
                        }
                    ],
                    "index": 4,
                    "page_num": "page_5",
                    "page_size": [
                        612.0,
                        792.0
                    ],
                    "bbox_fs": [
                        86,
                        242,
                        396,
                        253
                    ]
                },
                {
                    "type": "title",
                    "bbox": [
                        73,
                        266,
                        272,
                        278
                    ],
                    "lines": [
                        {
                            "bbox": [
                                72,
                                267,
                                273,
                                278
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        72,
                                        267,
                                        273,
                                        278
                                    ],
                                    "score": 1.0,
                                    "content": "Algorithm 1 FlashAttention-2 forward pass",
                                    "type": "text"
                                }
                            ],
                            "index": 5
                        }
                    ],
                    "index": 5,
                    "page_num": "page_5",
                    "page_size": [
                        612.0,
                        792.0
                    ]
                },
                {
                    "type": "index",
                    "bbox": [
                        72,
                        281,
                        541,
                        560
                    ],
                    "lines": [
                        {
                            "bbox": [
                                72,
                                281,
                                352,
                                296
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        72,
                                        281,
                                        159,
                                        296
                                    ],
                                    "score": 1.0,
                                    "content": "Require: Matrices ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        160,
                                        284,
                                        226,
                                        294
                                    ],
                                    "score": 0.87,
                                    "content": "{\\bf Q},{\\bf K},{\\bf V}\\in\\mathbb{R}^{N\\times d}",
                                    "type": "inline_equation",
                                    "height": 10,
                                    "width": 66
                                },
                                {
                                    "bbox": [
                                        227,
                                        281,
                                        319,
                                        296
                                    ],
                                    "score": 1.0,
                                    "content": "in HBM, block sizes",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        320,
                                        284,
                                        348,
                                        295
                                    ],
                                    "score": 0.28,
                                    "content": "B_{c},B_{r}",
                                    "type": "inline_equation",
                                    "height": 11,
                                    "width": 28
                                },
                                {
                                    "bbox": [
                                        349,
                                        281,
                                        352,
                                        296
                                    ],
                                    "score": 1.0,
                                    "content": ".",
                                    "type": "text"
                                }
                            ],
                            "index": 6,
                            "is_list_start_line": true
                        },
                        {
                            "bbox": [
                                74,
                                295,
                                540,
                                314
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        74,
                                        295,
                                        120,
                                        312
                                    ],
                                    "score": 1.0,
                                    "content": "1: Divide ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        121,
                                        300,
                                        129,
                                        309
                                    ],
                                    "score": 0.63,
                                    "content": "\\mathbf{Q}",
                                    "type": "inline_equation",
                                    "height": 9,
                                    "width": 8
                                },
                                {
                                    "bbox": [
                                        129,
                                        295,
                                        152,
                                        312
                                    ],
                                    "score": 1.0,
                                    "content": " into ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        152,
                                        295,
                                        194,
                                        314
                                    ],
                                    "score": 0.93,
                                    "content": "\\begin{array}{r}{T_{r}=\\bigg\\lceil\\frac{N}{B_{r}}\\bigg\\rceil}\\end{array}",
                                    "type": "inline_equation",
                                    "height": 19,
                                    "width": 42
                                },
                                {
                                    "bbox": [
                                        194,
                                        295,
                                        227,
                                        312
                                    ],
                                    "score": 1.0,
                                    "content": "blocks ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        227,
                                        299,
                                        277,
                                        310
                                    ],
                                    "score": 0.85,
                                    "content": "\\mathbf{Q}_{1},\\ldots,\\mathbf{Q}_{T_{r}}",
                                    "type": "inline_equation",
                                    "height": 11,
                                    "width": 50
                                },
                                {
                                    "bbox": [
                                        277,
                                        295,
                                        311,
                                        312
                                    ],
                                    "score": 1.0,
                                    "content": "of size ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        311,
                                        299,
                                        340,
                                        309
                                    ],
                                    "score": 0.88,
                                    "content": "B_{r}\\times d",
                                    "type": "inline_equation",
                                    "height": 10,
                                    "width": 29
                                },
                                {
                                    "bbox": [
                                        340,
                                        295,
                                        419,
                                        312
                                    ],
                                    "score": 1.0,
                                    "content": "each, and divide ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        419,
                                        298,
                                        440,
                                        309
                                    ],
                                    "score": 0.81,
                                    "content": "\\mathbf{K},\\mathbf{V}",
                                    "type": "inline_equation",
                                    "height": 11,
                                    "width": 21
                                },
                                {
                                    "bbox": [
                                        440,
                                        295,
                                        466,
                                        312
                                    ],
                                    "score": 1.0,
                                    "content": " in to",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        467,
                                        295,
                                        509,
                                        314
                                    ],
                                    "score": 0.93,
                                    "content": "\\begin{array}{r}{T_{c}=\\left\\lceil\\frac{N}{B_{c}}\\right\\rceil}\\end{array}",
                                    "type": "inline_equation",
                                    "height": 19,
                                    "width": 42
                                },
                                {
                                    "bbox": [
                                        511,
                                        297,
                                        540,
                                        309
                                    ],
                                    "score": 1.0,
                                    "content": "blocks",
                                    "type": "text"
                                }
                            ],
                            "index": 7,
                            "is_list_start_line": true
                        },
                        {
                            "bbox": [
                                88,
                                312,
                                302,
                                325
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        88,
                                        314,
                                        138,
                                        324
                                    ],
                                    "score": 0.91,
                                    "content": "\\mathbf{K}_{1},\\ldots,\\mathbf{K}_{T_{c}}",
                                    "type": "inline_equation",
                                    "height": 10,
                                    "width": 50
                                },
                                {
                                    "bbox": [
                                        138,
                                        312,
                                        161,
                                        325
                                    ],
                                    "score": 1.0,
                                    "content": "and ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        161,
                                        314,
                                        211,
                                        324
                                    ],
                                    "score": 0.83,
                                    "content": "\\mathbf{V}_{1},\\ldots,\\mathbf{V}_{T_{c}}",
                                    "type": "inline_equation",
                                    "height": 10,
                                    "width": 50
                                },
                                {
                                    "bbox": [
                                        212,
                                        312,
                                        247,
                                        325
                                    ],
                                    "score": 1.0,
                                    "content": ", of size ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        247,
                                        315,
                                        275,
                                        323
                                    ],
                                    "score": 0.9,
                                    "content": "B_{c}\\times d",
                                    "type": "inline_equation",
                                    "height": 8,
                                    "width": 28
                                },
                                {
                                    "bbox": [
                                        276,
                                        312,
                                        302,
                                        325
                                    ],
                                    "score": 1.0,
                                    "content": "each.",
                                    "type": "text"
                                }
                            ],
                            "index": 8,
                            "is_list_start_line": true
                        },
                        {
                            "bbox": [
                                74,
                                321,
                                540,
                                339
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        74,
                                        321,
                                        170,
                                        339
                                    ],
                                    "score": 1.0,
                                    "content": "2: Divide the output ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        170,
                                        325,
                                        213,
                                        334
                                    ],
                                    "score": 0.89,
                                    "content": "\\mathbf{O}\\in\\mathbb{R}^{N\\times d}",
                                    "type": "inline_equation",
                                    "height": 9,
                                    "width": 43
                                },
                                {
                                    "bbox": [
                                        213,
                                        321,
                                        236,
                                        339
                                    ],
                                    "score": 1.0,
                                    "content": "into ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        236,
                                        327,
                                        245,
                                        335
                                    ],
                                    "score": 0.9,
                                    "content": "T_{r}",
                                    "type": "inline_equation",
                                    "height": 8,
                                    "width": 9
                                },
                                {
                                    "bbox": [
                                        246,
                                        321,
                                        279,
                                        339
                                    ],
                                    "score": 1.0,
                                    "content": "blocks ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        279,
                                        325,
                                        327,
                                        336
                                    ],
                                    "score": 0.89,
                                    "content": "\\mathbf{0}_{i},\\ldots,\\mathbf{0}_{T_{r}}",
                                    "type": "inline_equation",
                                    "height": 11,
                                    "width": 48
                                },
                                {
                                    "bbox": [
                                        327,
                                        321,
                                        360,
                                        339
                                    ],
                                    "score": 1.0,
                                    "content": "of size",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        361,
                                        325,
                                        389,
                                        335
                                    ],
                                    "score": 0.9,
                                    "content": "B_{r}\\times d",
                                    "type": "inline_equation",
                                    "height": 10,
                                    "width": 28
                                },
                                {
                                    "bbox": [
                                        389,
                                        321,
                                        532,
                                        339
                                    ],
                                    "score": 1.0,
                                    "content": "each, and divide the logsumexp",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        532,
                                        327,
                                        540,
                                        334
                                    ],
                                    "score": 0.84,
                                    "content": "L",
                                    "type": "inline_equation",
                                    "height": 7,
                                    "width": 8
                                }
                            ],
                            "index": 9,
                            "is_list_start_line": true
                        },
                        {
                            "bbox": [
                                87,
                                336,
                                268,
                                349
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        87,
                                        336,
                                        108,
                                        349
                                    ],
                                    "score": 1.0,
                                    "content": "into ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        108,
                                        339,
                                        117,
                                        347
                                    ],
                                    "score": 0.9,
                                    "content": "T_{r}",
                                    "type": "inline_equation",
                                    "height": 8,
                                    "width": 9
                                },
                                {
                                    "bbox": [
                                        118,
                                        336,
                                        151,
                                        349
                                    ],
                                    "score": 1.0,
                                    "content": "blocks ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        151,
                                        339,
                                        197,
                                        348
                                    ],
                                    "score": 0.92,
                                    "content": "L_{i},\\ldots,L_{T_{r}}",
                                    "type": "inline_equation",
                                    "height": 9,
                                    "width": 46
                                },
                                {
                                    "bbox": [
                                        197,
                                        336,
                                        230,
                                        349
                                    ],
                                    "score": 1.0,
                                    "content": "of size ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        231,
                                        339,
                                        241,
                                        347
                                    ],
                                    "score": 0.89,
                                    "content": "B_{r}",
                                    "type": "inline_equation",
                                    "height": 8,
                                    "width": 10
                                },
                                {
                                    "bbox": [
                                        242,
                                        336,
                                        268,
                                        349
                                    ],
                                    "score": 1.0,
                                    "content": "each.",
                                    "type": "text"
                                }
                            ],
                            "index": 10,
                            "is_list_start_line": true
                        },
                        {
                            "bbox": [
                                75,
                                349,
                                165,
                                359
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        75,
                                        349,
                                        105,
                                        359
                                    ],
                                    "score": 1.0,
                                    "content": "3: for ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        105,
                                        351,
                                        147,
                                        359
                                    ],
                                    "score": 0.91,
                                    "content": "1\\leq i\\leq T_{r}",
                                    "type": "inline_equation",
                                    "height": 8,
                                    "width": 42
                                },
                                {
                                    "bbox": [
                                        147,
                                        349,
                                        165,
                                        359
                                    ],
                                    "score": 1.0,
                                    "content": "do",
                                    "type": "text"
                                }
                            ],
                            "index": 11,
                            "is_list_start_line": true
                        },
                        {
                            "bbox": [
                                74,
                                360,
                                268,
                                373
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        74,
                                        361,
                                        86,
                                        372
                                    ],
                                    "score": 1.0,
                                    "content": "4:",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        97,
                                        360,
                                        123,
                                        373
                                    ],
                                    "score": 1.0,
                                    "content": "Load ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        123,
                                        362,
                                        134,
                                        371
                                    ],
                                    "score": 0.9,
                                    "content": "\\mathbf{Q}_{i}",
                                    "type": "inline_equation",
                                    "height": 9,
                                    "width": 11
                                },
                                {
                                    "bbox": [
                                        134,
                                        360,
                                        268,
                                        373
                                    ],
                                    "score": 1.0,
                                    "content": "from HBM to on-chip SRAM.",
                                    "type": "text"
                                }
                            ],
                            "index": 12,
                            "is_list_start_line": true
                        },
                        {
                            "bbox": [
                                74,
                                367,
                                458,
                                389
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        74,
                                        374,
                                        86,
                                        385
                                    ],
                                    "score": 1.0,
                                    "content": "5:",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        95,
                                        367,
                                        178,
                                        389
                                    ],
                                    "score": 1.0,
                                    "content": "On chip, initialize",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        179,
                                        371,
                                        458,
                                        386
                                    ],
                                    "score": 0.83,
                                    "content": "\\mathbf{O}_{i}^{(0)}=(0)_{B_{r}\\times d}\\in\\mathbb{R}^{B_{r}\\times d},\\ell_{i}^{(0)}=(0)_{B_{r}}\\in\\mathbb{R}^{B_{r}},m_{i}^{(0)}=(-\\infty)_{B_{r}}\\in\\mathbb{R}^{B_{r}}.",
                                    "type": "inline_equation",
                                    "height": 15,
                                    "width": 279
                                }
                            ],
                            "index": 13,
                            "is_list_start_line": true
                        },
                        {
                            "bbox": [
                                74,
                                386,
                                177,
                                397
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        74,
                                        386,
                                        86,
                                        397
                                    ],
                                    "score": 1.0,
                                    "content": "6:",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        97,
                                        386,
                                        115,
                                        397
                                    ],
                                    "score": 1.0,
                                    "content": "for ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        115,
                                        387,
                                        159,
                                        397
                                    ],
                                    "score": 0.9,
                                    "content": "1\\leq j\\leq T_{c}",
                                    "type": "inline_equation",
                                    "height": 10,
                                    "width": 44
                                },
                                {
                                    "bbox": [
                                        160,
                                        386,
                                        177,
                                        397
                                    ],
                                    "score": 1.0,
                                    "content": "do",
                                    "type": "text"
                                }
                            ],
                            "index": 14,
                            "is_list_start_line": true
                        },
                        {
                            "bbox": [
                                75,
                                396,
                                296,
                                410
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        75,
                                        398,
                                        86,
                                        410
                                    ],
                                    "score": 1.0,
                                    "content": "7:",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        106,
                                        396,
                                        133,
                                        410
                                    ],
                                    "score": 1.0,
                                    "content": "Load ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        133,
                                        399,
                                        162,
                                        410
                                    ],
                                    "score": 0.92,
                                    "content": "\\mathbf{K}_{j},\\mathbf{V}_{j}",
                                    "type": "inline_equation",
                                    "height": 11,
                                    "width": 29
                                },
                                {
                                    "bbox": [
                                        162,
                                        396,
                                        296,
                                        410
                                    ],
                                    "score": 1.0,
                                    "content": "from HBM to on-chip SRAM.",
                                    "type": "text"
                                }
                            ],
                            "index": 15,
                            "is_list_start_line": true
                        },
                        {
                            "bbox": [
                                74,
                                409,
                                289,
                                425
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        74,
                                        412,
                                        86,
                                        424
                                    ],
                                    "score": 1.0,
                                    "content": "8:",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        105,
                                        409,
                                        189,
                                        425
                                    ],
                                    "score": 1.0,
                                    "content": "On chip, compute ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        189,
                                        410,
                                        284,
                                        425
                                    ],
                                    "score": 0.92,
                                    "content": "\\mathbf{S}_{i}^{(j)}=\\mathbf{Q}_{i}\\mathbf{K}_{j}^{T}\\in\\mathbb{R}^{B_{r}\\times B_{c}}",
                                    "type": "inline_equation",
                                    "height": 15,
                                    "width": 95
                                },
                                {
                                    "bbox": [
                                        284,
                                        409,
                                        289,
                                        425
                                    ],
                                    "score": 1.0,
                                    "content": ".",
                                    "type": "text"
                                }
                            ],
                            "index": 16,
                            "is_list_start_line": true
                        },
                        {
                            "bbox": [
                                74,
                                420,
                                539,
                                473
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        74,
                                        428,
                                        86,
                                        439
                                    ],
                                    "score": 1.0,
                                    "content": "9:",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        102,
                                        420,
                                        189,
                                        443
                                    ],
                                    "score": 1.0,
                                    "content": "On chip, compute",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        189,
                                        423,
                                        539,
                                        473
                                    ],
                                    "score": 0.44,
                                    "content": "\\begin{array}{r l}&{\\textrm{\\boldmath{m}}_{i}^{(j)}=\\displaystyle\\operatorname*{max}_{m({m}_{i}^{(j-1)},\\mathrm{rowmax}({\\bf S}_{i}^{(j)}))}\\in\\mathbb{R}^{B_{r}},\\tilde{{\\bf P}}_{i}^{(j)}=\\exp({\\bf S}_{i}^{(j)}-m_{i}^{(j)})\\in\\mathbb{R}^{B_{r}\\times B_{c}}}\\\\ &{e^{m_{i}^{j-1}-m_{i}^{(j)}}\\ell_{i}^{(j-1)}+\\mathrm{rowsum}(\\tilde{{\\bf P}}_{i}^{(j)})\\in\\mathbb{R}^{B_{r}}.}\\\\ &{{\\bf O}_{i}^{(j)}=\\mathrm{diag}(e^{m_{i}^{(j-1)}-m_{i}^{(j)}})^{-1}{\\bf O}_{i}^{(j-1)}+\\tilde{{\\bf P}}_{i}^{(j)}{\\bf V}_{j}.}\\end{array}",
                                    "type": "inline_equation"
                                }
                            ],
                            "index": 18,
                            "is_list_start_line": true
                        },
                        {
                            "bbox": [
                                104,
                                437,
                                161,
                                458
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        104,
                                        437,
                                        161,
                                        458
                                    ],
                                    "score": 1.0,
                                    "content": "(pointwise), ",
                                    "type": "text"
                                }
                            ],
                            "index": 17,
                            "is_list_start_line": true
                        },
                        {
                            "bbox": [
                                71,
                                454,
                                189,
                                471
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        71,
                                        459,
                                        86,
                                        471
                                    ],
                                    "score": 1.0,
                                    "content": "10:",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        104,
                                        454,
                                        189,
                                        471
                                    ],
                                    "score": 1.0,
                                    "content": "On chip, compute ",
                                    "type": "text"
                                }
                            ],
                            "index": 19,
                            "is_list_start_line": true
                        },
                        {
                            "bbox": [
                                71,
                                471,
                                136,
                                483
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        71,
                                        471,
                                        86,
                                        483
                                    ],
                                    "score": 1.0,
                                    "content": "11:",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        98,
                                        471,
                                        136,
                                        482
                                    ],
                                    "score": 1.0,
                                    "content": "end for",
                                    "type": "text"
                                }
                            ],
                            "index": 20,
                            "is_list_start_line": true
                        },
                        {
                            "bbox": [
                                71,
                                481,
                                280,
                                496
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        71,
                                        483,
                                        86,
                                        495
                                    ],
                                    "score": 1.0,
                                    "content": "12:",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        95,
                                        481,
                                        179,
                                        496
                                    ],
                                    "score": 1.0,
                                    "content": "On chip, compute ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        179,
                                        481,
                                        280,
                                        495
                                    ],
                                    "score": 0.92,
                                    "content": "\\mathbf{O}_{i}=\\mathrm{diag}(\\ell_{i}^{(T_{c})})^{-1}\\mathbf{O}_{i}^{(T_{c})}",
                                    "type": "inline_equation",
                                    "height": 14,
                                    "width": 101
                                }
                            ],
                            "index": 21,
                            "is_list_start_line": true
                        },
                        {
                            "bbox": [
                                71,
                                493,
                                274,
                                512
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        71,
                                        497,
                                        86,
                                        509
                                    ],
                                    "score": 1.0,
                                    "content": "13:",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        95,
                                        493,
                                        178,
                                        512
                                    ],
                                    "score": 1.0,
                                    "content": "On chip, compute",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        179,
                                        496,
                                        274,
                                        510
                                    ],
                                    "score": 0.92,
                                    "content": "L_{i}=m_{i}^{(T_{c})}+\\log(\\ell_{i}^{(T_{c})})",
                                    "type": "inline_equation",
                                    "height": 14,
                                    "width": 95
                                }
                            ],
                            "index": 22,
                            "is_list_start_line": true
                        },
                        {
                            "bbox": [
                                71,
                                509,
                                275,
                                521
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        71,
                                        509,
                                        86,
                                        521
                                    ],
                                    "score": 1.0,
                                    "content": "14:",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        98,
                                        509,
                                        126,
                                        520
                                    ],
                                    "score": 1.0,
                                    "content": "Write ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        126,
                                        511,
                                        136,
                                        520
                                    ],
                                    "score": 0.88,
                                    "content": "\\mathbf{0}_{i}",
                                    "type": "inline_equation",
                                    "height": 9,
                                    "width": 10
                                },
                                {
                                    "bbox": [
                                        137,
                                        509,
                                        208,
                                        520
                                    ],
                                    "score": 1.0,
                                    "content": "to HBM as the ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        208,
                                        511,
                                        212,
                                        518
                                    ],
                                    "score": 0.77,
                                    "content": "i",
                                    "type": "inline_equation",
                                    "height": 7,
                                    "width": 4
                                },
                                {
                                    "bbox": [
                                        212,
                                        509,
                                        264,
                                        520
                                    ],
                                    "score": 1.0,
                                    "content": "-th block of ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        265,
                                        511,
                                        273,
                                        518
                                    ],
                                    "score": 0.76,
                                    "content": "\\mathbf{0}",
                                    "type": "inline_equation",
                                    "height": 7,
                                    "width": 8
                                },
                                {
                                    "bbox": [
                                        273,
                                        509,
                                        275,
                                        520
                                    ],
                                    "score": 1.0,
                                    "content": ".",
                                    "type": "text"
                                }
                            ],
                            "index": 23,
                            "is_list_start_line": true
                        },
                        {
                            "bbox": [
                                71,
                                521,
                                274,
                                533
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        71,
                                        522,
                                        86,
                                        533
                                    ],
                                    "score": 1.0,
                                    "content": "15:",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        98,
                                        521,
                                        126,
                                        532
                                    ],
                                    "score": 1.0,
                                    "content": "Write ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        126,
                                        523,
                                        135,
                                        532
                                    ],
                                    "score": 0.9,
                                    "content": "L_{i}",
                                    "type": "inline_equation",
                                    "height": 9,
                                    "width": 9
                                },
                                {
                                    "bbox": [
                                        136,
                                        521,
                                        207,
                                        532
                                    ],
                                    "score": 1.0,
                                    "content": "to HBM as the ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        207,
                                        523,
                                        210,
                                        530
                                    ],
                                    "score": 0.8,
                                    "content": "i",
                                    "type": "inline_equation",
                                    "height": 7,
                                    "width": 3
                                },
                                {
                                    "bbox": [
                                        211,
                                        521,
                                        263,
                                        532
                                    ],
                                    "score": 1.0,
                                    "content": "-th block of",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        264,
                                        523,
                                        271,
                                        530
                                    ],
                                    "score": 0.88,
                                    "content": "L",
                                    "type": "inline_equation",
                                    "height": 7,
                                    "width": 7
                                },
                                {
                                    "bbox": [
                                        271,
                                        521,
                                        274,
                                        532
                                    ],
                                    "score": 1.0,
                                    "content": ".",
                                    "type": "text"
                                }
                            ],
                            "index": 24,
                            "is_list_start_line": true
                        },
                        {
                            "bbox": [
                                71,
                                533,
                                125,
                                543
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        71,
                                        533,
                                        125,
                                        543
                                    ],
                                    "score": 1.0,
                                    "content": "16: end for",
                                    "type": "text"
                                }
                            ],
                            "index": 25,
                            "is_list_start_line": true
                        },
                        {
                            "bbox": [
                                72,
                                546,
                                278,
                                557
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        72,
                                        546,
                                        172,
                                        557
                                    ],
                                    "score": 1.0,
                                    "content": "17: Return the output ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        172,
                                        547,
                                        180,
                                        555
                                    ],
                                    "score": 0.32,
                                    "content": "\\mathbf{0}",
                                    "type": "inline_equation",
                                    "height": 8,
                                    "width": 8
                                },
                                {
                                    "bbox": [
                                        180,
                                        546,
                                        268,
                                        557
                                    ],
                                    "score": 1.0,
                                    "content": " and the logsumexp ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        268,
                                        547,
                                        275,
                                        555
                                    ],
                                    "score": 0.84,
                                    "content": "L",
                                    "type": "inline_equation",
                                    "height": 8,
                                    "width": 7
                                },
                                {
                                    "bbox": [
                                        275,
                                        546,
                                        278,
                                        557
                                    ],
                                    "score": 1.0,
                                    "content": ".",
                                    "type": "text"
                                }
                            ],
                            "index": 26,
                            "is_list_start_line": true
                        }
                    ],
                    "index": 16,
                    "page_num": "page_5",
                    "page_size": [
                        612.0,
                        792.0
                    ],
                    "bbox_fs": [
                        71,
                        281,
                        540,
                        557
                    ]
                },
                {
                    "type": "text",
                    "bbox": [
                        72,
                        576,
                        541,
                        601
                    ],
                    "lines": [
                        {
                            "bbox": [
                                72,
                                577,
                                541,
                                588
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        72,
                                        577,
                                        541,
                                        588
                                    ],
                                    "score": 1.0,
                                    "content": "Causal masking. One common use case of attention is in auto-regressive language modeling, where we",
                                    "type": "text"
                                }
                            ],
                            "index": 27
                        },
                        {
                            "bbox": [
                                70,
                                589,
                                501,
                                601
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        589,
                                        379,
                                        601
                                    ],
                                    "score": 1.0,
                                    "content": "need to apply a causal mask to the attention matrix S (i.e., any entry ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        379,
                                        591,
                                        392,
                                        601
                                    ],
                                    "score": 0.91,
                                    "content": "\\mathbf{S}_{i j}",
                                    "type": "inline_equation",
                                    "height": 10,
                                    "width": 13
                                },
                                {
                                    "bbox": [
                                        392,
                                        589,
                                        417,
                                        601
                                    ],
                                    "score": 1.0,
                                    "content": "with",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        417,
                                        591,
                                        438,
                                        600
                                    ],
                                    "score": 0.92,
                                    "content": "j>i",
                                    "type": "inline_equation",
                                    "height": 9,
                                    "width": 21
                                },
                                {
                                    "bbox": [
                                        438,
                                        589,
                                        478,
                                        601
                                    ],
                                    "score": 1.0,
                                    "content": "is set to ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        479,
                                        592,
                                        494,
                                        598
                                    ],
                                    "score": 0.85,
                                    "content": "-\\infty",
                                    "type": "inline_equation",
                                    "height": 6,
                                    "width": 15
                                },
                                {
                                    "bbox": [
                                        494,
                                        589,
                                        501,
                                        601
                                    ],
                                    "score": 1.0,
                                    "content": ").",
                                    "type": "text"
                                }
                            ],
                            "index": 28
                        }
                    ],
                    "index": 27.5,
                    "page_num": "page_5",
                    "page_size": [
                        612.0,
                        792.0
                    ],
                    "bbox_fs": [
                        70,
                        577,
                        541,
                        601
                    ]
                },
                {
                    "type": "list",
                    "bbox": [
                        79,
                        608,
                        543,
                        701
                    ],
                    "lines": [
                        {
                            "bbox": [
                                83,
                                609,
                                540,
                                620
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        83,
                                        609,
                                        540,
                                        620
                                    ],
                                    "score": 1.0,
                                    "content": "1. As FlashAttention and FlashAttention-2 already operate by blocks, for any blocks where all",
                                    "type": "text"
                                }
                            ],
                            "index": 29,
                            "is_list_start_line": true
                        },
                        {
                            "bbox": [
                                95,
                                621,
                                541,
                                632
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        95,
                                        621,
                                        541,
                                        632
                                    ],
                                    "score": 1.0,
                                    "content": "the column indices are more than the row indices (approximately half of the blocks for large sequence",
                                    "type": "text"
                                }
                            ],
                            "index": 30
                        },
                        {
                            "bbox": [
                                95,
                                632,
                                542,
                                645
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        95,
                                        632,
                                        542,
                                        645
                                    ],
                                    "score": 1.0,
                                    "content": "length), we can skip the computation of that block. This leads to around 1.7-1.8× speedup compared",
                                    "type": "text"
                                }
                            ],
                            "index": 31
                        },
                        {
                            "bbox": [
                                96,
                                646,
                                262,
                                655
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        96,
                                        646,
                                        262,
                                        655
                                    ],
                                    "score": 1.0,
                                    "content": "to attention without the causal mask.",
                                    "type": "text"
                                }
                            ],
                            "index": 32,
                            "is_list_end_line": true
                        },
                        {
                            "bbox": [
                                83,
                                664,
                                541,
                                677
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        83,
                                        664,
                                        541,
                                        677
                                    ],
                                    "score": 1.0,
                                    "content": "2. We do not need to apply the causal mask for blocks whose row indices are guaranteed to be strictly less",
                                    "type": "text"
                                }
                            ],
                            "index": 33,
                            "is_list_start_line": true
                        },
                        {
                            "bbox": [
                                96,
                                677,
                                541,
                                688
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        96,
                                        677,
                                        541,
                                        688
                                    ],
                                    "score": 1.0,
                                    "content": "than the column indices. This means that for each row, we only need apply causal mask to 1 block",
                                    "type": "text"
                                }
                            ],
                            "index": 34
                        },
                        {
                            "bbox": [
                                95,
                                689,
                                205,
                                701
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        95,
                                        689,
                                        205,
                                        701
                                    ],
                                    "score": 1.0,
                                    "content": "(assuming square block).",
                                    "type": "text"
                                }
                            ],
                            "index": 35,
                            "is_list_end_line": true
                        }
                    ],
                    "index": 32,
                    "page_num": "page_5",
                    "page_size": [
                        612.0,
                        792.0
                    ],
                    "bbox_fs": [
                        83,
                        609,
                        542,
                        701
                    ]
                }
            ]
        },
        {
            "preproc_blocks": [
                {
                    "type": "text",
                    "bbox": [
                        71,
                        73,
                        541,
                        121
                    ],
                    "lines": [
                        {
                            "bbox": [
                                72,
                                75,
                                540,
                                85
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        72,
                                        75,
                                        540,
                                        85
                                    ],
                                    "score": 1.0,
                                    "content": "Correctness, runtime, and memory requirement. As with FlashAttention, Algorithm 1 returns",
                                    "type": "text"
                                }
                            ],
                            "index": 0
                        },
                        {
                            "bbox": [
                                70,
                                85,
                                539,
                                98
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        85,
                                        154,
                                        98
                                    ],
                                    "score": 1.0,
                                    "content": "the correct output ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        154,
                                        86,
                                        245,
                                        97
                                    ],
                                    "score": 0.4,
                                    "content": "{\\bf0}=\\mathrm{softmax}({\\bf Q}{\\bf K}^{\\top}){\\bf V}",
                                    "type": "inline_equation",
                                    "height": 11,
                                    "width": 91
                                },
                                {
                                    "bbox": [
                                        245,
                                        85,
                                        387,
                                        98
                                    ],
                                    "score": 1.0,
                                    "content": " (with no approximation), using ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        387,
                                        87,
                                        421,
                                        97
                                    ],
                                    "score": 0.93,
                                    "content": "O(N^{2}d)",
                                    "type": "inline_equation",
                                    "height": 10,
                                    "width": 34
                                },
                                {
                                    "bbox": [
                                        421,
                                        85,
                                        515,
                                        98
                                    ],
                                    "score": 1.0,
                                    "content": " FLOPs and requires ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        516,
                                        87,
                                        539,
                                        97
                                    ],
                                    "score": 0.93,
                                    "content": "O(N)",
                                    "type": "inline_equation",
                                    "height": 10,
                                    "width": 23
                                }
                            ],
                            "index": 1
                        },
                        {
                            "bbox": [
                                70,
                                97,
                                541,
                                109
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        97,
                                        381,
                                        109
                                    ],
                                    "score": 1.0,
                                    "content": "additional memory beyond inputs and output (to store the logsumexp ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        381,
                                        100,
                                        388,
                                        107
                                    ],
                                    "score": 0.85,
                                    "content": "L",
                                    "type": "inline_equation",
                                    "height": 7,
                                    "width": 7
                                },
                                {
                                    "bbox": [
                                        389,
                                        97,
                                        541,
                                        109
                                    ],
                                    "score": 1.0,
                                    "content": "). The proof is almost the same as",
                                    "type": "text"
                                }
                            ],
                            "index": 2
                        },
                        {
                            "bbox": [
                                71,
                                110,
                                325,
                                122
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        71,
                                        110,
                                        325,
                                        122
                                    ],
                                    "score": 1.0,
                                    "content": "the proof of Dao et al. [5, Theorem 1], so we omit it here.",
                                    "type": "text"
                                }
                            ],
                            "index": 3
                        }
                    ],
                    "index": 1.5
                },
                {
                    "type": "title",
                    "bbox": [
                        71,
                        135,
                        181,
                        147
                    ],
                    "lines": [
                        {
                            "bbox": [
                                71,
                                136,
                                181,
                                147
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        71,
                                        136,
                                        97,
                                        146
                                    ],
                                    "score": 1.0,
                                    "content": "3.1.2",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        105,
                                        136,
                                        181,
                                        147
                                    ],
                                    "score": 1.0,
                                    "content": "Backward pass",
                                    "type": "text"
                                }
                            ],
                            "index": 4
                        }
                    ],
                    "index": 4
                },
                {
                    "type": "text",
                    "bbox": [
                        71,
                        153,
                        542,
                        189
                    ],
                    "lines": [
                        {
                            "bbox": [
                                71,
                                154,
                                540,
                                165
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        71,
                                        154,
                                        540,
                                        165
                                    ],
                                    "score": 1.0,
                                    "content": "The backward pass of FlashAttention-2 is almost the same as that of FlashAttention. We make a",
                                    "type": "text"
                                }
                            ],
                            "index": 5
                        },
                        {
                            "bbox": [
                                70,
                                167,
                                541,
                                177
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        167,
                                        288,
                                        177
                                    ],
                                    "score": 1.0,
                                    "content": "minor tweak to only use the row-wise logsumexp",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        289,
                                        168,
                                        295,
                                        175
                                    ],
                                    "score": 0.88,
                                    "content": "L",
                                    "type": "inline_equation",
                                    "height": 7,
                                    "width": 6
                                },
                                {
                                    "bbox": [
                                        296,
                                        167,
                                        541,
                                        177
                                    ],
                                    "score": 1.0,
                                    "content": "instead of both the row-wise max and row-wise sum of",
                                    "type": "text"
                                }
                            ],
                            "index": 6
                        },
                        {
                            "bbox": [
                                70,
                                178,
                                529,
                                190
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        178,
                                        529,
                                        190
                                    ],
                                    "score": 1.0,
                                    "content": "exponentials in the softmax. We include the backward pass description in Algorithm 2 for completeness.",
                                    "type": "text"
                                }
                            ],
                            "index": 7
                        }
                    ],
                    "index": 6
                },
                {
                    "type": "title",
                    "bbox": [
                        74,
                        201,
                        282,
                        213
                    ],
                    "lines": [
                        {
                            "bbox": [
                                73,
                                202,
                                283,
                                212
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        73,
                                        202,
                                        283,
                                        212
                                    ],
                                    "score": 1.0,
                                    "content": "Algorithm 2 FlashAttention-2 Backward Pass",
                                    "type": "text"
                                }
                            ],
                            "index": 8
                        }
                    ],
                    "index": 8
                },
                {
                    "type": "text",
                    "bbox": [
                        72,
                        216,
                        542,
                        554
                    ],
                    "lines": [
                        {
                            "bbox": [
                                70,
                                215,
                                486,
                                230
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        215,
                                        159,
                                        230
                                    ],
                                    "score": 1.0,
                                    "content": "Require: Matrices ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        160,
                                        219,
                                        255,
                                        229
                                    ],
                                    "score": 0.84,
                                    "content": "\\mathbf{Q},\\mathbf{K},\\mathbf{V},\\mathbf{O},\\mathbf{dO}\\in\\mathbb{R}^{N\\times d}",
                                    "type": "inline_equation",
                                    "height": 10,
                                    "width": 95
                                },
                                {
                                    "bbox": [
                                        256,
                                        215,
                                        329,
                                        230
                                    ],
                                    "score": 1.0,
                                    "content": "in HBM, vector",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        330,
                                        219,
                                        362,
                                        227
                                    ],
                                    "score": 0.92,
                                    "content": "L\\in\\mathbb{R}^{N}",
                                    "type": "inline_equation",
                                    "height": 8,
                                    "width": 32
                                },
                                {
                                    "bbox": [
                                        362,
                                        215,
                                        455,
                                        230
                                    ],
                                    "score": 1.0,
                                    "content": "in HBM, block sizes ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        455,
                                        221,
                                        467,
                                        229
                                    ],
                                    "score": 0.86,
                                    "content": "B_{c}",
                                    "type": "inline_equation",
                                    "height": 8,
                                    "width": 12
                                },
                                {
                                    "bbox": [
                                        467,
                                        215,
                                        472,
                                        230
                                    ],
                                    "score": 1.0,
                                    "content": ", ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        473,
                                        221,
                                        484,
                                        229
                                    ],
                                    "score": 0.83,
                                    "content": "B_{r}",
                                    "type": "inline_equation",
                                    "height": 8,
                                    "width": 11
                                },
                                {
                                    "bbox": [
                                        484,
                                        215,
                                        486,
                                        230
                                    ],
                                    "score": 1.0,
                                    "content": ".",
                                    "type": "text"
                                }
                            ],
                            "index": 9
                        },
                        {
                            "bbox": [
                                77,
                                230,
                                540,
                                248
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        77,
                                        232,
                                        120,
                                        245
                                    ],
                                    "score": 1.0,
                                    "content": "1: Divide ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        121,
                                        235,
                                        129,
                                        244
                                    ],
                                    "score": 0.82,
                                    "content": "\\mathbf{Q}",
                                    "type": "inline_equation",
                                    "height": 9,
                                    "width": 8
                                },
                                {
                                    "bbox": [
                                        129,
                                        232,
                                        152,
                                        245
                                    ],
                                    "score": 1.0,
                                    "content": " into ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        152,
                                        230,
                                        194,
                                        248
                                    ],
                                    "score": 0.93,
                                    "content": "\\begin{array}{r}{T_{r}=\\bigg\\lceil\\frac{N}{B_{r}}\\bigg\\rceil}\\end{array}",
                                    "type": "inline_equation",
                                    "height": 18,
                                    "width": 42
                                },
                                {
                                    "bbox": [
                                        194,
                                        232,
                                        227,
                                        245
                                    ],
                                    "score": 1.0,
                                    "content": "blocks ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        227,
                                        235,
                                        277,
                                        245
                                    ],
                                    "score": 0.91,
                                    "content": "\\mathbf{Q}_{1},\\ldots,\\mathbf{Q}_{T_{r}}",
                                    "type": "inline_equation",
                                    "height": 10,
                                    "width": 50
                                },
                                {
                                    "bbox": [
                                        277,
                                        232,
                                        311,
                                        245
                                    ],
                                    "score": 1.0,
                                    "content": "of size ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        312,
                                        235,
                                        340,
                                        244
                                    ],
                                    "score": 0.92,
                                    "content": "B_{r}\\times d",
                                    "type": "inline_equation",
                                    "height": 9,
                                    "width": 28
                                },
                                {
                                    "bbox": [
                                        340,
                                        232,
                                        419,
                                        245
                                    ],
                                    "score": 1.0,
                                    "content": "each, and divide ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        419,
                                        235,
                                        440,
                                        244
                                    ],
                                    "score": 0.91,
                                    "content": "\\mathbf{K},\\mathbf{V}",
                                    "type": "inline_equation",
                                    "height": 9,
                                    "width": 21
                                },
                                {
                                    "bbox": [
                                        440,
                                        232,
                                        467,
                                        245
                                    ],
                                    "score": 1.0,
                                    "content": " in to ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        467,
                                        230,
                                        509,
                                        248
                                    ],
                                    "score": 0.94,
                                    "content": "\\begin{array}{r}{T_{c}=\\bigg\\lceil\\frac{N}{B_{c}}\\bigg\\rceil}\\end{array}",
                                    "type": "inline_equation",
                                    "height": 18,
                                    "width": 42
                                },
                                {
                                    "bbox": [
                                        510,
                                        232,
                                        540,
                                        244
                                    ],
                                    "score": 1.0,
                                    "content": "blocks",
                                    "type": "text"
                                }
                            ],
                            "index": 10
                        },
                        {
                            "bbox": [
                                88,
                                246,
                                303,
                                259
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        88,
                                        249,
                                        138,
                                        259
                                    ],
                                    "score": 0.92,
                                    "content": "\\mathbf{K}_{1},\\ldots,\\mathbf{K}_{T_{c}}",
                                    "type": "inline_equation",
                                    "height": 10,
                                    "width": 50
                                },
                                {
                                    "bbox": [
                                        138,
                                        246,
                                        160,
                                        259
                                    ],
                                    "score": 1.0,
                                    "content": "and",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        161,
                                        249,
                                        211,
                                        259
                                    ],
                                    "score": 0.89,
                                    "content": "\\mathbf{V}_{1},\\ldots,\\mathbf{V}_{T_{c}}",
                                    "type": "inline_equation",
                                    "height": 10,
                                    "width": 50
                                },
                                {
                                    "bbox": [
                                        212,
                                        246,
                                        247,
                                        259
                                    ],
                                    "score": 1.0,
                                    "content": ", of size ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        247,
                                        249,
                                        275,
                                        258
                                    ],
                                    "score": 0.92,
                                    "content": "B_{c}\\times d",
                                    "type": "inline_equation",
                                    "height": 9,
                                    "width": 28
                                },
                                {
                                    "bbox": [
                                        276,
                                        246,
                                        303,
                                        259
                                    ],
                                    "score": 1.0,
                                    "content": "each.",
                                    "type": "text"
                                }
                            ],
                            "index": 11
                        },
                        {
                            "bbox": [
                                75,
                                259,
                                541,
                                272
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        75,
                                        259,
                                        120,
                                        272
                                    ],
                                    "score": 1.0,
                                    "content": "2: Divide ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        121,
                                        261,
                                        129,
                                        269
                                    ],
                                    "score": 0.77,
                                    "content": "\\mathbf{0}",
                                    "type": "inline_equation",
                                    "height": 8,
                                    "width": 8
                                },
                                {
                                    "bbox": [
                                        129,
                                        259,
                                        152,
                                        272
                                    ],
                                    "score": 1.0,
                                    "content": " into ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        153,
                                        262,
                                        162,
                                        270
                                    ],
                                    "score": 0.9,
                                    "content": "T_{r}",
                                    "type": "inline_equation",
                                    "height": 8,
                                    "width": 9
                                },
                                {
                                    "bbox": [
                                        162,
                                        259,
                                        196,
                                        272
                                    ],
                                    "score": 1.0,
                                    "content": "blocks ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        197,
                                        261,
                                        244,
                                        271
                                    ],
                                    "score": 0.9,
                                    "content": "\\mathbf{O}_{i},\\ldots,\\mathbf{O}_{T_{r}}",
                                    "type": "inline_equation",
                                    "height": 10,
                                    "width": 47
                                },
                                {
                                    "bbox": [
                                        245,
                                        259,
                                        279,
                                        272
                                    ],
                                    "score": 1.0,
                                    "content": "of size ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        280,
                                        261,
                                        308,
                                        270
                                    ],
                                    "score": 0.92,
                                    "content": "B_{r}\\times d",
                                    "type": "inline_equation",
                                    "height": 9,
                                    "width": 28
                                },
                                {
                                    "bbox": [
                                        308,
                                        259,
                                        405,
                                        272
                                    ],
                                    "score": 1.0,
                                    "content": "each, divide dO into ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        405,
                                        262,
                                        414,
                                        270
                                    ],
                                    "score": 0.89,
                                    "content": "T_{r}",
                                    "type": "inline_equation",
                                    "height": 8,
                                    "width": 9
                                },
                                {
                                    "bbox": [
                                        414,
                                        259,
                                        448,
                                        272
                                    ],
                                    "score": 1.0,
                                    "content": "blocks ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        449,
                                        260,
                                        507,
                                        271
                                    ],
                                    "score": 0.84,
                                    "content": "\\mathbf{d}\\mathbf{O}_{i},\\dots,\\mathbf{d}\\mathbf{O}_{T_{r}}",
                                    "type": "inline_equation",
                                    "height": 11,
                                    "width": 58
                                },
                                {
                                    "bbox": [
                                        508,
                                        259,
                                        541,
                                        272
                                    ],
                                    "score": 1.0,
                                    "content": "of size",
                                    "type": "text"
                                }
                            ],
                            "index": 12
                        },
                        {
                            "bbox": [
                                88,
                                270,
                                382,
                                284
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        88,
                                        273,
                                        116,
                                        282
                                    ],
                                    "score": 0.92,
                                    "content": "B_{r}\\times d",
                                    "type": "inline_equation",
                                    "height": 9,
                                    "width": 28
                                },
                                {
                                    "bbox": [
                                        116,
                                        270,
                                        192,
                                        284
                                    ],
                                    "score": 1.0,
                                    "content": "each, and divide",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        193,
                                        273,
                                        200,
                                        280
                                    ],
                                    "score": 0.89,
                                    "content": "L",
                                    "type": "inline_equation",
                                    "height": 7,
                                    "width": 7
                                },
                                {
                                    "bbox": [
                                        200,
                                        270,
                                        223,
                                        284
                                    ],
                                    "score": 1.0,
                                    "content": "into ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        223,
                                        273,
                                        232,
                                        282
                                    ],
                                    "score": 0.9,
                                    "content": "T_{r}",
                                    "type": "inline_equation",
                                    "height": 9,
                                    "width": 9
                                },
                                {
                                    "bbox": [
                                        232,
                                        270,
                                        265,
                                        284
                                    ],
                                    "score": 1.0,
                                    "content": "blocks",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        266,
                                        273,
                                        311,
                                        283
                                    ],
                                    "score": 0.92,
                                    "content": "L_{i},\\ldots,L_{T_{r}}",
                                    "type": "inline_equation",
                                    "height": 10,
                                    "width": 45
                                },
                                {
                                    "bbox": [
                                        312,
                                        270,
                                        345,
                                        284
                                    ],
                                    "score": 1.0,
                                    "content": "of size ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        345,
                                        273,
                                        356,
                                        282
                                    ],
                                    "score": 0.9,
                                    "content": "B_{r}",
                                    "type": "inline_equation",
                                    "height": 9,
                                    "width": 11
                                },
                                {
                                    "bbox": [
                                        357,
                                        270,
                                        382,
                                        284
                                    ],
                                    "score": 1.0,
                                    "content": "each.",
                                    "type": "text"
                                }
                            ],
                            "index": 13
                        },
                        {
                            "bbox": [
                                75,
                                282,
                                541,
                                296
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        75,
                                        282,
                                        130,
                                        296
                                    ],
                                    "score": 1.0,
                                    "content": "3: Initialize ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        130,
                                        285,
                                        186,
                                        294
                                    ],
                                    "score": 0.92,
                                    "content": "{\\bf d Q}=(0)_{N\\times d}",
                                    "type": "inline_equation",
                                    "height": 9,
                                    "width": 56
                                },
                                {
                                    "bbox": [
                                        186,
                                        282,
                                        311,
                                        296
                                    ],
                                    "score": 1.0,
                                    "content": "in HBM and divide it into ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        312,
                                        285,
                                        320,
                                        294
                                    ],
                                    "score": 0.9,
                                    "content": "T_{r}",
                                    "type": "inline_equation",
                                    "height": 9,
                                    "width": 8
                                },
                                {
                                    "bbox": [
                                        321,
                                        282,
                                        355,
                                        296
                                    ],
                                    "score": 1.0,
                                    "content": "blocks ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        355,
                                        284,
                                        416,
                                        295
                                    ],
                                    "score": 0.87,
                                    "content": "\\mathbf{dQ}_{1},\\hdots,\\mathbf{dQ}_{T_{r}}",
                                    "type": "inline_equation",
                                    "height": 11,
                                    "width": 61
                                },
                                {
                                    "bbox": [
                                        416,
                                        282,
                                        450,
                                        296
                                    ],
                                    "score": 1.0,
                                    "content": "of size",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        451,
                                        285,
                                        479,
                                        294
                                    ],
                                    "score": 0.91,
                                    "content": "B_{r}\\times d",
                                    "type": "inline_equation",
                                    "height": 9,
                                    "width": 28
                                },
                                {
                                    "bbox": [
                                        479,
                                        282,
                                        541,
                                        296
                                    ],
                                    "score": 1.0,
                                    "content": "each. Divide",
                                    "type": "text"
                                }
                            ],
                            "index": 14
                        },
                        {
                            "bbox": [
                                86,
                                291,
                                461,
                                310
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        86,
                                        291,
                                        105,
                                        310
                                    ],
                                    "score": 1.0,
                                    "content": "dK,",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        105,
                                        295,
                                        154,
                                        304
                                    ],
                                    "score": 0.87,
                                    "content": "\\mathbf{dV}\\in\\mathbb{R}^{N\\times d}",
                                    "type": "inline_equation",
                                    "height": 9,
                                    "width": 49
                                },
                                {
                                    "bbox": [
                                        155,
                                        291,
                                        181,
                                        310
                                    ],
                                    "score": 1.0,
                                    "content": "in to ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        181,
                                        297,
                                        191,
                                        306
                                    ],
                                    "score": 0.87,
                                    "content": "T_{c}",
                                    "type": "inline_equation",
                                    "height": 9,
                                    "width": 10
                                },
                                {
                                    "bbox": [
                                        191,
                                        291,
                                        224,
                                        310
                                    ],
                                    "score": 1.0,
                                    "content": "blocks ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        225,
                                        297,
                                        285,
                                        307
                                    ],
                                    "score": 0.9,
                                    "content": "\\mathbf{dK}_{1},\\ldots,\\mathbf{dK}_{T_{c}}",
                                    "type": "inline_equation",
                                    "height": 10,
                                    "width": 60
                                },
                                {
                                    "bbox": [
                                        286,
                                        291,
                                        308,
                                        310
                                    ],
                                    "score": 1.0,
                                    "content": "and ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        308,
                                        297,
                                        370,
                                        307
                                    ],
                                    "score": 0.91,
                                    "content": "\\mathbf{dV}_{1},\\dots,\\mathbf{dV}_{T_{c}}",
                                    "type": "inline_equation",
                                    "height": 10,
                                    "width": 62
                                },
                                {
                                    "bbox": [
                                        370,
                                        291,
                                        405,
                                        310
                                    ],
                                    "score": 1.0,
                                    "content": ", of size",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        406,
                                        297,
                                        434,
                                        306
                                    ],
                                    "score": 0.91,
                                    "content": "B_{c}\\times d",
                                    "type": "inline_equation",
                                    "height": 9,
                                    "width": 28
                                },
                                {
                                    "bbox": [
                                        434,
                                        291,
                                        461,
                                        310
                                    ],
                                    "score": 1.0,
                                    "content": "each.",
                                    "type": "text"
                                }
                            ],
                            "index": 15
                        },
                        {
                            "bbox": [
                                76,
                                307,
                                541,
                                319
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        76,
                                        307,
                                        131,
                                        319
                                    ],
                                    "score": 1.0,
                                    "content": "4: Compute ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        131,
                                        307,
                                        246,
                                        318
                                    ],
                                    "score": 0.85,
                                    "content": "D=\\operatorname{rowsum}(\\mathbf{dO}\\circ\\mathbf{O})\\in\\mathbb{R}^{d}",
                                    "type": "inline_equation",
                                    "height": 11,
                                    "width": 115
                                },
                                {
                                    "bbox": [
                                        246,
                                        307,
                                        369,
                                        319
                                    ],
                                    "score": 1.0,
                                    "content": "(pointwise multiply), write ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        369,
                                        309,
                                        378,
                                        316
                                    ],
                                    "score": 0.89,
                                    "content": "D",
                                    "type": "inline_equation",
                                    "height": 7,
                                    "width": 9
                                },
                                {
                                    "bbox": [
                                        378,
                                        307,
                                        499,
                                        319
                                    ],
                                    "score": 1.0,
                                    "content": "to HBM and divide it into ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        500,
                                        309,
                                        509,
                                        318
                                    ],
                                    "score": 0.9,
                                    "content": "T_{r}",
                                    "type": "inline_equation",
                                    "height": 9,
                                    "width": 9
                                },
                                {
                                    "bbox": [
                                        509,
                                        307,
                                        541,
                                        319
                                    ],
                                    "score": 1.0,
                                    "content": "blocks",
                                    "type": "text"
                                }
                            ],
                            "index": 16
                        },
                        {
                            "bbox": [
                                88,
                                319,
                                210,
                                331
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        88,
                                        321,
                                        138,
                                        331
                                    ],
                                    "score": 0.9,
                                    "content": "D_{1},\\ldots,D_{T_{r}}",
                                    "type": "inline_equation",
                                    "height": 10,
                                    "width": 50
                                },
                                {
                                    "bbox": [
                                        139,
                                        319,
                                        172,
                                        331
                                    ],
                                    "score": 1.0,
                                    "content": "of size ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        172,
                                        321,
                                        183,
                                        330
                                    ],
                                    "score": 0.89,
                                    "content": "B_{r}",
                                    "type": "inline_equation",
                                    "height": 9,
                                    "width": 11
                                },
                                {
                                    "bbox": [
                                        184,
                                        319,
                                        210,
                                        331
                                    ],
                                    "score": 1.0,
                                    "content": "each.",
                                    "type": "text"
                                }
                            ],
                            "index": 17
                        },
                        {
                            "bbox": [
                                75,
                                331,
                                167,
                                343
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        75,
                                        331,
                                        105,
                                        343
                                    ],
                                    "score": 1.0,
                                    "content": "5: for ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        105,
                                        333,
                                        149,
                                        342
                                    ],
                                    "score": 0.9,
                                    "content": "1\\leq j\\leq T_{c}",
                                    "type": "inline_equation",
                                    "height": 9,
                                    "width": 44
                                },
                                {
                                    "bbox": [
                                        150,
                                        331,
                                        167,
                                        343
                                    ],
                                    "score": 1.0,
                                    "content": "do",
                                    "type": "text"
                                }
                            ],
                            "index": 18
                        },
                        {
                            "bbox": [
                                75,
                                342,
                                287,
                                356
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        75,
                                        343,
                                        86,
                                        354
                                    ],
                                    "score": 1.0,
                                    "content": "6:",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        96,
                                        342,
                                        123,
                                        356
                                    ],
                                    "score": 1.0,
                                    "content": "Load ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        123,
                                        344,
                                        151,
                                        355
                                    ],
                                    "score": 0.87,
                                    "content": "\\mathbf{K}_{j},\\mathbf{V}_{j}",
                                    "type": "inline_equation",
                                    "height": 11,
                                    "width": 28
                                },
                                {
                                    "bbox": [
                                        152,
                                        342,
                                        287,
                                        356
                                    ],
                                    "score": 1.0,
                                    "content": "from HBM to on-chip SRAM.",
                                    "type": "text"
                                }
                            ],
                            "index": 19
                        },
                        {
                            "bbox": [
                                75,
                                353,
                                318,
                                368
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        75,
                                        355,
                                        86,
                                        366
                                    ],
                                    "score": 1.0,
                                    "content": "7:",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        96,
                                        353,
                                        138,
                                        368
                                    ],
                                    "score": 1.0,
                                    "content": "Initialize",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        139,
                                        356,
                                        267,
                                        367
                                    ],
                                    "score": 0.88,
                                    "content": "{\\bf d}{\\bf K}_{j}=(0)_{B_{c}\\times d},{\\bf d}{\\bf V}_{j}=(0)_{B_{c}\\times d}",
                                    "type": "inline_equation",
                                    "height": 11,
                                    "width": 128
                                },
                                {
                                    "bbox": [
                                        268,
                                        353,
                                        318,
                                        368
                                    ],
                                    "score": 1.0,
                                    "content": "on SRAM.",
                                    "type": "text"
                                }
                            ],
                            "index": 20
                        },
                        {
                            "bbox": [
                                75,
                                367,
                                175,
                                378
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        75,
                                        367,
                                        86,
                                        378
                                    ],
                                    "score": 1.0,
                                    "content": "8:",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        97,
                                        367,
                                        115,
                                        378
                                    ],
                                    "score": 1.0,
                                    "content": "for ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        115,
                                        369,
                                        157,
                                        378
                                    ],
                                    "score": 0.91,
                                    "content": "1\\leq i\\leq T_{r}",
                                    "type": "inline_equation",
                                    "height": 9,
                                    "width": 42
                                },
                                {
                                    "bbox": [
                                        158,
                                        367,
                                        175,
                                        378
                                    ],
                                    "score": 1.0,
                                    "content": "do",
                                    "type": "text"
                                }
                            ],
                            "index": 21
                        },
                        {
                            "bbox": [
                                74,
                                378,
                                363,
                                390
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        74,
                                        379,
                                        86,
                                        390
                                    ],
                                    "score": 1.0,
                                    "content": "9:",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        107,
                                        378,
                                        133,
                                        390
                                    ],
                                    "score": 1.0,
                                    "content": "Load ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        133,
                                        380,
                                        229,
                                        390
                                    ],
                                    "score": 0.77,
                                    "content": "\\mathbf{Q}_{i},\\mathbf{O}_{i},\\mathbf{d}\\mathbf{O}_{i},\\mathbf{d}\\mathbf{Q}_{i},L_{i},D_{i}",
                                    "type": "inline_equation",
                                    "height": 10,
                                    "width": 96
                                },
                                {
                                    "bbox": [
                                        229,
                                        378,
                                        363,
                                        390
                                    ],
                                    "score": 1.0,
                                    "content": "from HBM to on-chip SRAM.",
                                    "type": "text"
                                }
                            ],
                            "index": 22
                        },
                        {
                            "bbox": [
                                70,
                                389,
                                288,
                                406
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        392,
                                        86,
                                        405
                                    ],
                                    "score": 1.0,
                                    "content": "10:",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        107,
                                        389,
                                        189,
                                        406
                                    ],
                                    "score": 1.0,
                                    "content": "On chip, compute ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        189,
                                        391,
                                        283,
                                        406
                                    ],
                                    "score": 0.91,
                                    "content": "\\mathbf{S}_{i}^{(j)}=\\mathbf{Q}_{i}\\mathbf{K}_{j}^{T}\\in\\mathbb{R}^{B_{r}\\times B_{c}}",
                                    "type": "inline_equation",
                                    "height": 15,
                                    "width": 94
                                },
                                {
                                    "bbox": [
                                        283,
                                        389,
                                        288,
                                        406
                                    ],
                                    "score": 1.0,
                                    "content": ".",
                                    "type": "text"
                                }
                            ],
                            "index": 23
                        },
                        {
                            "bbox": [
                                70,
                                403,
                                321,
                                422
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        408,
                                        86,
                                        420
                                    ],
                                    "score": 1.0,
                                    "content": "11:",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        106,
                                        403,
                                        189,
                                        422
                                    ],
                                    "score": 1.0,
                                    "content": "On chip, compute ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        189,
                                        407,
                                        316,
                                        420
                                    ],
                                    "score": 0.91,
                                    "content": "\\mathbf{P}_{i}^{(j)}=\\exp(\\mathbf{S}_{i j}-L_{i})\\in\\mathbb{R}^{B_{r}\\times B_{c}}",
                                    "type": "inline_equation",
                                    "height": 13,
                                    "width": 127
                                },
                                {
                                    "bbox": [
                                        317,
                                        403,
                                        321,
                                        422
                                    ],
                                    "score": 1.0,
                                    "content": ".",
                                    "type": "text"
                                }
                            ],
                            "index": 24
                        },
                        {
                            "bbox": [
                                71,
                                421,
                                339,
                                435
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        71,
                                        423,
                                        86,
                                        435
                                    ],
                                    "score": 1.0,
                                    "content": "12:",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        106,
                                        421,
                                        189,
                                        435
                                    ],
                                    "score": 1.0,
                                    "content": "On chip, compute ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        189,
                                        421,
                                        336,
                                        435
                                    ],
                                    "score": 0.87,
                                    "content": "\\mathbf{d}\\mathbf{V}_{j}\\leftarrow\\mathbf{d}\\mathbf{V}_{j}+(\\mathbf{P}_{i}^{(j)})^{\\top}\\mathbf{d}\\mathbf{0}_{i}\\in\\mathbb{R}^{B_{c}\\times d}",
                                    "type": "inline_equation",
                                    "height": 14,
                                    "width": 147
                                },
                                {
                                    "bbox": [
                                        337,
                                        421,
                                        339,
                                        435
                                    ],
                                    "score": 1.0,
                                    "content": ".",
                                    "type": "text"
                                }
                            ],
                            "index": 25
                        },
                        {
                            "bbox": [
                                72,
                                433,
                                302,
                                452
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        72,
                                        436,
                                        87,
                                        450
                                    ],
                                    "score": 1.0,
                                    "content": "13:",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        106,
                                        433,
                                        189,
                                        452
                                    ],
                                    "score": 1.0,
                                    "content": "On chip, compute ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        189,
                                        436,
                                        296,
                                        451
                                    ],
                                    "score": 0.9,
                                    "content": "\\mathbf{dP}_{i}^{(j)}=\\mathbf{dO}_{i}\\mathbf{V}_{j}^{\\top}\\in\\mathbb{R}^{B_{r}\\times B_{c}}",
                                    "type": "inline_equation",
                                    "height": 15,
                                    "width": 107
                                },
                                {
                                    "bbox": [
                                        296,
                                        433,
                                        302,
                                        452
                                    ],
                                    "score": 1.0,
                                    "content": ".",
                                    "type": "text"
                                }
                            ],
                            "index": 26
                        },
                        {
                            "bbox": [
                                71,
                                450,
                                349,
                                466
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        71,
                                        452,
                                        87,
                                        466
                                    ],
                                    "score": 1.0,
                                    "content": "14:",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        106,
                                        450,
                                        189,
                                        465
                                    ],
                                    "score": 1.0,
                                    "content": "On chip, compute ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        189,
                                        451,
                                        347,
                                        466
                                    ],
                                    "score": 0.92,
                                    "content": "\\mathbf{dS}_{i}^{(j)}=\\mathbf{P}_{i}^{(j)}\\circ(\\mathbf{dP}_{i}^{(j)}-D_{i})\\in\\mathbb{R}^{B_{r}\\times B_{c}}",
                                    "type": "inline_equation",
                                    "height": 15,
                                    "width": 158
                                },
                                {
                                    "bbox": [
                                        347,
                                        450,
                                        349,
                                        465
                                    ],
                                    "score": 1.0,
                                    "content": ".",
                                    "type": "text"
                                }
                            ],
                            "index": 27
                        },
                        {
                            "bbox": [
                                70,
                                465,
                                542,
                                480
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        468,
                                        86,
                                        480
                                    ],
                                    "score": 1.0,
                                    "content": "15:",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        105,
                                        466,
                                        132,
                                        480
                                    ],
                                    "score": 1.0,
                                    "content": "Load ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        132,
                                        470,
                                        149,
                                        479
                                    ],
                                    "score": 0.79,
                                    "content": "{\\bf d}{\\bf Q}_{i}",
                                    "type": "inline_equation",
                                    "height": 9,
                                    "width": 17
                                },
                                {
                                    "bbox": [
                                        149,
                                        466,
                                        340,
                                        480
                                    ],
                                    "score": 1.0,
                                    "content": "from HBM to SRAM, then on chip, update ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        340,
                                        465,
                                        470,
                                        480
                                    ],
                                    "score": 0.94,
                                    "content": "\\mathbf{d}\\mathbf{Q}_{i}\\leftarrow\\mathbf{d}\\mathbf{Q}_{i}+\\mathbf{d}\\mathbf{S}_{i}^{(j)}\\mathbf{K}_{j}\\in\\mathbb{R}^{B_{r}\\times d}",
                                    "type": "inline_equation",
                                    "height": 15,
                                    "width": 130
                                },
                                {
                                    "bbox": [
                                        470,
                                        466,
                                        542,
                                        480
                                    ],
                                    "score": 1.0,
                                    "content": ", and write back",
                                    "type": "text"
                                }
                            ],
                            "index": 28
                        },
                        {
                            "bbox": [
                                108,
                                480,
                                149,
                                491
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        108,
                                        480,
                                        149,
                                        491
                                    ],
                                    "score": 1.0,
                                    "content": "to HBM.",
                                    "type": "text"
                                }
                            ],
                            "index": 29
                        },
                        {
                            "bbox": [
                                70,
                                488,
                                328,
                                505
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        492,
                                        86,
                                        504
                                    ],
                                    "score": 1.0,
                                    "content": "16:",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        105,
                                        488,
                                        189,
                                        505
                                    ],
                                    "score": 1.0,
                                    "content": "On chip, compute ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        189,
                                        488,
                                        328,
                                        504
                                    ],
                                    "score": 0.91,
                                    "content": "\\mathbf{d}\\mathbf{K}_{j}\\gets\\mathbf{d}\\mathbf{K}_{j}+\\mathbf{d}\\mathbf{S}_{i}^{(j)^{\\top}}\\mathbf{Q}_{i}\\in\\mathbb{R}^{B_{c}\\times d}.",
                                    "type": "inline_equation",
                                    "height": 16,
                                    "width": 139
                                }
                            ],
                            "index": 30
                        },
                        {
                            "bbox": [
                                71,
                                502,
                                137,
                                516
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        71,
                                        504,
                                        86,
                                        516
                                    ],
                                    "score": 1.0,
                                    "content": "17:",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        98,
                                        502,
                                        137,
                                        516
                                    ],
                                    "score": 1.0,
                                    "content": "end for",
                                    "type": "text"
                                }
                            ],
                            "index": 31
                        },
                        {
                            "bbox": [
                                70,
                                515,
                                209,
                                528
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        516,
                                        86,
                                        528
                                    ],
                                    "score": 1.0,
                                    "content": "18:",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        97,
                                        515,
                                        125,
                                        528
                                    ],
                                    "score": 1.0,
                                    "content": "Write ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        125,
                                        515,
                                        166,
                                        528
                                    ],
                                    "score": 0.37,
                                    "content": "\\mathbf{dK}_{j},\\mathbf{dV}_{j}",
                                    "type": "inline_equation",
                                    "height": 13,
                                    "width": 41
                                },
                                {
                                    "bbox": [
                                        166,
                                        515,
                                        209,
                                        528
                                    ],
                                    "score": 1.0,
                                    "content": "to HBM.",
                                    "type": "text"
                                }
                            ],
                            "index": 32
                        },
                        {
                            "bbox": [
                                71,
                                527,
                                125,
                                538
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        71,
                                        527,
                                        125,
                                        538
                                    ],
                                    "score": 1.0,
                                    "content": "19: end for",
                                    "type": "text"
                                }
                            ],
                            "index": 33
                        },
                        {
                            "bbox": [
                                70,
                                539,
                                176,
                                551
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        539,
                                        176,
                                        551
                                    ],
                                    "score": 1.0,
                                    "content": "20: Return dQ, dK, dV.",
                                    "type": "text"
                                }
                            ],
                            "index": 34
                        }
                    ],
                    "index": 21.5
                },
                {
                    "type": "text",
                    "bbox": [
                        70,
                        581,
                        541,
                        653
                    ],
                    "lines": [
                        {
                            "bbox": [
                                70,
                                582,
                                542,
                                594
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        582,
                                        542,
                                        594
                                    ],
                                    "score": 1.0,
                                    "content": "Multi-query attention and grouped-query attention. Multi-query attention (MQA) [15] and grouped-",
                                    "type": "text"
                                }
                            ],
                            "index": 35
                        },
                        {
                            "bbox": [
                                70,
                                594,
                                542,
                                605
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        594,
                                        542,
                                        605
                                    ],
                                    "score": 1.0,
                                    "content": "query attention (GQA) [1] are variants of attention where multiple heads of query attend to the same head of",
                                    "type": "text"
                                }
                            ],
                            "index": 36
                        },
                        {
                            "bbox": [
                                70,
                                606,
                                541,
                                617
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        606,
                                        541,
                                        617
                                    ],
                                    "score": 1.0,
                                    "content": "key and value, in order to reduce the size of KV cache during inference. Instead of having to duplicate the",
                                    "type": "text"
                                }
                            ],
                            "index": 37
                        },
                        {
                            "bbox": [
                                70,
                                618,
                                541,
                                630
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        618,
                                        541,
                                        630
                                    ],
                                    "score": 1.0,
                                    "content": "key and value heads for the computation, we implicitly manipulate the indices into the head to perform the",
                                    "type": "text"
                                }
                            ],
                            "index": 38
                        },
                        {
                            "bbox": [
                                70,
                                631,
                                540,
                                641
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        631,
                                        392,
                                        641
                                    ],
                                    "score": 1.0,
                                    "content": "same computation. In the backward pass, we need to sum the gradients ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        392,
                                        632,
                                        406,
                                        639
                                    ],
                                    "score": 0.33,
                                    "content": "\\mathbf{dK}",
                                    "type": "inline_equation",
                                    "height": 7,
                                    "width": 14
                                },
                                {
                                    "bbox": [
                                        406,
                                        631,
                                        540,
                                        641
                                    ],
                                    "score": 1.0,
                                    "content": " and dV across different heads",
                                    "type": "text"
                                }
                            ],
                            "index": 39
                        },
                        {
                            "bbox": [
                                70,
                                642,
                                209,
                                652
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        642,
                                        209,
                                        652
                                    ],
                                    "score": 1.0,
                                    "content": "that were implicitly duplicated.",
                                    "type": "text"
                                }
                            ],
                            "index": 40
                        }
                    ],
                    "index": 37.5
                },
                {
                    "type": "title",
                    "bbox": [
                        72,
                        667,
                        168,
                        681
                    ],
                    "lines": [
                        {
                            "bbox": [
                                70,
                                668,
                                167,
                                680
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        668,
                                        91,
                                        680
                                    ],
                                    "score": 1.0,
                                    "content": "3.2",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        101,
                                        668,
                                        167,
                                        680
                                    ],
                                    "score": 1.0,
                                    "content": "Parallelism",
                                    "type": "text"
                                }
                            ],
                            "index": 41
                        }
                    ],
                    "index": 41
                },
                {
                    "type": "text",
                    "bbox": [
                        71,
                        687,
                        541,
                        723
                    ],
                    "lines": [
                        {
                            "bbox": [
                                71,
                                687,
                                540,
                                698
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        71,
                                        687,
                                        540,
                                        698
                                    ],
                                    "score": 1.0,
                                    "content": "The first version of FlashAttention parallelizes over batch size and number of heads. We use 1 thread",
                                    "type": "text"
                                }
                            ],
                            "index": 42
                        },
                        {
                            "bbox": [
                                71,
                                700,
                                540,
                                711
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        71,
                                        700,
                                        371,
                                        711
                                    ],
                                    "score": 1.0,
                                    "content": "block to process one attention head, and there are overall batch size",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        371,
                                        705,
                                        375,
                                        708
                                    ],
                                    "score": 0.25,
                                    "content": "\\cdot\\cdot",
                                    "type": "inline_equation",
                                    "height": 3,
                                    "width": 4
                                },
                                {
                                    "bbox": [
                                        375,
                                        700,
                                        540,
                                        711
                                    ],
                                    "score": 1.0,
                                    "content": " number of heads thread blocks. Each",
                                    "type": "text"
                                }
                            ],
                            "index": 43
                        },
                        {
                            "bbox": [
                                71,
                                712,
                                540,
                                723
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        71,
                                        712,
                                        540,
                                        723
                                    ],
                                    "score": 1.0,
                                    "content": "thread block is scheduled to run on a streaming multiprocessor (SM), and there are 108 of these SMs on",
                                    "type": "text"
                                }
                            ],
                            "index": 44
                        }
                    ],
                    "index": 43
                }
            ],
            "layout_bboxes": [],
            "page_idx": 6,
            "page_size": [
                612.0,
                792.0
            ],
            "_layout_tree": [],
            "images": [],
            "tables": [],
            "interline_equations": [],
            "discarded_blocks": [
                {
                    "type": "discarded",
                    "bbox": [
                        302,
                        742,
                        309,
                        751
                    ],
                    "lines": [
                        {
                            "bbox": [
                                301,
                                741,
                                311,
                                754
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        301,
                                        741,
                                        311,
                                        754
                                    ],
                                    "score": 1.0,
                                    "content": "",
                                    "type": "text",
                                    "height": 13,
                                    "width": 10
                                }
                            ]
                        }
                    ]
                }
            ],
            "need_drop": false,
            "drop_reason": [],
            "para_blocks": [
                {
                    "type": "text",
                    "bbox": [
                        71,
                        73,
                        541,
                        121
                    ],
                    "lines": [
                        {
                            "bbox": [
                                72,
                                75,
                                540,
                                85
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        72,
                                        75,
                                        540,
                                        85
                                    ],
                                    "score": 1.0,
                                    "content": "Correctness, runtime, and memory requirement. As with FlashAttention, Algorithm 1 returns",
                                    "type": "text"
                                }
                            ],
                            "index": 0
                        },
                        {
                            "bbox": [
                                70,
                                85,
                                539,
                                98
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        85,
                                        154,
                                        98
                                    ],
                                    "score": 1.0,
                                    "content": "the correct output ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        154,
                                        86,
                                        245,
                                        97
                                    ],
                                    "score": 0.4,
                                    "content": "{\\bf0}=\\mathrm{softmax}({\\bf Q}{\\bf K}^{\\top}){\\bf V}",
                                    "type": "inline_equation",
                                    "height": 11,
                                    "width": 91
                                },
                                {
                                    "bbox": [
                                        245,
                                        85,
                                        387,
                                        98
                                    ],
                                    "score": 1.0,
                                    "content": " (with no approximation), using ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        387,
                                        87,
                                        421,
                                        97
                                    ],
                                    "score": 0.93,
                                    "content": "O(N^{2}d)",
                                    "type": "inline_equation",
                                    "height": 10,
                                    "width": 34
                                },
                                {
                                    "bbox": [
                                        421,
                                        85,
                                        515,
                                        98
                                    ],
                                    "score": 1.0,
                                    "content": " FLOPs and requires ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        516,
                                        87,
                                        539,
                                        97
                                    ],
                                    "score": 0.93,
                                    "content": "O(N)",
                                    "type": "inline_equation",
                                    "height": 10,
                                    "width": 23
                                }
                            ],
                            "index": 1
                        },
                        {
                            "bbox": [
                                70,
                                97,
                                541,
                                109
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        97,
                                        381,
                                        109
                                    ],
                                    "score": 1.0,
                                    "content": "additional memory beyond inputs and output (to store the logsumexp ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        381,
                                        100,
                                        388,
                                        107
                                    ],
                                    "score": 0.85,
                                    "content": "L",
                                    "type": "inline_equation",
                                    "height": 7,
                                    "width": 7
                                },
                                {
                                    "bbox": [
                                        389,
                                        97,
                                        541,
                                        109
                                    ],
                                    "score": 1.0,
                                    "content": "). The proof is almost the same as",
                                    "type": "text"
                                }
                            ],
                            "index": 2
                        },
                        {
                            "bbox": [
                                71,
                                110,
                                325,
                                122
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        71,
                                        110,
                                        325,
                                        122
                                    ],
                                    "score": 1.0,
                                    "content": "the proof of Dao et al. [5, Theorem 1], so we omit it here.",
                                    "type": "text"
                                }
                            ],
                            "index": 3
                        }
                    ],
                    "index": 1.5,
                    "page_num": "page_6",
                    "page_size": [
                        612.0,
                        792.0
                    ],
                    "bbox_fs": [
                        70,
                        75,
                        541,
                        122
                    ]
                },
                {
                    "type": "title",
                    "bbox": [
                        71,
                        135,
                        181,
                        147
                    ],
                    "lines": [
                        {
                            "bbox": [
                                71,
                                136,
                                181,
                                147
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        71,
                                        136,
                                        97,
                                        146
                                    ],
                                    "score": 1.0,
                                    "content": "3.1.2",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        105,
                                        136,
                                        181,
                                        147
                                    ],
                                    "score": 1.0,
                                    "content": "Backward pass",
                                    "type": "text"
                                }
                            ],
                            "index": 4
                        }
                    ],
                    "index": 4,
                    "page_num": "page_6",
                    "page_size": [
                        612.0,
                        792.0
                    ]
                },
                {
                    "type": "text",
                    "bbox": [
                        71,
                        153,
                        542,
                        189
                    ],
                    "lines": [
                        {
                            "bbox": [
                                71,
                                154,
                                540,
                                165
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        71,
                                        154,
                                        540,
                                        165
                                    ],
                                    "score": 1.0,
                                    "content": "The backward pass of FlashAttention-2 is almost the same as that of FlashAttention. We make a",
                                    "type": "text"
                                }
                            ],
                            "index": 5
                        },
                        {
                            "bbox": [
                                70,
                                167,
                                541,
                                177
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        167,
                                        288,
                                        177
                                    ],
                                    "score": 1.0,
                                    "content": "minor tweak to only use the row-wise logsumexp",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        289,
                                        168,
                                        295,
                                        175
                                    ],
                                    "score": 0.88,
                                    "content": "L",
                                    "type": "inline_equation",
                                    "height": 7,
                                    "width": 6
                                },
                                {
                                    "bbox": [
                                        296,
                                        167,
                                        541,
                                        177
                                    ],
                                    "score": 1.0,
                                    "content": "instead of both the row-wise max and row-wise sum of",
                                    "type": "text"
                                }
                            ],
                            "index": 6
                        },
                        {
                            "bbox": [
                                70,
                                178,
                                529,
                                190
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        178,
                                        529,
                                        190
                                    ],
                                    "score": 1.0,
                                    "content": "exponentials in the softmax. We include the backward pass description in Algorithm 2 for completeness.",
                                    "type": "text"
                                }
                            ],
                            "index": 7
                        }
                    ],
                    "index": 6,
                    "page_num": "page_6",
                    "page_size": [
                        612.0,
                        792.0
                    ],
                    "bbox_fs": [
                        70,
                        154,
                        541,
                        190
                    ]
                },
                {
                    "type": "title",
                    "bbox": [
                        74,
                        201,
                        282,
                        213
                    ],
                    "lines": [
                        {
                            "bbox": [
                                73,
                                202,
                                283,
                                212
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        73,
                                        202,
                                        283,
                                        212
                                    ],
                                    "score": 1.0,
                                    "content": "Algorithm 2 FlashAttention-2 Backward Pass",
                                    "type": "text"
                                }
                            ],
                            "index": 8
                        }
                    ],
                    "index": 8,
                    "page_num": "page_6",
                    "page_size": [
                        612.0,
                        792.0
                    ]
                },
                {
                    "type": "list",
                    "bbox": [
                        72,
                        216,
                        542,
                        554
                    ],
                    "lines": [
                        {
                            "bbox": [
                                70,
                                215,
                                486,
                                230
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        215,
                                        159,
                                        230
                                    ],
                                    "score": 1.0,
                                    "content": "Require: Matrices ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        160,
                                        219,
                                        255,
                                        229
                                    ],
                                    "score": 0.84,
                                    "content": "\\mathbf{Q},\\mathbf{K},\\mathbf{V},\\mathbf{O},\\mathbf{dO}\\in\\mathbb{R}^{N\\times d}",
                                    "type": "inline_equation",
                                    "height": 10,
                                    "width": 95
                                },
                                {
                                    "bbox": [
                                        256,
                                        215,
                                        329,
                                        230
                                    ],
                                    "score": 1.0,
                                    "content": "in HBM, vector",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        330,
                                        219,
                                        362,
                                        227
                                    ],
                                    "score": 0.92,
                                    "content": "L\\in\\mathbb{R}^{N}",
                                    "type": "inline_equation",
                                    "height": 8,
                                    "width": 32
                                },
                                {
                                    "bbox": [
                                        362,
                                        215,
                                        455,
                                        230
                                    ],
                                    "score": 1.0,
                                    "content": "in HBM, block sizes ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        455,
                                        221,
                                        467,
                                        229
                                    ],
                                    "score": 0.86,
                                    "content": "B_{c}",
                                    "type": "inline_equation",
                                    "height": 8,
                                    "width": 12
                                },
                                {
                                    "bbox": [
                                        467,
                                        215,
                                        472,
                                        230
                                    ],
                                    "score": 1.0,
                                    "content": ", ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        473,
                                        221,
                                        484,
                                        229
                                    ],
                                    "score": 0.83,
                                    "content": "B_{r}",
                                    "type": "inline_equation",
                                    "height": 8,
                                    "width": 11
                                },
                                {
                                    "bbox": [
                                        484,
                                        215,
                                        486,
                                        230
                                    ],
                                    "score": 1.0,
                                    "content": ".",
                                    "type": "text"
                                }
                            ],
                            "index": 9,
                            "is_list_end_line": true
                        },
                        {
                            "bbox": [
                                77,
                                230,
                                540,
                                248
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        77,
                                        232,
                                        120,
                                        245
                                    ],
                                    "score": 1.0,
                                    "content": "1: Divide ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        121,
                                        235,
                                        129,
                                        244
                                    ],
                                    "score": 0.82,
                                    "content": "\\mathbf{Q}",
                                    "type": "inline_equation",
                                    "height": 9,
                                    "width": 8
                                },
                                {
                                    "bbox": [
                                        129,
                                        232,
                                        152,
                                        245
                                    ],
                                    "score": 1.0,
                                    "content": " into ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        152,
                                        230,
                                        194,
                                        248
                                    ],
                                    "score": 0.93,
                                    "content": "\\begin{array}{r}{T_{r}=\\bigg\\lceil\\frac{N}{B_{r}}\\bigg\\rceil}\\end{array}",
                                    "type": "inline_equation",
                                    "height": 18,
                                    "width": 42
                                },
                                {
                                    "bbox": [
                                        194,
                                        232,
                                        227,
                                        245
                                    ],
                                    "score": 1.0,
                                    "content": "blocks ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        227,
                                        235,
                                        277,
                                        245
                                    ],
                                    "score": 0.91,
                                    "content": "\\mathbf{Q}_{1},\\ldots,\\mathbf{Q}_{T_{r}}",
                                    "type": "inline_equation",
                                    "height": 10,
                                    "width": 50
                                },
                                {
                                    "bbox": [
                                        277,
                                        232,
                                        311,
                                        245
                                    ],
                                    "score": 1.0,
                                    "content": "of size ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        312,
                                        235,
                                        340,
                                        244
                                    ],
                                    "score": 0.92,
                                    "content": "B_{r}\\times d",
                                    "type": "inline_equation",
                                    "height": 9,
                                    "width": 28
                                },
                                {
                                    "bbox": [
                                        340,
                                        232,
                                        419,
                                        245
                                    ],
                                    "score": 1.0,
                                    "content": "each, and divide ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        419,
                                        235,
                                        440,
                                        244
                                    ],
                                    "score": 0.91,
                                    "content": "\\mathbf{K},\\mathbf{V}",
                                    "type": "inline_equation",
                                    "height": 9,
                                    "width": 21
                                },
                                {
                                    "bbox": [
                                        440,
                                        232,
                                        467,
                                        245
                                    ],
                                    "score": 1.0,
                                    "content": " in to ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        467,
                                        230,
                                        509,
                                        248
                                    ],
                                    "score": 0.94,
                                    "content": "\\begin{array}{r}{T_{c}=\\bigg\\lceil\\frac{N}{B_{c}}\\bigg\\rceil}\\end{array}",
                                    "type": "inline_equation",
                                    "height": 18,
                                    "width": 42
                                },
                                {
                                    "bbox": [
                                        510,
                                        232,
                                        540,
                                        244
                                    ],
                                    "score": 1.0,
                                    "content": "blocks",
                                    "type": "text"
                                }
                            ],
                            "index": 10,
                            "is_list_start_line": true
                        },
                        {
                            "bbox": [
                                88,
                                246,
                                303,
                                259
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        88,
                                        249,
                                        138,
                                        259
                                    ],
                                    "score": 0.92,
                                    "content": "\\mathbf{K}_{1},\\ldots,\\mathbf{K}_{T_{c}}",
                                    "type": "inline_equation",
                                    "height": 10,
                                    "width": 50
                                },
                                {
                                    "bbox": [
                                        138,
                                        246,
                                        160,
                                        259
                                    ],
                                    "score": 1.0,
                                    "content": "and",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        161,
                                        249,
                                        211,
                                        259
                                    ],
                                    "score": 0.89,
                                    "content": "\\mathbf{V}_{1},\\ldots,\\mathbf{V}_{T_{c}}",
                                    "type": "inline_equation",
                                    "height": 10,
                                    "width": 50
                                },
                                {
                                    "bbox": [
                                        212,
                                        246,
                                        247,
                                        259
                                    ],
                                    "score": 1.0,
                                    "content": ", of size ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        247,
                                        249,
                                        275,
                                        258
                                    ],
                                    "score": 0.92,
                                    "content": "B_{c}\\times d",
                                    "type": "inline_equation",
                                    "height": 9,
                                    "width": 28
                                },
                                {
                                    "bbox": [
                                        276,
                                        246,
                                        303,
                                        259
                                    ],
                                    "score": 1.0,
                                    "content": "each.",
                                    "type": "text"
                                }
                            ],
                            "index": 11,
                            "is_list_end_line": true
                        },
                        {
                            "bbox": [
                                75,
                                259,
                                541,
                                272
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        75,
                                        259,
                                        120,
                                        272
                                    ],
                                    "score": 1.0,
                                    "content": "2: Divide ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        121,
                                        261,
                                        129,
                                        269
                                    ],
                                    "score": 0.77,
                                    "content": "\\mathbf{0}",
                                    "type": "inline_equation",
                                    "height": 8,
                                    "width": 8
                                },
                                {
                                    "bbox": [
                                        129,
                                        259,
                                        152,
                                        272
                                    ],
                                    "score": 1.0,
                                    "content": " into ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        153,
                                        262,
                                        162,
                                        270
                                    ],
                                    "score": 0.9,
                                    "content": "T_{r}",
                                    "type": "inline_equation",
                                    "height": 8,
                                    "width": 9
                                },
                                {
                                    "bbox": [
                                        162,
                                        259,
                                        196,
                                        272
                                    ],
                                    "score": 1.0,
                                    "content": "blocks ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        197,
                                        261,
                                        244,
                                        271
                                    ],
                                    "score": 0.9,
                                    "content": "\\mathbf{O}_{i},\\ldots,\\mathbf{O}_{T_{r}}",
                                    "type": "inline_equation",
                                    "height": 10,
                                    "width": 47
                                },
                                {
                                    "bbox": [
                                        245,
                                        259,
                                        279,
                                        272
                                    ],
                                    "score": 1.0,
                                    "content": "of size ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        280,
                                        261,
                                        308,
                                        270
                                    ],
                                    "score": 0.92,
                                    "content": "B_{r}\\times d",
                                    "type": "inline_equation",
                                    "height": 9,
                                    "width": 28
                                },
                                {
                                    "bbox": [
                                        308,
                                        259,
                                        405,
                                        272
                                    ],
                                    "score": 1.0,
                                    "content": "each, divide dO into ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        405,
                                        262,
                                        414,
                                        270
                                    ],
                                    "score": 0.89,
                                    "content": "T_{r}",
                                    "type": "inline_equation",
                                    "height": 8,
                                    "width": 9
                                },
                                {
                                    "bbox": [
                                        414,
                                        259,
                                        448,
                                        272
                                    ],
                                    "score": 1.0,
                                    "content": "blocks ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        449,
                                        260,
                                        507,
                                        271
                                    ],
                                    "score": 0.84,
                                    "content": "\\mathbf{d}\\mathbf{O}_{i},\\dots,\\mathbf{d}\\mathbf{O}_{T_{r}}",
                                    "type": "inline_equation",
                                    "height": 11,
                                    "width": 58
                                },
                                {
                                    "bbox": [
                                        508,
                                        259,
                                        541,
                                        272
                                    ],
                                    "score": 1.0,
                                    "content": "of size",
                                    "type": "text"
                                }
                            ],
                            "index": 12,
                            "is_list_start_line": true
                        },
                        {
                            "bbox": [
                                88,
                                270,
                                382,
                                284
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        88,
                                        273,
                                        116,
                                        282
                                    ],
                                    "score": 0.92,
                                    "content": "B_{r}\\times d",
                                    "type": "inline_equation",
                                    "height": 9,
                                    "width": 28
                                },
                                {
                                    "bbox": [
                                        116,
                                        270,
                                        192,
                                        284
                                    ],
                                    "score": 1.0,
                                    "content": "each, and divide",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        193,
                                        273,
                                        200,
                                        280
                                    ],
                                    "score": 0.89,
                                    "content": "L",
                                    "type": "inline_equation",
                                    "height": 7,
                                    "width": 7
                                },
                                {
                                    "bbox": [
                                        200,
                                        270,
                                        223,
                                        284
                                    ],
                                    "score": 1.0,
                                    "content": "into ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        223,
                                        273,
                                        232,
                                        282
                                    ],
                                    "score": 0.9,
                                    "content": "T_{r}",
                                    "type": "inline_equation",
                                    "height": 9,
                                    "width": 9
                                },
                                {
                                    "bbox": [
                                        232,
                                        270,
                                        265,
                                        284
                                    ],
                                    "score": 1.0,
                                    "content": "blocks",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        266,
                                        273,
                                        311,
                                        283
                                    ],
                                    "score": 0.92,
                                    "content": "L_{i},\\ldots,L_{T_{r}}",
                                    "type": "inline_equation",
                                    "height": 10,
                                    "width": 45
                                },
                                {
                                    "bbox": [
                                        312,
                                        270,
                                        345,
                                        284
                                    ],
                                    "score": 1.0,
                                    "content": "of size ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        345,
                                        273,
                                        356,
                                        282
                                    ],
                                    "score": 0.9,
                                    "content": "B_{r}",
                                    "type": "inline_equation",
                                    "height": 9,
                                    "width": 11
                                },
                                {
                                    "bbox": [
                                        357,
                                        270,
                                        382,
                                        284
                                    ],
                                    "score": 1.0,
                                    "content": "each.",
                                    "type": "text"
                                }
                            ],
                            "index": 13,
                            "is_list_end_line": true
                        },
                        {
                            "bbox": [
                                75,
                                282,
                                541,
                                296
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        75,
                                        282,
                                        130,
                                        296
                                    ],
                                    "score": 1.0,
                                    "content": "3: Initialize ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        130,
                                        285,
                                        186,
                                        294
                                    ],
                                    "score": 0.92,
                                    "content": "{\\bf d Q}=(0)_{N\\times d}",
                                    "type": "inline_equation",
                                    "height": 9,
                                    "width": 56
                                },
                                {
                                    "bbox": [
                                        186,
                                        282,
                                        311,
                                        296
                                    ],
                                    "score": 1.0,
                                    "content": "in HBM and divide it into ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        312,
                                        285,
                                        320,
                                        294
                                    ],
                                    "score": 0.9,
                                    "content": "T_{r}",
                                    "type": "inline_equation",
                                    "height": 9,
                                    "width": 8
                                },
                                {
                                    "bbox": [
                                        321,
                                        282,
                                        355,
                                        296
                                    ],
                                    "score": 1.0,
                                    "content": "blocks ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        355,
                                        284,
                                        416,
                                        295
                                    ],
                                    "score": 0.87,
                                    "content": "\\mathbf{dQ}_{1},\\hdots,\\mathbf{dQ}_{T_{r}}",
                                    "type": "inline_equation",
                                    "height": 11,
                                    "width": 61
                                },
                                {
                                    "bbox": [
                                        416,
                                        282,
                                        450,
                                        296
                                    ],
                                    "score": 1.0,
                                    "content": "of size",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        451,
                                        285,
                                        479,
                                        294
                                    ],
                                    "score": 0.91,
                                    "content": "B_{r}\\times d",
                                    "type": "inline_equation",
                                    "height": 9,
                                    "width": 28
                                },
                                {
                                    "bbox": [
                                        479,
                                        282,
                                        541,
                                        296
                                    ],
                                    "score": 1.0,
                                    "content": "each. Divide",
                                    "type": "text"
                                }
                            ],
                            "index": 14,
                            "is_list_start_line": true
                        },
                        {
                            "bbox": [
                                86,
                                291,
                                461,
                                310
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        86,
                                        291,
                                        105,
                                        310
                                    ],
                                    "score": 1.0,
                                    "content": "dK,",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        105,
                                        295,
                                        154,
                                        304
                                    ],
                                    "score": 0.87,
                                    "content": "\\mathbf{dV}\\in\\mathbb{R}^{N\\times d}",
                                    "type": "inline_equation",
                                    "height": 9,
                                    "width": 49
                                },
                                {
                                    "bbox": [
                                        155,
                                        291,
                                        181,
                                        310
                                    ],
                                    "score": 1.0,
                                    "content": "in to ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        181,
                                        297,
                                        191,
                                        306
                                    ],
                                    "score": 0.87,
                                    "content": "T_{c}",
                                    "type": "inline_equation",
                                    "height": 9,
                                    "width": 10
                                },
                                {
                                    "bbox": [
                                        191,
                                        291,
                                        224,
                                        310
                                    ],
                                    "score": 1.0,
                                    "content": "blocks ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        225,
                                        297,
                                        285,
                                        307
                                    ],
                                    "score": 0.9,
                                    "content": "\\mathbf{dK}_{1},\\ldots,\\mathbf{dK}_{T_{c}}",
                                    "type": "inline_equation",
                                    "height": 10,
                                    "width": 60
                                },
                                {
                                    "bbox": [
                                        286,
                                        291,
                                        308,
                                        310
                                    ],
                                    "score": 1.0,
                                    "content": "and ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        308,
                                        297,
                                        370,
                                        307
                                    ],
                                    "score": 0.91,
                                    "content": "\\mathbf{dV}_{1},\\dots,\\mathbf{dV}_{T_{c}}",
                                    "type": "inline_equation",
                                    "height": 10,
                                    "width": 62
                                },
                                {
                                    "bbox": [
                                        370,
                                        291,
                                        405,
                                        310
                                    ],
                                    "score": 1.0,
                                    "content": ", of size",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        406,
                                        297,
                                        434,
                                        306
                                    ],
                                    "score": 0.91,
                                    "content": "B_{c}\\times d",
                                    "type": "inline_equation",
                                    "height": 9,
                                    "width": 28
                                },
                                {
                                    "bbox": [
                                        434,
                                        291,
                                        461,
                                        310
                                    ],
                                    "score": 1.0,
                                    "content": "each.",
                                    "type": "text"
                                }
                            ],
                            "index": 15,
                            "is_list_end_line": true
                        },
                        {
                            "bbox": [
                                76,
                                307,
                                541,
                                319
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        76,
                                        307,
                                        131,
                                        319
                                    ],
                                    "score": 1.0,
                                    "content": "4: Compute ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        131,
                                        307,
                                        246,
                                        318
                                    ],
                                    "score": 0.85,
                                    "content": "D=\\operatorname{rowsum}(\\mathbf{dO}\\circ\\mathbf{O})\\in\\mathbb{R}^{d}",
                                    "type": "inline_equation",
                                    "height": 11,
                                    "width": 115
                                },
                                {
                                    "bbox": [
                                        246,
                                        307,
                                        369,
                                        319
                                    ],
                                    "score": 1.0,
                                    "content": "(pointwise multiply), write ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        369,
                                        309,
                                        378,
                                        316
                                    ],
                                    "score": 0.89,
                                    "content": "D",
                                    "type": "inline_equation",
                                    "height": 7,
                                    "width": 9
                                },
                                {
                                    "bbox": [
                                        378,
                                        307,
                                        499,
                                        319
                                    ],
                                    "score": 1.0,
                                    "content": "to HBM and divide it into ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        500,
                                        309,
                                        509,
                                        318
                                    ],
                                    "score": 0.9,
                                    "content": "T_{r}",
                                    "type": "inline_equation",
                                    "height": 9,
                                    "width": 9
                                },
                                {
                                    "bbox": [
                                        509,
                                        307,
                                        541,
                                        319
                                    ],
                                    "score": 1.0,
                                    "content": "blocks",
                                    "type": "text"
                                }
                            ],
                            "index": 16,
                            "is_list_start_line": true
                        },
                        {
                            "bbox": [
                                88,
                                319,
                                210,
                                331
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        88,
                                        321,
                                        138,
                                        331
                                    ],
                                    "score": 0.9,
                                    "content": "D_{1},\\ldots,D_{T_{r}}",
                                    "type": "inline_equation",
                                    "height": 10,
                                    "width": 50
                                },
                                {
                                    "bbox": [
                                        139,
                                        319,
                                        172,
                                        331
                                    ],
                                    "score": 1.0,
                                    "content": "of size ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        172,
                                        321,
                                        183,
                                        330
                                    ],
                                    "score": 0.89,
                                    "content": "B_{r}",
                                    "type": "inline_equation",
                                    "height": 9,
                                    "width": 11
                                },
                                {
                                    "bbox": [
                                        184,
                                        319,
                                        210,
                                        331
                                    ],
                                    "score": 1.0,
                                    "content": "each.",
                                    "type": "text"
                                }
                            ],
                            "index": 17,
                            "is_list_end_line": true
                        },
                        {
                            "bbox": [
                                75,
                                331,
                                167,
                                343
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        75,
                                        331,
                                        105,
                                        343
                                    ],
                                    "score": 1.0,
                                    "content": "5: for ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        105,
                                        333,
                                        149,
                                        342
                                    ],
                                    "score": 0.9,
                                    "content": "1\\leq j\\leq T_{c}",
                                    "type": "inline_equation",
                                    "height": 9,
                                    "width": 44
                                },
                                {
                                    "bbox": [
                                        150,
                                        331,
                                        167,
                                        343
                                    ],
                                    "score": 1.0,
                                    "content": "do",
                                    "type": "text"
                                }
                            ],
                            "index": 18,
                            "is_list_start_line": true,
                            "is_list_end_line": true
                        },
                        {
                            "bbox": [
                                75,
                                342,
                                287,
                                356
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        75,
                                        343,
                                        86,
                                        354
                                    ],
                                    "score": 1.0,
                                    "content": "6:",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        96,
                                        342,
                                        123,
                                        356
                                    ],
                                    "score": 1.0,
                                    "content": "Load ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        123,
                                        344,
                                        151,
                                        355
                                    ],
                                    "score": 0.87,
                                    "content": "\\mathbf{K}_{j},\\mathbf{V}_{j}",
                                    "type": "inline_equation",
                                    "height": 11,
                                    "width": 28
                                },
                                {
                                    "bbox": [
                                        152,
                                        342,
                                        287,
                                        356
                                    ],
                                    "score": 1.0,
                                    "content": "from HBM to on-chip SRAM.",
                                    "type": "text"
                                }
                            ],
                            "index": 19,
                            "is_list_start_line": true,
                            "is_list_end_line": true
                        },
                        {
                            "bbox": [
                                75,
                                353,
                                318,
                                368
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        75,
                                        355,
                                        86,
                                        366
                                    ],
                                    "score": 1.0,
                                    "content": "7:",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        96,
                                        353,
                                        138,
                                        368
                                    ],
                                    "score": 1.0,
                                    "content": "Initialize",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        139,
                                        356,
                                        267,
                                        367
                                    ],
                                    "score": 0.88,
                                    "content": "{\\bf d}{\\bf K}_{j}=(0)_{B_{c}\\times d},{\\bf d}{\\bf V}_{j}=(0)_{B_{c}\\times d}",
                                    "type": "inline_equation",
                                    "height": 11,
                                    "width": 128
                                },
                                {
                                    "bbox": [
                                        268,
                                        353,
                                        318,
                                        368
                                    ],
                                    "score": 1.0,
                                    "content": "on SRAM.",
                                    "type": "text"
                                }
                            ],
                            "index": 20,
                            "is_list_start_line": true,
                            "is_list_end_line": true
                        },
                        {
                            "bbox": [
                                75,
                                367,
                                175,
                                378
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        75,
                                        367,
                                        86,
                                        378
                                    ],
                                    "score": 1.0,
                                    "content": "8:",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        97,
                                        367,
                                        115,
                                        378
                                    ],
                                    "score": 1.0,
                                    "content": "for ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        115,
                                        369,
                                        157,
                                        378
                                    ],
                                    "score": 0.91,
                                    "content": "1\\leq i\\leq T_{r}",
                                    "type": "inline_equation",
                                    "height": 9,
                                    "width": 42
                                },
                                {
                                    "bbox": [
                                        158,
                                        367,
                                        175,
                                        378
                                    ],
                                    "score": 1.0,
                                    "content": "do",
                                    "type": "text"
                                }
                            ],
                            "index": 21,
                            "is_list_start_line": true,
                            "is_list_end_line": true
                        },
                        {
                            "bbox": [
                                74,
                                378,
                                363,
                                390
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        74,
                                        379,
                                        86,
                                        390
                                    ],
                                    "score": 1.0,
                                    "content": "9:",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        107,
                                        378,
                                        133,
                                        390
                                    ],
                                    "score": 1.0,
                                    "content": "Load ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        133,
                                        380,
                                        229,
                                        390
                                    ],
                                    "score": 0.77,
                                    "content": "\\mathbf{Q}_{i},\\mathbf{O}_{i},\\mathbf{d}\\mathbf{O}_{i},\\mathbf{d}\\mathbf{Q}_{i},L_{i},D_{i}",
                                    "type": "inline_equation",
                                    "height": 10,
                                    "width": 96
                                },
                                {
                                    "bbox": [
                                        229,
                                        378,
                                        363,
                                        390
                                    ],
                                    "score": 1.0,
                                    "content": "from HBM to on-chip SRAM.",
                                    "type": "text"
                                }
                            ],
                            "index": 22,
                            "is_list_start_line": true,
                            "is_list_end_line": true
                        },
                        {
                            "bbox": [
                                70,
                                389,
                                288,
                                406
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        392,
                                        86,
                                        405
                                    ],
                                    "score": 1.0,
                                    "content": "10:",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        107,
                                        389,
                                        189,
                                        406
                                    ],
                                    "score": 1.0,
                                    "content": "On chip, compute ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        189,
                                        391,
                                        283,
                                        406
                                    ],
                                    "score": 0.91,
                                    "content": "\\mathbf{S}_{i}^{(j)}=\\mathbf{Q}_{i}\\mathbf{K}_{j}^{T}\\in\\mathbb{R}^{B_{r}\\times B_{c}}",
                                    "type": "inline_equation",
                                    "height": 15,
                                    "width": 94
                                },
                                {
                                    "bbox": [
                                        283,
                                        389,
                                        288,
                                        406
                                    ],
                                    "score": 1.0,
                                    "content": ".",
                                    "type": "text"
                                }
                            ],
                            "index": 23,
                            "is_list_start_line": true,
                            "is_list_end_line": true
                        },
                        {
                            "bbox": [
                                70,
                                403,
                                321,
                                422
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        408,
                                        86,
                                        420
                                    ],
                                    "score": 1.0,
                                    "content": "11:",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        106,
                                        403,
                                        189,
                                        422
                                    ],
                                    "score": 1.0,
                                    "content": "On chip, compute ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        189,
                                        407,
                                        316,
                                        420
                                    ],
                                    "score": 0.91,
                                    "content": "\\mathbf{P}_{i}^{(j)}=\\exp(\\mathbf{S}_{i j}-L_{i})\\in\\mathbb{R}^{B_{r}\\times B_{c}}",
                                    "type": "inline_equation",
                                    "height": 13,
                                    "width": 127
                                },
                                {
                                    "bbox": [
                                        317,
                                        403,
                                        321,
                                        422
                                    ],
                                    "score": 1.0,
                                    "content": ".",
                                    "type": "text"
                                }
                            ],
                            "index": 24,
                            "is_list_start_line": true,
                            "is_list_end_line": true
                        },
                        {
                            "bbox": [
                                71,
                                421,
                                339,
                                435
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        71,
                                        423,
                                        86,
                                        435
                                    ],
                                    "score": 1.0,
                                    "content": "12:",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        106,
                                        421,
                                        189,
                                        435
                                    ],
                                    "score": 1.0,
                                    "content": "On chip, compute ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        189,
                                        421,
                                        336,
                                        435
                                    ],
                                    "score": 0.87,
                                    "content": "\\mathbf{d}\\mathbf{V}_{j}\\leftarrow\\mathbf{d}\\mathbf{V}_{j}+(\\mathbf{P}_{i}^{(j)})^{\\top}\\mathbf{d}\\mathbf{0}_{i}\\in\\mathbb{R}^{B_{c}\\times d}",
                                    "type": "inline_equation",
                                    "height": 14,
                                    "width": 147
                                },
                                {
                                    "bbox": [
                                        337,
                                        421,
                                        339,
                                        435
                                    ],
                                    "score": 1.0,
                                    "content": ".",
                                    "type": "text"
                                }
                            ],
                            "index": 25,
                            "is_list_start_line": true,
                            "is_list_end_line": true
                        },
                        {
                            "bbox": [
                                72,
                                433,
                                302,
                                452
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        72,
                                        436,
                                        87,
                                        450
                                    ],
                                    "score": 1.0,
                                    "content": "13:",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        106,
                                        433,
                                        189,
                                        452
                                    ],
                                    "score": 1.0,
                                    "content": "On chip, compute ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        189,
                                        436,
                                        296,
                                        451
                                    ],
                                    "score": 0.9,
                                    "content": "\\mathbf{dP}_{i}^{(j)}=\\mathbf{dO}_{i}\\mathbf{V}_{j}^{\\top}\\in\\mathbb{R}^{B_{r}\\times B_{c}}",
                                    "type": "inline_equation",
                                    "height": 15,
                                    "width": 107
                                },
                                {
                                    "bbox": [
                                        296,
                                        433,
                                        302,
                                        452
                                    ],
                                    "score": 1.0,
                                    "content": ".",
                                    "type": "text"
                                }
                            ],
                            "index": 26,
                            "is_list_start_line": true,
                            "is_list_end_line": true
                        },
                        {
                            "bbox": [
                                71,
                                450,
                                349,
                                466
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        71,
                                        452,
                                        87,
                                        466
                                    ],
                                    "score": 1.0,
                                    "content": "14:",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        106,
                                        450,
                                        189,
                                        465
                                    ],
                                    "score": 1.0,
                                    "content": "On chip, compute ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        189,
                                        451,
                                        347,
                                        466
                                    ],
                                    "score": 0.92,
                                    "content": "\\mathbf{dS}_{i}^{(j)}=\\mathbf{P}_{i}^{(j)}\\circ(\\mathbf{dP}_{i}^{(j)}-D_{i})\\in\\mathbb{R}^{B_{r}\\times B_{c}}",
                                    "type": "inline_equation",
                                    "height": 15,
                                    "width": 158
                                },
                                {
                                    "bbox": [
                                        347,
                                        450,
                                        349,
                                        465
                                    ],
                                    "score": 1.0,
                                    "content": ".",
                                    "type": "text"
                                }
                            ],
                            "index": 27,
                            "is_list_start_line": true,
                            "is_list_end_line": true
                        },
                        {
                            "bbox": [
                                70,
                                465,
                                542,
                                480
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        468,
                                        86,
                                        480
                                    ],
                                    "score": 1.0,
                                    "content": "15:",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        105,
                                        466,
                                        132,
                                        480
                                    ],
                                    "score": 1.0,
                                    "content": "Load ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        132,
                                        470,
                                        149,
                                        479
                                    ],
                                    "score": 0.79,
                                    "content": "{\\bf d}{\\bf Q}_{i}",
                                    "type": "inline_equation",
                                    "height": 9,
                                    "width": 17
                                },
                                {
                                    "bbox": [
                                        149,
                                        466,
                                        340,
                                        480
                                    ],
                                    "score": 1.0,
                                    "content": "from HBM to SRAM, then on chip, update ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        340,
                                        465,
                                        470,
                                        480
                                    ],
                                    "score": 0.94,
                                    "content": "\\mathbf{d}\\mathbf{Q}_{i}\\leftarrow\\mathbf{d}\\mathbf{Q}_{i}+\\mathbf{d}\\mathbf{S}_{i}^{(j)}\\mathbf{K}_{j}\\in\\mathbb{R}^{B_{r}\\times d}",
                                    "type": "inline_equation",
                                    "height": 15,
                                    "width": 130
                                },
                                {
                                    "bbox": [
                                        470,
                                        466,
                                        542,
                                        480
                                    ],
                                    "score": 1.0,
                                    "content": ", and write back",
                                    "type": "text"
                                }
                            ],
                            "index": 28,
                            "is_list_start_line": true
                        },
                        {
                            "bbox": [
                                108,
                                480,
                                149,
                                491
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        108,
                                        480,
                                        149,
                                        491
                                    ],
                                    "score": 1.0,
                                    "content": "to HBM.",
                                    "type": "text"
                                }
                            ],
                            "index": 29,
                            "is_list_end_line": true
                        },
                        {
                            "bbox": [
                                70,
                                488,
                                328,
                                505
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        492,
                                        86,
                                        504
                                    ],
                                    "score": 1.0,
                                    "content": "16:",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        105,
                                        488,
                                        189,
                                        505
                                    ],
                                    "score": 1.0,
                                    "content": "On chip, compute ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        189,
                                        488,
                                        328,
                                        504
                                    ],
                                    "score": 0.91,
                                    "content": "\\mathbf{d}\\mathbf{K}_{j}\\gets\\mathbf{d}\\mathbf{K}_{j}+\\mathbf{d}\\mathbf{S}_{i}^{(j)^{\\top}}\\mathbf{Q}_{i}\\in\\mathbb{R}^{B_{c}\\times d}.",
                                    "type": "inline_equation",
                                    "height": 16,
                                    "width": 139
                                }
                            ],
                            "index": 30,
                            "is_list_start_line": true,
                            "is_list_end_line": true
                        },
                        {
                            "bbox": [
                                71,
                                502,
                                137,
                                516
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        71,
                                        504,
                                        86,
                                        516
                                    ],
                                    "score": 1.0,
                                    "content": "17:",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        98,
                                        502,
                                        137,
                                        516
                                    ],
                                    "score": 1.0,
                                    "content": "end for",
                                    "type": "text"
                                }
                            ],
                            "index": 31,
                            "is_list_start_line": true,
                            "is_list_end_line": true
                        },
                        {
                            "bbox": [
                                70,
                                515,
                                209,
                                528
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        516,
                                        86,
                                        528
                                    ],
                                    "score": 1.0,
                                    "content": "18:",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        97,
                                        515,
                                        125,
                                        528
                                    ],
                                    "score": 1.0,
                                    "content": "Write ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        125,
                                        515,
                                        166,
                                        528
                                    ],
                                    "score": 0.37,
                                    "content": "\\mathbf{dK}_{j},\\mathbf{dV}_{j}",
                                    "type": "inline_equation",
                                    "height": 13,
                                    "width": 41
                                },
                                {
                                    "bbox": [
                                        166,
                                        515,
                                        209,
                                        528
                                    ],
                                    "score": 1.0,
                                    "content": "to HBM.",
                                    "type": "text"
                                }
                            ],
                            "index": 32,
                            "is_list_start_line": true,
                            "is_list_end_line": true
                        },
                        {
                            "bbox": [
                                71,
                                527,
                                125,
                                538
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        71,
                                        527,
                                        125,
                                        538
                                    ],
                                    "score": 1.0,
                                    "content": "19: end for",
                                    "type": "text"
                                }
                            ],
                            "index": 33,
                            "is_list_start_line": true,
                            "is_list_end_line": true
                        },
                        {
                            "bbox": [
                                70,
                                539,
                                176,
                                551
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        539,
                                        176,
                                        551
                                    ],
                                    "score": 1.0,
                                    "content": "20: Return dQ, dK, dV.",
                                    "type": "text"
                                }
                            ],
                            "index": 34,
                            "is_list_start_line": true,
                            "is_list_end_line": true
                        }
                    ],
                    "index": 21.5,
                    "page_num": "page_6",
                    "page_size": [
                        612.0,
                        792.0
                    ],
                    "bbox_fs": [
                        70,
                        215,
                        542,
                        551
                    ]
                },
                {
                    "type": "text",
                    "bbox": [
                        70,
                        581,
                        541,
                        653
                    ],
                    "lines": [
                        {
                            "bbox": [
                                70,
                                582,
                                542,
                                594
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        582,
                                        542,
                                        594
                                    ],
                                    "score": 1.0,
                                    "content": "Multi-query attention and grouped-query attention. Multi-query attention (MQA) [15] and grouped-",
                                    "type": "text"
                                }
                            ],
                            "index": 35
                        },
                        {
                            "bbox": [
                                70,
                                594,
                                542,
                                605
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        594,
                                        542,
                                        605
                                    ],
                                    "score": 1.0,
                                    "content": "query attention (GQA) [1] are variants of attention where multiple heads of query attend to the same head of",
                                    "type": "text"
                                }
                            ],
                            "index": 36
                        },
                        {
                            "bbox": [
                                70,
                                606,
                                541,
                                617
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        606,
                                        541,
                                        617
                                    ],
                                    "score": 1.0,
                                    "content": "key and value, in order to reduce the size of KV cache during inference. Instead of having to duplicate the",
                                    "type": "text"
                                }
                            ],
                            "index": 37
                        },
                        {
                            "bbox": [
                                70,
                                618,
                                541,
                                630
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        618,
                                        541,
                                        630
                                    ],
                                    "score": 1.0,
                                    "content": "key and value heads for the computation, we implicitly manipulate the indices into the head to perform the",
                                    "type": "text"
                                }
                            ],
                            "index": 38
                        },
                        {
                            "bbox": [
                                70,
                                631,
                                540,
                                641
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        631,
                                        392,
                                        641
                                    ],
                                    "score": 1.0,
                                    "content": "same computation. In the backward pass, we need to sum the gradients ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        392,
                                        632,
                                        406,
                                        639
                                    ],
                                    "score": 0.33,
                                    "content": "\\mathbf{dK}",
                                    "type": "inline_equation",
                                    "height": 7,
                                    "width": 14
                                },
                                {
                                    "bbox": [
                                        406,
                                        631,
                                        540,
                                        641
                                    ],
                                    "score": 1.0,
                                    "content": " and dV across different heads",
                                    "type": "text"
                                }
                            ],
                            "index": 39
                        },
                        {
                            "bbox": [
                                70,
                                642,
                                209,
                                652
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        642,
                                        209,
                                        652
                                    ],
                                    "score": 1.0,
                                    "content": "that were implicitly duplicated.",
                                    "type": "text"
                                }
                            ],
                            "index": 40
                        }
                    ],
                    "index": 37.5,
                    "page_num": "page_6",
                    "page_size": [
                        612.0,
                        792.0
                    ],
                    "bbox_fs": [
                        70,
                        582,
                        542,
                        652
                    ]
                },
                {
                    "type": "title",
                    "bbox": [
                        72,
                        667,
                        168,
                        681
                    ],
                    "lines": [
                        {
                            "bbox": [
                                70,
                                668,
                                167,
                                680
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        668,
                                        91,
                                        680
                                    ],
                                    "score": 1.0,
                                    "content": "3.2",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        101,
                                        668,
                                        167,
                                        680
                                    ],
                                    "score": 1.0,
                                    "content": "Parallelism",
                                    "type": "text"
                                }
                            ],
                            "index": 41
                        }
                    ],
                    "index": 41,
                    "page_num": "page_6",
                    "page_size": [
                        612.0,
                        792.0
                    ]
                },
                {
                    "type": "text",
                    "bbox": [
                        71,
                        687,
                        541,
                        723
                    ],
                    "lines": [
                        {
                            "bbox": [
                                71,
                                687,
                                540,
                                698
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        71,
                                        687,
                                        540,
                                        698
                                    ],
                                    "score": 1.0,
                                    "content": "The first version of FlashAttention parallelizes over batch size and number of heads. We use 1 thread",
                                    "type": "text"
                                }
                            ],
                            "index": 42
                        },
                        {
                            "bbox": [
                                71,
                                700,
                                540,
                                711
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        71,
                                        700,
                                        371,
                                        711
                                    ],
                                    "score": 1.0,
                                    "content": "block to process one attention head, and there are overall batch size",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        371,
                                        705,
                                        375,
                                        708
                                    ],
                                    "score": 0.25,
                                    "content": "\\cdot\\cdot",
                                    "type": "inline_equation",
                                    "height": 3,
                                    "width": 4
                                },
                                {
                                    "bbox": [
                                        375,
                                        700,
                                        540,
                                        711
                                    ],
                                    "score": 1.0,
                                    "content": " number of heads thread blocks. Each",
                                    "type": "text"
                                }
                            ],
                            "index": 43
                        },
                        {
                            "bbox": [
                                71,
                                712,
                                540,
                                723
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        71,
                                        712,
                                        540,
                                        723
                                    ],
                                    "score": 1.0,
                                    "content": "thread block is scheduled to run on a streaming multiprocessor (SM), and there are 108 of these SMs on",
                                    "type": "text"
                                }
                            ],
                            "index": 44
                        },
                        {
                            "bbox": [
                                70,
                                74,
                                541,
                                86
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        74,
                                        454,
                                        86
                                    ],
                                    "score": 1.0,
                                    "content": "an A100 GPU for example. This scheduling is efficient when this number is large (say ",
                                    "type": "text",
                                    "cross_page": true
                                },
                                {
                                    "bbox": [
                                        455,
                                        76,
                                        474,
                                        84
                                    ],
                                    "score": 0.53,
                                    "content": "\\ge80",
                                    "type": "inline_equation",
                                    "height": 8,
                                    "width": 19,
                                    "cross_page": true
                                },
                                {
                                    "bbox": [
                                        474,
                                        74,
                                        541,
                                        86
                                    ],
                                    "score": 1.0,
                                    "content": "), since we can",
                                    "type": "text",
                                    "cross_page": true
                                }
                            ],
                            "index": 0
                        },
                        {
                            "bbox": [
                                70,
                                86,
                                350,
                                97
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        86,
                                        350,
                                        97
                                    ],
                                    "score": 1.0,
                                    "content": "effectively use almost all of the compute resources on the GPU.",
                                    "type": "text",
                                    "cross_page": true
                                }
                            ],
                            "index": 1
                        }
                    ],
                    "index": 43,
                    "page_num": "page_6",
                    "page_size": [
                        612.0,
                        792.0
                    ],
                    "bbox_fs": [
                        71,
                        687,
                        540,
                        723
                    ]
                }
            ]
        },
        {
            "preproc_blocks": [
                {
                    "type": "text",
                    "bbox": [
                        71,
                        73,
                        541,
                        96
                    ],
                    "lines": [
                        {
                            "bbox": [
                                70,
                                74,
                                541,
                                86
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        74,
                                        454,
                                        86
                                    ],
                                    "score": 1.0,
                                    "content": "an A100 GPU for example. This scheduling is efficient when this number is large (say ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        455,
                                        76,
                                        474,
                                        84
                                    ],
                                    "score": 0.53,
                                    "content": "\\ge80",
                                    "type": "inline_equation",
                                    "height": 8,
                                    "width": 19
                                },
                                {
                                    "bbox": [
                                        474,
                                        74,
                                        541,
                                        86
                                    ],
                                    "score": 1.0,
                                    "content": "), since we can",
                                    "type": "text"
                                }
                            ],
                            "index": 0
                        },
                        {
                            "bbox": [
                                70,
                                86,
                                350,
                                97
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        86,
                                        350,
                                        97
                                    ],
                                    "score": 1.0,
                                    "content": "effectively use almost all of the compute resources on the GPU.",
                                    "type": "text"
                                }
                            ],
                            "index": 1
                        }
                    ],
                    "index": 0.5
                },
                {
                    "type": "text",
                    "bbox": [
                        70,
                        97,
                        540,
                        133
                    ],
                    "lines": [
                        {
                            "bbox": [
                                86,
                                98,
                                540,
                                108
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        86,
                                        98,
                                        540,
                                        108
                                    ],
                                    "score": 1.0,
                                    "content": "In the case of long sequences (which usually means small batch sizes or small number of heads), to make",
                                    "type": "text"
                                }
                            ],
                            "index": 2
                        },
                        {
                            "bbox": [
                                71,
                                110,
                                541,
                                122
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        71,
                                        110,
                                        541,
                                        122
                                    ],
                                    "score": 1.0,
                                    "content": "better use of the multiprocessors on the GPU, we now additionally parallelize over the sequence length",
                                    "type": "text"
                                }
                            ],
                            "index": 3
                        },
                        {
                            "bbox": [
                                71,
                                122,
                                342,
                                134
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        71,
                                        122,
                                        342,
                                        134
                                    ],
                                    "score": 1.0,
                                    "content": "dimension. This results in significant speedup for this regime.",
                                    "type": "text"
                                }
                            ],
                            "index": 4
                        }
                    ],
                    "index": 3
                },
                {
                    "type": "text",
                    "bbox": [
                        70,
                        147,
                        540,
                        207
                    ],
                    "lines": [
                        {
                            "bbox": [
                                70,
                                147,
                                541,
                                159
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        147,
                                        541,
                                        159
                                    ],
                                    "score": 1.0,
                                    "content": "Forward pass. We see that the outer loop (over sequence length) is embarrassingly parallel, and we",
                                    "type": "text"
                                }
                            ],
                            "index": 5
                        },
                        {
                            "bbox": [
                                71,
                                160,
                                540,
                                170
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        71,
                                        160,
                                        540,
                                        170
                                    ],
                                    "score": 1.0,
                                    "content": "schedule them on different thread blocks that do not need to communicate with each other. We also parallelize",
                                    "type": "text"
                                }
                            ],
                            "index": 6
                        },
                        {
                            "bbox": [
                                72,
                                173,
                                540,
                                182
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        72,
                                        173,
                                        540,
                                        182
                                    ],
                                    "score": 1.0,
                                    "content": "over the batch dimension and number of heads dimension, as done in FlashAttention. The increased",
                                    "type": "text"
                                }
                            ],
                            "index": 7
                        },
                        {
                            "bbox": [
                                70,
                                183,
                                541,
                                195
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        183,
                                        541,
                                        195
                                    ],
                                    "score": 1.0,
                                    "content": "parallelism over sequence length helps improve occupancy (fraction of GPU resources being used) when the",
                                    "type": "text"
                                }
                            ],
                            "index": 8
                        },
                        {
                            "bbox": [
                                70,
                                196,
                                396,
                                207
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        196,
                                        396,
                                        207
                                    ],
                                    "score": 1.0,
                                    "content": "batch size and number of heads are small, leading to speedup in this case.",
                                    "type": "text"
                                }
                            ],
                            "index": 9
                        }
                    ],
                    "index": 7
                },
                {
                    "type": "text",
                    "bbox": [
                        71,
                        207,
                        540,
                        254
                    ],
                    "lines": [
                        {
                            "bbox": [
                                85,
                                206,
                                541,
                                219
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        85,
                                        206,
                                        541,
                                        219
                                    ],
                                    "score": 1.0,
                                    "content": "These ideas of swapping the order of the loop (outer loop over row blocks and inner loop over column",
                                    "type": "text"
                                }
                            ],
                            "index": 10
                        },
                        {
                            "bbox": [
                                71,
                                219,
                                540,
                                230
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        71,
                                        219,
                                        540,
                                        230
                                    ],
                                    "score": 1.0,
                                    "content": "blocks, instead of the other way round in the original FlashAttention paper), as well as parallelizing",
                                    "type": "text"
                                }
                            ],
                            "index": 11
                        },
                        {
                            "bbox": [
                                71,
                                231,
                                540,
                                243
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        71,
                                        231,
                                        540,
                                        243
                                    ],
                                    "score": 1.0,
                                    "content": "over the sequence length dimension were first suggested and implemented by Phil Tillet in the Triton [17]",
                                    "type": "text"
                                }
                            ],
                            "index": 12
                        },
                        {
                            "bbox": [
                                69,
                                243,
                                149,
                                254
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        69,
                                        243,
                                        149,
                                        254
                                    ],
                                    "score": 1.0,
                                    "content": "implementation.3",
                                    "type": "text"
                                }
                            ],
                            "index": 13
                        }
                    ],
                    "index": 11.5
                },
                {
                    "type": "text",
                    "bbox": [
                        70,
                        268,
                        542,
                        329
                    ],
                    "lines": [
                        {
                            "bbox": [
                                70,
                                268,
                                541,
                                281
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        268,
                                        541,
                                        281
                                    ],
                                    "score": 1.0,
                                    "content": "Backward pass. Notice that the only shared computation between different column blocks is in update dQ",
                                    "type": "text"
                                }
                            ],
                            "index": 14
                        },
                        {
                            "bbox": [
                                69,
                                281,
                                542,
                                295
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        69,
                                        281,
                                        238,
                                        295
                                    ],
                                    "score": 1.0,
                                    "content": "in Algorithm 2, where we need to load ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        239,
                                        284,
                                        254,
                                        294
                                    ],
                                    "score": 0.77,
                                    "content": "\\mathbf{d}\\mathbf{Q}_{i}",
                                    "type": "inline_equation",
                                    "height": 10,
                                    "width": 15
                                },
                                {
                                    "bbox": [
                                        255,
                                        281,
                                        446,
                                        295
                                    ],
                                    "score": 1.0,
                                    "content": "from HBM to SRAM, then on chip, update ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        446,
                                        281,
                                        538,
                                        295
                                    ],
                                    "score": 0.92,
                                    "content": "\\mathbf{dQ}_{i}\\leftarrow\\mathbf{dQ}_{i}+\\mathbf{dS}_{i}^{(j)}\\mathbf{K}_{j}",
                                    "type": "inline_equation",
                                    "height": 14,
                                    "width": 92
                                },
                                {
                                    "bbox": [
                                        538,
                                        281,
                                        542,
                                        295
                                    ],
                                    "score": 1.0,
                                    "content": ",",
                                    "type": "text"
                                }
                            ],
                            "index": 15
                        },
                        {
                            "bbox": [
                                69,
                                293,
                                542,
                                307
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        69,
                                        293,
                                        542,
                                        307
                                    ],
                                    "score": 1.0,
                                    "content": "and write back to HBM. We thus parallelize over the sequence length dimension as well, and schedule 1",
                                    "type": "text"
                                }
                            ],
                            "index": 16
                        },
                        {
                            "bbox": [
                                71,
                                307,
                                541,
                                317
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        71,
                                        307,
                                        541,
                                        317
                                    ],
                                    "score": 1.0,
                                    "content": "thread block for each column block of the backward pass. We use atomic adds to communicate between",
                                    "type": "text"
                                }
                            ],
                            "index": 17
                        },
                        {
                            "bbox": [
                                70,
                                317,
                                234,
                                330
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        317,
                                        234,
                                        330
                                    ],
                                    "score": 1.0,
                                    "content": "different thread blocks to update dQ.",
                                    "type": "text"
                                }
                            ],
                            "index": 18
                        }
                    ],
                    "index": 16
                },
                {
                    "type": "text",
                    "bbox": [
                        88,
                        330,
                        297,
                        342
                    ],
                    "lines": [
                        {
                            "bbox": [
                                87,
                                330,
                                297,
                                341
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        87,
                                        330,
                                        297,
                                        341
                                    ],
                                    "score": 1.0,
                                    "content": "We describe the parallelization scheme in Fig. 2.",
                                    "type": "text"
                                }
                            ],
                            "index": 19
                        }
                    ],
                    "index": 19
                },
                {
                    "type": "title",
                    "bbox": [
                        103,
                        357,
                        216,
                        377
                    ],
                    "lines": [
                        {
                            "bbox": [
                                102,
                                357,
                                216,
                                377
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        102,
                                        357,
                                        216,
                                        377
                                    ],
                                    "score": 1.0,
                                    "content": "Forward pass",
                                    "type": "text"
                                }
                            ],
                            "index": 20
                        }
                    ],
                    "index": 20
                },
                {
                    "type": "title",
                    "bbox": [
                        361,
                        357,
                        488,
                        377
                    ],
                    "lines": [
                        {
                            "bbox": [
                                362,
                                358,
                                487,
                                376
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        362,
                                        358,
                                        487,
                                        376
                                    ],
                                    "score": 1.0,
                                    "content": "Backward pass",
                                    "type": "text"
                                }
                            ],
                            "index": 21
                        }
                    ],
                    "index": 21
                },
                {
                    "type": "table",
                    "bbox": [
                        95,
                        395,
                        303,
                        531
                    ],
                    "blocks": [
                        {
                            "type": "table_body",
                            "bbox": [
                                95,
                                395,
                                303,
                                531
                            ],
                            "group_id": 0,
                            "lines": [
                                {
                                    "bbox": [
                                        95,
                                        395,
                                        303,
                                        531
                                    ],
                                    "spans": [
                                        {
                                            "bbox": [
                                                95,
                                                395,
                                                303,
                                                531
                                            ],
                                            "score": 0.52,
                                            "type": "table",
                                            "image_path": "82358ab5d81a6f34c78b995b42ff4b602988037e8402b9db39e018b6d73d44ba.jpg"
                                        }
                                    ]
                                }
                            ],
                            "index": 27,
                            "virtual_lines": [
                                {
                                    "bbox": [
                                        95,
                                        395,
                                        303,
                                        407.3636363636364
                                    ],
                                    "spans": [],
                                    "index": 22
                                },
                                {
                                    "bbox": [
                                        95,
                                        407.3636363636364,
                                        303,
                                        419.72727272727275
                                    ],
                                    "spans": [],
                                    "index": 23
                                },
                                {
                                    "bbox": [
                                        95,
                                        419.72727272727275,
                                        303,
                                        432.0909090909091
                                    ],
                                    "spans": [],
                                    "index": 24
                                },
                                {
                                    "bbox": [
                                        95,
                                        432.0909090909091,
                                        303,
                                        444.4545454545455
                                    ],
                                    "spans": [],
                                    "index": 25
                                },
                                {
                                    "bbox": [
                                        95,
                                        444.4545454545455,
                                        303,
                                        456.81818181818187
                                    ],
                                    "spans": [],
                                    "index": 26
                                },
                                {
                                    "bbox": [
                                        95,
                                        456.81818181818187,
                                        303,
                                        469.18181818181824
                                    ],
                                    "spans": [],
                                    "index": 27
                                },
                                {
                                    "bbox": [
                                        95,
                                        469.18181818181824,
                                        303,
                                        481.5454545454546
                                    ],
                                    "spans": [],
                                    "index": 28
                                },
                                {
                                    "bbox": [
                                        95,
                                        481.5454545454546,
                                        303,
                                        493.909090909091
                                    ],
                                    "spans": [],
                                    "index": 29
                                },
                                {
                                    "bbox": [
                                        95,
                                        493.909090909091,
                                        303,
                                        506.27272727272737
                                    ],
                                    "spans": [],
                                    "index": 30
                                },
                                {
                                    "bbox": [
                                        95,
                                        506.27272727272737,
                                        303,
                                        518.6363636363637
                                    ],
                                    "spans": [],
                                    "index": 31
                                },
                                {
                                    "bbox": [
                                        95,
                                        518.6363636363637,
                                        303,
                                        531.0000000000001
                                    ],
                                    "spans": [],
                                    "index": 32
                                }
                            ]
                        }
                    ],
                    "index": 27
                },
                {
                    "type": "image",
                    "bbox": [
                        354,
                        394,
                        526,
                        590
                    ],
                    "blocks": [
                        {
                            "type": "image_body",
                            "bbox": [
                                354,
                                394,
                                526,
                                590
                            ],
                            "group_id": 0,
                            "lines": [
                                {
                                    "bbox": [
                                        354,
                                        394,
                                        526,
                                        590
                                    ],
                                    "spans": [
                                        {
                                            "bbox": [
                                                354,
                                                394,
                                                526,
                                                590
                                            ],
                                            "score": 0.888,
                                            "type": "image",
                                            "image_path": "c03c4cb27f1b6ed85a37b4e9dcab82be68e768083352e4c92c6ac790fa4360c0.jpg"
                                        }
                                    ]
                                }
                            ],
                            "index": 40.5,
                            "virtual_lines": [
                                {
                                    "bbox": [
                                        354,
                                        394,
                                        526,
                                        406.25
                                    ],
                                    "spans": [],
                                    "index": 33
                                },
                                {
                                    "bbox": [
                                        354,
                                        406.25,
                                        526,
                                        418.5
                                    ],
                                    "spans": [],
                                    "index": 34
                                },
                                {
                                    "bbox": [
                                        354,
                                        418.5,
                                        526,
                                        430.75
                                    ],
                                    "spans": [],
                                    "index": 35
                                },
                                {
                                    "bbox": [
                                        354,
                                        430.75,
                                        526,
                                        443.0
                                    ],
                                    "spans": [],
                                    "index": 36
                                },
                                {
                                    "bbox": [
                                        354,
                                        443.0,
                                        526,
                                        455.25
                                    ],
                                    "spans": [],
                                    "index": 37
                                },
                                {
                                    "bbox": [
                                        354,
                                        455.25,
                                        526,
                                        467.5
                                    ],
                                    "spans": [],
                                    "index": 38
                                },
                                {
                                    "bbox": [
                                        354,
                                        467.5,
                                        526,
                                        479.75
                                    ],
                                    "spans": [],
                                    "index": 39
                                },
                                {
                                    "bbox": [
                                        354,
                                        479.75,
                                        526,
                                        492.0
                                    ],
                                    "spans": [],
                                    "index": 40
                                },
                                {
                                    "bbox": [
                                        354,
                                        492.0,
                                        526,
                                        504.25
                                    ],
                                    "spans": [],
                                    "index": 41
                                },
                                {
                                    "bbox": [
                                        354,
                                        504.25,
                                        526,
                                        516.5
                                    ],
                                    "spans": [],
                                    "index": 42
                                },
                                {
                                    "bbox": [
                                        354,
                                        516.5,
                                        526,
                                        528.75
                                    ],
                                    "spans": [],
                                    "index": 43
                                },
                                {
                                    "bbox": [
                                        354,
                                        528.75,
                                        526,
                                        541.0
                                    ],
                                    "spans": [],
                                    "index": 44
                                },
                                {
                                    "bbox": [
                                        354,
                                        541.0,
                                        526,
                                        553.25
                                    ],
                                    "spans": [],
                                    "index": 45
                                },
                                {
                                    "bbox": [
                                        354,
                                        553.25,
                                        526,
                                        565.5
                                    ],
                                    "spans": [],
                                    "index": 46
                                },
                                {
                                    "bbox": [
                                        354,
                                        565.5,
                                        526,
                                        577.75
                                    ],
                                    "spans": [],
                                    "index": 47
                                },
                                {
                                    "bbox": [
                                        354,
                                        577.75,
                                        526,
                                        590.0
                                    ],
                                    "spans": [],
                                    "index": 48
                                }
                            ]
                        },
                        {
                            "type": "image_caption",
                            "bbox": [
                                70,
                                606,
                                541,
                                643
                            ],
                            "group_id": 0,
                            "lines": [
                                {
                                    "bbox": [
                                        71,
                                        608,
                                        540,
                                        619
                                    ],
                                    "spans": [
                                        {
                                            "bbox": [
                                                71,
                                                608,
                                                540,
                                                619
                                            ],
                                            "score": 1.0,
                                            "content": "Figure 2: In the forward pass (left), we parallelize the workers (thread blocks) where each worker takes care",
                                            "type": "text"
                                        }
                                    ],
                                    "index": 49
                                },
                                {
                                    "bbox": [
                                        70,
                                        619,
                                        542,
                                        632
                                    ],
                                    "spans": [
                                        {
                                            "bbox": [
                                                70,
                                                619,
                                                542,
                                                632
                                            ],
                                            "score": 1.0,
                                            "content": "of a block of rows of the attention matrix. In the backward pass (right), each worker takes care of a block of",
                                            "type": "text"
                                        }
                                    ],
                                    "index": 50
                                },
                                {
                                    "bbox": [
                                        70,
                                        631,
                                        214,
                                        642
                                    ],
                                    "spans": [
                                        {
                                            "bbox": [
                                                70,
                                                631,
                                                214,
                                                642
                                            ],
                                            "score": 1.0,
                                            "content": "columns of the attention matrix.",
                                            "type": "text"
                                        }
                                    ],
                                    "index": 51
                                }
                            ],
                            "index": 50
                        }
                    ],
                    "index": 45.25
                }
            ],
            "layout_bboxes": [],
            "page_idx": 7,
            "page_size": [
                612.0,
                792.0
            ],
            "_layout_tree": [],
            "images": [
                {
                    "type": "image",
                    "bbox": [
                        354,
                        394,
                        526,
                        590
                    ],
                    "blocks": [
                        {
                            "type": "image_body",
                            "bbox": [
                                354,
                                394,
                                526,
                                590
                            ],
                            "group_id": 0,
                            "lines": [
                                {
                                    "bbox": [
                                        354,
                                        394,
                                        526,
                                        590
                                    ],
                                    "spans": [
                                        {
                                            "bbox": [
                                                354,
                                                394,
                                                526,
                                                590
                                            ],
                                            "score": 0.888,
                                            "type": "image",
                                            "image_path": "c03c4cb27f1b6ed85a37b4e9dcab82be68e768083352e4c92c6ac790fa4360c0.jpg"
                                        }
                                    ]
                                }
                            ],
                            "index": 40.5,
                            "virtual_lines": [
                                {
                                    "bbox": [
                                        354,
                                        394,
                                        526,
                                        406.25
                                    ],
                                    "spans": [],
                                    "index": 33
                                },
                                {
                                    "bbox": [
                                        354,
                                        406.25,
                                        526,
                                        418.5
                                    ],
                                    "spans": [],
                                    "index": 34
                                },
                                {
                                    "bbox": [
                                        354,
                                        418.5,
                                        526,
                                        430.75
                                    ],
                                    "spans": [],
                                    "index": 35
                                },
                                {
                                    "bbox": [
                                        354,
                                        430.75,
                                        526,
                                        443.0
                                    ],
                                    "spans": [],
                                    "index": 36
                                },
                                {
                                    "bbox": [
                                        354,
                                        443.0,
                                        526,
                                        455.25
                                    ],
                                    "spans": [],
                                    "index": 37
                                },
                                {
                                    "bbox": [
                                        354,
                                        455.25,
                                        526,
                                        467.5
                                    ],
                                    "spans": [],
                                    "index": 38
                                },
                                {
                                    "bbox": [
                                        354,
                                        467.5,
                                        526,
                                        479.75
                                    ],
                                    "spans": [],
                                    "index": 39
                                },
                                {
                                    "bbox": [
                                        354,
                                        479.75,
                                        526,
                                        492.0
                                    ],
                                    "spans": [],
                                    "index": 40
                                },
                                {
                                    "bbox": [
                                        354,
                                        492.0,
                                        526,
                                        504.25
                                    ],
                                    "spans": [],
                                    "index": 41
                                },
                                {
                                    "bbox": [
                                        354,
                                        504.25,
                                        526,
                                        516.5
                                    ],
                                    "spans": [],
                                    "index": 42
                                },
                                {
                                    "bbox": [
                                        354,
                                        516.5,
                                        526,
                                        528.75
                                    ],
                                    "spans": [],
                                    "index": 43
                                },
                                {
                                    "bbox": [
                                        354,
                                        528.75,
                                        526,
                                        541.0
                                    ],
                                    "spans": [],
                                    "index": 44
                                },
                                {
                                    "bbox": [
                                        354,
                                        541.0,
                                        526,
                                        553.25
                                    ],
                                    "spans": [],
                                    "index": 45
                                },
                                {
                                    "bbox": [
                                        354,
                                        553.25,
                                        526,
                                        565.5
                                    ],
                                    "spans": [],
                                    "index": 46
                                },
                                {
                                    "bbox": [
                                        354,
                                        565.5,
                                        526,
                                        577.75
                                    ],
                                    "spans": [],
                                    "index": 47
                                },
                                {
                                    "bbox": [
                                        354,
                                        577.75,
                                        526,
                                        590.0
                                    ],
                                    "spans": [],
                                    "index": 48
                                }
                            ]
                        },
                        {
                            "type": "image_caption",
                            "bbox": [
                                70,
                                606,
                                541,
                                643
                            ],
                            "group_id": 0,
                            "lines": [
                                {
                                    "bbox": [
                                        71,
                                        608,
                                        540,
                                        619
                                    ],
                                    "spans": [
                                        {
                                            "bbox": [
                                                71,
                                                608,
                                                540,
                                                619
                                            ],
                                            "score": 1.0,
                                            "content": "Figure 2: In the forward pass (left), we parallelize the workers (thread blocks) where each worker takes care",
                                            "type": "text"
                                        }
                                    ],
                                    "index": 49
                                },
                                {
                                    "bbox": [
                                        70,
                                        619,
                                        542,
                                        632
                                    ],
                                    "spans": [
                                        {
                                            "bbox": [
                                                70,
                                                619,
                                                542,
                                                632
                                            ],
                                            "score": 1.0,
                                            "content": "of a block of rows of the attention matrix. In the backward pass (right), each worker takes care of a block of",
                                            "type": "text"
                                        }
                                    ],
                                    "index": 50
                                },
                                {
                                    "bbox": [
                                        70,
                                        631,
                                        214,
                                        642
                                    ],
                                    "spans": [
                                        {
                                            "bbox": [
                                                70,
                                                631,
                                                214,
                                                642
                                            ],
                                            "score": 1.0,
                                            "content": "columns of the attention matrix.",
                                            "type": "text"
                                        }
                                    ],
                                    "index": 51
                                }
                            ],
                            "index": 50
                        }
                    ],
                    "index": 45.25
                }
            ],
            "tables": [
                {
                    "type": "table",
                    "bbox": [
                        95,
                        395,
                        303,
                        531
                    ],
                    "blocks": [
                        {
                            "type": "table_body",
                            "bbox": [
                                95,
                                395,
                                303,
                                531
                            ],
                            "group_id": 0,
                            "lines": [
                                {
                                    "bbox": [
                                        95,
                                        395,
                                        303,
                                        531
                                    ],
                                    "spans": [
                                        {
                                            "bbox": [
                                                95,
                                                395,
                                                303,
                                                531
                                            ],
                                            "score": 0.52,
                                            "type": "table",
                                            "image_path": "82358ab5d81a6f34c78b995b42ff4b602988037e8402b9db39e018b6d73d44ba.jpg"
                                        }
                                    ]
                                }
                            ],
                            "index": 27,
                            "virtual_lines": [
                                {
                                    "bbox": [
                                        95,
                                        395,
                                        303,
                                        407.3636363636364
                                    ],
                                    "spans": [],
                                    "index": 22
                                },
                                {
                                    "bbox": [
                                        95,
                                        407.3636363636364,
                                        303,
                                        419.72727272727275
                                    ],
                                    "spans": [],
                                    "index": 23
                                },
                                {
                                    "bbox": [
                                        95,
                                        419.72727272727275,
                                        303,
                                        432.0909090909091
                                    ],
                                    "spans": [],
                                    "index": 24
                                },
                                {
                                    "bbox": [
                                        95,
                                        432.0909090909091,
                                        303,
                                        444.4545454545455
                                    ],
                                    "spans": [],
                                    "index": 25
                                },
                                {
                                    "bbox": [
                                        95,
                                        444.4545454545455,
                                        303,
                                        456.81818181818187
                                    ],
                                    "spans": [],
                                    "index": 26
                                },
                                {
                                    "bbox": [
                                        95,
                                        456.81818181818187,
                                        303,
                                        469.18181818181824
                                    ],
                                    "spans": [],
                                    "index": 27
                                },
                                {
                                    "bbox": [
                                        95,
                                        469.18181818181824,
                                        303,
                                        481.5454545454546
                                    ],
                                    "spans": [],
                                    "index": 28
                                },
                                {
                                    "bbox": [
                                        95,
                                        481.5454545454546,
                                        303,
                                        493.909090909091
                                    ],
                                    "spans": [],
                                    "index": 29
                                },
                                {
                                    "bbox": [
                                        95,
                                        493.909090909091,
                                        303,
                                        506.27272727272737
                                    ],
                                    "spans": [],
                                    "index": 30
                                },
                                {
                                    "bbox": [
                                        95,
                                        506.27272727272737,
                                        303,
                                        518.6363636363637
                                    ],
                                    "spans": [],
                                    "index": 31
                                },
                                {
                                    "bbox": [
                                        95,
                                        518.6363636363637,
                                        303,
                                        531.0000000000001
                                    ],
                                    "spans": [],
                                    "index": 32
                                }
                            ]
                        }
                    ],
                    "index": 27
                }
            ],
            "interline_equations": [],
            "discarded_blocks": [
                {
                    "type": "discarded",
                    "bbox": [
                        77,
                        664,
                        432,
                        674
                    ],
                    "lines": [
                        {
                            "bbox": [
                                81,
                                663,
                                432,
                                675
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        81,
                                        663,
                                        432,
                                        675
                                    ],
                                    "score": 1.0,
                                    "content": "3https://github.com/openai/triton/blob/main/python/tutorials/06-fused-attention.py",
                                    "type": "text"
                                }
                            ]
                        }
                    ]
                },
                {
                    "type": "discarded",
                    "bbox": [
                        302,
                        742,
                        309,
                        751
                    ],
                    "lines": [
                        {
                            "bbox": [
                                301,
                                741,
                                310,
                                753
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        301,
                                        741,
                                        310,
                                        753
                                    ],
                                    "score": 1.0,
                                    "content": "8",
                                    "type": "text"
                                }
                            ]
                        }
                    ]
                }
            ],
            "need_drop": false,
            "drop_reason": [],
            "para_blocks": [
                {
                    "type": "text",
                    "bbox": [
                        71,
                        73,
                        541,
                        96
                    ],
                    "lines": [],
                    "index": 0.5,
                    "page_num": "page_7",
                    "page_size": [
                        612.0,
                        792.0
                    ],
                    "bbox_fs": [
                        70,
                        74,
                        541,
                        97
                    ],
                    "lines_deleted": true
                },
                {
                    "type": "text",
                    "bbox": [
                        70,
                        97,
                        540,
                        133
                    ],
                    "lines": [
                        {
                            "bbox": [
                                86,
                                98,
                                540,
                                108
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        86,
                                        98,
                                        540,
                                        108
                                    ],
                                    "score": 1.0,
                                    "content": "In the case of long sequences (which usually means small batch sizes or small number of heads), to make",
                                    "type": "text"
                                }
                            ],
                            "index": 2
                        },
                        {
                            "bbox": [
                                71,
                                110,
                                541,
                                122
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        71,
                                        110,
                                        541,
                                        122
                                    ],
                                    "score": 1.0,
                                    "content": "better use of the multiprocessors on the GPU, we now additionally parallelize over the sequence length",
                                    "type": "text"
                                }
                            ],
                            "index": 3
                        },
                        {
                            "bbox": [
                                71,
                                122,
                                342,
                                134
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        71,
                                        122,
                                        342,
                                        134
                                    ],
                                    "score": 1.0,
                                    "content": "dimension. This results in significant speedup for this regime.",
                                    "type": "text"
                                }
                            ],
                            "index": 4
                        }
                    ],
                    "index": 3,
                    "page_num": "page_7",
                    "page_size": [
                        612.0,
                        792.0
                    ],
                    "bbox_fs": [
                        71,
                        98,
                        541,
                        134
                    ]
                },
                {
                    "type": "text",
                    "bbox": [
                        70,
                        147,
                        540,
                        207
                    ],
                    "lines": [
                        {
                            "bbox": [
                                70,
                                147,
                                541,
                                159
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        147,
                                        541,
                                        159
                                    ],
                                    "score": 1.0,
                                    "content": "Forward pass. We see that the outer loop (over sequence length) is embarrassingly parallel, and we",
                                    "type": "text"
                                }
                            ],
                            "index": 5
                        },
                        {
                            "bbox": [
                                71,
                                160,
                                540,
                                170
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        71,
                                        160,
                                        540,
                                        170
                                    ],
                                    "score": 1.0,
                                    "content": "schedule them on different thread blocks that do not need to communicate with each other. We also parallelize",
                                    "type": "text"
                                }
                            ],
                            "index": 6
                        },
                        {
                            "bbox": [
                                72,
                                173,
                                540,
                                182
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        72,
                                        173,
                                        540,
                                        182
                                    ],
                                    "score": 1.0,
                                    "content": "over the batch dimension and number of heads dimension, as done in FlashAttention. The increased",
                                    "type": "text"
                                }
                            ],
                            "index": 7
                        },
                        {
                            "bbox": [
                                70,
                                183,
                                541,
                                195
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        183,
                                        541,
                                        195
                                    ],
                                    "score": 1.0,
                                    "content": "parallelism over sequence length helps improve occupancy (fraction of GPU resources being used) when the",
                                    "type": "text"
                                }
                            ],
                            "index": 8
                        },
                        {
                            "bbox": [
                                70,
                                196,
                                396,
                                207
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        196,
                                        396,
                                        207
                                    ],
                                    "score": 1.0,
                                    "content": "batch size and number of heads are small, leading to speedup in this case.",
                                    "type": "text"
                                }
                            ],
                            "index": 9
                        }
                    ],
                    "index": 7,
                    "page_num": "page_7",
                    "page_size": [
                        612.0,
                        792.0
                    ],
                    "bbox_fs": [
                        70,
                        147,
                        541,
                        207
                    ]
                },
                {
                    "type": "text",
                    "bbox": [
                        71,
                        207,
                        540,
                        254
                    ],
                    "lines": [
                        {
                            "bbox": [
                                85,
                                206,
                                541,
                                219
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        85,
                                        206,
                                        541,
                                        219
                                    ],
                                    "score": 1.0,
                                    "content": "These ideas of swapping the order of the loop (outer loop over row blocks and inner loop over column",
                                    "type": "text"
                                }
                            ],
                            "index": 10
                        },
                        {
                            "bbox": [
                                71,
                                219,
                                540,
                                230
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        71,
                                        219,
                                        540,
                                        230
                                    ],
                                    "score": 1.0,
                                    "content": "blocks, instead of the other way round in the original FlashAttention paper), as well as parallelizing",
                                    "type": "text"
                                }
                            ],
                            "index": 11
                        },
                        {
                            "bbox": [
                                71,
                                231,
                                540,
                                243
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        71,
                                        231,
                                        540,
                                        243
                                    ],
                                    "score": 1.0,
                                    "content": "over the sequence length dimension were first suggested and implemented by Phil Tillet in the Triton [17]",
                                    "type": "text"
                                }
                            ],
                            "index": 12
                        },
                        {
                            "bbox": [
                                69,
                                243,
                                149,
                                254
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        69,
                                        243,
                                        149,
                                        254
                                    ],
                                    "score": 1.0,
                                    "content": "implementation.3",
                                    "type": "text"
                                }
                            ],
                            "index": 13
                        }
                    ],
                    "index": 11.5,
                    "page_num": "page_7",
                    "page_size": [
                        612.0,
                        792.0
                    ],
                    "bbox_fs": [
                        69,
                        206,
                        541,
                        254
                    ]
                },
                {
                    "type": "text",
                    "bbox": [
                        70,
                        268,
                        542,
                        329
                    ],
                    "lines": [
                        {
                            "bbox": [
                                70,
                                268,
                                541,
                                281
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        268,
                                        541,
                                        281
                                    ],
                                    "score": 1.0,
                                    "content": "Backward pass. Notice that the only shared computation between different column blocks is in update dQ",
                                    "type": "text"
                                }
                            ],
                            "index": 14
                        },
                        {
                            "bbox": [
                                69,
                                281,
                                542,
                                295
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        69,
                                        281,
                                        238,
                                        295
                                    ],
                                    "score": 1.0,
                                    "content": "in Algorithm 2, where we need to load ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        239,
                                        284,
                                        254,
                                        294
                                    ],
                                    "score": 0.77,
                                    "content": "\\mathbf{d}\\mathbf{Q}_{i}",
                                    "type": "inline_equation",
                                    "height": 10,
                                    "width": 15
                                },
                                {
                                    "bbox": [
                                        255,
                                        281,
                                        446,
                                        295
                                    ],
                                    "score": 1.0,
                                    "content": "from HBM to SRAM, then on chip, update ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        446,
                                        281,
                                        538,
                                        295
                                    ],
                                    "score": 0.92,
                                    "content": "\\mathbf{dQ}_{i}\\leftarrow\\mathbf{dQ}_{i}+\\mathbf{dS}_{i}^{(j)}\\mathbf{K}_{j}",
                                    "type": "inline_equation",
                                    "height": 14,
                                    "width": 92
                                },
                                {
                                    "bbox": [
                                        538,
                                        281,
                                        542,
                                        295
                                    ],
                                    "score": 1.0,
                                    "content": ",",
                                    "type": "text"
                                }
                            ],
                            "index": 15
                        },
                        {
                            "bbox": [
                                69,
                                293,
                                542,
                                307
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        69,
                                        293,
                                        542,
                                        307
                                    ],
                                    "score": 1.0,
                                    "content": "and write back to HBM. We thus parallelize over the sequence length dimension as well, and schedule 1",
                                    "type": "text"
                                }
                            ],
                            "index": 16
                        },
                        {
                            "bbox": [
                                71,
                                307,
                                541,
                                317
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        71,
                                        307,
                                        541,
                                        317
                                    ],
                                    "score": 1.0,
                                    "content": "thread block for each column block of the backward pass. We use atomic adds to communicate between",
                                    "type": "text"
                                }
                            ],
                            "index": 17
                        },
                        {
                            "bbox": [
                                70,
                                317,
                                234,
                                330
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        317,
                                        234,
                                        330
                                    ],
                                    "score": 1.0,
                                    "content": "different thread blocks to update dQ.",
                                    "type": "text"
                                }
                            ],
                            "index": 18
                        }
                    ],
                    "index": 16,
                    "page_num": "page_7",
                    "page_size": [
                        612.0,
                        792.0
                    ],
                    "bbox_fs": [
                        69,
                        268,
                        542,
                        330
                    ]
                },
                {
                    "type": "text",
                    "bbox": [
                        88,
                        330,
                        297,
                        342
                    ],
                    "lines": [
                        {
                            "bbox": [
                                87,
                                330,
                                297,
                                341
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        87,
                                        330,
                                        297,
                                        341
                                    ],
                                    "score": 1.0,
                                    "content": "We describe the parallelization scheme in Fig. 2.",
                                    "type": "text"
                                }
                            ],
                            "index": 19
                        }
                    ],
                    "index": 19,
                    "page_num": "page_7",
                    "page_size": [
                        612.0,
                        792.0
                    ],
                    "bbox_fs": [
                        87,
                        330,
                        297,
                        341
                    ]
                },
                {
                    "type": "title",
                    "bbox": [
                        103,
                        357,
                        216,
                        377
                    ],
                    "lines": [
                        {
                            "bbox": [
                                102,
                                357,
                                216,
                                377
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        102,
                                        357,
                                        216,
                                        377
                                    ],
                                    "score": 1.0,
                                    "content": "Forward pass",
                                    "type": "text"
                                }
                            ],
                            "index": 20
                        }
                    ],
                    "index": 20,
                    "page_num": "page_7",
                    "page_size": [
                        612.0,
                        792.0
                    ]
                },
                {
                    "type": "title",
                    "bbox": [
                        361,
                        357,
                        488,
                        377
                    ],
                    "lines": [
                        {
                            "bbox": [
                                362,
                                358,
                                487,
                                376
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        362,
                                        358,
                                        487,
                                        376
                                    ],
                                    "score": 1.0,
                                    "content": "Backward pass",
                                    "type": "text"
                                }
                            ],
                            "index": 21
                        }
                    ],
                    "index": 21,
                    "page_num": "page_7",
                    "page_size": [
                        612.0,
                        792.0
                    ]
                },
                {
                    "type": "table",
                    "bbox": [
                        95,
                        395,
                        303,
                        531
                    ],
                    "blocks": [
                        {
                            "type": "table_body",
                            "bbox": [
                                95,
                                395,
                                303,
                                531
                            ],
                            "group_id": 0,
                            "lines": [
                                {
                                    "bbox": [
                                        95,
                                        395,
                                        303,
                                        531
                                    ],
                                    "spans": [
                                        {
                                            "bbox": [
                                                95,
                                                395,
                                                303,
                                                531
                                            ],
                                            "score": 0.52,
                                            "type": "table",
                                            "image_path": "82358ab5d81a6f34c78b995b42ff4b602988037e8402b9db39e018b6d73d44ba.jpg"
                                        }
                                    ]
                                }
                            ],
                            "index": 27,
                            "virtual_lines": [
                                {
                                    "bbox": [
                                        95,
                                        395,
                                        303,
                                        407.3636363636364
                                    ],
                                    "spans": [],
                                    "index": 22
                                },
                                {
                                    "bbox": [
                                        95,
                                        407.3636363636364,
                                        303,
                                        419.72727272727275
                                    ],
                                    "spans": [],
                                    "index": 23
                                },
                                {
                                    "bbox": [
                                        95,
                                        419.72727272727275,
                                        303,
                                        432.0909090909091
                                    ],
                                    "spans": [],
                                    "index": 24
                                },
                                {
                                    "bbox": [
                                        95,
                                        432.0909090909091,
                                        303,
                                        444.4545454545455
                                    ],
                                    "spans": [],
                                    "index": 25
                                },
                                {
                                    "bbox": [
                                        95,
                                        444.4545454545455,
                                        303,
                                        456.81818181818187
                                    ],
                                    "spans": [],
                                    "index": 26
                                },
                                {
                                    "bbox": [
                                        95,
                                        456.81818181818187,
                                        303,
                                        469.18181818181824
                                    ],
                                    "spans": [],
                                    "index": 27
                                },
                                {
                                    "bbox": [
                                        95,
                                        469.18181818181824,
                                        303,
                                        481.5454545454546
                                    ],
                                    "spans": [],
                                    "index": 28
                                },
                                {
                                    "bbox": [
                                        95,
                                        481.5454545454546,
                                        303,
                                        493.909090909091
                                    ],
                                    "spans": [],
                                    "index": 29
                                },
                                {
                                    "bbox": [
                                        95,
                                        493.909090909091,
                                        303,
                                        506.27272727272737
                                    ],
                                    "spans": [],
                                    "index": 30
                                },
                                {
                                    "bbox": [
                                        95,
                                        506.27272727272737,
                                        303,
                                        518.6363636363637
                                    ],
                                    "spans": [],
                                    "index": 31
                                },
                                {
                                    "bbox": [
                                        95,
                                        518.6363636363637,
                                        303,
                                        531.0000000000001
                                    ],
                                    "spans": [],
                                    "index": 32
                                }
                            ]
                        }
                    ],
                    "index": 27,
                    "page_num": "page_7",
                    "page_size": [
                        612.0,
                        792.0
                    ]
                },
                {
                    "type": "image",
                    "bbox": [
                        354,
                        394,
                        526,
                        590
                    ],
                    "blocks": [
                        {
                            "type": "image_body",
                            "bbox": [
                                354,
                                394,
                                526,
                                590
                            ],
                            "group_id": 0,
                            "lines": [
                                {
                                    "bbox": [
                                        354,
                                        394,
                                        526,
                                        590
                                    ],
                                    "spans": [
                                        {
                                            "bbox": [
                                                354,
                                                394,
                                                526,
                                                590
                                            ],
                                            "score": 0.888,
                                            "type": "image",
                                            "image_path": "c03c4cb27f1b6ed85a37b4e9dcab82be68e768083352e4c92c6ac790fa4360c0.jpg"
                                        }
                                    ]
                                }
                            ],
                            "index": 40.5,
                            "virtual_lines": [
                                {
                                    "bbox": [
                                        354,
                                        394,
                                        526,
                                        406.25
                                    ],
                                    "spans": [],
                                    "index": 33
                                },
                                {
                                    "bbox": [
                                        354,
                                        406.25,
                                        526,
                                        418.5
                                    ],
                                    "spans": [],
                                    "index": 34
                                },
                                {
                                    "bbox": [
                                        354,
                                        418.5,
                                        526,
                                        430.75
                                    ],
                                    "spans": [],
                                    "index": 35
                                },
                                {
                                    "bbox": [
                                        354,
                                        430.75,
                                        526,
                                        443.0
                                    ],
                                    "spans": [],
                                    "index": 36
                                },
                                {
                                    "bbox": [
                                        354,
                                        443.0,
                                        526,
                                        455.25
                                    ],
                                    "spans": [],
                                    "index": 37
                                },
                                {
                                    "bbox": [
                                        354,
                                        455.25,
                                        526,
                                        467.5
                                    ],
                                    "spans": [],
                                    "index": 38
                                },
                                {
                                    "bbox": [
                                        354,
                                        467.5,
                                        526,
                                        479.75
                                    ],
                                    "spans": [],
                                    "index": 39
                                },
                                {
                                    "bbox": [
                                        354,
                                        479.75,
                                        526,
                                        492.0
                                    ],
                                    "spans": [],
                                    "index": 40
                                },
                                {
                                    "bbox": [
                                        354,
                                        492.0,
                                        526,
                                        504.25
                                    ],
                                    "spans": [],
                                    "index": 41
                                },
                                {
                                    "bbox": [
                                        354,
                                        504.25,
                                        526,
                                        516.5
                                    ],
                                    "spans": [],
                                    "index": 42
                                },
                                {
                                    "bbox": [
                                        354,
                                        516.5,
                                        526,
                                        528.75
                                    ],
                                    "spans": [],
                                    "index": 43
                                },
                                {
                                    "bbox": [
                                        354,
                                        528.75,
                                        526,
                                        541.0
                                    ],
                                    "spans": [],
                                    "index": 44
                                },
                                {
                                    "bbox": [
                                        354,
                                        541.0,
                                        526,
                                        553.25
                                    ],
                                    "spans": [],
                                    "index": 45
                                },
                                {
                                    "bbox": [
                                        354,
                                        553.25,
                                        526,
                                        565.5
                                    ],
                                    "spans": [],
                                    "index": 46
                                },
                                {
                                    "bbox": [
                                        354,
                                        565.5,
                                        526,
                                        577.75
                                    ],
                                    "spans": [],
                                    "index": 47
                                },
                                {
                                    "bbox": [
                                        354,
                                        577.75,
                                        526,
                                        590.0
                                    ],
                                    "spans": [],
                                    "index": 48
                                }
                            ]
                        },
                        {
                            "type": "image_caption",
                            "bbox": [
                                70,
                                606,
                                541,
                                643
                            ],
                            "group_id": 0,
                            "lines": [
                                {
                                    "bbox": [
                                        71,
                                        608,
                                        540,
                                        619
                                    ],
                                    "spans": [
                                        {
                                            "bbox": [
                                                71,
                                                608,
                                                540,
                                                619
                                            ],
                                            "score": 1.0,
                                            "content": "Figure 2: In the forward pass (left), we parallelize the workers (thread blocks) where each worker takes care",
                                            "type": "text"
                                        }
                                    ],
                                    "index": 49
                                },
                                {
                                    "bbox": [
                                        70,
                                        619,
                                        542,
                                        632
                                    ],
                                    "spans": [
                                        {
                                            "bbox": [
                                                70,
                                                619,
                                                542,
                                                632
                                            ],
                                            "score": 1.0,
                                            "content": "of a block of rows of the attention matrix. In the backward pass (right), each worker takes care of a block of",
                                            "type": "text"
                                        }
                                    ],
                                    "index": 50
                                },
                                {
                                    "bbox": [
                                        70,
                                        631,
                                        214,
                                        642
                                    ],
                                    "spans": [
                                        {
                                            "bbox": [
                                                70,
                                                631,
                                                214,
                                                642
                                            ],
                                            "score": 1.0,
                                            "content": "columns of the attention matrix.",
                                            "type": "text"
                                        }
                                    ],
                                    "index": 51
                                }
                            ],
                            "index": 50
                        }
                    ],
                    "index": 45.25,
                    "page_num": "page_7",
                    "page_size": [
                        612.0,
                        792.0
                    ]
                }
            ]
        },
        {
            "preproc_blocks": [
                {
                    "type": "title",
                    "bbox": [
                        71,
                        71,
                        307,
                        86
                    ],
                    "lines": [
                        {
                            "bbox": [
                                70,
                                72,
                                307,
                                85
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        72,
                                        90,
                                        85
                                    ],
                                    "score": 1.0,
                                    "content": "3.3",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        102,
                                        72,
                                        307,
                                        85
                                    ],
                                    "score": 1.0,
                                    "content": "Work Partitioning Between Warps",
                                    "type": "text"
                                }
                            ],
                            "index": 0
                        }
                    ],
                    "index": 0
                },
                {
                    "type": "text",
                    "bbox": [
                        71,
                        91,
                        541,
                        128
                    ],
                    "lines": [
                        {
                            "bbox": [
                                72,
                                92,
                                540,
                                103
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        72,
                                        92,
                                        540,
                                        103
                                    ],
                                    "score": 1.0,
                                    "content": "As Section 3.2 describe how we schedule thread blocks, even within each thread block, we also have to decide",
                                    "type": "text"
                                }
                            ],
                            "index": 1
                        },
                        {
                            "bbox": [
                                70,
                                104,
                                541,
                                116
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        104,
                                        541,
                                        116
                                    ],
                                    "score": 1.0,
                                    "content": "how to partition the work between different warps. We typically use 4 or 8 warps per thread block, and the",
                                    "type": "text"
                                }
                            ],
                            "index": 2
                        },
                        {
                            "bbox": [
                                70,
                                116,
                                221,
                                128
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        116,
                                        221,
                                        128
                                    ],
                                    "score": 1.0,
                                    "content": "partitioning is described in Fig. 3.",
                                    "type": "text"
                                }
                            ],
                            "index": 3
                        }
                    ],
                    "index": 2
                },
                {
                    "type": "text",
                    "bbox": [
                        71,
                        141,
                        541,
                        201
                    ],
                    "lines": [
                        {
                            "bbox": [
                                71,
                                142,
                                540,
                                153
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        71,
                                        142,
                                        324,
                                        153
                                    ],
                                    "score": 1.0,
                                    "content": "Forward pass. For each block, FlashAttention splits ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        324,
                                        144,
                                        332,
                                        151
                                    ],
                                    "score": 0.9,
                                    "content": "\\mathbf{K}",
                                    "type": "inline_equation",
                                    "height": 7,
                                    "width": 8
                                },
                                {
                                    "bbox": [
                                        332,
                                        142,
                                        353,
                                        153
                                    ],
                                    "score": 1.0,
                                    "content": " and ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        353,
                                        144,
                                        361,
                                        151
                                    ],
                                    "score": 0.86,
                                    "content": "\\mathbf{V}",
                                    "type": "inline_equation",
                                    "height": 7,
                                    "width": 8
                                },
                                {
                                    "bbox": [
                                        361,
                                        142,
                                        488,
                                        153
                                    ],
                                    "score": 1.0,
                                    "content": " across 4 warps while keeping ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        488,
                                        144,
                                        496,
                                        153
                                    ],
                                    "score": 0.76,
                                    "content": "\\mathbf{Q}",
                                    "type": "inline_equation",
                                    "height": 9,
                                    "width": 8
                                },
                                {
                                    "bbox": [
                                        496,
                                        142,
                                        540,
                                        153
                                    ],
                                    "score": 1.0,
                                    "content": " accessible",
                                    "type": "text"
                                }
                            ],
                            "index": 4
                        },
                        {
                            "bbox": [
                                70,
                                154,
                                541,
                                165
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        154,
                                        298,
                                        165
                                    ],
                                    "score": 1.0,
                                    "content": "by all warps. Each warp multiplies to get a slice of ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        299,
                                        155,
                                        320,
                                        165
                                    ],
                                    "score": 0.48,
                                    "content": "\\mathbf{Q}\\mathbf{K}^{\\mathrm{~I~}}",
                                    "type": "inline_equation",
                                    "height": 10,
                                    "width": 21
                                },
                                {
                                    "bbox": [
                                        320,
                                        154,
                                        511,
                                        165
                                    ],
                                    "score": 1.0,
                                    "content": ", then they need to multiply with a slice of",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        512,
                                        156,
                                        520,
                                        163
                                    ],
                                    "score": 0.85,
                                    "content": "\\mathbf{V}",
                                    "type": "inline_equation",
                                    "height": 7,
                                    "width": 8
                                },
                                {
                                    "bbox": [
                                        520,
                                        154,
                                        541,
                                        165
                                    ],
                                    "score": 1.0,
                                    "content": " and",
                                    "type": "text"
                                }
                            ],
                            "index": 5
                        },
                        {
                            "bbox": [
                                71,
                                166,
                                540,
                                177
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        71,
                                        166,
                                        540,
                                        177
                                    ],
                                    "score": 1.0,
                                    "content": "communicate to add up the result. This is referred to as the “split-K” scheme. However, this is inefficient",
                                    "type": "text"
                                }
                            ],
                            "index": 6
                        },
                        {
                            "bbox": [
                                71,
                                179,
                                540,
                                190
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        71,
                                        179,
                                        540,
                                        190
                                    ],
                                    "score": 1.0,
                                    "content": "since all warps need to write their intermediate results out to shared memory, synchronize, then add up the",
                                    "type": "text"
                                }
                            ],
                            "index": 7
                        },
                        {
                            "bbox": [
                                70,
                                190,
                                540,
                                201
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        190,
                                        540,
                                        201
                                    ],
                                    "score": 1.0,
                                    "content": "intermediate results. These shared memory reads/writes slow down the forward pass in FlashAttention.",
                                    "type": "text"
                                }
                            ],
                            "index": 8
                        }
                    ],
                    "index": 6
                },
                {
                    "type": "text",
                    "bbox": [
                        71,
                        201,
                        542,
                        249
                    ],
                    "lines": [
                        {
                            "bbox": [
                                84,
                                201,
                                542,
                                214
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        84,
                                        201,
                                        263,
                                        214
                                    ],
                                    "score": 1.0,
                                    "content": "In FlashAttention-2, we instead split ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        263,
                                        204,
                                        271,
                                        213
                                    ],
                                    "score": 0.5,
                                    "content": "\\mathbf{Q}",
                                    "type": "inline_equation",
                                    "height": 9,
                                    "width": 8
                                },
                                {
                                    "bbox": [
                                        272,
                                        201,
                                        401,
                                        214
                                    ],
                                    "score": 1.0,
                                    "content": " across 4 warps while keeping ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        401,
                                        204,
                                        409,
                                        211
                                    ],
                                    "score": 0.76,
                                    "content": "\\mathbf{K}",
                                    "type": "inline_equation",
                                    "height": 7,
                                    "width": 8
                                },
                                {
                                    "bbox": [
                                        409,
                                        201,
                                        430,
                                        214
                                    ],
                                    "score": 1.0,
                                    "content": " and",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        431,
                                        204,
                                        439,
                                        211
                                    ],
                                    "score": 0.75,
                                    "content": "\\mathbf{V}",
                                    "type": "inline_equation",
                                    "height": 7,
                                    "width": 8
                                },
                                {
                                    "bbox": [
                                        439,
                                        201,
                                        542,
                                        214
                                    ],
                                    "score": 1.0,
                                    "content": " accessible by all warps.",
                                    "type": "text"
                                }
                            ],
                            "index": 9
                        },
                        {
                            "bbox": [
                                71,
                                213,
                                542,
                                226
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        71,
                                        213,
                                        323,
                                        226
                                    ],
                                    "score": 1.0,
                                    "content": "After each warp performs matrix multiply to get a slice of ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        324,
                                        215,
                                        344,
                                        225
                                    ],
                                    "score": 0.61,
                                    "content": "\\mathbf{Q}\\mathbf{K}^{\\top}",
                                    "type": "inline_equation",
                                    "height": 10,
                                    "width": 20
                                },
                                {
                                    "bbox": [
                                        345,
                                        213,
                                        542,
                                        226
                                    ],
                                    "score": 1.0,
                                    "content": ", they just need to multiply with their shared",
                                    "type": "text"
                                }
                            ],
                            "index": 10
                        },
                        {
                            "bbox": [
                                71,
                                225,
                                542,
                                238
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        71,
                                        225,
                                        104,
                                        238
                                    ],
                                    "score": 1.0,
                                    "content": "slice of ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        104,
                                        228,
                                        112,
                                        235
                                    ],
                                    "score": 0.67,
                                    "content": "\\mathbf{V}",
                                    "type": "inline_equation",
                                    "height": 7,
                                    "width": 8
                                },
                                {
                                    "bbox": [
                                        112,
                                        225,
                                        542,
                                        238
                                    ],
                                    "score": 1.0,
                                    "content": " to get their corresponding slice of the output. There is no need for communication between warps.",
                                    "type": "text"
                                }
                            ],
                            "index": 11
                        },
                        {
                            "bbox": [
                                70,
                                236,
                                394,
                                250
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        236,
                                        394,
                                        250
                                    ],
                                    "score": 1.0,
                                    "content": "The reduction in shared memory reads/writes yields speedup (Section 4).",
                                    "type": "text"
                                }
                            ],
                            "index": 12
                        }
                    ],
                    "index": 10.5
                },
                {
                    "type": "image",
                    "bbox": [
                        78,
                        259,
                        534,
                        426
                    ],
                    "blocks": [
                        {
                            "type": "image_body",
                            "bbox": [
                                78,
                                259,
                                534,
                                426
                            ],
                            "group_id": 0,
                            "lines": [
                                {
                                    "bbox": [
                                        78,
                                        259,
                                        534,
                                        426
                                    ],
                                    "spans": [
                                        {
                                            "bbox": [
                                                78,
                                                259,
                                                534,
                                                426
                                            ],
                                            "score": 0.967,
                                            "type": "image",
                                            "image_path": "b883f8a3564ffb024bb8313ea3bf0366f7f8c7f16a41cd4af5a2bbca088ab319.jpg"
                                        }
                                    ]
                                }
                            ],
                            "index": 14,
                            "virtual_lines": [
                                {
                                    "bbox": [
                                        78,
                                        259,
                                        534,
                                        314.6666666666667
                                    ],
                                    "spans": [],
                                    "index": 13
                                },
                                {
                                    "bbox": [
                                        78,
                                        314.6666666666667,
                                        534,
                                        370.33333333333337
                                    ],
                                    "spans": [],
                                    "index": 14
                                },
                                {
                                    "bbox": [
                                        78,
                                        370.33333333333337,
                                        534,
                                        426.00000000000006
                                    ],
                                    "spans": [],
                                    "index": 15
                                }
                            ]
                        },
                        {
                            "type": "image_caption",
                            "bbox": [
                                146,
                                434,
                                465,
                                447
                            ],
                            "group_id": 0,
                            "lines": [
                                {
                                    "bbox": [
                                        148,
                                        435,
                                        464,
                                        446
                                    ],
                                    "spans": [
                                        {
                                            "bbox": [
                                                148,
                                                435,
                                                464,
                                                446
                                            ],
                                            "score": 1.0,
                                            "content": "Figure 3: Work partitioning between different warps in the forward pass",
                                            "type": "text"
                                        }
                                    ],
                                    "index": 16
                                }
                            ],
                            "index": 16
                        }
                    ],
                    "index": 15.0
                },
                {
                    "type": "text",
                    "bbox": [
                        71,
                        473,
                        541,
                        521
                    ],
                    "lines": [
                        {
                            "bbox": [
                                71,
                                474,
                                542,
                                484
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        71,
                                        474,
                                        542,
                                        484
                                    ],
                                    "score": 1.0,
                                    "content": "Backward pass. Similarly for the backward pass, we choose to partition the warps to avoid the “split-K”",
                                    "type": "text"
                                }
                            ],
                            "index": 17
                        },
                        {
                            "bbox": [
                                71,
                                486,
                                541,
                                497
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        71,
                                        486,
                                        541,
                                        497
                                    ],
                                    "score": 1.0,
                                    "content": "scheme. However, it still requires some synchronization due to the more complicated dependency between all",
                                    "type": "text"
                                }
                            ],
                            "index": 18
                        },
                        {
                            "bbox": [
                                71,
                                498,
                                541,
                                509
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        71,
                                        498,
                                        541,
                                        509
                                    ],
                                    "score": 1.0,
                                    "content": "the different inputs and gradients Q, K, V, O, dO, dQ, dK, dV. Nevertheless, avoiding “split-K” reduces shared",
                                    "type": "text"
                                }
                            ],
                            "index": 19
                        },
                        {
                            "bbox": [
                                70,
                                510,
                                330,
                                522
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        510,
                                        330,
                                        522
                                    ],
                                    "score": 1.0,
                                    "content": "memory reads/writes and again yields speedup (Section 4).",
                                    "type": "text"
                                }
                            ],
                            "index": 20
                        }
                    ],
                    "index": 18.5
                },
                {
                    "type": "text",
                    "bbox": [
                        70,
                        534,
                        541,
                        594
                    ],
                    "lines": [
                        {
                            "bbox": [
                                72,
                                536,
                                541,
                                547
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        72,
                                        536,
                                        541,
                                        547
                                    ],
                                    "score": 1.0,
                                    "content": "Tuning block sizes Increasing block sizes generally reduces shared memory loads/stores, but increases",
                                    "type": "text"
                                }
                            ],
                            "index": 21
                        },
                        {
                            "bbox": [
                                70,
                                547,
                                540,
                                559
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        547,
                                        540,
                                        559
                                    ],
                                    "score": 1.0,
                                    "content": "the number of registers required and the total amount of shared memory. Past a certain block size, register",
                                    "type": "text"
                                }
                            ],
                            "index": 22
                        },
                        {
                            "bbox": [
                                70,
                                559,
                                541,
                                571
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        559,
                                        541,
                                        571
                                    ],
                                    "score": 1.0,
                                    "content": "spilling causes significant slowdown, or the amount of shared memory required is larger than what the GPU",
                                    "type": "text"
                                }
                            ],
                            "index": 23
                        },
                        {
                            "bbox": [
                                71,
                                572,
                                541,
                                583
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        71,
                                        572,
                                        448,
                                        583
                                    ],
                                    "score": 1.0,
                                    "content": "has available, and the kernel cannot run at all. Typically we choose blocks of size ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        449,
                                        573,
                                        538,
                                        583
                                    ],
                                    "score": 0.87,
                                    "content": "\\{64,128\\}\\times\\{64,128\\}",
                                    "type": "inline_equation",
                                    "height": 10,
                                    "width": 89
                                },
                                {
                                    "bbox": [
                                        538,
                                        572,
                                        541,
                                        583
                                    ],
                                    "score": 1.0,
                                    "content": ",",
                                    "type": "text"
                                }
                            ],
                            "index": 24
                        },
                        {
                            "bbox": [
                                71,
                                584,
                                386,
                                595
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        71,
                                        584,
                                        221,
                                        595
                                    ],
                                    "score": 1.0,
                                    "content": "depending on the head dimension ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        221,
                                        585,
                                        227,
                                        592
                                    ],
                                    "score": 0.9,
                                    "content": "d",
                                    "type": "inline_equation",
                                    "height": 7,
                                    "width": 6
                                },
                                {
                                    "bbox": [
                                        227,
                                        584,
                                        386,
                                        595
                                    ],
                                    "score": 1.0,
                                    "content": "and the device shared memory size.",
                                    "type": "text"
                                }
                            ],
                            "index": 25
                        }
                    ],
                    "index": 23
                },
                {
                    "type": "text",
                    "bbox": [
                        69,
                        595,
                        540,
                        619
                    ],
                    "lines": [
                        {
                            "bbox": [
                                87,
                                595,
                                541,
                                606
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        87,
                                        595,
                                        541,
                                        606
                                    ],
                                    "score": 1.0,
                                    "content": "We manually tune for each head dimensions since there are essentially only 4 choices for block sizes, but",
                                    "type": "text"
                                }
                            ],
                            "index": 26
                        },
                        {
                            "bbox": [
                                71,
                                608,
                                477,
                                618
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        71,
                                        608,
                                        477,
                                        618
                                    ],
                                    "score": 1.0,
                                    "content": "this could benefit from auto-tuning to avoid this manual labor. We leave this to future work.",
                                    "type": "text"
                                }
                            ],
                            "index": 27
                        }
                    ],
                    "index": 26.5
                },
                {
                    "type": "title",
                    "bbox": [
                        72,
                        635,
                        239,
                        652
                    ],
                    "lines": [
                        {
                            "bbox": [
                                72,
                                638,
                                239,
                                651
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        72,
                                        639,
                                        81,
                                        650
                                    ],
                                    "score": 1.0,
                                    "content": "4",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        92,
                                        638,
                                        239,
                                        651
                                    ],
                                    "score": 1.0,
                                    "content": "Empirical Validation",
                                    "type": "text"
                                }
                            ],
                            "index": 28
                        }
                    ],
                    "index": 28
                },
                {
                    "type": "text",
                    "bbox": [
                        70,
                        661,
                        436,
                        673
                    ],
                    "lines": [
                        {
                            "bbox": [
                                70,
                                662,
                                435,
                                673
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        662,
                                        435,
                                        673
                                    ],
                                    "score": 1.0,
                                    "content": "We evaluate the impact of using FlashAttention-2 to train Transformer models.",
                                    "type": "text"
                                }
                            ],
                            "index": 29
                        }
                    ],
                    "index": 29
                },
                {
                    "type": "text",
                    "bbox": [
                        71,
                        674,
                        541,
                        721
                    ],
                    "lines": [
                        {
                            "bbox": [
                                73,
                                674,
                                541,
                                685
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        73,
                                        674,
                                        541,
                                        685
                                    ],
                                    "score": 1.0,
                                    "content": "• Benchmarking attention. We measure the runtime of FlashAttention-2 across different sequence",
                                    "type": "text"
                                }
                            ],
                            "index": 30
                        },
                        {
                            "bbox": [
                                80,
                                686,
                                541,
                                698
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        80,
                                        686,
                                        541,
                                        698
                                    ],
                                    "score": 1.0,
                                    "content": "lengths and compare it to a standard implementation in PyTorch, FlashAttention, and FlashAttention",
                                    "type": "text"
                                }
                            ],
                            "index": 31
                        },
                        {
                            "bbox": [
                                81,
                                697,
                                540,
                                708
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        81,
                                        698,
                                        319,
                                        708
                                    ],
                                    "score": 1.0,
                                    "content": "in Triton. We confirm that FlashAttention-2 is ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        319,
                                        697,
                                        356,
                                        708
                                    ],
                                    "score": 0.37,
                                    "content": "1.7\\mathrm{-}3.0\\times",
                                    "type": "inline_equation",
                                    "height": 11,
                                    "width": 37
                                },
                                {
                                    "bbox": [
                                        357,
                                        698,
                                        502,
                                        708
                                    ],
                                    "score": 1.0,
                                    "content": " faster than FlashAttention, ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        503,
                                        697,
                                        540,
                                        708
                                    ],
                                    "score": 0.4,
                                    "content": "1.3\\ –2.5\\times",
                                    "type": "inline_equation",
                                    "height": 11,
                                    "width": 37
                                }
                            ],
                            "index": 32
                        },
                        {
                            "bbox": [
                                81,
                                711,
                                542,
                                720
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        81,
                                        711,
                                        542,
                                        720
                                    ],
                                    "score": 1.0,
                                    "content": "faster than FlashAttention in Triton, and 3-10 faster than a standard attention implementation.",
                                    "type": "text"
                                }
                            ],
                            "index": 33
                        }
                    ],
                    "index": 31.5
                }
            ],
            "layout_bboxes": [],
            "page_idx": 8,
            "page_size": [
                612.0,
                792.0
            ],
            "_layout_tree": [],
            "images": [
                {
                    "type": "image",
                    "bbox": [
                        78,
                        259,
                        534,
                        426
                    ],
                    "blocks": [
                        {
                            "type": "image_body",
                            "bbox": [
                                78,
                                259,
                                534,
                                426
                            ],
                            "group_id": 0,
                            "lines": [
                                {
                                    "bbox": [
                                        78,
                                        259,
                                        534,
                                        426
                                    ],
                                    "spans": [
                                        {
                                            "bbox": [
                                                78,
                                                259,
                                                534,
                                                426
                                            ],
                                            "score": 0.967,
                                            "type": "image",
                                            "image_path": "b883f8a3564ffb024bb8313ea3bf0366f7f8c7f16a41cd4af5a2bbca088ab319.jpg"
                                        }
                                    ]
                                }
                            ],
                            "index": 14,
                            "virtual_lines": [
                                {
                                    "bbox": [
                                        78,
                                        259,
                                        534,
                                        314.6666666666667
                                    ],
                                    "spans": [],
                                    "index": 13
                                },
                                {
                                    "bbox": [
                                        78,
                                        314.6666666666667,
                                        534,
                                        370.33333333333337
                                    ],
                                    "spans": [],
                                    "index": 14
                                },
                                {
                                    "bbox": [
                                        78,
                                        370.33333333333337,
                                        534,
                                        426.00000000000006
                                    ],
                                    "spans": [],
                                    "index": 15
                                }
                            ]
                        },
                        {
                            "type": "image_caption",
                            "bbox": [
                                146,
                                434,
                                465,
                                447
                            ],
                            "group_id": 0,
                            "lines": [
                                {
                                    "bbox": [
                                        148,
                                        435,
                                        464,
                                        446
                                    ],
                                    "spans": [
                                        {
                                            "bbox": [
                                                148,
                                                435,
                                                464,
                                                446
                                            ],
                                            "score": 1.0,
                                            "content": "Figure 3: Work partitioning between different warps in the forward pass",
                                            "type": "text"
                                        }
                                    ],
                                    "index": 16
                                }
                            ],
                            "index": 16
                        }
                    ],
                    "index": 15.0
                }
            ],
            "tables": [],
            "interline_equations": [],
            "discarded_blocks": [
                {
                    "type": "discarded",
                    "bbox": [
                        302,
                        742,
                        309,
                        751
                    ],
                    "lines": [
                        {
                            "bbox": [
                                301,
                                741,
                                310,
                                753
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        301,
                                        741,
                                        310,
                                        753
                                    ],
                                    "score": 1.0,
                                    "content": "9",
                                    "type": "text"
                                }
                            ]
                        }
                    ]
                }
            ],
            "need_drop": false,
            "drop_reason": [],
            "para_blocks": [
                {
                    "type": "title",
                    "bbox": [
                        71,
                        71,
                        307,
                        86
                    ],
                    "lines": [
                        {
                            "bbox": [
                                70,
                                72,
                                307,
                                85
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        72,
                                        90,
                                        85
                                    ],
                                    "score": 1.0,
                                    "content": "3.3",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        102,
                                        72,
                                        307,
                                        85
                                    ],
                                    "score": 1.0,
                                    "content": "Work Partitioning Between Warps",
                                    "type": "text"
                                }
                            ],
                            "index": 0
                        }
                    ],
                    "index": 0,
                    "page_num": "page_8",
                    "page_size": [
                        612.0,
                        792.0
                    ]
                },
                {
                    "type": "text",
                    "bbox": [
                        71,
                        91,
                        541,
                        128
                    ],
                    "lines": [
                        {
                            "bbox": [
                                72,
                                92,
                                540,
                                103
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        72,
                                        92,
                                        540,
                                        103
                                    ],
                                    "score": 1.0,
                                    "content": "As Section 3.2 describe how we schedule thread blocks, even within each thread block, we also have to decide",
                                    "type": "text"
                                }
                            ],
                            "index": 1
                        },
                        {
                            "bbox": [
                                70,
                                104,
                                541,
                                116
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        104,
                                        541,
                                        116
                                    ],
                                    "score": 1.0,
                                    "content": "how to partition the work between different warps. We typically use 4 or 8 warps per thread block, and the",
                                    "type": "text"
                                }
                            ],
                            "index": 2
                        },
                        {
                            "bbox": [
                                70,
                                116,
                                221,
                                128
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        116,
                                        221,
                                        128
                                    ],
                                    "score": 1.0,
                                    "content": "partitioning is described in Fig. 3.",
                                    "type": "text"
                                }
                            ],
                            "index": 3
                        }
                    ],
                    "index": 2,
                    "page_num": "page_8",
                    "page_size": [
                        612.0,
                        792.0
                    ],
                    "bbox_fs": [
                        70,
                        92,
                        541,
                        128
                    ]
                },
                {
                    "type": "text",
                    "bbox": [
                        71,
                        141,
                        541,
                        201
                    ],
                    "lines": [
                        {
                            "bbox": [
                                71,
                                142,
                                540,
                                153
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        71,
                                        142,
                                        324,
                                        153
                                    ],
                                    "score": 1.0,
                                    "content": "Forward pass. For each block, FlashAttention splits ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        324,
                                        144,
                                        332,
                                        151
                                    ],
                                    "score": 0.9,
                                    "content": "\\mathbf{K}",
                                    "type": "inline_equation",
                                    "height": 7,
                                    "width": 8
                                },
                                {
                                    "bbox": [
                                        332,
                                        142,
                                        353,
                                        153
                                    ],
                                    "score": 1.0,
                                    "content": " and ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        353,
                                        144,
                                        361,
                                        151
                                    ],
                                    "score": 0.86,
                                    "content": "\\mathbf{V}",
                                    "type": "inline_equation",
                                    "height": 7,
                                    "width": 8
                                },
                                {
                                    "bbox": [
                                        361,
                                        142,
                                        488,
                                        153
                                    ],
                                    "score": 1.0,
                                    "content": " across 4 warps while keeping ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        488,
                                        144,
                                        496,
                                        153
                                    ],
                                    "score": 0.76,
                                    "content": "\\mathbf{Q}",
                                    "type": "inline_equation",
                                    "height": 9,
                                    "width": 8
                                },
                                {
                                    "bbox": [
                                        496,
                                        142,
                                        540,
                                        153
                                    ],
                                    "score": 1.0,
                                    "content": " accessible",
                                    "type": "text"
                                }
                            ],
                            "index": 4
                        },
                        {
                            "bbox": [
                                70,
                                154,
                                541,
                                165
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        154,
                                        298,
                                        165
                                    ],
                                    "score": 1.0,
                                    "content": "by all warps. Each warp multiplies to get a slice of ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        299,
                                        155,
                                        320,
                                        165
                                    ],
                                    "score": 0.48,
                                    "content": "\\mathbf{Q}\\mathbf{K}^{\\mathrm{~I~}}",
                                    "type": "inline_equation",
                                    "height": 10,
                                    "width": 21
                                },
                                {
                                    "bbox": [
                                        320,
                                        154,
                                        511,
                                        165
                                    ],
                                    "score": 1.0,
                                    "content": ", then they need to multiply with a slice of",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        512,
                                        156,
                                        520,
                                        163
                                    ],
                                    "score": 0.85,
                                    "content": "\\mathbf{V}",
                                    "type": "inline_equation",
                                    "height": 7,
                                    "width": 8
                                },
                                {
                                    "bbox": [
                                        520,
                                        154,
                                        541,
                                        165
                                    ],
                                    "score": 1.0,
                                    "content": " and",
                                    "type": "text"
                                }
                            ],
                            "index": 5
                        },
                        {
                            "bbox": [
                                71,
                                166,
                                540,
                                177
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        71,
                                        166,
                                        540,
                                        177
                                    ],
                                    "score": 1.0,
                                    "content": "communicate to add up the result. This is referred to as the “split-K” scheme. However, this is inefficient",
                                    "type": "text"
                                }
                            ],
                            "index": 6
                        },
                        {
                            "bbox": [
                                71,
                                179,
                                540,
                                190
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        71,
                                        179,
                                        540,
                                        190
                                    ],
                                    "score": 1.0,
                                    "content": "since all warps need to write their intermediate results out to shared memory, synchronize, then add up the",
                                    "type": "text"
                                }
                            ],
                            "index": 7
                        },
                        {
                            "bbox": [
                                70,
                                190,
                                540,
                                201
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        190,
                                        540,
                                        201
                                    ],
                                    "score": 1.0,
                                    "content": "intermediate results. These shared memory reads/writes slow down the forward pass in FlashAttention.",
                                    "type": "text"
                                }
                            ],
                            "index": 8
                        }
                    ],
                    "index": 6,
                    "page_num": "page_8",
                    "page_size": [
                        612.0,
                        792.0
                    ],
                    "bbox_fs": [
                        70,
                        142,
                        541,
                        201
                    ]
                },
                {
                    "type": "text",
                    "bbox": [
                        71,
                        201,
                        542,
                        249
                    ],
                    "lines": [
                        {
                            "bbox": [
                                84,
                                201,
                                542,
                                214
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        84,
                                        201,
                                        263,
                                        214
                                    ],
                                    "score": 1.0,
                                    "content": "In FlashAttention-2, we instead split ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        263,
                                        204,
                                        271,
                                        213
                                    ],
                                    "score": 0.5,
                                    "content": "\\mathbf{Q}",
                                    "type": "inline_equation",
                                    "height": 9,
                                    "width": 8
                                },
                                {
                                    "bbox": [
                                        272,
                                        201,
                                        401,
                                        214
                                    ],
                                    "score": 1.0,
                                    "content": " across 4 warps while keeping ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        401,
                                        204,
                                        409,
                                        211
                                    ],
                                    "score": 0.76,
                                    "content": "\\mathbf{K}",
                                    "type": "inline_equation",
                                    "height": 7,
                                    "width": 8
                                },
                                {
                                    "bbox": [
                                        409,
                                        201,
                                        430,
                                        214
                                    ],
                                    "score": 1.0,
                                    "content": " and",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        431,
                                        204,
                                        439,
                                        211
                                    ],
                                    "score": 0.75,
                                    "content": "\\mathbf{V}",
                                    "type": "inline_equation",
                                    "height": 7,
                                    "width": 8
                                },
                                {
                                    "bbox": [
                                        439,
                                        201,
                                        542,
                                        214
                                    ],
                                    "score": 1.0,
                                    "content": " accessible by all warps.",
                                    "type": "text"
                                }
                            ],
                            "index": 9
                        },
                        {
                            "bbox": [
                                71,
                                213,
                                542,
                                226
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        71,
                                        213,
                                        323,
                                        226
                                    ],
                                    "score": 1.0,
                                    "content": "After each warp performs matrix multiply to get a slice of ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        324,
                                        215,
                                        344,
                                        225
                                    ],
                                    "score": 0.61,
                                    "content": "\\mathbf{Q}\\mathbf{K}^{\\top}",
                                    "type": "inline_equation",
                                    "height": 10,
                                    "width": 20
                                },
                                {
                                    "bbox": [
                                        345,
                                        213,
                                        542,
                                        226
                                    ],
                                    "score": 1.0,
                                    "content": ", they just need to multiply with their shared",
                                    "type": "text"
                                }
                            ],
                            "index": 10
                        },
                        {
                            "bbox": [
                                71,
                                225,
                                542,
                                238
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        71,
                                        225,
                                        104,
                                        238
                                    ],
                                    "score": 1.0,
                                    "content": "slice of ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        104,
                                        228,
                                        112,
                                        235
                                    ],
                                    "score": 0.67,
                                    "content": "\\mathbf{V}",
                                    "type": "inline_equation",
                                    "height": 7,
                                    "width": 8
                                },
                                {
                                    "bbox": [
                                        112,
                                        225,
                                        542,
                                        238
                                    ],
                                    "score": 1.0,
                                    "content": " to get their corresponding slice of the output. There is no need for communication between warps.",
                                    "type": "text"
                                }
                            ],
                            "index": 11
                        },
                        {
                            "bbox": [
                                70,
                                236,
                                394,
                                250
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        236,
                                        394,
                                        250
                                    ],
                                    "score": 1.0,
                                    "content": "The reduction in shared memory reads/writes yields speedup (Section 4).",
                                    "type": "text"
                                }
                            ],
                            "index": 12
                        }
                    ],
                    "index": 10.5,
                    "page_num": "page_8",
                    "page_size": [
                        612.0,
                        792.0
                    ],
                    "bbox_fs": [
                        70,
                        201,
                        542,
                        250
                    ]
                },
                {
                    "type": "image",
                    "bbox": [
                        78,
                        259,
                        534,
                        426
                    ],
                    "blocks": [
                        {
                            "type": "image_body",
                            "bbox": [
                                78,
                                259,
                                534,
                                426
                            ],
                            "group_id": 0,
                            "lines": [
                                {
                                    "bbox": [
                                        78,
                                        259,
                                        534,
                                        426
                                    ],
                                    "spans": [
                                        {
                                            "bbox": [
                                                78,
                                                259,
                                                534,
                                                426
                                            ],
                                            "score": 0.967,
                                            "type": "image",
                                            "image_path": "b883f8a3564ffb024bb8313ea3bf0366f7f8c7f16a41cd4af5a2bbca088ab319.jpg"
                                        }
                                    ]
                                }
                            ],
                            "index": 14,
                            "virtual_lines": [
                                {
                                    "bbox": [
                                        78,
                                        259,
                                        534,
                                        314.6666666666667
                                    ],
                                    "spans": [],
                                    "index": 13
                                },
                                {
                                    "bbox": [
                                        78,
                                        314.6666666666667,
                                        534,
                                        370.33333333333337
                                    ],
                                    "spans": [],
                                    "index": 14
                                },
                                {
                                    "bbox": [
                                        78,
                                        370.33333333333337,
                                        534,
                                        426.00000000000006
                                    ],
                                    "spans": [],
                                    "index": 15
                                }
                            ]
                        },
                        {
                            "type": "image_caption",
                            "bbox": [
                                146,
                                434,
                                465,
                                447
                            ],
                            "group_id": 0,
                            "lines": [
                                {
                                    "bbox": [
                                        148,
                                        435,
                                        464,
                                        446
                                    ],
                                    "spans": [
                                        {
                                            "bbox": [
                                                148,
                                                435,
                                                464,
                                                446
                                            ],
                                            "score": 1.0,
                                            "content": "Figure 3: Work partitioning between different warps in the forward pass",
                                            "type": "text"
                                        }
                                    ],
                                    "index": 16
                                }
                            ],
                            "index": 16
                        }
                    ],
                    "index": 15.0,
                    "page_num": "page_8",
                    "page_size": [
                        612.0,
                        792.0
                    ]
                },
                {
                    "type": "text",
                    "bbox": [
                        71,
                        473,
                        541,
                        521
                    ],
                    "lines": [
                        {
                            "bbox": [
                                71,
                                474,
                                542,
                                484
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        71,
                                        474,
                                        542,
                                        484
                                    ],
                                    "score": 1.0,
                                    "content": "Backward pass. Similarly for the backward pass, we choose to partition the warps to avoid the “split-K”",
                                    "type": "text"
                                }
                            ],
                            "index": 17
                        },
                        {
                            "bbox": [
                                71,
                                486,
                                541,
                                497
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        71,
                                        486,
                                        541,
                                        497
                                    ],
                                    "score": 1.0,
                                    "content": "scheme. However, it still requires some synchronization due to the more complicated dependency between all",
                                    "type": "text"
                                }
                            ],
                            "index": 18
                        },
                        {
                            "bbox": [
                                71,
                                498,
                                541,
                                509
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        71,
                                        498,
                                        541,
                                        509
                                    ],
                                    "score": 1.0,
                                    "content": "the different inputs and gradients Q, K, V, O, dO, dQ, dK, dV. Nevertheless, avoiding “split-K” reduces shared",
                                    "type": "text"
                                }
                            ],
                            "index": 19
                        },
                        {
                            "bbox": [
                                70,
                                510,
                                330,
                                522
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        510,
                                        330,
                                        522
                                    ],
                                    "score": 1.0,
                                    "content": "memory reads/writes and again yields speedup (Section 4).",
                                    "type": "text"
                                }
                            ],
                            "index": 20
                        }
                    ],
                    "index": 18.5,
                    "page_num": "page_8",
                    "page_size": [
                        612.0,
                        792.0
                    ],
                    "bbox_fs": [
                        70,
                        474,
                        542,
                        522
                    ]
                },
                {
                    "type": "text",
                    "bbox": [
                        70,
                        534,
                        541,
                        594
                    ],
                    "lines": [
                        {
                            "bbox": [
                                72,
                                536,
                                541,
                                547
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        72,
                                        536,
                                        541,
                                        547
                                    ],
                                    "score": 1.0,
                                    "content": "Tuning block sizes Increasing block sizes generally reduces shared memory loads/stores, but increases",
                                    "type": "text"
                                }
                            ],
                            "index": 21
                        },
                        {
                            "bbox": [
                                70,
                                547,
                                540,
                                559
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        547,
                                        540,
                                        559
                                    ],
                                    "score": 1.0,
                                    "content": "the number of registers required and the total amount of shared memory. Past a certain block size, register",
                                    "type": "text"
                                }
                            ],
                            "index": 22
                        },
                        {
                            "bbox": [
                                70,
                                559,
                                541,
                                571
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        559,
                                        541,
                                        571
                                    ],
                                    "score": 1.0,
                                    "content": "spilling causes significant slowdown, or the amount of shared memory required is larger than what the GPU",
                                    "type": "text"
                                }
                            ],
                            "index": 23
                        },
                        {
                            "bbox": [
                                71,
                                572,
                                541,
                                583
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        71,
                                        572,
                                        448,
                                        583
                                    ],
                                    "score": 1.0,
                                    "content": "has available, and the kernel cannot run at all. Typically we choose blocks of size ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        449,
                                        573,
                                        538,
                                        583
                                    ],
                                    "score": 0.87,
                                    "content": "\\{64,128\\}\\times\\{64,128\\}",
                                    "type": "inline_equation",
                                    "height": 10,
                                    "width": 89
                                },
                                {
                                    "bbox": [
                                        538,
                                        572,
                                        541,
                                        583
                                    ],
                                    "score": 1.0,
                                    "content": ",",
                                    "type": "text"
                                }
                            ],
                            "index": 24
                        },
                        {
                            "bbox": [
                                71,
                                584,
                                386,
                                595
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        71,
                                        584,
                                        221,
                                        595
                                    ],
                                    "score": 1.0,
                                    "content": "depending on the head dimension ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        221,
                                        585,
                                        227,
                                        592
                                    ],
                                    "score": 0.9,
                                    "content": "d",
                                    "type": "inline_equation",
                                    "height": 7,
                                    "width": 6
                                },
                                {
                                    "bbox": [
                                        227,
                                        584,
                                        386,
                                        595
                                    ],
                                    "score": 1.0,
                                    "content": "and the device shared memory size.",
                                    "type": "text"
                                }
                            ],
                            "index": 25
                        }
                    ],
                    "index": 23,
                    "page_num": "page_8",
                    "page_size": [
                        612.0,
                        792.0
                    ],
                    "bbox_fs": [
                        70,
                        536,
                        541,
                        595
                    ]
                },
                {
                    "type": "text",
                    "bbox": [
                        69,
                        595,
                        540,
                        619
                    ],
                    "lines": [
                        {
                            "bbox": [
                                87,
                                595,
                                541,
                                606
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        87,
                                        595,
                                        541,
                                        606
                                    ],
                                    "score": 1.0,
                                    "content": "We manually tune for each head dimensions since there are essentially only 4 choices for block sizes, but",
                                    "type": "text"
                                }
                            ],
                            "index": 26
                        },
                        {
                            "bbox": [
                                71,
                                608,
                                477,
                                618
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        71,
                                        608,
                                        477,
                                        618
                                    ],
                                    "score": 1.0,
                                    "content": "this could benefit from auto-tuning to avoid this manual labor. We leave this to future work.",
                                    "type": "text"
                                }
                            ],
                            "index": 27
                        }
                    ],
                    "index": 26.5,
                    "page_num": "page_8",
                    "page_size": [
                        612.0,
                        792.0
                    ],
                    "bbox_fs": [
                        71,
                        595,
                        541,
                        618
                    ]
                },
                {
                    "type": "title",
                    "bbox": [
                        72,
                        635,
                        239,
                        652
                    ],
                    "lines": [
                        {
                            "bbox": [
                                72,
                                638,
                                239,
                                651
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        72,
                                        639,
                                        81,
                                        650
                                    ],
                                    "score": 1.0,
                                    "content": "4",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        92,
                                        638,
                                        239,
                                        651
                                    ],
                                    "score": 1.0,
                                    "content": "Empirical Validation",
                                    "type": "text"
                                }
                            ],
                            "index": 28
                        }
                    ],
                    "index": 28,
                    "page_num": "page_8",
                    "page_size": [
                        612.0,
                        792.0
                    ]
                },
                {
                    "type": "text",
                    "bbox": [
                        70,
                        661,
                        436,
                        673
                    ],
                    "lines": [
                        {
                            "bbox": [
                                70,
                                662,
                                435,
                                673
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        662,
                                        435,
                                        673
                                    ],
                                    "score": 1.0,
                                    "content": "We evaluate the impact of using FlashAttention-2 to train Transformer models.",
                                    "type": "text"
                                }
                            ],
                            "index": 29
                        }
                    ],
                    "index": 29,
                    "page_num": "page_8",
                    "page_size": [
                        612.0,
                        792.0
                    ],
                    "bbox_fs": [
                        70,
                        662,
                        435,
                        673
                    ]
                },
                {
                    "type": "text",
                    "bbox": [
                        71,
                        674,
                        541,
                        721
                    ],
                    "lines": [
                        {
                            "bbox": [
                                73,
                                674,
                                541,
                                685
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        73,
                                        674,
                                        541,
                                        685
                                    ],
                                    "score": 1.0,
                                    "content": "• Benchmarking attention. We measure the runtime of FlashAttention-2 across different sequence",
                                    "type": "text"
                                }
                            ],
                            "index": 30
                        },
                        {
                            "bbox": [
                                80,
                                686,
                                541,
                                698
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        80,
                                        686,
                                        541,
                                        698
                                    ],
                                    "score": 1.0,
                                    "content": "lengths and compare it to a standard implementation in PyTorch, FlashAttention, and FlashAttention",
                                    "type": "text"
                                }
                            ],
                            "index": 31
                        },
                        {
                            "bbox": [
                                81,
                                697,
                                540,
                                708
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        81,
                                        698,
                                        319,
                                        708
                                    ],
                                    "score": 1.0,
                                    "content": "in Triton. We confirm that FlashAttention-2 is ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        319,
                                        697,
                                        356,
                                        708
                                    ],
                                    "score": 0.37,
                                    "content": "1.7\\mathrm{-}3.0\\times",
                                    "type": "inline_equation",
                                    "height": 11,
                                    "width": 37
                                },
                                {
                                    "bbox": [
                                        357,
                                        698,
                                        502,
                                        708
                                    ],
                                    "score": 1.0,
                                    "content": " faster than FlashAttention, ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        503,
                                        697,
                                        540,
                                        708
                                    ],
                                    "score": 0.4,
                                    "content": "1.3\\ –2.5\\times",
                                    "type": "inline_equation",
                                    "height": 11,
                                    "width": 37
                                }
                            ],
                            "index": 32
                        },
                        {
                            "bbox": [
                                81,
                                711,
                                542,
                                720
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        81,
                                        711,
                                        542,
                                        720
                                    ],
                                    "score": 1.0,
                                    "content": "faster than FlashAttention in Triton, and 3-10 faster than a standard attention implementation.",
                                    "type": "text"
                                }
                            ],
                            "index": 33
                        }
                    ],
                    "index": 31.5,
                    "page_num": "page_8",
                    "page_size": [
                        612.0,
                        792.0
                    ],
                    "bbox_fs": [
                        73,
                        674,
                        542,
                        720
                    ]
                }
            ]
        },
        {
            "preproc_blocks": [
                {
                    "type": "text",
                    "bbox": [
                        81,
                        73,
                        540,
                        96
                    ],
                    "lines": [
                        {
                            "bbox": [
                                81,
                                74,
                                540,
                                84
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        81,
                                        74,
                                        540,
                                        84
                                    ],
                                    "score": 1.0,
                                    "content": "FlashAttention-2 reaches up to 230 TFLOPs/s, 73% of the theoretical maximum TFLOPs/s on A100",
                                    "type": "text"
                                }
                            ],
                            "index": 0
                        },
                        {
                            "bbox": [
                                79,
                                84,
                                112,
                                98
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        79,
                                        84,
                                        112,
                                        98
                                    ],
                                    "score": 1.0,
                                    "content": "GPUs.",
                                    "type": "text"
                                }
                            ],
                            "index": 1
                        }
                    ],
                    "index": 0.5
                },
                {
                    "type": "text",
                    "bbox": [
                        72,
                        101,
                        541,
                        149
                    ],
                    "lines": [
                        {
                            "bbox": [
                                72,
                                102,
                                541,
                                113
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        72,
                                        102,
                                        541,
                                        113
                                    ],
                                    "score": 1.0,
                                    "content": "• End-to-end training speed When used end-to-end to train GPT-style models of size 1.3B and 2.7B on",
                                    "type": "text"
                                }
                            ],
                            "index": 2
                        },
                        {
                            "bbox": [
                                79,
                                114,
                                541,
                                124
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        79,
                                        114,
                                        541,
                                        124
                                    ],
                                    "score": 1.0,
                                    "content": "sequence lengths either 2k or 8k, FlashAttention-2 yields up to 1.3 speedup compared to FlashAt-",
                                    "type": "text"
                                }
                            ],
                            "index": 3
                        },
                        {
                            "bbox": [
                                81,
                                127,
                                540,
                                137
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        81,
                                        127,
                                        145,
                                        137
                                    ],
                                    "score": 1.0,
                                    "content": "tention and ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        145,
                                        128,
                                        165,
                                        136
                                    ],
                                    "score": 0.25,
                                    "content": "2.8\\times",
                                    "type": "inline_equation",
                                    "height": 8,
                                    "width": 20
                                },
                                {
                                    "bbox": [
                                        165,
                                        127,
                                        540,
                                        137
                                    ],
                                    "score": 1.0,
                                    "content": " speedup compared to a baseline without FlashAttention. FlashAttention-2",
                                    "type": "text"
                                }
                            ],
                            "index": 4
                        },
                        {
                            "bbox": [
                                80,
                                137,
                                421,
                                149
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        80,
                                        137,
                                        421,
                                        149
                                    ],
                                    "score": 1.0,
                                    "content": "reaches up to 225 TFLOPs/s (72% model FLOPs utilization) per A100 GPU.",
                                    "type": "text"
                                }
                            ],
                            "index": 5
                        }
                    ],
                    "index": 3.5
                },
                {
                    "type": "title",
                    "bbox": [
                        72,
                        163,
                        249,
                        177
                    ],
                    "lines": [
                        {
                            "bbox": [
                                70,
                                163,
                                248,
                                177
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        163,
                                        91,
                                        177
                                    ],
                                    "score": 1.0,
                                    "content": "4.1",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        100,
                                        164,
                                        248,
                                        176
                                    ],
                                    "score": 1.0,
                                    "content": "Benchmarking Attention",
                                    "type": "text"
                                }
                            ],
                            "index": 6
                        }
                    ],
                    "index": 6
                },
                {
                    "type": "text",
                    "bbox": [
                        70,
                        183,
                        542,
                        255
                    ],
                    "lines": [
                        {
                            "bbox": [
                                70,
                                183,
                                541,
                                196
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        183,
                                        541,
                                        196
                                    ],
                                    "score": 1.0,
                                    "content": "We measure the runtime of different attention methods on an A100 80GB SXM4 GPU for different settings",
                                    "type": "text"
                                }
                            ],
                            "index": 7
                        },
                        {
                            "bbox": [
                                70,
                                195,
                                541,
                                208
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        195,
                                        541,
                                        208
                                    ],
                                    "score": 1.0,
                                    "content": "(without / with causal mask, head dimension 64 or 128). We report the results in Fig. 4, Fig. 5 and Fig. 6,",
                                    "type": "text"
                                }
                            ],
                            "index": 8
                        },
                        {
                            "bbox": [
                                70,
                                207,
                                542,
                                220
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        207,
                                        272,
                                        220
                                    ],
                                    "score": 1.0,
                                    "content": "showing that FlashAttention-2 is around ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        272,
                                        210,
                                        284,
                                        217
                                    ],
                                    "score": 0.34,
                                    "content": "2\\times",
                                    "type": "inline_equation",
                                    "height": 7,
                                    "width": 12
                                },
                                {
                                    "bbox": [
                                        285,
                                        207,
                                        542,
                                        220
                                    ],
                                    "score": 1.0,
                                    "content": " faster than FlashAttention and FlashAttention in",
                                    "type": "text"
                                }
                            ],
                            "index": 9
                        },
                        {
                            "bbox": [
                                71,
                                221,
                                541,
                                231
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        71,
                                        221,
                                        541,
                                        231
                                    ],
                                    "score": 1.0,
                                    "content": "xformers (the “cutlass” implementation). FlashAttention-2 is around 1.3-1.5 faster than FlashAtten-",
                                    "type": "text"
                                }
                            ],
                            "index": 10
                        },
                        {
                            "bbox": [
                                70,
                                232,
                                541,
                                244
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        232,
                                        289,
                                        244
                                    ],
                                    "score": 1.0,
                                    "content": "tion in Triton in the forward pass and around 2",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        289,
                                        235,
                                        296,
                                        241
                                    ],
                                    "score": 0.49,
                                    "content": "\\times",
                                    "type": "inline_equation",
                                    "height": 6,
                                    "width": 7
                                },
                                {
                                    "bbox": [
                                        297,
                                        232,
                                        541,
                                        244
                                    ],
                                    "score": 1.0,
                                    "content": " faster in the backward pass. Compared to a standard",
                                    "type": "text"
                                }
                            ],
                            "index": 11
                        },
                        {
                            "bbox": [
                                70,
                                243,
                                440,
                                256
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        243,
                                        440,
                                        256
                                    ],
                                    "score": 1.0,
                                    "content": "attention implementation in PyTorch, FlashAttention-2 can be up to 10× faster.",
                                    "type": "text"
                                }
                            ],
                            "index": 12
                        }
                    ],
                    "index": 9.5
                },
                {
                    "type": "text",
                    "bbox": [
                        71,
                        255,
                        541,
                        291
                    ],
                    "lines": [
                        {
                            "bbox": [
                                86,
                                256,
                                541,
                                266
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        86,
                                        256,
                                        541,
                                        266
                                    ],
                                    "score": 1.0,
                                    "content": "Benchmark setting: we vary the sequence length from 512, 1k, ..., 16k, and set batch size so that the total",
                                    "type": "text"
                                }
                            ],
                            "index": 13
                        },
                        {
                            "bbox": [
                                70,
                                266,
                                542,
                                280
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        266,
                                        542,
                                        280
                                    ],
                                    "score": 1.0,
                                    "content": "number of tokens is 16k. We set hidden dimension to 2048, and head dimension to be either 64 or 128 (i.e.,",
                                    "type": "text"
                                }
                            ],
                            "index": 14
                        },
                        {
                            "bbox": [
                                70,
                                279,
                                403,
                                291
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        279,
                                        403,
                                        291
                                    ],
                                    "score": 1.0,
                                    "content": "32 heads or 16 heads). To calculate the FLOPs of the forward pass, we use:",
                                    "type": "text"
                                }
                            ],
                            "index": 15
                        }
                    ],
                    "index": 14
                },
                {
                    "type": "text",
                    "bbox": [
                        70,
                        322,
                        542,
                        359
                    ],
                    "lines": [
                        {
                            "bbox": [
                                70,
                                323,
                                541,
                                335
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        323,
                                        541,
                                        335
                                    ],
                                    "score": 1.0,
                                    "content": "With causal mask, we divide this number by 2 to account for the fact that approximately only half of the",
                                    "type": "text"
                                }
                            ],
                            "index": 16
                        },
                        {
                            "bbox": [
                                70,
                                335,
                                541,
                                347
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        335,
                                        541,
                                        347
                                    ],
                                    "score": 1.0,
                                    "content": "entries are calculated. To get the FLOPs of the backward pass, we multiply the forward pass FLOPs by 2.5",
                                    "type": "text"
                                }
                            ],
                            "index": 17
                        },
                        {
                            "bbox": [
                                70,
                                348,
                                541,
                                359
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        348,
                                        541,
                                        359
                                    ],
                                    "score": 1.0,
                                    "content": "(since there are 2 matmuls in the forward pass and 5 matmuls in the backward pass, due to recomputation).",
                                    "type": "text"
                                }
                            ],
                            "index": 18
                        }
                    ],
                    "index": 17
                },
                {
                    "type": "image",
                    "bbox": [
                        77,
                        375,
                        533,
                        699
                    ],
                    "blocks": [
                        {
                            "type": "image_caption",
                            "bbox": [
                                110,
                                372,
                                289,
                                381
                            ],
                            "group_id": 0,
                            "lines": [
                                {
                                    "bbox": [
                                        110,
                                        372,
                                        289,
                                        381
                                    ],
                                    "spans": [],
                                    "index": 19
                                }
                            ],
                            "index": 19
                        },
                        {
                            "type": "image_caption",
                            "bbox": [
                                343,
                                372,
                                523,
                                381
                            ],
                            "group_id": 0,
                            "lines": [
                                {
                                    "bbox": [
                                        343,
                                        372,
                                        523,
                                        381
                                    ],
                                    "spans": [],
                                    "index": 20
                                }
                            ],
                            "index": 20
                        },
                        {
                            "type": "image_body",
                            "bbox": [
                                77,
                                375,
                                533,
                                699
                            ],
                            "group_id": 0,
                            "lines": [
                                {
                                    "bbox": [
                                        77,
                                        375,
                                        533,
                                        699
                                    ],
                                    "spans": [
                                        {
                                            "bbox": [
                                                77,
                                                375,
                                                533,
                                                699
                                            ],
                                            "score": 0.968,
                                            "type": "image",
                                            "image_path": "be7f7000879776848846a83e3645cead72c2644da8a9a8ef60104a3888bf5610.jpg"
                                        }
                                    ]
                                }
                            ],
                            "index": 22,
                            "virtual_lines": [
                                {
                                    "bbox": [
                                        77,
                                        375,
                                        533,
                                        483.0
                                    ],
                                    "spans": [],
                                    "index": 21
                                },
                                {
                                    "bbox": [
                                        77,
                                        483.0,
                                        533,
                                        591.0
                                    ],
                                    "spans": [],
                                    "index": 22
                                },
                                {
                                    "bbox": [
                                        77,
                                        591.0,
                                        533,
                                        699.0
                                    ],
                                    "spans": [],
                                    "index": 23
                                }
                            ]
                        },
                        {
                            "type": "image_caption",
                            "bbox": [
                                168,
                                708,
                                442,
                                720
                            ],
                            "group_id": 0,
                            "lines": [
                                {
                                    "bbox": [
                                        170,
                                        708,
                                        441,
                                        719
                                    ],
                                    "spans": [
                                        {
                                            "bbox": [
                                                170,
                                                708,
                                                294,
                                                719
                                            ],
                                            "score": 1.0,
                                            "content": "Figure 4: Attention forward",
                                            "type": "text"
                                        },
                                        {
                                            "bbox": [
                                                294,
                                                709,
                                                304,
                                                718
                                            ],
                                            "score": 0.51,
                                            "content": "^+",
                                            "type": "inline_equation",
                                            "height": 9,
                                            "width": 10
                                        },
                                        {
                                            "bbox": [
                                                305,
                                                708,
                                                441,
                                                719
                                            ],
                                            "score": 1.0,
                                            "content": " backward speed on A100 GPU",
                                            "type": "text"
                                        }
                                    ],
                                    "index": 24
                                }
                            ],
                            "index": 24
                        }
                    ],
                    "index": 21.0
                }
            ],
            "layout_bboxes": [],
            "page_idx": 9,
            "page_size": [
                612.0,
                792.0
            ],
            "_layout_tree": [],
            "images": [
                {
                    "type": "image",
                    "bbox": [
                        77,
                        375,
                        533,
                        699
                    ],
                    "blocks": [
                        {
                            "type": "image_caption",
                            "bbox": [
                                110,
                                372,
                                289,
                                381
                            ],
                            "group_id": 0,
                            "lines": [
                                {
                                    "bbox": [
                                        110,
                                        372,
                                        289,
                                        381
                                    ],
                                    "spans": [],
                                    "index": 19
                                }
                            ],
                            "index": 19
                        },
                        {
                            "type": "image_caption",
                            "bbox": [
                                343,
                                372,
                                523,
                                381
                            ],
                            "group_id": 0,
                            "lines": [
                                {
                                    "bbox": [
                                        343,
                                        372,
                                        523,
                                        381
                                    ],
                                    "spans": [],
                                    "index": 20
                                }
                            ],
                            "index": 20
                        },
                        {
                            "type": "image_body",
                            "bbox": [
                                77,
                                375,
                                533,
                                699
                            ],
                            "group_id": 0,
                            "lines": [
                                {
                                    "bbox": [
                                        77,
                                        375,
                                        533,
                                        699
                                    ],
                                    "spans": [
                                        {
                                            "bbox": [
                                                77,
                                                375,
                                                533,
                                                699
                                            ],
                                            "score": 0.968,
                                            "type": "image",
                                            "image_path": "be7f7000879776848846a83e3645cead72c2644da8a9a8ef60104a3888bf5610.jpg"
                                        }
                                    ]
                                }
                            ],
                            "index": 22,
                            "virtual_lines": [
                                {
                                    "bbox": [
                                        77,
                                        375,
                                        533,
                                        483.0
                                    ],
                                    "spans": [],
                                    "index": 21
                                },
                                {
                                    "bbox": [
                                        77,
                                        483.0,
                                        533,
                                        591.0
                                    ],
                                    "spans": [],
                                    "index": 22
                                },
                                {
                                    "bbox": [
                                        77,
                                        591.0,
                                        533,
                                        699.0
                                    ],
                                    "spans": [],
                                    "index": 23
                                }
                            ]
                        },
                        {
                            "type": "image_caption",
                            "bbox": [
                                168,
                                708,
                                442,
                                720
                            ],
                            "group_id": 0,
                            "lines": [
                                {
                                    "bbox": [
                                        170,
                                        708,
                                        441,
                                        719
                                    ],
                                    "spans": [
                                        {
                                            "bbox": [
                                                170,
                                                708,
                                                294,
                                                719
                                            ],
                                            "score": 1.0,
                                            "content": "Figure 4: Attention forward",
                                            "type": "text"
                                        },
                                        {
                                            "bbox": [
                                                294,
                                                709,
                                                304,
                                                718
                                            ],
                                            "score": 0.51,
                                            "content": "^+",
                                            "type": "inline_equation",
                                            "height": 9,
                                            "width": 10
                                        },
                                        {
                                            "bbox": [
                                                305,
                                                708,
                                                441,
                                                719
                                            ],
                                            "score": 1.0,
                                            "content": " backward speed on A100 GPU",
                                            "type": "text"
                                        }
                                    ],
                                    "index": 24
                                }
                            ],
                            "index": 24
                        }
                    ],
                    "index": 21.0
                }
            ],
            "tables": [],
            "interline_equations": [],
            "discarded_blocks": [
                {
                    "type": "discarded",
                    "bbox": [
                        300,
                        742,
                        311,
                        751
                    ],
                    "lines": [
                        {
                            "bbox": [
                                298,
                                741,
                                313,
                                754
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        298,
                                        741,
                                        313,
                                        754
                                    ],
                                    "score": 1.0,
                                    "content": "10",
                                    "type": "text"
                                }
                            ]
                        }
                    ]
                }
            ],
            "need_drop": false,
            "drop_reason": [],
            "para_blocks": [
                {
                    "type": "text",
                    "bbox": [
                        81,
                        73,
                        540,
                        96
                    ],
                    "lines": [
                        {
                            "bbox": [
                                81,
                                74,
                                540,
                                84
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        81,
                                        74,
                                        540,
                                        84
                                    ],
                                    "score": 1.0,
                                    "content": "FlashAttention-2 reaches up to 230 TFLOPs/s, 73% of the theoretical maximum TFLOPs/s on A100",
                                    "type": "text"
                                }
                            ],
                            "index": 0
                        },
                        {
                            "bbox": [
                                79,
                                84,
                                112,
                                98
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        79,
                                        84,
                                        112,
                                        98
                                    ],
                                    "score": 1.0,
                                    "content": "GPUs.",
                                    "type": "text"
                                }
                            ],
                            "index": 1
                        }
                    ],
                    "index": 0.5,
                    "page_num": "page_9",
                    "page_size": [
                        612.0,
                        792.0
                    ],
                    "bbox_fs": [
                        79,
                        74,
                        540,
                        98
                    ]
                },
                {
                    "type": "text",
                    "bbox": [
                        72,
                        101,
                        541,
                        149
                    ],
                    "lines": [
                        {
                            "bbox": [
                                72,
                                102,
                                541,
                                113
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        72,
                                        102,
                                        541,
                                        113
                                    ],
                                    "score": 1.0,
                                    "content": "• End-to-end training speed When used end-to-end to train GPT-style models of size 1.3B and 2.7B on",
                                    "type": "text"
                                }
                            ],
                            "index": 2
                        },
                        {
                            "bbox": [
                                79,
                                114,
                                541,
                                124
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        79,
                                        114,
                                        541,
                                        124
                                    ],
                                    "score": 1.0,
                                    "content": "sequence lengths either 2k or 8k, FlashAttention-2 yields up to 1.3 speedup compared to FlashAt-",
                                    "type": "text"
                                }
                            ],
                            "index": 3
                        },
                        {
                            "bbox": [
                                81,
                                127,
                                540,
                                137
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        81,
                                        127,
                                        145,
                                        137
                                    ],
                                    "score": 1.0,
                                    "content": "tention and ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        145,
                                        128,
                                        165,
                                        136
                                    ],
                                    "score": 0.25,
                                    "content": "2.8\\times",
                                    "type": "inline_equation",
                                    "height": 8,
                                    "width": 20
                                },
                                {
                                    "bbox": [
                                        165,
                                        127,
                                        540,
                                        137
                                    ],
                                    "score": 1.0,
                                    "content": " speedup compared to a baseline without FlashAttention. FlashAttention-2",
                                    "type": "text"
                                }
                            ],
                            "index": 4
                        },
                        {
                            "bbox": [
                                80,
                                137,
                                421,
                                149
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        80,
                                        137,
                                        421,
                                        149
                                    ],
                                    "score": 1.0,
                                    "content": "reaches up to 225 TFLOPs/s (72% model FLOPs utilization) per A100 GPU.",
                                    "type": "text"
                                }
                            ],
                            "index": 5
                        }
                    ],
                    "index": 3.5,
                    "page_num": "page_9",
                    "page_size": [
                        612.0,
                        792.0
                    ],
                    "bbox_fs": [
                        72,
                        102,
                        541,
                        149
                    ]
                },
                {
                    "type": "title",
                    "bbox": [
                        72,
                        163,
                        249,
                        177
                    ],
                    "lines": [
                        {
                            "bbox": [
                                70,
                                163,
                                248,
                                177
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        163,
                                        91,
                                        177
                                    ],
                                    "score": 1.0,
                                    "content": "4.1",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        100,
                                        164,
                                        248,
                                        176
                                    ],
                                    "score": 1.0,
                                    "content": "Benchmarking Attention",
                                    "type": "text"
                                }
                            ],
                            "index": 6
                        }
                    ],
                    "index": 6,
                    "page_num": "page_9",
                    "page_size": [
                        612.0,
                        792.0
                    ]
                },
                {
                    "type": "text",
                    "bbox": [
                        70,
                        183,
                        542,
                        255
                    ],
                    "lines": [
                        {
                            "bbox": [
                                70,
                                183,
                                541,
                                196
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        183,
                                        541,
                                        196
                                    ],
                                    "score": 1.0,
                                    "content": "We measure the runtime of different attention methods on an A100 80GB SXM4 GPU for different settings",
                                    "type": "text"
                                }
                            ],
                            "index": 7
                        },
                        {
                            "bbox": [
                                70,
                                195,
                                541,
                                208
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        195,
                                        541,
                                        208
                                    ],
                                    "score": 1.0,
                                    "content": "(without / with causal mask, head dimension 64 or 128). We report the results in Fig. 4, Fig. 5 and Fig. 6,",
                                    "type": "text"
                                }
                            ],
                            "index": 8
                        },
                        {
                            "bbox": [
                                70,
                                207,
                                542,
                                220
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        207,
                                        272,
                                        220
                                    ],
                                    "score": 1.0,
                                    "content": "showing that FlashAttention-2 is around ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        272,
                                        210,
                                        284,
                                        217
                                    ],
                                    "score": 0.34,
                                    "content": "2\\times",
                                    "type": "inline_equation",
                                    "height": 7,
                                    "width": 12
                                },
                                {
                                    "bbox": [
                                        285,
                                        207,
                                        542,
                                        220
                                    ],
                                    "score": 1.0,
                                    "content": " faster than FlashAttention and FlashAttention in",
                                    "type": "text"
                                }
                            ],
                            "index": 9
                        },
                        {
                            "bbox": [
                                71,
                                221,
                                541,
                                231
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        71,
                                        221,
                                        541,
                                        231
                                    ],
                                    "score": 1.0,
                                    "content": "xformers (the “cutlass” implementation). FlashAttention-2 is around 1.3-1.5 faster than FlashAtten-",
                                    "type": "text"
                                }
                            ],
                            "index": 10
                        },
                        {
                            "bbox": [
                                70,
                                232,
                                541,
                                244
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        232,
                                        289,
                                        244
                                    ],
                                    "score": 1.0,
                                    "content": "tion in Triton in the forward pass and around 2",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        289,
                                        235,
                                        296,
                                        241
                                    ],
                                    "score": 0.49,
                                    "content": "\\times",
                                    "type": "inline_equation",
                                    "height": 6,
                                    "width": 7
                                },
                                {
                                    "bbox": [
                                        297,
                                        232,
                                        541,
                                        244
                                    ],
                                    "score": 1.0,
                                    "content": " faster in the backward pass. Compared to a standard",
                                    "type": "text"
                                }
                            ],
                            "index": 11
                        },
                        {
                            "bbox": [
                                70,
                                243,
                                440,
                                256
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        243,
                                        440,
                                        256
                                    ],
                                    "score": 1.0,
                                    "content": "attention implementation in PyTorch, FlashAttention-2 can be up to 10× faster.",
                                    "type": "text"
                                }
                            ],
                            "index": 12
                        }
                    ],
                    "index": 9.5,
                    "page_num": "page_9",
                    "page_size": [
                        612.0,
                        792.0
                    ],
                    "bbox_fs": [
                        70,
                        183,
                        542,
                        256
                    ]
                },
                {
                    "type": "text",
                    "bbox": [
                        71,
                        255,
                        541,
                        291
                    ],
                    "lines": [
                        {
                            "bbox": [
                                86,
                                256,
                                541,
                                266
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        86,
                                        256,
                                        541,
                                        266
                                    ],
                                    "score": 1.0,
                                    "content": "Benchmark setting: we vary the sequence length from 512, 1k, ..., 16k, and set batch size so that the total",
                                    "type": "text"
                                }
                            ],
                            "index": 13
                        },
                        {
                            "bbox": [
                                70,
                                266,
                                542,
                                280
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        266,
                                        542,
                                        280
                                    ],
                                    "score": 1.0,
                                    "content": "number of tokens is 16k. We set hidden dimension to 2048, and head dimension to be either 64 or 128 (i.e.,",
                                    "type": "text"
                                }
                            ],
                            "index": 14
                        },
                        {
                            "bbox": [
                                70,
                                279,
                                403,
                                291
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        279,
                                        403,
                                        291
                                    ],
                                    "score": 1.0,
                                    "content": "32 heads or 16 heads). To calculate the FLOPs of the forward pass, we use:",
                                    "type": "text"
                                }
                            ],
                            "index": 15
                        }
                    ],
                    "index": 14,
                    "page_num": "page_9",
                    "page_size": [
                        612.0,
                        792.0
                    ],
                    "bbox_fs": [
                        70,
                        256,
                        542,
                        291
                    ]
                },
                {
                    "type": "text",
                    "bbox": [
                        70,
                        322,
                        542,
                        359
                    ],
                    "lines": [
                        {
                            "bbox": [
                                70,
                                323,
                                541,
                                335
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        323,
                                        541,
                                        335
                                    ],
                                    "score": 1.0,
                                    "content": "With causal mask, we divide this number by 2 to account for the fact that approximately only half of the",
                                    "type": "text"
                                }
                            ],
                            "index": 16
                        },
                        {
                            "bbox": [
                                70,
                                335,
                                541,
                                347
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        335,
                                        541,
                                        347
                                    ],
                                    "score": 1.0,
                                    "content": "entries are calculated. To get the FLOPs of the backward pass, we multiply the forward pass FLOPs by 2.5",
                                    "type": "text"
                                }
                            ],
                            "index": 17
                        },
                        {
                            "bbox": [
                                70,
                                348,
                                541,
                                359
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        348,
                                        541,
                                        359
                                    ],
                                    "score": 1.0,
                                    "content": "(since there are 2 matmuls in the forward pass and 5 matmuls in the backward pass, due to recomputation).",
                                    "type": "text"
                                }
                            ],
                            "index": 18
                        }
                    ],
                    "index": 17,
                    "page_num": "page_9",
                    "page_size": [
                        612.0,
                        792.0
                    ],
                    "bbox_fs": [
                        70,
                        323,
                        541,
                        359
                    ]
                },
                {
                    "type": "image",
                    "bbox": [
                        77,
                        375,
                        533,
                        699
                    ],
                    "blocks": [
                        {
                            "type": "image_caption",
                            "bbox": [
                                110,
                                372,
                                289,
                                381
                            ],
                            "group_id": 0,
                            "lines": [
                                {
                                    "bbox": [
                                        110,
                                        372,
                                        289,
                                        381
                                    ],
                                    "spans": [],
                                    "index": 19
                                }
                            ],
                            "index": 19
                        },
                        {
                            "type": "image_caption",
                            "bbox": [
                                343,
                                372,
                                523,
                                381
                            ],
                            "group_id": 0,
                            "lines": [
                                {
                                    "bbox": [
                                        343,
                                        372,
                                        523,
                                        381
                                    ],
                                    "spans": [],
                                    "index": 20
                                }
                            ],
                            "index": 20
                        },
                        {
                            "type": "image_body",
                            "bbox": [
                                77,
                                375,
                                533,
                                699
                            ],
                            "group_id": 0,
                            "lines": [
                                {
                                    "bbox": [
                                        77,
                                        375,
                                        533,
                                        699
                                    ],
                                    "spans": [
                                        {
                                            "bbox": [
                                                77,
                                                375,
                                                533,
                                                699
                                            ],
                                            "score": 0.968,
                                            "type": "image",
                                            "image_path": "be7f7000879776848846a83e3645cead72c2644da8a9a8ef60104a3888bf5610.jpg"
                                        }
                                    ]
                                }
                            ],
                            "index": 22,
                            "virtual_lines": [
                                {
                                    "bbox": [
                                        77,
                                        375,
                                        533,
                                        483.0
                                    ],
                                    "spans": [],
                                    "index": 21
                                },
                                {
                                    "bbox": [
                                        77,
                                        483.0,
                                        533,
                                        591.0
                                    ],
                                    "spans": [],
                                    "index": 22
                                },
                                {
                                    "bbox": [
                                        77,
                                        591.0,
                                        533,
                                        699.0
                                    ],
                                    "spans": [],
                                    "index": 23
                                }
                            ]
                        },
                        {
                            "type": "image_caption",
                            "bbox": [
                                168,
                                708,
                                442,
                                720
                            ],
                            "group_id": 0,
                            "lines": [
                                {
                                    "bbox": [
                                        170,
                                        708,
                                        441,
                                        719
                                    ],
                                    "spans": [
                                        {
                                            "bbox": [
                                                170,
                                                708,
                                                294,
                                                719
                                            ],
                                            "score": 1.0,
                                            "content": "Figure 4: Attention forward",
                                            "type": "text"
                                        },
                                        {
                                            "bbox": [
                                                294,
                                                709,
                                                304,
                                                718
                                            ],
                                            "score": 0.51,
                                            "content": "^+",
                                            "type": "inline_equation",
                                            "height": 9,
                                            "width": 10
                                        },
                                        {
                                            "bbox": [
                                                305,
                                                708,
                                                441,
                                                719
                                            ],
                                            "score": 1.0,
                                            "content": " backward speed on A100 GPU",
                                            "type": "text"
                                        }
                                    ],
                                    "index": 24
                                }
                            ],
                            "index": 24
                        }
                    ],
                    "index": 21.0,
                    "page_num": "page_9",
                    "page_size": [
                        612.0,
                        792.0
                    ]
                }
            ]
        },
        {
            "preproc_blocks": [
                {
                    "type": "image",
                    "bbox": [
                        78,
                        80,
                        533,
                        401
                    ],
                    "blocks": [
                        {
                            "type": "image_caption",
                            "bbox": [
                                130,
                                74,
                                270,
                                83
                            ],
                            "group_id": 0,
                            "lines": [
                                {
                                    "bbox": [
                                        131,
                                        75,
                                        270,
                                        83
                                    ],
                                    "spans": [
                                        {
                                            "bbox": [
                                                131,
                                                75,
                                                270,
                                                83
                                            ],
                                            "score": 1.0,
                                            "content": "Attention forward speed (A100 80GB SXM4)",
                                            "type": "text"
                                        }
                                    ],
                                    "index": 0
                                }
                            ],
                            "index": 0
                        },
                        {
                            "type": "image_body",
                            "bbox": [
                                78,
                                80,
                                533,
                                401
                            ],
                            "group_id": 0,
                            "lines": [
                                {
                                    "bbox": [
                                        78,
                                        80,
                                        533,
                                        401
                                    ],
                                    "spans": [
                                        {
                                            "bbox": [
                                                78,
                                                80,
                                                533,
                                                401
                                            ],
                                            "score": 0.97,
                                            "type": "image",
                                            "image_path": "4fa953728e905c82938cf1a2263c23f4b9c889f23d94bd5137acd4252de87a41.jpg"
                                        }
                                    ]
                                }
                            ],
                            "index": 2,
                            "virtual_lines": [
                                {
                                    "bbox": [
                                        78,
                                        80,
                                        533,
                                        187.0
                                    ],
                                    "spans": [],
                                    "index": 1
                                },
                                {
                                    "bbox": [
                                        78,
                                        187.0,
                                        533,
                                        294.0
                                    ],
                                    "spans": [],
                                    "index": 2
                                },
                                {
                                    "bbox": [
                                        78,
                                        294.0,
                                        533,
                                        401.0
                                    ],
                                    "spans": [],
                                    "index": 3
                                }
                            ]
                        },
                        {
                            "type": "image_caption",
                            "bbox": [
                                197,
                                410,
                                414,
                                422
                            ],
                            "group_id": 0,
                            "lines": [
                                {
                                    "bbox": [
                                        198,
                                        411,
                                        413,
                                        421
                                    ],
                                    "spans": [
                                        {
                                            "bbox": [
                                                198,
                                                411,
                                                413,
                                                421
                                            ],
                                            "score": 1.0,
                                            "content": "Figure 5: Attention forward speed on A100 GPU",
                                            "type": "text"
                                        }
                                    ],
                                    "index": 4
                                }
                            ],
                            "index": 4
                        }
                    ],
                    "index": 2
                },
                {
                    "type": "text",
                    "bbox": [
                        71,
                        441,
                        541,
                        477
                    ],
                    "lines": [
                        {
                            "bbox": [
                                85,
                                441,
                                540,
                                453
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        85,
                                        441,
                                        540,
                                        453
                                    ],
                                    "score": 1.0,
                                    "content": "Just running the same implementation on H100 GPUs (using no special instructions to make use of new",
                                    "type": "text"
                                }
                            ],
                            "index": 5
                        },
                        {
                            "bbox": [
                                71,
                                454,
                                540,
                                465
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        71,
                                        454,
                                        540,
                                        465
                                    ],
                                    "score": 1.0,
                                    "content": "features such as TMA and 4th-gen Tensor Cores), we obtain up to 335 TFLOPs/s (Fig. 7). We expect that by",
                                    "type": "text"
                                }
                            ],
                            "index": 6
                        },
                        {
                            "bbox": [
                                70,
                                465,
                                541,
                                478
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        465,
                                        541,
                                        478
                                    ],
                                    "score": 1.0,
                                    "content": "using new instructions, we can obtain another 1.5x-2x speedup on H100 GPUs. We leave that to future work.",
                                    "type": "text"
                                }
                            ],
                            "index": 7
                        }
                    ],
                    "index": 6
                },
                {
                    "type": "title",
                    "bbox": [
                        72,
                        490,
                        247,
                        504
                    ],
                    "lines": [
                        {
                            "bbox": [
                                70,
                                491,
                                247,
                                504
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        491,
                                        91,
                                        504
                                    ],
                                    "score": 1.0,
                                    "content": "4.2",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        101,
                                        492,
                                        247,
                                        503
                                    ],
                                    "score": 1.0,
                                    "content": "End-to-end Performance",
                                    "type": "text"
                                }
                            ],
                            "index": 8
                        }
                    ],
                    "index": 8
                },
                {
                    "type": "text",
                    "bbox": [
                        70,
                        510,
                        541,
                        558
                    ],
                    "lines": [
                        {
                            "bbox": [
                                71,
                                511,
                                540,
                                522
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        71,
                                        511,
                                        510,
                                        522
                                    ],
                                    "score": 1.0,
                                    "content": "We measure the training throughput of GPT-style models with either 1.3B or 2.7B parameters, on 8",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        511,
                                        514,
                                        518,
                                        521
                                    ],
                                    "score": 0.46,
                                    "content": "\\times",
                                    "type": "inline_equation",
                                    "height": 7,
                                    "width": 7
                                },
                                {
                                    "bbox": [
                                        518,
                                        511,
                                        540,
                                        522
                                    ],
                                    "score": 1.0,
                                    "content": "A100",
                                    "type": "text"
                                }
                            ],
                            "index": 9
                        },
                        {
                            "bbox": [
                                70,
                                523,
                                541,
                                535
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        523,
                                        541,
                                        535
                                    ],
                                    "score": 1.0,
                                    "content": "80GB SXM. As shown in Table 1, FlashAttention-2 yields 2.8× speedup compared to a baseline without",
                                    "type": "text"
                                }
                            ],
                            "index": 10
                        },
                        {
                            "bbox": [
                                70,
                                535,
                                541,
                                547
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        535,
                                        170,
                                        547
                                    ],
                                    "score": 1.0,
                                    "content": "FlashAttention and 1.3",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        170,
                                        538,
                                        177,
                                        545
                                    ],
                                    "score": 0.29,
                                    "content": "\\times",
                                    "type": "inline_equation",
                                    "height": 7,
                                    "width": 7
                                },
                                {
                                    "bbox": [
                                        177,
                                        535,
                                        541,
                                        547
                                    ],
                                    "score": 1.0,
                                    "content": " speedup compared to FlashAttention-2, reaching up to 225 TFLOPs/s per A100",
                                    "type": "text"
                                }
                            ],
                            "index": 11
                        },
                        {
                            "bbox": [
                                70,
                                547,
                                98,
                                559
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        547,
                                        98,
                                        559
                                    ],
                                    "score": 1.0,
                                    "content": "GPU.",
                                    "type": "text"
                                }
                            ],
                            "index": 12
                        }
                    ],
                    "index": 10.5
                },
                {
                    "type": "text",
                    "bbox": [
                        69,
                        558,
                        538,
                        583
                    ],
                    "lines": [
                        {
                            "bbox": [
                                85,
                                558,
                                540,
                                571
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        85,
                                        558,
                                        540,
                                        571
                                    ],
                                    "score": 1.0,
                                    "content": "Note that we calculate the FLOPs by the formula, following Megatron-LM [16] (and many other papers",
                                    "type": "text"
                                }
                            ],
                            "index": 13
                        },
                        {
                            "bbox": [
                                70,
                                570,
                                134,
                                584
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        570,
                                        134,
                                        584
                                    ],
                                    "score": 1.0,
                                    "content": "and libraries):",
                                    "type": "text"
                                }
                            ],
                            "index": 14
                        }
                    ],
                    "index": 13.5
                },
                {
                    "type": "text",
                    "bbox": [
                        141,
                        589,
                        467,
                        602
                    ],
                    "lines": [
                        {
                            "bbox": [
                                144,
                                590,
                                466,
                                601
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        144,
                                        590,
                                        271,
                                        601
                                    ],
                                    "score": 1.0,
                                    "content": "6 seqlen number of params",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        271,
                                        593,
                                        290,
                                        600
                                    ],
                                    "score": 0.37,
                                    "content": "+12",
                                    "type": "inline_equation",
                                    "height": 7,
                                    "width": 19
                                },
                                {
                                    "bbox": [
                                        290,
                                        590,
                                        426,
                                        601
                                    ],
                                    "score": 1.0,
                                    "content": " number of layers hidden dim",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        426,
                                        596,
                                        431,
                                        599
                                    ],
                                    "score": 0.29,
                                    "content": "\\cdot\\cdot",
                                    "type": "inline_equation",
                                    "height": 3,
                                    "width": 5
                                },
                                {
                                    "bbox": [
                                        432,
                                        590,
                                        466,
                                        601
                                    ],
                                    "score": 1.0,
                                    "content": "seqlen2.",
                                    "type": "text"
                                }
                            ],
                            "index": 15
                        }
                    ],
                    "index": 15
                },
                {
                    "type": "text",
                    "bbox": [
                        70,
                        609,
                        540,
                        657
                    ],
                    "lines": [
                        {
                            "bbox": [
                                71,
                                610,
                                541,
                                621
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        71,
                                        610,
                                        541,
                                        621
                                    ],
                                    "score": 1.0,
                                    "content": "The first term accounts for the FLOPs due to weight–input multiplication, and the second term accounts for",
                                    "type": "text"
                                }
                            ],
                            "index": 16
                        },
                        {
                            "bbox": [
                                71,
                                622,
                                540,
                                632
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        71,
                                        622,
                                        540,
                                        632
                                    ],
                                    "score": 1.0,
                                    "content": "the FLOPs due to attention. However, one can argue that the second term should be halved, as with causal",
                                    "type": "text"
                                }
                            ],
                            "index": 17
                        },
                        {
                            "bbox": [
                                71,
                                635,
                                540,
                                645
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        71,
                                        635,
                                        540,
                                        645
                                    ],
                                    "score": 1.0,
                                    "content": "mask we only need to compute approximately half the number of elements in attention. We choose to follow",
                                    "type": "text"
                                }
                            ],
                            "index": 18
                        },
                        {
                            "bbox": [
                                69,
                                644,
                                477,
                                658
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        69,
                                        644,
                                        477,
                                        658
                                    ],
                                    "score": 1.0,
                                    "content": "the formula from the literature (without dividing the attention FLOPs by 2) for consistency.",
                                    "type": "text"
                                }
                            ],
                            "index": 19
                        }
                    ],
                    "index": 17.5
                },
                {
                    "type": "title",
                    "bbox": [
                        70,
                        673,
                        326,
                        690
                    ],
                    "lines": [
                        {
                            "bbox": [
                                71,
                                676,
                                325,
                                688
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        71,
                                        676,
                                        82,
                                        688
                                    ],
                                    "score": 1.0,
                                    "content": "5",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        90,
                                        676,
                                        325,
                                        688
                                    ],
                                    "score": 1.0,
                                    "content": "Discussion and Future Directions",
                                    "type": "text"
                                }
                            ],
                            "index": 20
                        }
                    ],
                    "index": 20
                },
                {
                    "type": "text",
                    "bbox": [
                        70,
                        699,
                        543,
                        723
                    ],
                    "lines": [
                        {
                            "bbox": [
                                71,
                                700,
                                540,
                                711
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        71,
                                        700,
                                        175,
                                        711
                                    ],
                                    "score": 1.0,
                                    "content": "FlashAttention-2 is ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        176,
                                        702,
                                        187,
                                        709
                                    ],
                                    "score": 0.39,
                                    "content": "2\\times",
                                    "type": "inline_equation",
                                    "height": 7,
                                    "width": 11
                                },
                                {
                                    "bbox": [
                                        188,
                                        700,
                                        540,
                                        711
                                    ],
                                    "score": 1.0,
                                    "content": " faster than FlashAttention, which means that we can train models with 16k",
                                    "type": "text"
                                }
                            ],
                            "index": 21
                        },
                        {
                            "bbox": [
                                71,
                                712,
                                540,
                                722
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        71,
                                        712,
                                        540,
                                        722
                                    ],
                                    "score": 1.0,
                                    "content": "longer context for the same price as previously training a 8k context model. We are excited about how this can",
                                    "type": "text"
                                }
                            ],
                            "index": 22
                        }
                    ],
                    "index": 21.5
                }
            ],
            "layout_bboxes": [],
            "page_idx": 10,
            "page_size": [
                612.0,
                792.0
            ],
            "_layout_tree": [],
            "images": [
                {
                    "type": "image",
                    "bbox": [
                        78,
                        80,
                        533,
                        401
                    ],
                    "blocks": [
                        {
                            "type": "image_caption",
                            "bbox": [
                                130,
                                74,
                                270,
                                83
                            ],
                            "group_id": 0,
                            "lines": [
                                {
                                    "bbox": [
                                        131,
                                        75,
                                        270,
                                        83
                                    ],
                                    "spans": [
                                        {
                                            "bbox": [
                                                131,
                                                75,
                                                270,
                                                83
                                            ],
                                            "score": 1.0,
                                            "content": "Attention forward speed (A100 80GB SXM4)",
                                            "type": "text"
                                        }
                                    ],
                                    "index": 0
                                }
                            ],
                            "index": 0
                        },
                        {
                            "type": "image_body",
                            "bbox": [
                                78,
                                80,
                                533,
                                401
                            ],
                            "group_id": 0,
                            "lines": [
                                {
                                    "bbox": [
                                        78,
                                        80,
                                        533,
                                        401
                                    ],
                                    "spans": [
                                        {
                                            "bbox": [
                                                78,
                                                80,
                                                533,
                                                401
                                            ],
                                            "score": 0.97,
                                            "type": "image",
                                            "image_path": "4fa953728e905c82938cf1a2263c23f4b9c889f23d94bd5137acd4252de87a41.jpg"
                                        }
                                    ]
                                }
                            ],
                            "index": 2,
                            "virtual_lines": [
                                {
                                    "bbox": [
                                        78,
                                        80,
                                        533,
                                        187.0
                                    ],
                                    "spans": [],
                                    "index": 1
                                },
                                {
                                    "bbox": [
                                        78,
                                        187.0,
                                        533,
                                        294.0
                                    ],
                                    "spans": [],
                                    "index": 2
                                },
                                {
                                    "bbox": [
                                        78,
                                        294.0,
                                        533,
                                        401.0
                                    ],
                                    "spans": [],
                                    "index": 3
                                }
                            ]
                        },
                        {
                            "type": "image_caption",
                            "bbox": [
                                197,
                                410,
                                414,
                                422
                            ],
                            "group_id": 0,
                            "lines": [
                                {
                                    "bbox": [
                                        198,
                                        411,
                                        413,
                                        421
                                    ],
                                    "spans": [
                                        {
                                            "bbox": [
                                                198,
                                                411,
                                                413,
                                                421
                                            ],
                                            "score": 1.0,
                                            "content": "Figure 5: Attention forward speed on A100 GPU",
                                            "type": "text"
                                        }
                                    ],
                                    "index": 4
                                }
                            ],
                            "index": 4
                        }
                    ],
                    "index": 2
                }
            ],
            "tables": [],
            "interline_equations": [],
            "discarded_blocks": [
                {
                    "type": "discarded",
                    "bbox": [
                        300,
                        742,
                        310,
                        751
                    ],
                    "lines": [
                        {
                            "bbox": [
                                298,
                                741,
                                313,
                                753
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        298,
                                        741,
                                        313,
                                        753
                                    ],
                                    "score": 1.0,
                                    "content": "",
                                    "type": "text",
                                    "height": 12,
                                    "width": 15
                                }
                            ]
                        }
                    ]
                },
                {
                    "type": "discarded",
                    "bbox": [
                        364,
                        75,
                        504,
                        82
                    ],
                    "lines": [
                        {
                            "bbox": [
                                365,
                                75,
                                503,
                                83
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        365,
                                        75,
                                        503,
                                        83
                                    ],
                                    "score": 1.0,
                                    "content": "Attention forward speed (A100 80GB SXM4)",
                                    "type": "text"
                                }
                            ]
                        }
                    ]
                }
            ],
            "need_drop": false,
            "drop_reason": [],
            "para_blocks": [
                {
                    "type": "image",
                    "bbox": [
                        78,
                        80,
                        533,
                        401
                    ],
                    "blocks": [
                        {
                            "type": "image_caption",
                            "bbox": [
                                130,
                                74,
                                270,
                                83
                            ],
                            "group_id": 0,
                            "lines": [
                                {
                                    "bbox": [
                                        131,
                                        75,
                                        270,
                                        83
                                    ],
                                    "spans": [
                                        {
                                            "bbox": [
                                                131,
                                                75,
                                                270,
                                                83
                                            ],
                                            "score": 1.0,
                                            "content": "Attention forward speed (A100 80GB SXM4)",
                                            "type": "text"
                                        }
                                    ],
                                    "index": 0
                                }
                            ],
                            "index": 0
                        },
                        {
                            "type": "image_body",
                            "bbox": [
                                78,
                                80,
                                533,
                                401
                            ],
                            "group_id": 0,
                            "lines": [
                                {
                                    "bbox": [
                                        78,
                                        80,
                                        533,
                                        401
                                    ],
                                    "spans": [
                                        {
                                            "bbox": [
                                                78,
                                                80,
                                                533,
                                                401
                                            ],
                                            "score": 0.97,
                                            "type": "image",
                                            "image_path": "4fa953728e905c82938cf1a2263c23f4b9c889f23d94bd5137acd4252de87a41.jpg"
                                        }
                                    ]
                                }
                            ],
                            "index": 2,
                            "virtual_lines": [
                                {
                                    "bbox": [
                                        78,
                                        80,
                                        533,
                                        187.0
                                    ],
                                    "spans": [],
                                    "index": 1
                                },
                                {
                                    "bbox": [
                                        78,
                                        187.0,
                                        533,
                                        294.0
                                    ],
                                    "spans": [],
                                    "index": 2
                                },
                                {
                                    "bbox": [
                                        78,
                                        294.0,
                                        533,
                                        401.0
                                    ],
                                    "spans": [],
                                    "index": 3
                                }
                            ]
                        },
                        {
                            "type": "image_caption",
                            "bbox": [
                                197,
                                410,
                                414,
                                422
                            ],
                            "group_id": 0,
                            "lines": [
                                {
                                    "bbox": [
                                        198,
                                        411,
                                        413,
                                        421
                                    ],
                                    "spans": [
                                        {
                                            "bbox": [
                                                198,
                                                411,
                                                413,
                                                421
                                            ],
                                            "score": 1.0,
                                            "content": "Figure 5: Attention forward speed on A100 GPU",
                                            "type": "text"
                                        }
                                    ],
                                    "index": 4
                                }
                            ],
                            "index": 4
                        }
                    ],
                    "index": 2,
                    "page_num": "page_10",
                    "page_size": [
                        612.0,
                        792.0
                    ]
                },
                {
                    "type": "text",
                    "bbox": [
                        71,
                        441,
                        541,
                        477
                    ],
                    "lines": [
                        {
                            "bbox": [
                                85,
                                441,
                                540,
                                453
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        85,
                                        441,
                                        540,
                                        453
                                    ],
                                    "score": 1.0,
                                    "content": "Just running the same implementation on H100 GPUs (using no special instructions to make use of new",
                                    "type": "text"
                                }
                            ],
                            "index": 5
                        },
                        {
                            "bbox": [
                                71,
                                454,
                                540,
                                465
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        71,
                                        454,
                                        540,
                                        465
                                    ],
                                    "score": 1.0,
                                    "content": "features such as TMA and 4th-gen Tensor Cores), we obtain up to 335 TFLOPs/s (Fig. 7). We expect that by",
                                    "type": "text"
                                }
                            ],
                            "index": 6
                        },
                        {
                            "bbox": [
                                70,
                                465,
                                541,
                                478
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        465,
                                        541,
                                        478
                                    ],
                                    "score": 1.0,
                                    "content": "using new instructions, we can obtain another 1.5x-2x speedup on H100 GPUs. We leave that to future work.",
                                    "type": "text"
                                }
                            ],
                            "index": 7
                        }
                    ],
                    "index": 6,
                    "page_num": "page_10",
                    "page_size": [
                        612.0,
                        792.0
                    ],
                    "bbox_fs": [
                        70,
                        441,
                        541,
                        478
                    ]
                },
                {
                    "type": "title",
                    "bbox": [
                        72,
                        490,
                        247,
                        504
                    ],
                    "lines": [
                        {
                            "bbox": [
                                70,
                                491,
                                247,
                                504
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        491,
                                        91,
                                        504
                                    ],
                                    "score": 1.0,
                                    "content": "4.2",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        101,
                                        492,
                                        247,
                                        503
                                    ],
                                    "score": 1.0,
                                    "content": "End-to-end Performance",
                                    "type": "text"
                                }
                            ],
                            "index": 8
                        }
                    ],
                    "index": 8,
                    "page_num": "page_10",
                    "page_size": [
                        612.0,
                        792.0
                    ]
                },
                {
                    "type": "text",
                    "bbox": [
                        70,
                        510,
                        541,
                        558
                    ],
                    "lines": [
                        {
                            "bbox": [
                                71,
                                511,
                                540,
                                522
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        71,
                                        511,
                                        510,
                                        522
                                    ],
                                    "score": 1.0,
                                    "content": "We measure the training throughput of GPT-style models with either 1.3B or 2.7B parameters, on 8",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        511,
                                        514,
                                        518,
                                        521
                                    ],
                                    "score": 0.46,
                                    "content": "\\times",
                                    "type": "inline_equation",
                                    "height": 7,
                                    "width": 7
                                },
                                {
                                    "bbox": [
                                        518,
                                        511,
                                        540,
                                        522
                                    ],
                                    "score": 1.0,
                                    "content": "A100",
                                    "type": "text"
                                }
                            ],
                            "index": 9
                        },
                        {
                            "bbox": [
                                70,
                                523,
                                541,
                                535
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        523,
                                        541,
                                        535
                                    ],
                                    "score": 1.0,
                                    "content": "80GB SXM. As shown in Table 1, FlashAttention-2 yields 2.8× speedup compared to a baseline without",
                                    "type": "text"
                                }
                            ],
                            "index": 10
                        },
                        {
                            "bbox": [
                                70,
                                535,
                                541,
                                547
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        535,
                                        170,
                                        547
                                    ],
                                    "score": 1.0,
                                    "content": "FlashAttention and 1.3",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        170,
                                        538,
                                        177,
                                        545
                                    ],
                                    "score": 0.29,
                                    "content": "\\times",
                                    "type": "inline_equation",
                                    "height": 7,
                                    "width": 7
                                },
                                {
                                    "bbox": [
                                        177,
                                        535,
                                        541,
                                        547
                                    ],
                                    "score": 1.0,
                                    "content": " speedup compared to FlashAttention-2, reaching up to 225 TFLOPs/s per A100",
                                    "type": "text"
                                }
                            ],
                            "index": 11
                        },
                        {
                            "bbox": [
                                70,
                                547,
                                98,
                                559
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        547,
                                        98,
                                        559
                                    ],
                                    "score": 1.0,
                                    "content": "GPU.",
                                    "type": "text"
                                }
                            ],
                            "index": 12
                        }
                    ],
                    "index": 10.5,
                    "page_num": "page_10",
                    "page_size": [
                        612.0,
                        792.0
                    ],
                    "bbox_fs": [
                        70,
                        511,
                        541,
                        559
                    ]
                },
                {
                    "type": "text",
                    "bbox": [
                        69,
                        558,
                        538,
                        583
                    ],
                    "lines": [
                        {
                            "bbox": [
                                85,
                                558,
                                540,
                                571
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        85,
                                        558,
                                        540,
                                        571
                                    ],
                                    "score": 1.0,
                                    "content": "Note that we calculate the FLOPs by the formula, following Megatron-LM [16] (and many other papers",
                                    "type": "text"
                                }
                            ],
                            "index": 13
                        },
                        {
                            "bbox": [
                                70,
                                570,
                                134,
                                584
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        570,
                                        134,
                                        584
                                    ],
                                    "score": 1.0,
                                    "content": "and libraries):",
                                    "type": "text"
                                }
                            ],
                            "index": 14
                        }
                    ],
                    "index": 13.5,
                    "page_num": "page_10",
                    "page_size": [
                        612.0,
                        792.0
                    ],
                    "bbox_fs": [
                        70,
                        558,
                        540,
                        584
                    ]
                },
                {
                    "type": "text",
                    "bbox": [
                        141,
                        589,
                        467,
                        602
                    ],
                    "lines": [
                        {
                            "bbox": [
                                144,
                                590,
                                466,
                                601
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        144,
                                        590,
                                        271,
                                        601
                                    ],
                                    "score": 1.0,
                                    "content": "6 seqlen number of params",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        271,
                                        593,
                                        290,
                                        600
                                    ],
                                    "score": 0.37,
                                    "content": "+12",
                                    "type": "inline_equation",
                                    "height": 7,
                                    "width": 19
                                },
                                {
                                    "bbox": [
                                        290,
                                        590,
                                        426,
                                        601
                                    ],
                                    "score": 1.0,
                                    "content": " number of layers hidden dim",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        426,
                                        596,
                                        431,
                                        599
                                    ],
                                    "score": 0.29,
                                    "content": "\\cdot\\cdot",
                                    "type": "inline_equation",
                                    "height": 3,
                                    "width": 5
                                },
                                {
                                    "bbox": [
                                        432,
                                        590,
                                        466,
                                        601
                                    ],
                                    "score": 1.0,
                                    "content": "seqlen2.",
                                    "type": "text"
                                }
                            ],
                            "index": 15
                        }
                    ],
                    "index": 15,
                    "page_num": "page_10",
                    "page_size": [
                        612.0,
                        792.0
                    ],
                    "bbox_fs": [
                        144,
                        590,
                        466,
                        601
                    ]
                },
                {
                    "type": "text",
                    "bbox": [
                        70,
                        609,
                        540,
                        657
                    ],
                    "lines": [
                        {
                            "bbox": [
                                71,
                                610,
                                541,
                                621
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        71,
                                        610,
                                        541,
                                        621
                                    ],
                                    "score": 1.0,
                                    "content": "The first term accounts for the FLOPs due to weight–input multiplication, and the second term accounts for",
                                    "type": "text"
                                }
                            ],
                            "index": 16
                        },
                        {
                            "bbox": [
                                71,
                                622,
                                540,
                                632
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        71,
                                        622,
                                        540,
                                        632
                                    ],
                                    "score": 1.0,
                                    "content": "the FLOPs due to attention. However, one can argue that the second term should be halved, as with causal",
                                    "type": "text"
                                }
                            ],
                            "index": 17
                        },
                        {
                            "bbox": [
                                71,
                                635,
                                540,
                                645
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        71,
                                        635,
                                        540,
                                        645
                                    ],
                                    "score": 1.0,
                                    "content": "mask we only need to compute approximately half the number of elements in attention. We choose to follow",
                                    "type": "text"
                                }
                            ],
                            "index": 18
                        },
                        {
                            "bbox": [
                                69,
                                644,
                                477,
                                658
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        69,
                                        644,
                                        477,
                                        658
                                    ],
                                    "score": 1.0,
                                    "content": "the formula from the literature (without dividing the attention FLOPs by 2) for consistency.",
                                    "type": "text"
                                }
                            ],
                            "index": 19
                        }
                    ],
                    "index": 17.5,
                    "page_num": "page_10",
                    "page_size": [
                        612.0,
                        792.0
                    ],
                    "bbox_fs": [
                        69,
                        610,
                        541,
                        658
                    ]
                },
                {
                    "type": "title",
                    "bbox": [
                        70,
                        673,
                        326,
                        690
                    ],
                    "lines": [
                        {
                            "bbox": [
                                71,
                                676,
                                325,
                                688
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        71,
                                        676,
                                        82,
                                        688
                                    ],
                                    "score": 1.0,
                                    "content": "5",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        90,
                                        676,
                                        325,
                                        688
                                    ],
                                    "score": 1.0,
                                    "content": "Discussion and Future Directions",
                                    "type": "text"
                                }
                            ],
                            "index": 20
                        }
                    ],
                    "index": 20,
                    "page_num": "page_10",
                    "page_size": [
                        612.0,
                        792.0
                    ]
                },
                {
                    "type": "text",
                    "bbox": [
                        70,
                        699,
                        543,
                        723
                    ],
                    "lines": [
                        {
                            "bbox": [
                                71,
                                700,
                                540,
                                711
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        71,
                                        700,
                                        175,
                                        711
                                    ],
                                    "score": 1.0,
                                    "content": "FlashAttention-2 is ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        176,
                                        702,
                                        187,
                                        709
                                    ],
                                    "score": 0.39,
                                    "content": "2\\times",
                                    "type": "inline_equation",
                                    "height": 7,
                                    "width": 11
                                },
                                {
                                    "bbox": [
                                        188,
                                        700,
                                        540,
                                        711
                                    ],
                                    "score": 1.0,
                                    "content": " faster than FlashAttention, which means that we can train models with 16k",
                                    "type": "text"
                                }
                            ],
                            "index": 21
                        },
                        {
                            "bbox": [
                                71,
                                712,
                                540,
                                722
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        71,
                                        712,
                                        540,
                                        722
                                    ],
                                    "score": 1.0,
                                    "content": "longer context for the same price as previously training a 8k context model. We are excited about how this can",
                                    "type": "text"
                                }
                            ],
                            "index": 22
                        },
                        {
                            "bbox": [
                                70,
                                561,
                                541,
                                573
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        561,
                                        541,
                                        573
                                    ],
                                    "score": 1.0,
                                    "content": "be used to understand long books and reports, high resolution images, audio and video. FlashAttention-2",
                                    "type": "text",
                                    "cross_page": true
                                }
                            ],
                            "index": 10
                        },
                        {
                            "bbox": [
                                71,
                                574,
                                385,
                                585
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        71,
                                        574,
                                        385,
                                        585
                                    ],
                                    "score": 1.0,
                                    "content": "will also speed up training, finetuning, and inference of existing models.",
                                    "type": "text",
                                    "cross_page": true
                                }
                            ],
                            "index": 11
                        }
                    ],
                    "index": 21.5,
                    "page_num": "page_10",
                    "page_size": [
                        612.0,
                        792.0
                    ],
                    "bbox_fs": [
                        71,
                        700,
                        540,
                        722
                    ]
                }
            ]
        },
        {
            "preproc_blocks": [
                {
                    "type": "image",
                    "bbox": [
                        78,
                        82,
                        533,
                        402
                    ],
                    "blocks": [
                        {
                            "type": "image_body",
                            "bbox": [
                                78,
                                82,
                                533,
                                402
                            ],
                            "group_id": 0,
                            "lines": [
                                {
                                    "bbox": [
                                        78,
                                        82,
                                        533,
                                        402
                                    ],
                                    "spans": [
                                        {
                                            "bbox": [
                                                78,
                                                82,
                                                533,
                                                402
                                            ],
                                            "score": 0.971,
                                            "type": "image",
                                            "image_path": "e362975793b7acf47fa0d91c35efc7052feb7dc2b6a8a45effddf73f4939f08d.jpg"
                                        }
                                    ]
                                }
                            ],
                            "index": 1,
                            "virtual_lines": [
                                {
                                    "bbox": [
                                        78,
                                        82,
                                        533,
                                        188.66666666666669
                                    ],
                                    "spans": [],
                                    "index": 0
                                },
                                {
                                    "bbox": [
                                        78,
                                        188.66666666666669,
                                        533,
                                        295.33333333333337
                                    ],
                                    "spans": [],
                                    "index": 1
                                },
                                {
                                    "bbox": [
                                        78,
                                        295.33333333333337,
                                        533,
                                        402.00000000000006
                                    ],
                                    "spans": [],
                                    "index": 2
                                }
                            ]
                        },
                        {
                            "type": "image_caption",
                            "bbox": [
                                192,
                                410,
                                418,
                                422
                            ],
                            "group_id": 0,
                            "lines": [
                                {
                                    "bbox": [
                                        194,
                                        411,
                                        417,
                                        421
                                    ],
                                    "spans": [
                                        {
                                            "bbox": [
                                                194,
                                                411,
                                                417,
                                                421
                                            ],
                                            "score": 1.0,
                                            "content": "Figure 6: Attention backward speed on A100 GPU",
                                            "type": "text"
                                        }
                                    ],
                                    "index": 3
                                }
                            ],
                            "index": 3
                        }
                    ],
                    "index": 2.0
                },
                {
                    "type": "table",
                    "bbox": [
                        88,
                        478,
                        519,
                        542
                    ],
                    "blocks": [
                        {
                            "type": "table_caption",
                            "bbox": [
                                70,
                                433,
                                541,
                                469
                            ],
                            "group_id": 0,
                            "lines": [
                                {
                                    "bbox": [
                                        70,
                                        434,
                                        541,
                                        446
                                    ],
                                    "spans": [
                                        {
                                            "bbox": [
                                                70,
                                                434,
                                                380,
                                                446
                                            ],
                                            "score": 1.0,
                                            "content": "Table 1: Training speed (TFLOPs/s/GPU) of GPT-style models on 8",
                                            "type": "text"
                                        },
                                        {
                                            "bbox": [
                                                381,
                                                437,
                                                388,
                                                444
                                            ],
                                            "score": 0.27,
                                            "content": "\\times",
                                            "type": "inline_equation",
                                            "height": 7,
                                            "width": 7
                                        },
                                        {
                                            "bbox": [
                                                389,
                                                434,
                                                541,
                                                446
                                            ],
                                            "score": 1.0,
                                            "content": "A100 GPUs. FlashAttention-2",
                                            "type": "text"
                                        }
                                    ],
                                    "index": 4
                                },
                                {
                                    "bbox": [
                                        71,
                                        447,
                                        541,
                                        457
                                    ],
                                    "spans": [
                                        {
                                            "bbox": [
                                                71,
                                                447,
                                                541,
                                                457
                                            ],
                                            "score": 1.0,
                                            "content": "reaches up to 225 TFLOPs/s (72% model FLOPs utilization). We compare against a baseline running without",
                                            "type": "text"
                                        }
                                    ],
                                    "index": 5
                                },
                                {
                                    "bbox": [
                                        71,
                                        459,
                                        156,
                                        469
                                    ],
                                    "spans": [
                                        {
                                            "bbox": [
                                                71,
                                                459,
                                                156,
                                                469
                                            ],
                                            "score": 1.0,
                                            "content": "FlashAttention.",
                                            "type": "text"
                                        }
                                    ],
                                    "index": 6
                                }
                            ],
                            "index": 5
                        },
                        {
                            "type": "table_body",
                            "bbox": [
                                88,
                                478,
                                519,
                                542
                            ],
                            "group_id": 0,
                            "lines": [
                                {
                                    "bbox": [
                                        88,
                                        478,
                                        519,
                                        542
                                    ],
                                    "spans": [
                                        {
                                            "bbox": [
                                                88,
                                                478,
                                                519,
                                                542
                                            ],
                                            "score": 0.969,
                                            "type": "table",
                                            "image_path": "4d50f360b9b485cc1e5bce486190db6cbfb9609bcbc1e015066107e155eb500f.jpg"
                                        }
                                    ]
                                }
                            ],
                            "index": 8,
                            "virtual_lines": [
                                {
                                    "bbox": [
                                        88,
                                        478,
                                        519,
                                        499.3333333333333
                                    ],
                                    "spans": [],
                                    "index": 7
                                },
                                {
                                    "bbox": [
                                        88,
                                        499.3333333333333,
                                        519,
                                        520.6666666666666
                                    ],
                                    "spans": [],
                                    "index": 8
                                },
                                {
                                    "bbox": [
                                        88,
                                        520.6666666666666,
                                        519,
                                        542.0
                                    ],
                                    "spans": [],
                                    "index": 9
                                }
                            ]
                        }
                    ],
                    "index": 6.5
                },
                {
                    "type": "text",
                    "bbox": [
                        73,
                        561,
                        539,
                        585
                    ],
                    "lines": [
                        {
                            "bbox": [
                                70,
                                561,
                                541,
                                573
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        561,
                                        541,
                                        573
                                    ],
                                    "score": 1.0,
                                    "content": "be used to understand long books and reports, high resolution images, audio and video. FlashAttention-2",
                                    "type": "text"
                                }
                            ],
                            "index": 10
                        },
                        {
                            "bbox": [
                                71,
                                574,
                                385,
                                585
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        71,
                                        574,
                                        385,
                                        585
                                    ],
                                    "score": 1.0,
                                    "content": "will also speed up training, finetuning, and inference of existing models.",
                                    "type": "text"
                                }
                            ],
                            "index": 11
                        }
                    ],
                    "index": 10.5
                },
                {
                    "type": "text",
                    "bbox": [
                        70,
                        586,
                        541,
                        669
                    ],
                    "lines": [
                        {
                            "bbox": [
                                84,
                                585,
                                541,
                                597
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        84,
                                        585,
                                        541,
                                        597
                                    ],
                                    "score": 1.0,
                                    "content": "In the near future, we plan to collaborate with researchers and engineers to make FlashAttention widely",
                                    "type": "text"
                                }
                            ],
                            "index": 12
                        },
                        {
                            "bbox": [
                                71,
                                597,
                                541,
                                609
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        71,
                                        597,
                                        541,
                                        609
                                    ],
                                    "score": 1.0,
                                    "content": "applicable in different kinds of devices (e.g., H100 GPUs, AMD GPUs), as well as new data types such as",
                                    "type": "text"
                                }
                            ],
                            "index": 13
                        },
                        {
                            "bbox": [
                                70,
                                610,
                                541,
                                622
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        610,
                                        541,
                                        622
                                    ],
                                    "score": 1.0,
                                    "content": "FP8. As an immediate next step, we plan to optimize FlashAttention-2 for H100 GPUs to use new hardware",
                                    "type": "text"
                                }
                            ],
                            "index": 14
                        },
                        {
                            "bbox": [
                                70,
                                622,
                                540,
                                633
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        622,
                                        540,
                                        633
                                    ],
                                    "score": 1.0,
                                    "content": "features (TMA, 4th-gen Tensor Cores, fp8). Combining the low-level optimizations in FlashAttention-2 with",
                                    "type": "text"
                                }
                            ],
                            "index": 15
                        },
                        {
                            "bbox": [
                                70,
                                634,
                                541,
                                645
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        634,
                                        541,
                                        645
                                    ],
                                    "score": 1.0,
                                    "content": "high-level algorithmic changes (e.g., local, dilated, block-sparse attention) could allow us to train AI models",
                                    "type": "text"
                                }
                            ],
                            "index": 16
                        },
                        {
                            "bbox": [
                                70,
                                645,
                                541,
                                657
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        645,
                                        541,
                                        657
                                    ],
                                    "score": 1.0,
                                    "content": "with much longer context. We are also excited to work with compiler researchers to make these optimization",
                                    "type": "text"
                                }
                            ],
                            "index": 17
                        },
                        {
                            "bbox": [
                                70,
                                658,
                                214,
                                669
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        658,
                                        214,
                                        669
                                    ],
                                    "score": 1.0,
                                    "content": "techniques easily programmable.",
                                    "type": "text"
                                }
                            ],
                            "index": 18
                        }
                    ],
                    "index": 15
                }
            ],
            "layout_bboxes": [],
            "page_idx": 11,
            "page_size": [
                612.0,
                792.0
            ],
            "_layout_tree": [],
            "images": [
                {
                    "type": "image",
                    "bbox": [
                        78,
                        82,
                        533,
                        402
                    ],
                    "blocks": [
                        {
                            "type": "image_body",
                            "bbox": [
                                78,
                                82,
                                533,
                                402
                            ],
                            "group_id": 0,
                            "lines": [
                                {
                                    "bbox": [
                                        78,
                                        82,
                                        533,
                                        402
                                    ],
                                    "spans": [
                                        {
                                            "bbox": [
                                                78,
                                                82,
                                                533,
                                                402
                                            ],
                                            "score": 0.971,
                                            "type": "image",
                                            "image_path": "e362975793b7acf47fa0d91c35efc7052feb7dc2b6a8a45effddf73f4939f08d.jpg"
                                        }
                                    ]
                                }
                            ],
                            "index": 1,
                            "virtual_lines": [
                                {
                                    "bbox": [
                                        78,
                                        82,
                                        533,
                                        188.66666666666669
                                    ],
                                    "spans": [],
                                    "index": 0
                                },
                                {
                                    "bbox": [
                                        78,
                                        188.66666666666669,
                                        533,
                                        295.33333333333337
                                    ],
                                    "spans": [],
                                    "index": 1
                                },
                                {
                                    "bbox": [
                                        78,
                                        295.33333333333337,
                                        533,
                                        402.00000000000006
                                    ],
                                    "spans": [],
                                    "index": 2
                                }
                            ]
                        },
                        {
                            "type": "image_caption",
                            "bbox": [
                                192,
                                410,
                                418,
                                422
                            ],
                            "group_id": 0,
                            "lines": [
                                {
                                    "bbox": [
                                        194,
                                        411,
                                        417,
                                        421
                                    ],
                                    "spans": [
                                        {
                                            "bbox": [
                                                194,
                                                411,
                                                417,
                                                421
                                            ],
                                            "score": 1.0,
                                            "content": "Figure 6: Attention backward speed on A100 GPU",
                                            "type": "text"
                                        }
                                    ],
                                    "index": 3
                                }
                            ],
                            "index": 3
                        }
                    ],
                    "index": 2.0
                }
            ],
            "tables": [
                {
                    "type": "table",
                    "bbox": [
                        88,
                        478,
                        519,
                        542
                    ],
                    "blocks": [
                        {
                            "type": "table_caption",
                            "bbox": [
                                70,
                                433,
                                541,
                                469
                            ],
                            "group_id": 0,
                            "lines": [
                                {
                                    "bbox": [
                                        70,
                                        434,
                                        541,
                                        446
                                    ],
                                    "spans": [
                                        {
                                            "bbox": [
                                                70,
                                                434,
                                                380,
                                                446
                                            ],
                                            "score": 1.0,
                                            "content": "Table 1: Training speed (TFLOPs/s/GPU) of GPT-style models on 8",
                                            "type": "text"
                                        },
                                        {
                                            "bbox": [
                                                381,
                                                437,
                                                388,
                                                444
                                            ],
                                            "score": 0.27,
                                            "content": "\\times",
                                            "type": "inline_equation",
                                            "height": 7,
                                            "width": 7
                                        },
                                        {
                                            "bbox": [
                                                389,
                                                434,
                                                541,
                                                446
                                            ],
                                            "score": 1.0,
                                            "content": "A100 GPUs. FlashAttention-2",
                                            "type": "text"
                                        }
                                    ],
                                    "index": 4
                                },
                                {
                                    "bbox": [
                                        71,
                                        447,
                                        541,
                                        457
                                    ],
                                    "spans": [
                                        {
                                            "bbox": [
                                                71,
                                                447,
                                                541,
                                                457
                                            ],
                                            "score": 1.0,
                                            "content": "reaches up to 225 TFLOPs/s (72% model FLOPs utilization). We compare against a baseline running without",
                                            "type": "text"
                                        }
                                    ],
                                    "index": 5
                                },
                                {
                                    "bbox": [
                                        71,
                                        459,
                                        156,
                                        469
                                    ],
                                    "spans": [
                                        {
                                            "bbox": [
                                                71,
                                                459,
                                                156,
                                                469
                                            ],
                                            "score": 1.0,
                                            "content": "FlashAttention.",
                                            "type": "text"
                                        }
                                    ],
                                    "index": 6
                                }
                            ],
                            "index": 5
                        },
                        {
                            "type": "table_body",
                            "bbox": [
                                88,
                                478,
                                519,
                                542
                            ],
                            "group_id": 0,
                            "lines": [
                                {
                                    "bbox": [
                                        88,
                                        478,
                                        519,
                                        542
                                    ],
                                    "spans": [
                                        {
                                            "bbox": [
                                                88,
                                                478,
                                                519,
                                                542
                                            ],
                                            "score": 0.969,
                                            "type": "table",
                                            "image_path": "4d50f360b9b485cc1e5bce486190db6cbfb9609bcbc1e015066107e155eb500f.jpg"
                                        }
                                    ]
                                }
                            ],
                            "index": 8,
                            "virtual_lines": [
                                {
                                    "bbox": [
                                        88,
                                        478,
                                        519,
                                        499.3333333333333
                                    ],
                                    "spans": [],
                                    "index": 7
                                },
                                {
                                    "bbox": [
                                        88,
                                        499.3333333333333,
                                        519,
                                        520.6666666666666
                                    ],
                                    "spans": [],
                                    "index": 8
                                },
                                {
                                    "bbox": [
                                        88,
                                        520.6666666666666,
                                        519,
                                        542.0
                                    ],
                                    "spans": [],
                                    "index": 9
                                }
                            ]
                        }
                    ],
                    "index": 6.5
                }
            ],
            "interline_equations": [],
            "discarded_blocks": [
                {
                    "type": "discarded",
                    "bbox": [
                        300,
                        742,
                        311,
                        751
                    ],
                    "lines": [
                        {
                            "bbox": [
                                298,
                                741,
                                314,
                                754
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        298,
                                        741,
                                        314,
                                        754
                                    ],
                                    "score": 1.0,
                                    "content": "",
                                    "type": "text",
                                    "height": 13,
                                    "width": 16
                                }
                            ]
                        }
                    ]
                },
                {
                    "type": "discarded",
                    "bbox": [
                        362,
                        75,
                        506,
                        83
                    ],
                    "lines": [
                        {
                            "bbox": [
                                362,
                                75,
                                506,
                                82
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        362,
                                        75,
                                        506,
                                        82
                                    ],
                                    "score": 1.0,
                                    "content": "Attention backward speed (A100 80GB SXM4)",
                                    "type": "text"
                                }
                            ]
                        }
                    ]
                },
                {
                    "type": "discarded",
                    "bbox": [
                        127,
                        75,
                        273,
                        83
                    ],
                    "lines": [
                        {
                            "bbox": [
                                128,
                                75,
                                272,
                                82
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        128,
                                        75,
                                        272,
                                        82
                                    ],
                                    "score": 1.0,
                                    "content": "Attention backward speed (A100 80GB SXM4)",
                                    "type": "text"
                                }
                            ]
                        }
                    ]
                }
            ],
            "need_drop": false,
            "drop_reason": [],
            "para_blocks": [
                {
                    "type": "image",
                    "bbox": [
                        78,
                        82,
                        533,
                        402
                    ],
                    "blocks": [
                        {
                            "type": "image_body",
                            "bbox": [
                                78,
                                82,
                                533,
                                402
                            ],
                            "group_id": 0,
                            "lines": [
                                {
                                    "bbox": [
                                        78,
                                        82,
                                        533,
                                        402
                                    ],
                                    "spans": [
                                        {
                                            "bbox": [
                                                78,
                                                82,
                                                533,
                                                402
                                            ],
                                            "score": 0.971,
                                            "type": "image",
                                            "image_path": "e362975793b7acf47fa0d91c35efc7052feb7dc2b6a8a45effddf73f4939f08d.jpg"
                                        }
                                    ]
                                }
                            ],
                            "index": 1,
                            "virtual_lines": [
                                {
                                    "bbox": [
                                        78,
                                        82,
                                        533,
                                        188.66666666666669
                                    ],
                                    "spans": [],
                                    "index": 0
                                },
                                {
                                    "bbox": [
                                        78,
                                        188.66666666666669,
                                        533,
                                        295.33333333333337
                                    ],
                                    "spans": [],
                                    "index": 1
                                },
                                {
                                    "bbox": [
                                        78,
                                        295.33333333333337,
                                        533,
                                        402.00000000000006
                                    ],
                                    "spans": [],
                                    "index": 2
                                }
                            ]
                        },
                        {
                            "type": "image_caption",
                            "bbox": [
                                192,
                                410,
                                418,
                                422
                            ],
                            "group_id": 0,
                            "lines": [
                                {
                                    "bbox": [
                                        194,
                                        411,
                                        417,
                                        421
                                    ],
                                    "spans": [
                                        {
                                            "bbox": [
                                                194,
                                                411,
                                                417,
                                                421
                                            ],
                                            "score": 1.0,
                                            "content": "Figure 6: Attention backward speed on A100 GPU",
                                            "type": "text"
                                        }
                                    ],
                                    "index": 3
                                }
                            ],
                            "index": 3
                        }
                    ],
                    "index": 2.0,
                    "page_num": "page_11",
                    "page_size": [
                        612.0,
                        792.0
                    ]
                },
                {
                    "type": "table",
                    "bbox": [
                        88,
                        478,
                        519,
                        542
                    ],
                    "blocks": [
                        {
                            "type": "table_caption",
                            "bbox": [
                                70,
                                433,
                                541,
                                469
                            ],
                            "group_id": 0,
                            "lines": [
                                {
                                    "bbox": [
                                        70,
                                        434,
                                        541,
                                        446
                                    ],
                                    "spans": [
                                        {
                                            "bbox": [
                                                70,
                                                434,
                                                380,
                                                446
                                            ],
                                            "score": 1.0,
                                            "content": "Table 1: Training speed (TFLOPs/s/GPU) of GPT-style models on 8",
                                            "type": "text"
                                        },
                                        {
                                            "bbox": [
                                                381,
                                                437,
                                                388,
                                                444
                                            ],
                                            "score": 0.27,
                                            "content": "\\times",
                                            "type": "inline_equation",
                                            "height": 7,
                                            "width": 7
                                        },
                                        {
                                            "bbox": [
                                                389,
                                                434,
                                                541,
                                                446
                                            ],
                                            "score": 1.0,
                                            "content": "A100 GPUs. FlashAttention-2",
                                            "type": "text"
                                        }
                                    ],
                                    "index": 4
                                },
                                {
                                    "bbox": [
                                        71,
                                        447,
                                        541,
                                        457
                                    ],
                                    "spans": [
                                        {
                                            "bbox": [
                                                71,
                                                447,
                                                541,
                                                457
                                            ],
                                            "score": 1.0,
                                            "content": "reaches up to 225 TFLOPs/s (72% model FLOPs utilization). We compare against a baseline running without",
                                            "type": "text"
                                        }
                                    ],
                                    "index": 5
                                },
                                {
                                    "bbox": [
                                        71,
                                        459,
                                        156,
                                        469
                                    ],
                                    "spans": [
                                        {
                                            "bbox": [
                                                71,
                                                459,
                                                156,
                                                469
                                            ],
                                            "score": 1.0,
                                            "content": "FlashAttention.",
                                            "type": "text"
                                        }
                                    ],
                                    "index": 6
                                }
                            ],
                            "index": 5
                        },
                        {
                            "type": "table_body",
                            "bbox": [
                                88,
                                478,
                                519,
                                542
                            ],
                            "group_id": 0,
                            "lines": [
                                {
                                    "bbox": [
                                        88,
                                        478,
                                        519,
                                        542
                                    ],
                                    "spans": [
                                        {
                                            "bbox": [
                                                88,
                                                478,
                                                519,
                                                542
                                            ],
                                            "score": 0.969,
                                            "type": "table",
                                            "image_path": "4d50f360b9b485cc1e5bce486190db6cbfb9609bcbc1e015066107e155eb500f.jpg"
                                        }
                                    ]
                                }
                            ],
                            "index": 8,
                            "virtual_lines": [
                                {
                                    "bbox": [
                                        88,
                                        478,
                                        519,
                                        499.3333333333333
                                    ],
                                    "spans": [],
                                    "index": 7
                                },
                                {
                                    "bbox": [
                                        88,
                                        499.3333333333333,
                                        519,
                                        520.6666666666666
                                    ],
                                    "spans": [],
                                    "index": 8
                                },
                                {
                                    "bbox": [
                                        88,
                                        520.6666666666666,
                                        519,
                                        542.0
                                    ],
                                    "spans": [],
                                    "index": 9
                                }
                            ]
                        }
                    ],
                    "index": 6.5,
                    "page_num": "page_11",
                    "page_size": [
                        612.0,
                        792.0
                    ]
                },
                {
                    "type": "text",
                    "bbox": [
                        73,
                        561,
                        539,
                        585
                    ],
                    "lines": [],
                    "index": 10.5,
                    "page_num": "page_11",
                    "page_size": [
                        612.0,
                        792.0
                    ],
                    "bbox_fs": [
                        70,
                        561,
                        541,
                        585
                    ],
                    "lines_deleted": true
                },
                {
                    "type": "text",
                    "bbox": [
                        70,
                        586,
                        541,
                        669
                    ],
                    "lines": [
                        {
                            "bbox": [
                                84,
                                585,
                                541,
                                597
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        84,
                                        585,
                                        541,
                                        597
                                    ],
                                    "score": 1.0,
                                    "content": "In the near future, we plan to collaborate with researchers and engineers to make FlashAttention widely",
                                    "type": "text"
                                }
                            ],
                            "index": 12
                        },
                        {
                            "bbox": [
                                71,
                                597,
                                541,
                                609
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        71,
                                        597,
                                        541,
                                        609
                                    ],
                                    "score": 1.0,
                                    "content": "applicable in different kinds of devices (e.g., H100 GPUs, AMD GPUs), as well as new data types such as",
                                    "type": "text"
                                }
                            ],
                            "index": 13
                        },
                        {
                            "bbox": [
                                70,
                                610,
                                541,
                                622
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        610,
                                        541,
                                        622
                                    ],
                                    "score": 1.0,
                                    "content": "FP8. As an immediate next step, we plan to optimize FlashAttention-2 for H100 GPUs to use new hardware",
                                    "type": "text"
                                }
                            ],
                            "index": 14
                        },
                        {
                            "bbox": [
                                70,
                                622,
                                540,
                                633
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        622,
                                        540,
                                        633
                                    ],
                                    "score": 1.0,
                                    "content": "features (TMA, 4th-gen Tensor Cores, fp8). Combining the low-level optimizations in FlashAttention-2 with",
                                    "type": "text"
                                }
                            ],
                            "index": 15
                        },
                        {
                            "bbox": [
                                70,
                                634,
                                541,
                                645
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        634,
                                        541,
                                        645
                                    ],
                                    "score": 1.0,
                                    "content": "high-level algorithmic changes (e.g., local, dilated, block-sparse attention) could allow us to train AI models",
                                    "type": "text"
                                }
                            ],
                            "index": 16
                        },
                        {
                            "bbox": [
                                70,
                                645,
                                541,
                                657
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        645,
                                        541,
                                        657
                                    ],
                                    "score": 1.0,
                                    "content": "with much longer context. We are also excited to work with compiler researchers to make these optimization",
                                    "type": "text"
                                }
                            ],
                            "index": 17
                        },
                        {
                            "bbox": [
                                70,
                                658,
                                214,
                                669
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        658,
                                        214,
                                        669
                                    ],
                                    "score": 1.0,
                                    "content": "techniques easily programmable.",
                                    "type": "text"
                                }
                            ],
                            "index": 18
                        }
                    ],
                    "index": 15,
                    "page_num": "page_11",
                    "page_size": [
                        612.0,
                        792.0
                    ],
                    "bbox_fs": [
                        70,
                        585,
                        541,
                        669
                    ]
                }
            ]
        },
        {
            "preproc_blocks": [
                {
                    "type": "image",
                    "bbox": [
                        78,
                        83,
                        533,
                        401
                    ],
                    "blocks": [
                        {
                            "type": "image_body",
                            "bbox": [
                                78,
                                83,
                                533,
                                401
                            ],
                            "group_id": 0,
                            "lines": [
                                {
                                    "bbox": [
                                        78,
                                        83,
                                        533,
                                        401
                                    ],
                                    "spans": [
                                        {
                                            "bbox": [
                                                78,
                                                83,
                                                533,
                                                401
                                            ],
                                            "score": 0.97,
                                            "type": "image",
                                            "image_path": "1e664f2a1298f0576cc2e34783515247c46e50bd8fd058430488782fa010c412.jpg"
                                        }
                                    ]
                                }
                            ],
                            "index": 1,
                            "virtual_lines": [
                                {
                                    "bbox": [
                                        78,
                                        83,
                                        533,
                                        189.0
                                    ],
                                    "spans": [],
                                    "index": 0
                                },
                                {
                                    "bbox": [
                                        78,
                                        189.0,
                                        533,
                                        295.0
                                    ],
                                    "spans": [],
                                    "index": 1
                                },
                                {
                                    "bbox": [
                                        78,
                                        295.0,
                                        533,
                                        401.0
                                    ],
                                    "spans": [],
                                    "index": 2
                                }
                            ]
                        },
                        {
                            "type": "image_caption",
                            "bbox": [
                                168,
                                410,
                                441,
                                422
                            ],
                            "group_id": 0,
                            "lines": [
                                {
                                    "bbox": [
                                        170,
                                        410,
                                        441,
                                        421
                                    ],
                                    "spans": [
                                        {
                                            "bbox": [
                                                170,
                                                410,
                                                294,
                                                421
                                            ],
                                            "score": 1.0,
                                            "content": "Figure 7: Attention forward",
                                            "type": "text"
                                        },
                                        {
                                            "bbox": [
                                                294,
                                                411,
                                                304,
                                                421
                                            ],
                                            "score": 0.63,
                                            "content": "^+",
                                            "type": "inline_equation",
                                            "height": 10,
                                            "width": 10
                                        },
                                        {
                                            "bbox": [
                                                305,
                                                410,
                                                441,
                                                421
                                            ],
                                            "score": 1.0,
                                            "content": " backward speed on H100 GPU",
                                            "type": "text"
                                        }
                                    ],
                                    "index": 3
                                }
                            ],
                            "index": 3
                        }
                    ],
                    "index": 2.0
                },
                {
                    "type": "title",
                    "bbox": [
                        72,
                        443,
                        162,
                        455
                    ],
                    "lines": [
                        {
                            "bbox": [
                                72,
                                444,
                                162,
                                455
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        72,
                                        444,
                                        162,
                                        455
                                    ],
                                    "score": 1.0,
                                    "content": "Acknowledgments",
                                    "type": "text"
                                }
                            ],
                            "index": 4
                        }
                    ],
                    "index": 4
                },
                {
                    "type": "text",
                    "bbox": [
                        70,
                        461,
                        541,
                        605
                    ],
                    "lines": [
                        {
                            "bbox": [
                                70,
                                462,
                                541,
                                474
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        462,
                                        541,
                                        474
                                    ],
                                    "score": 1.0,
                                    "content": "We thank Phil Tillet and Daniel Haziza, who have implemented versions of FlashAttention in Triton [17] and",
                                    "type": "text"
                                }
                            ],
                            "index": 5
                        },
                        {
                            "bbox": [
                                70,
                                474,
                                541,
                                485
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        474,
                                        541,
                                        485
                                    ],
                                    "score": 1.0,
                                    "content": "the xformers library [10]. FlashAttention-2 was motivated by exchange of ideas between different ways that",
                                    "type": "text"
                                }
                            ],
                            "index": 6
                        },
                        {
                            "bbox": [
                                70,
                                485,
                                542,
                                498
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        485,
                                        542,
                                        498
                                    ],
                                    "score": 1.0,
                                    "content": "attention could be implemented. We are grateful to the Nvidia CUTLASS team (especially Vijay Thakkar, Cris",
                                    "type": "text"
                                }
                            ],
                            "index": 7
                        },
                        {
                            "bbox": [
                                71,
                                498,
                                542,
                                509
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        71,
                                        498,
                                        542,
                                        509
                                    ],
                                    "score": 1.0,
                                    "content": "Cecka, Haicheng Wu, and Andrew Kerr) for their CUTLASS library, in particular the CUTLASS 3.x release,",
                                    "type": "text"
                                }
                            ],
                            "index": 8
                        },
                        {
                            "bbox": [
                                70,
                                510,
                                541,
                                522
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        510,
                                        541,
                                        522
                                    ],
                                    "score": 1.0,
                                    "content": "which provides clean abstractions and powerful building blocks for the implementation of FlashAttention-2.",
                                    "type": "text"
                                }
                            ],
                            "index": 9
                        },
                        {
                            "bbox": [
                                70,
                                522,
                                541,
                                533
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        522,
                                        541,
                                        533
                                    ],
                                    "score": 1.0,
                                    "content": "We thank Driss Guessous for integrating FlashAttention to PyTorch. FlashAttention-2 has benefited",
                                    "type": "text"
                                }
                            ],
                            "index": 10
                        },
                        {
                            "bbox": [
                                70,
                                533,
                                542,
                                546
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        533,
                                        542,
                                        546
                                    ],
                                    "score": 1.0,
                                    "content": "from helpful discussions with Phil Wang, Markus Rabe, James Bradbury, Young-Jun Ko, Julien Launay,",
                                    "type": "text"
                                }
                            ],
                            "index": 11
                        },
                        {
                            "bbox": [
                                71,
                                547,
                                541,
                                556
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        71,
                                        547,
                                        541,
                                        556
                                    ],
                                    "score": 1.0,
                                    "content": "Daniel Hesslow, Michaël Benesty, Horace He, Ashish Vaswani, and Erich Elsen. Thanks for Stanford CRFM",
                                    "type": "text"
                                }
                            ],
                            "index": 12
                        },
                        {
                            "bbox": [
                                70,
                                558,
                                542,
                                570
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        558,
                                        542,
                                        570
                                    ],
                                    "score": 1.0,
                                    "content": "and Stanford NLP for the compute support. We thank Dan Fu and Christopher Ré for their collaboration,",
                                    "type": "text"
                                }
                            ],
                            "index": 13
                        },
                        {
                            "bbox": [
                                70,
                                570,
                                542,
                                582
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        570,
                                        542,
                                        582
                                    ],
                                    "score": 1.0,
                                    "content": "constructive feedback, and constant encouragement on this line of work of designing hardware-efficient",
                                    "type": "text"
                                }
                            ],
                            "index": 14
                        },
                        {
                            "bbox": [
                                70,
                                582,
                                542,
                                594
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        582,
                                        542,
                                        594
                                    ],
                                    "score": 1.0,
                                    "content": "algorithms. We thank Albert Gu and Beidi Chen for their helpful suggestions on early drafts of this technical",
                                    "type": "text"
                                }
                            ],
                            "index": 15
                        },
                        {
                            "bbox": [
                                70,
                                594,
                                102,
                                606
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        594,
                                        102,
                                        606
                                    ],
                                    "score": 1.0,
                                    "content": "report.",
                                    "type": "text"
                                }
                            ],
                            "index": 16
                        }
                    ],
                    "index": 10.5
                },
                {
                    "type": "title",
                    "bbox": [
                        71,
                        623,
                        145,
                        638
                    ],
                    "lines": [
                        {
                            "bbox": [
                                71,
                                623,
                                146,
                                637
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        71,
                                        623,
                                        146,
                                        637
                                    ],
                                    "score": 1.0,
                                    "content": "References",
                                    "type": "text"
                                }
                            ],
                            "index": 17
                        }
                    ],
                    "index": 17
                },
                {
                    "type": "text",
                    "bbox": [
                        71,
                        647,
                        542,
                        716
                    ],
                    "lines": [
                        {
                            "bbox": [
                                77,
                                648,
                                541,
                                660
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        77,
                                        648,
                                        541,
                                        660
                                    ],
                                    "score": 1.0,
                                    "content": "[1] Joshua Ainslie, James Lee-Thorp, Michiel de Jong, Yury Zemlyanskiy, Federico Lebrón, and Sumit",
                                    "type": "text"
                                }
                            ],
                            "index": 18
                        },
                        {
                            "bbox": [
                                90,
                                659,
                                541,
                                672
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        90,
                                        659,
                                        541,
                                        672
                                    ],
                                    "score": 1.0,
                                    "content": "Sanghai. Gqa: Training generalized multi-query transformer models from multi-head checkpoints. arXiv",
                                    "type": "text"
                                }
                            ],
                            "index": 19
                        },
                        {
                            "bbox": [
                                91,
                                673,
                                236,
                                684
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        91,
                                        673,
                                        236,
                                        684
                                    ],
                                    "score": 1.0,
                                    "content": "preprint arXiv:2305.13245, 2023.",
                                    "type": "text"
                                }
                            ],
                            "index": 20
                        },
                        {
                            "bbox": [
                                76,
                                692,
                                541,
                                704
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        76,
                                        692,
                                        541,
                                        704
                                    ],
                                    "score": 1.0,
                                    "content": "[2] Iz Beltagy, Matthew E Peters, and Arman Cohan. Longformer: The long-document transformer. arXiv",
                                    "type": "text"
                                }
                            ],
                            "index": 21
                        },
                        {
                            "bbox": [
                                90,
                                705,
                                236,
                                715
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        90,
                                        705,
                                        236,
                                        715
                                    ],
                                    "score": 1.0,
                                    "content": "preprint arXiv:2004.05150, 2020.",
                                    "type": "text"
                                }
                            ],
                            "index": 22
                        }
                    ],
                    "index": 20
                }
            ],
            "layout_bboxes": [],
            "page_idx": 12,
            "page_size": [
                612.0,
                792.0
            ],
            "_layout_tree": [],
            "images": [
                {
                    "type": "image",
                    "bbox": [
                        78,
                        83,
                        533,
                        401
                    ],
                    "blocks": [
                        {
                            "type": "image_body",
                            "bbox": [
                                78,
                                83,
                                533,
                                401
                            ],
                            "group_id": 0,
                            "lines": [
                                {
                                    "bbox": [
                                        78,
                                        83,
                                        533,
                                        401
                                    ],
                                    "spans": [
                                        {
                                            "bbox": [
                                                78,
                                                83,
                                                533,
                                                401
                                            ],
                                            "score": 0.97,
                                            "type": "image",
                                            "image_path": "1e664f2a1298f0576cc2e34783515247c46e50bd8fd058430488782fa010c412.jpg"
                                        }
                                    ]
                                }
                            ],
                            "index": 1,
                            "virtual_lines": [
                                {
                                    "bbox": [
                                        78,
                                        83,
                                        533,
                                        189.0
                                    ],
                                    "spans": [],
                                    "index": 0
                                },
                                {
                                    "bbox": [
                                        78,
                                        189.0,
                                        533,
                                        295.0
                                    ],
                                    "spans": [],
                                    "index": 1
                                },
                                {
                                    "bbox": [
                                        78,
                                        295.0,
                                        533,
                                        401.0
                                    ],
                                    "spans": [],
                                    "index": 2
                                }
                            ]
                        },
                        {
                            "type": "image_caption",
                            "bbox": [
                                168,
                                410,
                                441,
                                422
                            ],
                            "group_id": 0,
                            "lines": [
                                {
                                    "bbox": [
                                        170,
                                        410,
                                        441,
                                        421
                                    ],
                                    "spans": [
                                        {
                                            "bbox": [
                                                170,
                                                410,
                                                294,
                                                421
                                            ],
                                            "score": 1.0,
                                            "content": "Figure 7: Attention forward",
                                            "type": "text"
                                        },
                                        {
                                            "bbox": [
                                                294,
                                                411,
                                                304,
                                                421
                                            ],
                                            "score": 0.63,
                                            "content": "^+",
                                            "type": "inline_equation",
                                            "height": 10,
                                            "width": 10
                                        },
                                        {
                                            "bbox": [
                                                305,
                                                410,
                                                441,
                                                421
                                            ],
                                            "score": 1.0,
                                            "content": " backward speed on H100 GPU",
                                            "type": "text"
                                        }
                                    ],
                                    "index": 3
                                }
                            ],
                            "index": 3
                        }
                    ],
                    "index": 2.0
                }
            ],
            "tables": [],
            "interline_equations": [],
            "discarded_blocks": [
                {
                    "type": "discarded",
                    "bbox": [
                        300,
                        742,
                        311,
                        751
                    ],
                    "lines": [
                        {
                            "bbox": [
                                298,
                                741,
                                313,
                                753
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        298,
                                        741,
                                        313,
                                        753
                                    ],
                                    "score": 1.0,
                                    "content": "13",
                                    "type": "text"
                                }
                            ]
                        }
                    ]
                },
                {
                    "type": "discarded",
                    "bbox": [
                        110,
                        75,
                        289,
                        82
                    ],
                    "lines": [
                        {
                            "bbox": [
                                111,
                                75,
                                290,
                                83
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        111,
                                        75,
                                        167,
                                        83
                                    ],
                                    "score": 1.0,
                                    "content": "Attention forward",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        167,
                                        75,
                                        174,
                                        82
                                    ],
                                    "score": 0.61,
                                    "content": "^+",
                                    "type": "inline_equation",
                                    "height": 7,
                                    "width": 7
                                },
                                {
                                    "bbox": [
                                        174,
                                        75,
                                        290,
                                        83
                                    ],
                                    "score": 1.0,
                                    "content": " backward speed (H100 80GB SXM5)",
                                    "type": "text"
                                }
                            ]
                        }
                    ]
                },
                {
                    "type": "discarded",
                    "bbox": [
                        343,
                        75,
                        522,
                        82
                    ],
                    "lines": [
                        {
                            "bbox": [
                                345,
                                75,
                                524,
                                83
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        345,
                                        75,
                                        401,
                                        83
                                    ],
                                    "score": 1.0,
                                    "content": "Attention forward",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        401,
                                        75,
                                        408,
                                        82
                                    ],
                                    "score": 0.61,
                                    "content": "^+",
                                    "type": "inline_equation",
                                    "height": 7,
                                    "width": 7
                                },
                                {
                                    "bbox": [
                                        408,
                                        75,
                                        524,
                                        83
                                    ],
                                    "score": 1.0,
                                    "content": " backward speed (H100 80GB SXM5)",
                                    "type": "text"
                                }
                            ]
                        }
                    ]
                }
            ],
            "need_drop": false,
            "drop_reason": [],
            "para_blocks": [
                {
                    "type": "image",
                    "bbox": [
                        78,
                        83,
                        533,
                        401
                    ],
                    "blocks": [
                        {
                            "type": "image_body",
                            "bbox": [
                                78,
                                83,
                                533,
                                401
                            ],
                            "group_id": 0,
                            "lines": [
                                {
                                    "bbox": [
                                        78,
                                        83,
                                        533,
                                        401
                                    ],
                                    "spans": [
                                        {
                                            "bbox": [
                                                78,
                                                83,
                                                533,
                                                401
                                            ],
                                            "score": 0.97,
                                            "type": "image",
                                            "image_path": "1e664f2a1298f0576cc2e34783515247c46e50bd8fd058430488782fa010c412.jpg"
                                        }
                                    ]
                                }
                            ],
                            "index": 1,
                            "virtual_lines": [
                                {
                                    "bbox": [
                                        78,
                                        83,
                                        533,
                                        189.0
                                    ],
                                    "spans": [],
                                    "index": 0
                                },
                                {
                                    "bbox": [
                                        78,
                                        189.0,
                                        533,
                                        295.0
                                    ],
                                    "spans": [],
                                    "index": 1
                                },
                                {
                                    "bbox": [
                                        78,
                                        295.0,
                                        533,
                                        401.0
                                    ],
                                    "spans": [],
                                    "index": 2
                                }
                            ]
                        },
                        {
                            "type": "image_caption",
                            "bbox": [
                                168,
                                410,
                                441,
                                422
                            ],
                            "group_id": 0,
                            "lines": [
                                {
                                    "bbox": [
                                        170,
                                        410,
                                        441,
                                        421
                                    ],
                                    "spans": [
                                        {
                                            "bbox": [
                                                170,
                                                410,
                                                294,
                                                421
                                            ],
                                            "score": 1.0,
                                            "content": "Figure 7: Attention forward",
                                            "type": "text"
                                        },
                                        {
                                            "bbox": [
                                                294,
                                                411,
                                                304,
                                                421
                                            ],
                                            "score": 0.63,
                                            "content": "^+",
                                            "type": "inline_equation",
                                            "height": 10,
                                            "width": 10
                                        },
                                        {
                                            "bbox": [
                                                305,
                                                410,
                                                441,
                                                421
                                            ],
                                            "score": 1.0,
                                            "content": " backward speed on H100 GPU",
                                            "type": "text"
                                        }
                                    ],
                                    "index": 3
                                }
                            ],
                            "index": 3
                        }
                    ],
                    "index": 2.0,
                    "page_num": "page_12",
                    "page_size": [
                        612.0,
                        792.0
                    ]
                },
                {
                    "type": "title",
                    "bbox": [
                        72,
                        443,
                        162,
                        455
                    ],
                    "lines": [
                        {
                            "bbox": [
                                72,
                                444,
                                162,
                                455
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        72,
                                        444,
                                        162,
                                        455
                                    ],
                                    "score": 1.0,
                                    "content": "Acknowledgments",
                                    "type": "text"
                                }
                            ],
                            "index": 4
                        }
                    ],
                    "index": 4,
                    "page_num": "page_12",
                    "page_size": [
                        612.0,
                        792.0
                    ]
                },
                {
                    "type": "text",
                    "bbox": [
                        70,
                        461,
                        541,
                        605
                    ],
                    "lines": [
                        {
                            "bbox": [
                                70,
                                462,
                                541,
                                474
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        462,
                                        541,
                                        474
                                    ],
                                    "score": 1.0,
                                    "content": "We thank Phil Tillet and Daniel Haziza, who have implemented versions of FlashAttention in Triton [17] and",
                                    "type": "text"
                                }
                            ],
                            "index": 5
                        },
                        {
                            "bbox": [
                                70,
                                474,
                                541,
                                485
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        474,
                                        541,
                                        485
                                    ],
                                    "score": 1.0,
                                    "content": "the xformers library [10]. FlashAttention-2 was motivated by exchange of ideas between different ways that",
                                    "type": "text"
                                }
                            ],
                            "index": 6
                        },
                        {
                            "bbox": [
                                70,
                                485,
                                542,
                                498
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        485,
                                        542,
                                        498
                                    ],
                                    "score": 1.0,
                                    "content": "attention could be implemented. We are grateful to the Nvidia CUTLASS team (especially Vijay Thakkar, Cris",
                                    "type": "text"
                                }
                            ],
                            "index": 7
                        },
                        {
                            "bbox": [
                                71,
                                498,
                                542,
                                509
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        71,
                                        498,
                                        542,
                                        509
                                    ],
                                    "score": 1.0,
                                    "content": "Cecka, Haicheng Wu, and Andrew Kerr) for their CUTLASS library, in particular the CUTLASS 3.x release,",
                                    "type": "text"
                                }
                            ],
                            "index": 8
                        },
                        {
                            "bbox": [
                                70,
                                510,
                                541,
                                522
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        510,
                                        541,
                                        522
                                    ],
                                    "score": 1.0,
                                    "content": "which provides clean abstractions and powerful building blocks for the implementation of FlashAttention-2.",
                                    "type": "text"
                                }
                            ],
                            "index": 9
                        },
                        {
                            "bbox": [
                                70,
                                522,
                                541,
                                533
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        522,
                                        541,
                                        533
                                    ],
                                    "score": 1.0,
                                    "content": "We thank Driss Guessous for integrating FlashAttention to PyTorch. FlashAttention-2 has benefited",
                                    "type": "text"
                                }
                            ],
                            "index": 10
                        },
                        {
                            "bbox": [
                                70,
                                533,
                                542,
                                546
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        533,
                                        542,
                                        546
                                    ],
                                    "score": 1.0,
                                    "content": "from helpful discussions with Phil Wang, Markus Rabe, James Bradbury, Young-Jun Ko, Julien Launay,",
                                    "type": "text"
                                }
                            ],
                            "index": 11
                        },
                        {
                            "bbox": [
                                71,
                                547,
                                541,
                                556
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        71,
                                        547,
                                        541,
                                        556
                                    ],
                                    "score": 1.0,
                                    "content": "Daniel Hesslow, Michaël Benesty, Horace He, Ashish Vaswani, and Erich Elsen. Thanks for Stanford CRFM",
                                    "type": "text"
                                }
                            ],
                            "index": 12
                        },
                        {
                            "bbox": [
                                70,
                                558,
                                542,
                                570
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        558,
                                        542,
                                        570
                                    ],
                                    "score": 1.0,
                                    "content": "and Stanford NLP for the compute support. We thank Dan Fu and Christopher Ré for their collaboration,",
                                    "type": "text"
                                }
                            ],
                            "index": 13
                        },
                        {
                            "bbox": [
                                70,
                                570,
                                542,
                                582
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        570,
                                        542,
                                        582
                                    ],
                                    "score": 1.0,
                                    "content": "constructive feedback, and constant encouragement on this line of work of designing hardware-efficient",
                                    "type": "text"
                                }
                            ],
                            "index": 14
                        },
                        {
                            "bbox": [
                                70,
                                582,
                                542,
                                594
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        582,
                                        542,
                                        594
                                    ],
                                    "score": 1.0,
                                    "content": "algorithms. We thank Albert Gu and Beidi Chen for their helpful suggestions on early drafts of this technical",
                                    "type": "text"
                                }
                            ],
                            "index": 15
                        },
                        {
                            "bbox": [
                                70,
                                594,
                                102,
                                606
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        594,
                                        102,
                                        606
                                    ],
                                    "score": 1.0,
                                    "content": "report.",
                                    "type": "text"
                                }
                            ],
                            "index": 16
                        }
                    ],
                    "index": 10.5,
                    "page_num": "page_12",
                    "page_size": [
                        612.0,
                        792.0
                    ],
                    "bbox_fs": [
                        70,
                        462,
                        542,
                        606
                    ]
                },
                {
                    "type": "title",
                    "bbox": [
                        71,
                        623,
                        145,
                        638
                    ],
                    "lines": [
                        {
                            "bbox": [
                                71,
                                623,
                                146,
                                637
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        71,
                                        623,
                                        146,
                                        637
                                    ],
                                    "score": 1.0,
                                    "content": "References",
                                    "type": "text"
                                }
                            ],
                            "index": 17
                        }
                    ],
                    "index": 17,
                    "page_num": "page_12",
                    "page_size": [
                        612.0,
                        792.0
                    ]
                },
                {
                    "type": "list",
                    "bbox": [
                        71,
                        647,
                        542,
                        716
                    ],
                    "lines": [
                        {
                            "bbox": [
                                77,
                                648,
                                541,
                                660
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        77,
                                        648,
                                        541,
                                        660
                                    ],
                                    "score": 1.0,
                                    "content": "[1] Joshua Ainslie, James Lee-Thorp, Michiel de Jong, Yury Zemlyanskiy, Federico Lebrón, and Sumit",
                                    "type": "text"
                                }
                            ],
                            "index": 18,
                            "is_list_start_line": true
                        },
                        {
                            "bbox": [
                                90,
                                659,
                                541,
                                672
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        90,
                                        659,
                                        541,
                                        672
                                    ],
                                    "score": 1.0,
                                    "content": "Sanghai. Gqa: Training generalized multi-query transformer models from multi-head checkpoints. arXiv",
                                    "type": "text"
                                }
                            ],
                            "index": 19
                        },
                        {
                            "bbox": [
                                91,
                                673,
                                236,
                                684
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        91,
                                        673,
                                        236,
                                        684
                                    ],
                                    "score": 1.0,
                                    "content": "preprint arXiv:2305.13245, 2023.",
                                    "type": "text"
                                }
                            ],
                            "index": 20,
                            "is_list_end_line": true
                        },
                        {
                            "bbox": [
                                76,
                                692,
                                541,
                                704
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        76,
                                        692,
                                        541,
                                        704
                                    ],
                                    "score": 1.0,
                                    "content": "[2] Iz Beltagy, Matthew E Peters, and Arman Cohan. Longformer: The long-document transformer. arXiv",
                                    "type": "text"
                                }
                            ],
                            "index": 21,
                            "is_list_start_line": true
                        },
                        {
                            "bbox": [
                                90,
                                705,
                                236,
                                715
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        90,
                                        705,
                                        236,
                                        715
                                    ],
                                    "score": 1.0,
                                    "content": "preprint arXiv:2004.05150, 2020.",
                                    "type": "text"
                                }
                            ],
                            "index": 22,
                            "is_list_end_line": true
                        },
                        {
                            "bbox": [
                                76,
                                73,
                                542,
                                87
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        76,
                                        73,
                                        542,
                                        87
                                    ],
                                    "score": 1.0,
                                    "content": "[3] Beidi Chen, Tri Dao, Eric Winsor, Zhao Song, Atri Rudra, and Christopher Ré. Scatterbrain: Unifying",
                                    "type": "text",
                                    "cross_page": true
                                }
                            ],
                            "index": 0,
                            "is_list_start_line": true
                        },
                        {
                            "bbox": [
                                88,
                                85,
                                542,
                                98
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        88,
                                        85,
                                        542,
                                        98
                                    ],
                                    "score": 1.0,
                                    "content": "sparse and low-rank attention. In Advances in Neural Information Processing Systems (NeurIPS), 2021.",
                                    "type": "text",
                                    "cross_page": true
                                }
                            ],
                            "index": 1
                        },
                        {
                            "bbox": [
                                75,
                                104,
                                542,
                                118
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        75,
                                        104,
                                        542,
                                        118
                                    ],
                                    "score": 1.0,
                                    "content": "[4] Krzysztof Marcin Choromanski, Valerii Likhosherstov, David Dohan, Xingyou Song, Andreea Gane,",
                                    "type": "text",
                                    "cross_page": true
                                }
                            ],
                            "index": 2,
                            "is_list_start_line": true
                        },
                        {
                            "bbox": [
                                91,
                                117,
                                542,
                                129
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        91,
                                        117,
                                        542,
                                        129
                                    ],
                                    "score": 1.0,
                                    "content": "Tamas Sarlos, Peter Hawkins, Jared Quincy Davis, Afroz Mohiuddin, Lukasz Kaiser, et al. Rethinking",
                                    "type": "text",
                                    "cross_page": true
                                }
                            ],
                            "index": 3
                        },
                        {
                            "bbox": [
                                89,
                                128,
                                527,
                                141
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        89,
                                        128,
                                        527,
                                        141
                                    ],
                                    "score": 1.0,
                                    "content": "attention with performers. In International Conference on Learning Representations (ICLR), 2020.",
                                    "type": "text",
                                    "cross_page": true
                                }
                            ],
                            "index": 4,
                            "is_list_end_line": true
                        },
                        {
                            "bbox": [
                                76,
                                149,
                                541,
                                160
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        76,
                                        149,
                                        541,
                                        160
                                    ],
                                    "score": 1.0,
                                    "content": "[5] Tri Dao, Daniel Y. Fu, Stefano Ermon, Atri Rudra, and Christopher Ré. FlashAttention: Fast and",
                                    "type": "text",
                                    "cross_page": true
                                }
                            ],
                            "index": 5,
                            "is_list_start_line": true
                        },
                        {
                            "bbox": [
                                90,
                                160,
                                541,
                                173
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        90,
                                        160,
                                        541,
                                        173
                                    ],
                                    "score": 1.0,
                                    "content": "memory-efficient exact attention with IO-awareness. In Advances in Neural Information Processing",
                                    "type": "text",
                                    "cross_page": true
                                }
                            ],
                            "index": 6
                        },
                        {
                            "bbox": [
                                91,
                                172,
                                156,
                                184
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        91,
                                        172,
                                        156,
                                        184
                                    ],
                                    "score": 1.0,
                                    "content": "Systems, 2022.",
                                    "type": "text",
                                    "cross_page": true
                                }
                            ],
                            "index": 7,
                            "is_list_end_line": true
                        },
                        {
                            "bbox": [
                                75,
                                191,
                                541,
                                204
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        75,
                                        191,
                                        541,
                                        204
                                    ],
                                    "score": 1.0,
                                    "content": "[6] Zhe Jia and Peter Van Sandt. Dissecting the Ampere GPU architecture via microbenchmarking. GPU",
                                    "type": "text",
                                    "cross_page": true
                                }
                            ],
                            "index": 8,
                            "is_list_start_line": true
                        },
                        {
                            "bbox": [
                                91,
                                204,
                                223,
                                216
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        91,
                                        204,
                                        223,
                                        216
                                    ],
                                    "score": 1.0,
                                    "content": "Technology Conference, 2021.",
                                    "type": "text",
                                    "cross_page": true
                                }
                            ],
                            "index": 9,
                            "is_list_end_line": true
                        },
                        {
                            "bbox": [
                                75,
                                222,
                                542,
                                234
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        75,
                                        222,
                                        542,
                                        234
                                    ],
                                    "score": 1.0,
                                    "content": "[7] Zhe Jia, Marco Maggioni, Benjamin Staiger, and Daniele P Scarpazza. Dissecting the nvidia Volta GPU",
                                    "type": "text",
                                    "cross_page": true
                                }
                            ],
                            "index": 10,
                            "is_list_start_line": true
                        },
                        {
                            "bbox": [
                                89,
                                234,
                                429,
                                247
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        89,
                                        234,
                                        429,
                                        247
                                    ],
                                    "score": 1.0,
                                    "content": "architecture via microbenchmarking. arXiv preprint arXiv:1804.06826, 2018.",
                                    "type": "text",
                                    "cross_page": true
                                }
                            ],
                            "index": 11,
                            "is_list_end_line": true
                        },
                        {
                            "bbox": [
                                75,
                                253,
                                542,
                                267
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        75,
                                        253,
                                        542,
                                        267
                                    ],
                                    "score": 1.0,
                                    "content": "[8] Angelos Katharopoulos, Apoorv Vyas, Nikolaos Pappas, and François Fleuret. Transformers are RNNs:",
                                    "type": "text",
                                    "cross_page": true
                                }
                            ],
                            "index": 12,
                            "is_list_start_line": true
                        },
                        {
                            "bbox": [
                                90,
                                265,
                                542,
                                279
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        90,
                                        265,
                                        542,
                                        279
                                    ],
                                    "score": 1.0,
                                    "content": "Fast autoregressive transformers with linear attention. In International Conference on Machine Learning,",
                                    "type": "text",
                                    "cross_page": true
                                }
                            ],
                            "index": 13
                        },
                        {
                            "bbox": [
                                89,
                                277,
                                231,
                                289
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        89,
                                        277,
                                        231,
                                        289
                                    ],
                                    "score": 1.0,
                                    "content": "pages 5156–5165. PMLR, 2020.",
                                    "type": "text",
                                    "cross_page": true
                                }
                            ],
                            "index": 14,
                            "is_list_end_line": true
                        },
                        {
                            "bbox": [
                                76,
                                297,
                                542,
                                308
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        76,
                                        297,
                                        542,
                                        308
                                    ],
                                    "score": 1.0,
                                    "content": "[9] Nikita Kitaev, Łukasz Kaiser, and Anselm Levskaya. Reformer: The efficient transformer. In The",
                                    "type": "text",
                                    "cross_page": true
                                }
                            ],
                            "index": 15,
                            "is_list_start_line": true
                        },
                        {
                            "bbox": [
                                91,
                                309,
                                364,
                                321
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        91,
                                        309,
                                        364,
                                        321
                                    ],
                                    "score": 1.0,
                                    "content": "International Conference on Machine Learning (ICML), 2020.",
                                    "type": "text",
                                    "cross_page": true
                                }
                            ],
                            "index": 16,
                            "is_list_end_line": true
                        },
                        {
                            "bbox": [
                                71,
                                328,
                                542,
                                340
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        71,
                                        328,
                                        542,
                                        340
                                    ],
                                    "score": 1.0,
                                    "content": "[10] Benjamin Lefaudeux, Francisco Massa, Diana Liskovich, Wenhan Xiong, Vittorio Caggiano, Sean Naren,",
                                    "type": "text",
                                    "cross_page": true
                                }
                            ],
                            "index": 17,
                            "is_list_start_line": true
                        },
                        {
                            "bbox": [
                                90,
                                340,
                                541,
                                352
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        90,
                                        340,
                                        541,
                                        352
                                    ],
                                    "score": 1.0,
                                    "content": "Min Xu, Jieru Hu, Marta Tintore, Susan Zhang, Patrick Labatut, and Daniel Haziza. xformers: A modular",
                                    "type": "text",
                                    "cross_page": true
                                }
                            ],
                            "index": 18
                        },
                        {
                            "bbox": [
                                88,
                                351,
                                542,
                                365
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        88,
                                        351,
                                        542,
                                        365
                                    ],
                                    "score": 1.0,
                                    "content": "and hackable transformer modelling library. https://github.com/facebookresearch/xformers, 2022.",
                                    "type": "text",
                                    "cross_page": true
                                }
                            ],
                            "index": 19
                        },
                        {
                            "bbox": [
                                70,
                                370,
                                542,
                                384
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        370,
                                        542,
                                        384
                                    ],
                                    "score": 1.0,
                                    "content": "[11] Maxim Milakov and Natalia Gimelshein. Online normalizer calculation for softmax. arXiv preprint",
                                    "type": "text",
                                    "cross_page": true
                                }
                            ],
                            "index": 20,
                            "is_list_start_line": true
                        },
                        {
                            "bbox": [
                                90,
                                383,
                                198,
                                395
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        90,
                                        383,
                                        198,
                                        395
                                    ],
                                    "score": 1.0,
                                    "content": "arXiv:1805.02867, 2018.",
                                    "type": "text",
                                    "cross_page": true
                                }
                            ],
                            "index": 21,
                            "is_list_end_line": true
                        },
                        {
                            "bbox": [
                                70,
                                402,
                                368,
                                415
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        402,
                                        368,
                                        415
                                    ],
                                    "score": 1.0,
                                    "content": "[12] OpenAI. Gpt-4 technical report. ArXiv, abs/2303.08774, 2023.",
                                    "type": "text",
                                    "cross_page": true
                                }
                            ],
                            "index": 22,
                            "is_list_start_line": true,
                            "is_list_end_line": true
                        },
                        {
                            "bbox": [
                                70,
                                420,
                                542,
                                434
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        420,
                                        398,
                                        434
                                    ],
                                    "score": 1.0,
                                    "content": "[13] Markus N Rabe and Charles Staats. Self-attention does not need ",
                                    "type": "text",
                                    "cross_page": true
                                },
                                {
                                    "bbox": [
                                        399,
                                        422,
                                        424,
                                        433
                                    ],
                                    "score": 0.92,
                                    "content": "O(n^{2})",
                                    "type": "inline_equation",
                                    "height": 11,
                                    "width": 25,
                                    "cross_page": true
                                },
                                {
                                    "bbox": [
                                        424,
                                        420,
                                        542,
                                        434
                                    ],
                                    "score": 1.0,
                                    "content": " memory. arXiv preprint",
                                    "type": "text",
                                    "cross_page": true
                                }
                            ],
                            "index": 23,
                            "is_list_start_line": true
                        },
                        {
                            "bbox": [
                                88,
                                433,
                                199,
                                446
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        88,
                                        433,
                                        199,
                                        446
                                    ],
                                    "score": 1.0,
                                    "content": "arXiv:2112.05682, 2021.",
                                    "type": "text",
                                    "cross_page": true
                                }
                            ],
                            "index": 24,
                            "is_list_end_line": true
                        },
                        {
                            "bbox": [
                                70,
                                452,
                                542,
                                465
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        452,
                                        542,
                                        465
                                    ],
                                    "score": 1.0,
                                    "content": "[14] Aurko Roy, Mohammad Saffar, Ashish Vaswani, and David Grangier. Efficient content-based sparse",
                                    "type": "text",
                                    "cross_page": true
                                }
                            ],
                            "index": 25,
                            "is_list_start_line": true
                        },
                        {
                            "bbox": [
                                89,
                                464,
                                542,
                                478
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        89,
                                        464,
                                        542,
                                        478
                                    ],
                                    "score": 1.0,
                                    "content": "attention with routing transformers. Transactions of the Association for Computational Linguistics, 9:",
                                    "type": "text",
                                    "cross_page": true
                                }
                            ],
                            "index": 26
                        },
                        {
                            "bbox": [
                                91,
                                477,
                                148,
                                489
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        91,
                                        477,
                                        148,
                                        489
                                    ],
                                    "score": 1.0,
                                    "content": "53–68, 2021.",
                                    "type": "text",
                                    "cross_page": true
                                }
                            ],
                            "index": 27,
                            "is_list_end_line": true
                        },
                        {
                            "bbox": [
                                70,
                                495,
                                542,
                                509
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        495,
                                        542,
                                        509
                                    ],
                                    "score": 1.0,
                                    "content": "[15] Noam Shazeer. Fast transformer decoding: One write-head is all you need. arXiv preprint",
                                    "type": "text",
                                    "cross_page": true
                                }
                            ],
                            "index": 28,
                            "is_list_start_line": true
                        },
                        {
                            "bbox": [
                                91,
                                509,
                                197,
                                519
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        91,
                                        509,
                                        197,
                                        519
                                    ],
                                    "score": 1.0,
                                    "content": "arXiv:1911.02150, 2019.",
                                    "type": "text",
                                    "cross_page": true
                                }
                            ],
                            "index": 29,
                            "is_list_end_line": true
                        },
                        {
                            "bbox": [
                                70,
                                527,
                                542,
                                540
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        527,
                                        542,
                                        540
                                    ],
                                    "score": 1.0,
                                    "content": "[16] Mohammad Shoeybi, Mostofa Patwary, Raul Puri, Patrick LeGresley, Jared Casper, and Bryan Catanzaro.",
                                    "type": "text",
                                    "cross_page": true
                                }
                            ],
                            "index": 30,
                            "is_list_start_line": true
                        },
                        {
                            "bbox": [
                                91,
                                539,
                                542,
                                553
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        91,
                                        539,
                                        542,
                                        553
                                    ],
                                    "score": 1.0,
                                    "content": "Megatron-LM: Training multi-billion parameter language models using model parallelism. arXiv preprint",
                                    "type": "text",
                                    "cross_page": true
                                }
                            ],
                            "index": 31
                        },
                        {
                            "bbox": [
                                90,
                                551,
                                198,
                                563
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        90,
                                        551,
                                        198,
                                        563
                                    ],
                                    "score": 1.0,
                                    "content": "arXiv:1909.08053, 2019.",
                                    "type": "text",
                                    "cross_page": true
                                }
                            ],
                            "index": 32,
                            "is_list_end_line": true
                        },
                        {
                            "bbox": [
                                70,
                                569,
                                542,
                                583
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        569,
                                        542,
                                        583
                                    ],
                                    "score": 1.0,
                                    "content": "[17] Philippe Tillet, Hsiang-Tsung Kung, and David Cox. Triton: an intermediate language and compiler for",
                                    "type": "text",
                                    "cross_page": true
                                }
                            ],
                            "index": 33,
                            "is_list_start_line": true
                        },
                        {
                            "bbox": [
                                90,
                                582,
                                542,
                                596
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        90,
                                        582,
                                        542,
                                        596
                                    ],
                                    "score": 1.0,
                                    "content": "tiled neural network computations. In Proceedings of the 3rd ACM SIGPLAN International Workshop",
                                    "type": "text",
                                    "cross_page": true
                                }
                            ],
                            "index": 34
                        },
                        {
                            "bbox": [
                                89,
                                593,
                                403,
                                609
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        89,
                                        593,
                                        403,
                                        609
                                    ],
                                    "score": 1.0,
                                    "content": "on Machine Learning and Programming Languages, pages 10–19, 2019.",
                                    "type": "text",
                                    "cross_page": true
                                }
                            ],
                            "index": 35,
                            "is_list_end_line": true
                        },
                        {
                            "bbox": [
                                70,
                                612,
                                542,
                                626
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        612,
                                        542,
                                        626
                                    ],
                                    "score": 1.0,
                                    "content": "[18] Ashish Vaswani, Noam Shazeer, Niki Parmar, Jakob Uszkoreit, Llion Jones, Aidan N Gomez, Łukasz",
                                    "type": "text",
                                    "cross_page": true
                                }
                            ],
                            "index": 36,
                            "is_list_start_line": true
                        },
                        {
                            "bbox": [
                                90,
                                624,
                                542,
                                639
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        90,
                                        624,
                                        542,
                                        639
                                    ],
                                    "score": 1.0,
                                    "content": "Kaiser, and Illia Polosukhin. Attention is all you need. Advances in neural information processing",
                                    "type": "text",
                                    "cross_page": true
                                }
                            ],
                            "index": 37
                        },
                        {
                            "bbox": [
                                90,
                                638,
                                171,
                                649
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        90,
                                        638,
                                        171,
                                        649
                                    ],
                                    "score": 1.0,
                                    "content": "systems, 30, 2017.",
                                    "type": "text",
                                    "cross_page": true
                                }
                            ],
                            "index": 38,
                            "is_list_end_line": true
                        },
                        {
                            "bbox": [
                                70,
                                655,
                                541,
                                669
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        655,
                                        541,
                                        669
                                    ],
                                    "score": 1.0,
                                    "content": "[19] Sinong Wang, Belinda Z Li, Madian Khabsa, Han Fang, and Hao Ma. Linformer: Self-attention with",
                                    "type": "text",
                                    "cross_page": true
                                }
                            ],
                            "index": 39,
                            "is_list_start_line": true
                        },
                        {
                            "bbox": [
                                90,
                                669,
                                347,
                                681
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        90,
                                        669,
                                        347,
                                        681
                                    ],
                                    "score": 1.0,
                                    "content": "linear complexity. arXiv preprint arXiv:2006.04768, 2020.",
                                    "type": "text",
                                    "cross_page": true
                                }
                            ],
                            "index": 40,
                            "is_list_end_line": true
                        },
                        {
                            "bbox": [
                                70,
                                686,
                                541,
                                701
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        686,
                                        541,
                                        701
                                    ],
                                    "score": 1.0,
                                    "content": "[20] Manzil Zaheer, Guru Guruganesh, Kumar Avinava Dubey, Joshua Ainslie, Chris Alberti, Santiago",
                                    "type": "text",
                                    "cross_page": true
                                }
                            ],
                            "index": 41,
                            "is_list_start_line": true
                        },
                        {
                            "bbox": [
                                90,
                                699,
                                542,
                                713
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        90,
                                        699,
                                        542,
                                        713
                                    ],
                                    "score": 1.0,
                                    "content": "Ontanon, Philip Pham, Anirudh Ravula, Qifan Wang, Li Yang, et al. Big bird: Transformers for longer",
                                    "type": "text",
                                    "cross_page": true
                                }
                            ],
                            "index": 42
                        },
                        {
                            "bbox": [
                                88,
                                711,
                                415,
                                724
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        88,
                                        711,
                                        415,
                                        724
                                    ],
                                    "score": 1.0,
                                    "content": "sequences. Advances in Neural Information Processing Systems, 33, 2020.",
                                    "type": "text",
                                    "cross_page": true
                                }
                            ],
                            "index": 43,
                            "is_list_end_line": true
                        }
                    ],
                    "index": 20,
                    "page_num": "page_12",
                    "page_size": [
                        612.0,
                        792.0
                    ],
                    "bbox_fs": [
                        76,
                        648,
                        541,
                        715
                    ]
                }
            ]
        },
        {
            "preproc_blocks": [
                {
                    "type": "text",
                    "bbox": [
                        67,
                        65,
                        545,
                        727
                    ],
                    "lines": [
                        {
                            "bbox": [
                                76,
                                73,
                                542,
                                87
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        76,
                                        73,
                                        542,
                                        87
                                    ],
                                    "score": 1.0,
                                    "content": "[3] Beidi Chen, Tri Dao, Eric Winsor, Zhao Song, Atri Rudra, and Christopher Ré. Scatterbrain: Unifying",
                                    "type": "text"
                                }
                            ],
                            "index": 0
                        },
                        {
                            "bbox": [
                                88,
                                85,
                                542,
                                98
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        88,
                                        85,
                                        542,
                                        98
                                    ],
                                    "score": 1.0,
                                    "content": "sparse and low-rank attention. In Advances in Neural Information Processing Systems (NeurIPS), 2021.",
                                    "type": "text"
                                }
                            ],
                            "index": 1
                        },
                        {
                            "bbox": [
                                75,
                                104,
                                542,
                                118
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        75,
                                        104,
                                        542,
                                        118
                                    ],
                                    "score": 1.0,
                                    "content": "[4] Krzysztof Marcin Choromanski, Valerii Likhosherstov, David Dohan, Xingyou Song, Andreea Gane,",
                                    "type": "text"
                                }
                            ],
                            "index": 2
                        },
                        {
                            "bbox": [
                                91,
                                117,
                                542,
                                129
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        91,
                                        117,
                                        542,
                                        129
                                    ],
                                    "score": 1.0,
                                    "content": "Tamas Sarlos, Peter Hawkins, Jared Quincy Davis, Afroz Mohiuddin, Lukasz Kaiser, et al. Rethinking",
                                    "type": "text"
                                }
                            ],
                            "index": 3
                        },
                        {
                            "bbox": [
                                89,
                                128,
                                527,
                                141
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        89,
                                        128,
                                        527,
                                        141
                                    ],
                                    "score": 1.0,
                                    "content": "attention with performers. In International Conference on Learning Representations (ICLR), 2020.",
                                    "type": "text"
                                }
                            ],
                            "index": 4
                        },
                        {
                            "bbox": [
                                76,
                                149,
                                541,
                                160
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        76,
                                        149,
                                        541,
                                        160
                                    ],
                                    "score": 1.0,
                                    "content": "[5] Tri Dao, Daniel Y. Fu, Stefano Ermon, Atri Rudra, and Christopher Ré. FlashAttention: Fast and",
                                    "type": "text"
                                }
                            ],
                            "index": 5
                        },
                        {
                            "bbox": [
                                90,
                                160,
                                541,
                                173
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        90,
                                        160,
                                        541,
                                        173
                                    ],
                                    "score": 1.0,
                                    "content": "memory-efficient exact attention with IO-awareness. In Advances in Neural Information Processing",
                                    "type": "text"
                                }
                            ],
                            "index": 6
                        },
                        {
                            "bbox": [
                                91,
                                172,
                                156,
                                184
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        91,
                                        172,
                                        156,
                                        184
                                    ],
                                    "score": 1.0,
                                    "content": "Systems, 2022.",
                                    "type": "text"
                                }
                            ],
                            "index": 7
                        },
                        {
                            "bbox": [
                                75,
                                191,
                                541,
                                204
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        75,
                                        191,
                                        541,
                                        204
                                    ],
                                    "score": 1.0,
                                    "content": "[6] Zhe Jia and Peter Van Sandt. Dissecting the Ampere GPU architecture via microbenchmarking. GPU",
                                    "type": "text"
                                }
                            ],
                            "index": 8
                        },
                        {
                            "bbox": [
                                91,
                                204,
                                223,
                                216
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        91,
                                        204,
                                        223,
                                        216
                                    ],
                                    "score": 1.0,
                                    "content": "Technology Conference, 2021.",
                                    "type": "text"
                                }
                            ],
                            "index": 9
                        },
                        {
                            "bbox": [
                                75,
                                222,
                                542,
                                234
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        75,
                                        222,
                                        542,
                                        234
                                    ],
                                    "score": 1.0,
                                    "content": "[7] Zhe Jia, Marco Maggioni, Benjamin Staiger, and Daniele P Scarpazza. Dissecting the nvidia Volta GPU",
                                    "type": "text"
                                }
                            ],
                            "index": 10
                        },
                        {
                            "bbox": [
                                89,
                                234,
                                429,
                                247
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        89,
                                        234,
                                        429,
                                        247
                                    ],
                                    "score": 1.0,
                                    "content": "architecture via microbenchmarking. arXiv preprint arXiv:1804.06826, 2018.",
                                    "type": "text"
                                }
                            ],
                            "index": 11
                        },
                        {
                            "bbox": [
                                75,
                                253,
                                542,
                                267
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        75,
                                        253,
                                        542,
                                        267
                                    ],
                                    "score": 1.0,
                                    "content": "[8] Angelos Katharopoulos, Apoorv Vyas, Nikolaos Pappas, and François Fleuret. Transformers are RNNs:",
                                    "type": "text"
                                }
                            ],
                            "index": 12
                        },
                        {
                            "bbox": [
                                90,
                                265,
                                542,
                                279
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        90,
                                        265,
                                        542,
                                        279
                                    ],
                                    "score": 1.0,
                                    "content": "Fast autoregressive transformers with linear attention. In International Conference on Machine Learning,",
                                    "type": "text"
                                }
                            ],
                            "index": 13
                        },
                        {
                            "bbox": [
                                89,
                                277,
                                231,
                                289
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        89,
                                        277,
                                        231,
                                        289
                                    ],
                                    "score": 1.0,
                                    "content": "pages 5156–5165. PMLR, 2020.",
                                    "type": "text"
                                }
                            ],
                            "index": 14
                        },
                        {
                            "bbox": [
                                76,
                                297,
                                542,
                                308
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        76,
                                        297,
                                        542,
                                        308
                                    ],
                                    "score": 1.0,
                                    "content": "[9] Nikita Kitaev, Łukasz Kaiser, and Anselm Levskaya. Reformer: The efficient transformer. In The",
                                    "type": "text"
                                }
                            ],
                            "index": 15
                        },
                        {
                            "bbox": [
                                91,
                                309,
                                364,
                                321
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        91,
                                        309,
                                        364,
                                        321
                                    ],
                                    "score": 1.0,
                                    "content": "International Conference on Machine Learning (ICML), 2020.",
                                    "type": "text"
                                }
                            ],
                            "index": 16
                        },
                        {
                            "bbox": [
                                71,
                                328,
                                542,
                                340
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        71,
                                        328,
                                        542,
                                        340
                                    ],
                                    "score": 1.0,
                                    "content": "[10] Benjamin Lefaudeux, Francisco Massa, Diana Liskovich, Wenhan Xiong, Vittorio Caggiano, Sean Naren,",
                                    "type": "text"
                                }
                            ],
                            "index": 17
                        },
                        {
                            "bbox": [
                                90,
                                340,
                                541,
                                352
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        90,
                                        340,
                                        541,
                                        352
                                    ],
                                    "score": 1.0,
                                    "content": "Min Xu, Jieru Hu, Marta Tintore, Susan Zhang, Patrick Labatut, and Daniel Haziza. xformers: A modular",
                                    "type": "text"
                                }
                            ],
                            "index": 18
                        },
                        {
                            "bbox": [
                                88,
                                351,
                                542,
                                365
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        88,
                                        351,
                                        542,
                                        365
                                    ],
                                    "score": 1.0,
                                    "content": "and hackable transformer modelling library. https://github.com/facebookresearch/xformers, 2022.",
                                    "type": "text"
                                }
                            ],
                            "index": 19
                        },
                        {
                            "bbox": [
                                70,
                                370,
                                542,
                                384
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        370,
                                        542,
                                        384
                                    ],
                                    "score": 1.0,
                                    "content": "[11] Maxim Milakov and Natalia Gimelshein. Online normalizer calculation for softmax. arXiv preprint",
                                    "type": "text"
                                }
                            ],
                            "index": 20
                        },
                        {
                            "bbox": [
                                90,
                                383,
                                198,
                                395
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        90,
                                        383,
                                        198,
                                        395
                                    ],
                                    "score": 1.0,
                                    "content": "arXiv:1805.02867, 2018.",
                                    "type": "text"
                                }
                            ],
                            "index": 21
                        },
                        {
                            "bbox": [
                                70,
                                402,
                                368,
                                415
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        402,
                                        368,
                                        415
                                    ],
                                    "score": 1.0,
                                    "content": "[12] OpenAI. Gpt-4 technical report. ArXiv, abs/2303.08774, 2023.",
                                    "type": "text"
                                }
                            ],
                            "index": 22
                        },
                        {
                            "bbox": [
                                70,
                                420,
                                542,
                                434
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        420,
                                        398,
                                        434
                                    ],
                                    "score": 1.0,
                                    "content": "[13] Markus N Rabe and Charles Staats. Self-attention does not need ",
                                    "type": "text"
                                },
                                {
                                    "bbox": [
                                        399,
                                        422,
                                        424,
                                        433
                                    ],
                                    "score": 0.92,
                                    "content": "O(n^{2})",
                                    "type": "inline_equation",
                                    "height": 11,
                                    "width": 25
                                },
                                {
                                    "bbox": [
                                        424,
                                        420,
                                        542,
                                        434
                                    ],
                                    "score": 1.0,
                                    "content": " memory. arXiv preprint",
                                    "type": "text"
                                }
                            ],
                            "index": 23
                        },
                        {
                            "bbox": [
                                88,
                                433,
                                199,
                                446
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        88,
                                        433,
                                        199,
                                        446
                                    ],
                                    "score": 1.0,
                                    "content": "arXiv:2112.05682, 2021.",
                                    "type": "text"
                                }
                            ],
                            "index": 24
                        },
                        {
                            "bbox": [
                                70,
                                452,
                                542,
                                465
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        452,
                                        542,
                                        465
                                    ],
                                    "score": 1.0,
                                    "content": "[14] Aurko Roy, Mohammad Saffar, Ashish Vaswani, and David Grangier. Efficient content-based sparse",
                                    "type": "text"
                                }
                            ],
                            "index": 25
                        },
                        {
                            "bbox": [
                                89,
                                464,
                                542,
                                478
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        89,
                                        464,
                                        542,
                                        478
                                    ],
                                    "score": 1.0,
                                    "content": "attention with routing transformers. Transactions of the Association for Computational Linguistics, 9:",
                                    "type": "text"
                                }
                            ],
                            "index": 26
                        },
                        {
                            "bbox": [
                                91,
                                477,
                                148,
                                489
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        91,
                                        477,
                                        148,
                                        489
                                    ],
                                    "score": 1.0,
                                    "content": "53–68, 2021.",
                                    "type": "text"
                                }
                            ],
                            "index": 27
                        },
                        {
                            "bbox": [
                                70,
                                495,
                                542,
                                509
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        495,
                                        542,
                                        509
                                    ],
                                    "score": 1.0,
                                    "content": "[15] Noam Shazeer. Fast transformer decoding: One write-head is all you need. arXiv preprint",
                                    "type": "text"
                                }
                            ],
                            "index": 28
                        },
                        {
                            "bbox": [
                                91,
                                509,
                                197,
                                519
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        91,
                                        509,
                                        197,
                                        519
                                    ],
                                    "score": 1.0,
                                    "content": "arXiv:1911.02150, 2019.",
                                    "type": "text"
                                }
                            ],
                            "index": 29
                        },
                        {
                            "bbox": [
                                70,
                                527,
                                542,
                                540
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        527,
                                        542,
                                        540
                                    ],
                                    "score": 1.0,
                                    "content": "[16] Mohammad Shoeybi, Mostofa Patwary, Raul Puri, Patrick LeGresley, Jared Casper, and Bryan Catanzaro.",
                                    "type": "text"
                                }
                            ],
                            "index": 30
                        },
                        {
                            "bbox": [
                                91,
                                539,
                                542,
                                553
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        91,
                                        539,
                                        542,
                                        553
                                    ],
                                    "score": 1.0,
                                    "content": "Megatron-LM: Training multi-billion parameter language models using model parallelism. arXiv preprint",
                                    "type": "text"
                                }
                            ],
                            "index": 31
                        },
                        {
                            "bbox": [
                                90,
                                551,
                                198,
                                563
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        90,
                                        551,
                                        198,
                                        563
                                    ],
                                    "score": 1.0,
                                    "content": "arXiv:1909.08053, 2019.",
                                    "type": "text"
                                }
                            ],
                            "index": 32
                        },
                        {
                            "bbox": [
                                70,
                                569,
                                542,
                                583
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        569,
                                        542,
                                        583
                                    ],
                                    "score": 1.0,
                                    "content": "[17] Philippe Tillet, Hsiang-Tsung Kung, and David Cox. Triton: an intermediate language and compiler for",
                                    "type": "text"
                                }
                            ],
                            "index": 33
                        },
                        {
                            "bbox": [
                                90,
                                582,
                                542,
                                596
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        90,
                                        582,
                                        542,
                                        596
                                    ],
                                    "score": 1.0,
                                    "content": "tiled neural network computations. In Proceedings of the 3rd ACM SIGPLAN International Workshop",
                                    "type": "text"
                                }
                            ],
                            "index": 34
                        },
                        {
                            "bbox": [
                                89,
                                593,
                                403,
                                609
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        89,
                                        593,
                                        403,
                                        609
                                    ],
                                    "score": 1.0,
                                    "content": "on Machine Learning and Programming Languages, pages 10–19, 2019.",
                                    "type": "text"
                                }
                            ],
                            "index": 35
                        },
                        {
                            "bbox": [
                                70,
                                612,
                                542,
                                626
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        612,
                                        542,
                                        626
                                    ],
                                    "score": 1.0,
                                    "content": "[18] Ashish Vaswani, Noam Shazeer, Niki Parmar, Jakob Uszkoreit, Llion Jones, Aidan N Gomez, Łukasz",
                                    "type": "text"
                                }
                            ],
                            "index": 36
                        },
                        {
                            "bbox": [
                                90,
                                624,
                                542,
                                639
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        90,
                                        624,
                                        542,
                                        639
                                    ],
                                    "score": 1.0,
                                    "content": "Kaiser, and Illia Polosukhin. Attention is all you need. Advances in neural information processing",
                                    "type": "text"
                                }
                            ],
                            "index": 37
                        },
                        {
                            "bbox": [
                                90,
                                638,
                                171,
                                649
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        90,
                                        638,
                                        171,
                                        649
                                    ],
                                    "score": 1.0,
                                    "content": "systems, 30, 2017.",
                                    "type": "text"
                                }
                            ],
                            "index": 38
                        },
                        {
                            "bbox": [
                                70,
                                655,
                                541,
                                669
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        655,
                                        541,
                                        669
                                    ],
                                    "score": 1.0,
                                    "content": "[19] Sinong Wang, Belinda Z Li, Madian Khabsa, Han Fang, and Hao Ma. Linformer: Self-attention with",
                                    "type": "text"
                                }
                            ],
                            "index": 39
                        },
                        {
                            "bbox": [
                                90,
                                669,
                                347,
                                681
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        90,
                                        669,
                                        347,
                                        681
                                    ],
                                    "score": 1.0,
                                    "content": "linear complexity. arXiv preprint arXiv:2006.04768, 2020.",
                                    "type": "text"
                                }
                            ],
                            "index": 40
                        },
                        {
                            "bbox": [
                                70,
                                686,
                                541,
                                701
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        70,
                                        686,
                                        541,
                                        701
                                    ],
                                    "score": 1.0,
                                    "content": "[20] Manzil Zaheer, Guru Guruganesh, Kumar Avinava Dubey, Joshua Ainslie, Chris Alberti, Santiago",
                                    "type": "text"
                                }
                            ],
                            "index": 41
                        },
                        {
                            "bbox": [
                                90,
                                699,
                                542,
                                713
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        90,
                                        699,
                                        542,
                                        713
                                    ],
                                    "score": 1.0,
                                    "content": "Ontanon, Philip Pham, Anirudh Ravula, Qifan Wang, Li Yang, et al. Big bird: Transformers for longer",
                                    "type": "text"
                                }
                            ],
                            "index": 42
                        },
                        {
                            "bbox": [
                                88,
                                711,
                                415,
                                724
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        88,
                                        711,
                                        415,
                                        724
                                    ],
                                    "score": 1.0,
                                    "content": "sequences. Advances in Neural Information Processing Systems, 33, 2020.",
                                    "type": "text"
                                }
                            ],
                            "index": 43
                        }
                    ],
                    "index": 21.5
                }
            ],
            "layout_bboxes": [],
            "page_idx": 13,
            "page_size": [
                612.0,
                792.0
            ],
            "_layout_tree": [],
            "images": [],
            "tables": [],
            "interline_equations": [],
            "discarded_blocks": [
                {
                    "type": "discarded",
                    "bbox": [
                        300,
                        742,
                        311,
                        751
                    ],
                    "lines": [
                        {
                            "bbox": [
                                298,
                                741,
                                313,
                                753
                            ],
                            "spans": [
                                {
                                    "bbox": [
                                        298,
                                        741,
                                        313,
                                        753
                                    ],
                                    "score": 1.0,
                                    "content": "14",
                                    "type": "text"
                                }
                            ]
                        }
                    ]
                }
            ],
            "need_drop": false,
            "drop_reason": [],
            "para_blocks": [
                {
                    "type": "list",
                    "bbox": [
                        67,
                        65,
                        545,
                        727
                    ],
                    "lines": [],
                    "index": 21.5,
                    "page_num": "page_13",
                    "page_size": [
                        612.0,
                        792.0
                    ],
                    "bbox_fs": [
                        70,
                        73,
                        542,
                        724
                    ],
                    "lines_deleted": true
                }
            ]
        }
    ],
    "_parse_type": "txt",
    "_version_name": "1.3.2",
    "lang": "en"
}